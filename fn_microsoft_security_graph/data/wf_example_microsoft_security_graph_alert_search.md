<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-circuits codegen
-->

# Example: Microsoft Security Graph Alert Search

## Function - Microsoft Security Graph Alert Search

### API Name
`microsoft_security_graph_alert_search`

### Output Name
``

### Message Destination
`microsoft_security_graph_message_destination`

### Pre-Processing Script
```python
import java.util.Date as Date

search = "filter="
conjunction = False

if rule.properties.microsoft_security_graph_query_start_datetime:
  start = Date(rule.properties.microsoft_security_graph_query_start_datetime)
  start_ts = str(start.toInstant())
  start_filter = "createdDateTime%20ge%20{}".format(start_ts)
  search = search + start_filter
  conjunction = True

if rule.properties.microsoft_security_graph_query_end_datetime:
  end = Date(rule.properties.microsoft_security_graph_query_end_datetime)
  end_ts = str(end.toInstant())
  end_filter = "createdDateTime%20le%20{}".format(end_ts)
  if conjunction: search = search + "%20and%20"
  search = search + end_filter
  conjunction = True

if artifact.type == "User Account":
  artifact_filter = "userStates/any(user:%20user/accountName%20eq%20'{}')".format(artifact.value)
  if conjunction: search = search + "%20and%20"
  search = search + artifact_filter
  conjunction = True


inputs.microsoft_security_graph_alert_search_query = search
```

### Post-Processing Script
```python
alerts = results.content.value
note = "There are <b>{}</b> alerts based on the artifact of value <b>{}</b>.".format(str(len(alerts)), artifact.value)

if len(alerts) > 0:
  note = note + "<br><b>Alert ids:</b>"
  for alert in alerts:
    note = note + "<br>- {}".format(alert.id)

incident.addNote(helper.createRichText(note))
```

---

