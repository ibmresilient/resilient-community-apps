<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v49.0.4368
-->

# Playbook - VirusTotal: Scan Artifact (PB)

### API Name
`virustotal_scan_artifact`

### Status
`enabled`

### Activation Type
`manual`

### Object Type
`artifact`

### Description
Perform a VirusTotal scan an artifact and write the results to a note for review.  

In some cases, the scan results may not be available immediately. 
In those cases, a link to the VirusTotal report is provided for review when complete. 


---
## Function - VirusTotal

### API Name
`virustotal`

### Output Name
`vt_scan_results`

### Message Destination
`fn_virustotal`

### Function-Input Script
```python
typeLookup = { 'Email Attachment': 'file', 'Malware Sample': 'file', 'Malware MD5 Hash': 'hash', 'Malware SHA-1 Hash': 'hash', 'Malware SHA-256 Hash': 'hash', 'Other File': 'file', 'RCF 822 Email Message Fife': 'file', 'File Name': 'filename',
 'URL': 'url', 'IP Address': 'ip', 'DNS Name':'domain'}
if artifact.type in typeLookup:
  inputs.vt_type = typeLookup.get(artifact.type, artifact.type)
else:
  inputs.vt_type = artifact.type

inputs.incident_id = incident.id
inputs.artifact_id = artifact.id
inputs.vt_data = artifact.value
```

---

## Local script - VirusTotal: Write artifact scan to a note

### Description
Write VirusTotal scan results to an incident note.

### Script Type
`Local script`

### Objet Type
`artifact`

### Script Content
```python
import datetime

results = playbook.functions.results.vt_scan_results
  
msg = u"<p>VirusTotal scan of {0} Artifact: {1}</p>".format(artifact.type, artifact.value)
stats = results.scan.data.attributes.get("last_analysis_stats", None)
if stats is not None:

    msg = msg + u"""<p>Malicious: <span style='color:red'>{}</span>
Suspicious: {}
Harmless:   {}
Undetected: {}
Timeout:    {}</p>""".format(stats.get('malicious'), stats.get('suspicious'),stats.get('harmless'), stats.get('undetected'), stats.get('timeout'))
    last_analysis_date = results.scan.data.attributes.get("last_analysis_date", None)
    if last_analysis_date is not None:
        last_analysis_date_str = datetime.datetime.fromtimestamp(last_analysis_date).strftime('%Y-%b-%d %H:%M:%S')
        msg = msg + u"""<p>Last analysis date: {}</p>""".format(last_analysis_date_str)

incident.addNote(helper.createRichText(u"<div>{}</div>".format(msg)))

last_http_response_content_sha256 = results.scan.data.attributes.get("last_http_response_content_sha256", None)
if last_http_response_content_sha256 is not None:
    incident.addArtifact('Malware SHA-256 Hash', last_http_response_content_sha256, "Created by VirusTotal scan of artifact type: {0} value: {1}".format(artifact.type, artifact.value))

sha256 = results.scan.data.attributes.get("sha256", None) 
if sha256 is not None:
  incident.addArtifact('Malware SHA-256 Hash', sha256, "Created by VirusTotal scan of artifact type: {0} value: {1}".format(artifact.type, artifact.value))

md5 = results.scan.data.attributes.get("md5", None)
if md5is not None:
  incident.addArtifact('Malware MD5 Hash', md5, "Created by VirusTotal scan of artifact type: {0} value: {1}".format(artifact.type, artifact.value))

sha1 = results.scan.data.attributes.get("sha1", None)
if sha1 is not None:
  incident.addArtifact('Malware SHA-1 Hash', sha1, None, "Created by VirusTotal scan of artifact type: {0} value: {1}".format(artifact.type, artifact.value))
  
```

---
