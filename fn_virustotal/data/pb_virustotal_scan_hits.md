<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v49.0.4368
-->

# Playbook - Example VirusTotal: Scan Hits (PB)

### API Name
`virustotal_scan_hits`

### Status
`disabled`

### Activation Type
`automatic`

### Object Type
`artifact`

### Description
Perform automatic lookups for artifacts including IP addresses, hashes, domains, and URLS and creates a hit for the artifact if it is deemed potentially malicious by VirusTotal.


---
## Function - VirusTotal

### API Name
`virustotal`

### Output Name
`vt_scan_results`

### Message Destination
`fn_virustotal`

### Function-Input Script
```python
typeLookup = { 'Email Attachment': 'file', 'Malware Sample': 'file', 'Malware MD5 Hash': 'hash', 'Malware SHA-1 Hash': 'hash', 'Malware SHA-256 Hash': 'hash', 'Other File': 'file', 'RCF 822 Email Message File': 'file', 'File Name': 'filename',
 'URL': 'url', 'IP Address': 'ip', 'DNS Name':'domain'}
if artifact.type in typeLookup:
  inputs.vt_type = typeLookup.get(artifact.type, artifact.type)
else:
  inputs.vt_type = artifact.type

inputs.incident_id = incident.id
inputs.artifact_id = artifact.id
inputs.vt_data = artifact.value
```

---

## Local script - VirusTotal: Create artifact hits

### Description
Create artifact hits on artifacts the VirusTotal has deemed malicious. Created malware hash artifacts if found in the VT scan data results.

### Script Type
`Local script`

### Objet Type
`artifact`

### Script Content
```python
results = playbook.functions.results.vt_scan_results

if results:
  scan = results.get("scan", None)
  if scan is not None and scan.get("data", None) is not None:
    data = scan.get("data", None)
    attributes = data.get("attributes", None)
    if attributes is not None:
      last_analysis_stats = attributes.get("last_analysis_stats", None)
      if last_analysis_stats is not None:
        malicious = last_analysis_stats.get("malicious", None)
        if malicious is not None and malicious > 0:
          hit = [
            {
              "name": "Artifact Value",
              "type": "string",
              "value": "{}".format(artifact.value)
            }
          ]
          artifact.addHit("VirusTotal hits added.", hit)
          if attributes.get("last_http_response_content_sha256", None) is not None:
            incident.addArtifact('Malware SHA-256 Hash', attributes.get("last_http_response_content_sha256", None), "Created by VirusTotal.")
            
          if attributes.get('md5', None) is not None:
            incident.addArtifact('Malware MD5 Hash', attributes.get('md5'), "Created by VirusTotal.")
  
          if attributes.get('sha1', None) is not None:
            incident.addArtifact('Malware SHA-1 Hash', attributes.get('sha1'), "Created by VirusTotal.")
    
          if attributes.get('sha256', None) is not None:
            incident.addArtifact('Malware SHA-256 Hash', attributes.get('sha256'), "Created by VirusTotal.")
        else:
          incident.addNote('VirusTotal has not found a hit.')
      else:
        incident.addNote('VirusTotal has failed. - no last_analysis_stats')
    else:
      incident.addNote('VirusTotal has failed - no attributes.')
  else:
    incident.addNote('VirusTotal has failed - no data.')
else:
  incident.addNote('VirusTotal has failed - no results.')
      
```

---
