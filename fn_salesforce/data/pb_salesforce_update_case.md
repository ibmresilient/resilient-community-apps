<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v49.1.51
-->

# Playbook - Salesforce: Update Case in SOAR

### API Name
`salesforce_update_case`

### Status
`enabled`

### Activation Type
`automatic`

### Object Type
`incident`

### Description
Automatic playbook to update the SOAR case with information from Salesforce.


---
## Function - Salesforce: Get Case

### API Name
`salesforce_get_case`

### Output Name
`salesforce_case_results`

### Message Destination
`fn_salesforce`

### Function-Input Script
```python
inputs.salesforce_case_id = incident.properties.salesforce_case_id
```

---

## Local script - Salesforce: Update case in SOAR

### Description
Update the case in SOAR with the data from the case in Salesforce.

### Script Type
`Local script`

### Objet Type
`incident`

### Script Content
```python
results = playbook.functions.results.salesforce_case_results

TYPE_LOOKUP = {
  'None': "TBD / Unknown",
  'Communication error (fax; email)' : 'Communication error (fax; email)',
  'Customization Packages (internal)': 'Customization Packages (internal)',
  'Denial of Service':                 'Denial of Service',
  'Improper disposal: digital assets': 'Improper disposal: digital assets',
  'Improper disposal: documents / files / records': 'Improper disposal: documents / files / records',
  'Lost documents / files / records':  'Lost documents / files / records',
  'Lost PC / laptop / tablet':         'Lost PC / laptop / tablet',
  'Lost storage device / media':       'Lost storage device / media',
  'Malware':                           'Malware',
  'Not an Issue':                      'Not an Issue',
  'Other':                             'Other',
  'Phishing':                          'Phishing',
  'Stolen documents / files / records':'Stolen documents / files / records',
  'Stolen PC / laptop / tablet':       'Stolen PC / laptop / tablet',
  'Stolen PDA / smartphone':           'Stolen PDA / smartphone',
  'Stolen storage device / media':     'Stolen storage device / media',
  'System Intrusion':                  'System Intrusion',
  'TBD / Unknown':                     'TBD / Unknown',
  'Vendor / 3rd party error':          'Vendor / 3rd party error'
}


if not results.success:
    incident.addNote("Salesforce: Update custom fields: Unable to get case data to update custom fields.")
else:
    content = results.get("content", {})
    sf_case =content.get("salesforce_case")
    incident.properties.salesforce_account_id = sf_case.get("AccountId")
    incident.properties.salesforce_contact_id = sf_case.get("ContactId")
    incident.properties.salesforce_owner_id = sf_case.get("OwnerId")
    incident.properties.salesforce_case_number = sf_case.get("CaseNumber")
    incident.properties.salesforce_case_type = TYPE_LOOKUP.get(sf_case.get("Type"), "None")
    incident.properties.salesforce_contact_phone = sf_case.get("ContactPhone")
    incident.properties.salesforce_contact_email = sf_case.get("ContactEmail")    
    incident.properties.salesforce_contact_fax = sf_case.get("ContactFax")
    incident.properties.salesforce_supplied_name = sf_case.get("SuppliedName")
    incident.properties.salesforce_supplied_phone = sf_case.get("SuppliedPhone")
    incident.properties.salesforce_supplied_email = sf_case.get("SuppliedEmail")    
    incident.properties.salesforce_supplied_company = sf_case.get("SuppliedCompany")
    incident.properties.salesforce_origin = sf_case.get("Origin")
    incident.properties.salesforce_status = sf_case.get("Status")
    entity_url = sf_case.get("entity_url", None)
    if entity_url:
      incident.properties.salesforce_case_link = "<a target='_blank' href='{0}'>{1}</a>".format(entity_url, sf_case.get("CaseNumber"))
      
    # Add Salesforce case Comments as a note
    sf_case_comments = sf_case.get("Comments", None)
    if sf_case_comments:
        incident.addNote(helper.createRichText("<b>Created by Salesforce:</b><br> {}".format(sf_case_comments)))
```

---
