<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-circuits codegen
-->

# Example: Shodan Host Lookup

## Function - Shodan Lookup

### API Name
`shodan_lookup`

### Output Name
`None`

### Message Destination
`fn_shodan`

### Pre-Processing Script
```python
inputs.shodan_lookuphost = artifact.value
```

### Post-Processing Script
```python
def append_artifact_description(the_artifact, the_text):
  """Appends the_text to the_artifact.description safely
  handling unicode"""
  
  new_description = u""
  
  if the_artifact.description is None:
    current_description = None
  else:
    current_description = the_artifact.description.get("content", None)

  if current_description is not None:
    new_description = u"{0}<br>---<br>{1}".format(unicode(current_description), unicode(the_text))

  else:
    new_description = u"{0}".format(unicode(the_text))

  the_artifact.description = helper.createRichText(new_description)

comment = u"""<b>Shodan Host Lookup</b> has complete
            <br><b>Found:</b> <b style="color:{found_color}">{was_found}</b>
            <br><b>Artifact Type:</b> {artifact_type}
            <br><b>Artifact Value:</b> {artifact_value}"""

if results.success:
  results_content = results.get("content", {})
  comment = comment.format(found_color="#ff402b", was_found="Yes", artifact_type=artifact.type, artifact_value=artifact.value)
  comment += u"""<br><b>Organization:</b> {0}""".format(results_content.get("org", "Unknown"))
  comment += u"""<br><b>ISP:</b> {0}""".format(results_content.get("isp", "Unknown"))
  comment += u"""<br><b>Location:</b> {0}, {1}""".format(results_content.get("city", "Unknown City"), results_content.get("country_name", "Unknown Country"))
  comment += u"""<br><b>Vulnerabilities:</b> {0}""".format(results_content.get("vulns", "None Found"))
  comment += u"""<br><b>Ports:</b> {0}""".format(results_content.get("ports", "None Found"))
  comment += u"""<br><b>Link:</b> <a target='blank' href='{0}'>{0}</a>""".format(results.get("shodan_url", "404"))

else:
  comment = comment.format(found_color="#45bc27", was_found="No", artifact_type=artifact.type, artifact_value=artifact.value)
  comment += u"""<br><b>Reason:</b> {reason}""".format(reason=results.get("reason", "Not found in Shodan"))
  
append_artifact_description(artifact, comment)
incident.addNote(helper.createRichText(comment))
```

---

