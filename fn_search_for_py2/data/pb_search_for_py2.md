<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v51.0.5.0.1475
-->

# Playbook - Search for Python 2

### API Name
`search_for_py2`

### Status
`enabled`

### Activation Type
`Manual`

### Activation Conditions
`-`

### Activation Form Elements
| Input Field Label | API Name | Element Type | Tooltip | Requirement |
| ----------------- | -------- | ------------ | ------- | ----------- |
| Clear Database | `clear_database` | select | - | Optional |
| Item Id | `item_id` | number | script, workflow or playbook id | Optional |
| Item Name | `item_name` | text | Display name or script, workflow or playbook | Optional |
| Item Type | `item_type` | select | - | Always |
| Search Apps | `search_tags` | text | comma separated list app API names to allow | Optional |

### Object Type
`incident`

### Description
Search for Python2 in scripts, workflows and playbooks. Python 2 will be removed in an upcoming version of SOAR.


---
## Function - Search for Python 2

### API Name
`fn_search_for_py2`

### Output Name
`search_for_py2_results`

### Message Destination
`fn_search_for_py2`

### Function-Input Script
```python
inputs.py2_inc_id = incident.id
inputs.py2_item_id = playbook.inputs.item_id
inputs.py2_item_name = playbook.inputs.item_name
inputs.py2_item_type = playbook.inputs.item_type

inputs.py2_search_tags = playbook.inputs.search_tags
inputs.py2_clear_datatable = bool(playbook.inputs.clear_database == "Yes")
```

---

## Local script - search_for_py2_results

### Description


### Script Type
`Local script`

### Object Type
`incident`

### Script Content
```python
from datetime import datetime

results = playbook.functions.results.search_for_py2_results

PY2_LOOKUP = {
  "PY2_UNCONVERTIBLE": "Python 2 execution found, but script complexity prevents further analysis. Please review and, in some cases, changing the setting to Python 3 is the only change needed.",
  "PY2_CONVERTIBLE": "{item_type} set to run Python 2. This {item_type} can be easily changed to use Python 3. Check function input scripts, local scripts, and scripts used in conditions. Mostly likely the only change needed is to convert all language settings to Python 3.",
  "PY2_ITERS": "Python 2 iters found. Convert to use .items(), .keys(), and .values() as appropriate",
  "PY2_JAVA_UTIL_DATE": "'import java.util.Date' found. Change to 'from datetime import datetime' and datetime functions such as 'datetime.now()'.",
  "PY2_UNICODE": "Unicode strings found ('u' string prefix). This can remain for Python 3, but it's cleaner to remove."
}

def display_db_row(db, now, item_type, item_id, item_name, tags, attributes, components):
  row = incident.addRow(db)
  row["date"] = now
  row["status"] = "Unconverted"
  row["item_type"] = item_type
  row["item_id"] = int(item_id)
  row["item_name"] = make_url(item_type, item_id, item_name)
  if tags:
    row["app_tags"] = ", ".join([str(tag.get("tag_handle"))  for tag in tags])
  msg = []
  for attr in attributes:
    row[attr.lower()] = "Yes"
    msg.append(PY2_LOOKUP.get(attr, "").format(item_type=item_type.title()))
  row["py2_components"] = helper.createPlainText("\n".join(components)) if components else ""
  row["notes"] = "\n".join(msg)

def display_db(db="search_for_py2_results"):
  now = int(datetime.now().timestamp()*1000)
  found = False
  for item_type in ["script", "playbook", "workflow"]:
    for item_id, item_info in results.content.get(item_type, []).items():
      found = True
      display_db_row(db,
                     now,
                     item_type,
                     item_id,
                     item_info.get("display_name") if item_info.get("display_name") else item_info.get("name"),
                     item_info.get("tags", []),
                     item_info.get("attributes", []),
                     item_info.get("components", []))
             
  if not found:
    item_type_msg = "scripts, workflows, or playbooks" if playbook.inputs.item_type == "all" else f"{playbook.inputs.item_type}s"
    info = ""
    if playbook.inputs.item_id:
      info = f"for ID: {playbook.inputs.item_id}"
    elif playbook.inputs.item_name:
      info = f"for name: {playbook.inputs.item_name}"
    elif playbook.inputs.search_tags:
      info = f"for app(s): {playbook.inputs.search_tags}"
    
    incident.addNote(f"No Python 2 {item_type_msg} found {info}")

def make_url(item_type, item_id, item_name):
  if item_type == "script":
    return f"<a target='_blank' href='#customize?tab=scripts&script={item_id}'>{item_name}</a>"

  if item_type == "workflow":
    return f"<a target='_blank' href='#customize?tab=workflows&workflow={item_id}'>{item_name}</a>"

  if item_type == "playbook":
    return f"<a target='_blank' href='#playbooks/designer/{item_id}'>{item_name}</a>"

  return item_name

# S T A R T
if results.success:
    display_db()
else:
    incident.addNote(f"Search for Python 2 failed: {results.reason}")

```

---

