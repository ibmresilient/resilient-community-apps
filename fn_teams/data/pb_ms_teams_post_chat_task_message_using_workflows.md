<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v51.0.7.0.1603
-->

# Playbook - MS Teams: Post Chat Task Message (using Workflows)

### API Name
`ms_teams_post_chat_task_message_using_workflows`

### Status
`enabled`

### Activation Type
`Manual`

### Activation Conditions
`-`

### Activation Form Elements
| Input Field Label | API Name | Element Type | Tooltip | Requirement |
| ----------------- | -------- | ------------ | ------- | ----------- |
| Channel label | `teams_channel` | text | Channel matches a label in app.config | Always |
| Message | `teams_message` | textarea | - | Always |

### Object Type
`task`

### Description
Post a simple message to a Teams channel using the new Workflows model


---
## Function - MS Teams: Post Message for Workflows

### API Name
`ms_teams_post_message_workflows`

### Output Name
`post_message_workflow_results`

### Message Destination
`fn_teams`

### Function-Input Script
```python
import json
import datetime

ADAPTIVE_CARD_TYPE = "AdaptiveCard"
ADAPTIVE_CARD_VERSION = "1.4"

# S T A R T

body = {
  "type": "TextBlock",
  "text": playbook.inputs.teams_message.content
}

adaptive_card = {
  "contentType": "application/vnd.microsoft.card.adaptive",
  "content": {
    "$schema": "http://adaptivecards.io/schemas/adaptive-card.json",
    "type": ADAPTIVE_CARD_TYPE,
    "version": ADAPTIVE_CARD_VERSION,
    "body": [body],
    "actions": []
  }
}

inputs.incident_id = incident.id
inputs.task_id = task.id
inputs.teams_payload = json.dumps(adaptive_card)
inputs.teams_channel = playbook.inputs.teams_channel

```

---

## Local script - post chat message workflow results

### Description


### Script Type
`Local script`

### Object Type
`task`

### Script Content
```python
FN_NAME = "ms_teams_post_message_workflows"
WF_NAME = "MS Teams: Post Chat Task Message (using Workflows)"

results = playbook.functions.results.post_message_workflow_results

if not results.get("success"):
  text = f"MS Teams Playbook: <b>{WF_NAME}</b><br>Failed for SOAR function <b>{FN_NAME}</b><br>"
  text += "Unable to Post message"
  fail_reason = results.get("reason")
  if fail_reason:
    text = f"{text}:\n\tFailure reason: {fail_reason}"
  incident.addNote(helper.createRichText(text))
else:
  text = f"MS Teams Playbook: <b>{WF_NAME}</b><br>Successfully Executed for SOAR function <b>{FN_NAME}</b><br>"
  text += f"Successfully queued workflow message to channel: {results.get('inputs', {}).get('teams_channel')}."
  incident.addNote(text)

```

---

