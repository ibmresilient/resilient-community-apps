<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-circuits codegen
-->

# Defender ATP Alerts by Machine

## Function - Defender Alert Search

### API Name
`defender_alert_search`

### Output Name
`None`

### Message Destination
`fn_microsoft_defender`

### Pre-Processing Script
```python
inputs.defender_machine_id = row['machine_id']
inputs.defender_alert_lastseen = rule.properties.defender_alert_last_seen
inputs.defender_alert_lastupdatetime = rule.properties.defender_alert_lastupdatetime
inputs.defender_alert_severity = str(rule.properties.defender_alert_severity)
inputs.defender_alert_result_max = rule.properties.defender_max_results

```

### Post-Processing Script
```python
"""
"value" = {
    "@odata.context": "https://api.securitycenter.microsoft.com/api/$metadata#Alerts",
    "value": [
        {
            "id": "da637308392288907382_-880718168",
            "incidentId": 7587,
            "investigationId": 723156,
            "assignedTo": "secop123@contoso.com",
            "severity": "Low",
            "status": "New",
            "classification": "TruePositive",
            "determination": null,
            "investigationState": "Queued",
            "detectionSource": "WindowsDefenderAv",
            "category": "SuspiciousActivity",
            "threatFamilyName": "Meterpreter",
            "title": "Suspicious 'Meterpreter' behavior was detected",
            "description": "Malware and unwanted software are undesirable applications that perform annoying, disruptive, or harmful actions on affected machines. Some of these undesirable applications can replicate and spread from one machine to another. Others are able to receive commands from remote attackers and perform activities associated with cyber attacks.\n\nA malware is considered active if it is found running on the machine or it already has persistence mechanisms in place. Active malware detections are assigned higher severity ratings.\n\nBecause this malware was active, take precautionary measures and check for residual signs of infection.",
            "alertCreationTime": "2020-07-20T10:53:48.7657932Z",
            "firstEventTime": "2020-07-20T10:52:17.6654369Z",
            "lastEventTime": "2020-07-20T10:52:18.1362905Z",
            "lastUpdateTime": "2020-07-20T10:53:50.19Z",
            "resolvedTime": null,
            "machineId": "12ee6dd8c833c8a052ea231ec1b19adaf497b625",
            "computerDnsName": "temp123.middleeast.corp.microsoft.com",
            "rbacGroupName": "MiddleEast",
            "aadTenantId": "a839b112-1253-6432-9bf6-94542403f21c",
            "relatedUser": {
                "userName": "temp123",
                "domainName": "MIDDLEEAST"
            },
			"comments": [
				{
					"comment": "test comment for docs",
					"createdBy": "secop123@contoso.com",
					"createdTime": "2020-07-21T01:00:37.8404534Z"
				}
			],
            "evidence": []
		}
	]
}
"""
if results.success:
    for alert in results.content['value']:
        row = incident.addRow("defender_atp_alerts")
        row['alert_id'] = alert['id']
        row['azure_incident_id'] = alert['incidentId']
        row['assigned_to'] = alert['assignedTo']
        row['severity'] = alert['severity']
        row['status'] = alert['status']
        row['title'] = alert['title']
        row['alert_description'] = alert['description']
        row['classification'] = alert['classification']
        row['determination'] = alert['determination']
        row['category'] = alert['category']
        row['computer_name'] = alert['computerDnsName']
        row['machine_id'] = alert['machineId']
        row['last_event'] = alert['lastEventTime_ts']
        row['last_updated'] = alert['lastUpdateTime_ts']
else:
    msg = u"Defender ATP Action unsuccessful.\nAction: Find alerts by machine\nReason: {}".format(results.reason)
    incident.addNote(msg)

```

---

