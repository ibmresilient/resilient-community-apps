<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v51.0.2.0.974
-->

# Playbook - Defender Machine Collect Investigation Package (PB)

### API Name
`defender_machine_collect_investigation_package_pb`

### Status
`enabled`

### Activation Type
`Manual`

### Activation Conditions
`-`

### Activation Form Elements
| Input Field Label | API Name | Element Type | Tooltip | Requirement |
| ----------------- | -------- | ------------ | ------- | ----------- |
| Action Comment | `defender_action_comment` | text | - | Always |

### Object Type
`defender_machines`

### Description
Start a process to collect an investigation report


---
## Function - Defender Collect Machine Investigation Package

### API Name
`defender_collect_machine_investigation_package`

### Output Name
`collect_machine_package`

### Message Destination
`fn_microsoft_defender`

### Function-Input Script
```python
inputs.defender_machine_id = row['machine_id']
inputs.defender_description = playbook.inputs.defender_action_comment
```

---

## Local script - defender post process

### Description


### Script Type
`Local script`

### Object Type
`defender_machines`

### Script Content
```python
from datetime import datetime
results = playbook.functions.results.collect_machine_package

if results.get("success"):
  res_content = results.get("content", {})
  msg = "Action: {}\nComment: {}\nStatus: {}\nStart Date: {}".format(
    res_content.get('type'),
    res_content.get('requestorComment'),
    res_content.get('status'),
    res_content.get('creationDateTimeUtc'))
  row['machine_last_action'] = helper.createPlainText(msg)
  row['report_date'] = int(datetime.now().timestamp()*1000)
  
"""
  'type': 'CollectInvestigationPackage',
  'title': None,
  'requestor': 'f0dc3f88-f617-449c-960c-6b54818cd110',
  'requestorComment': 'ss',
  'status': 'Succeeded',
  'machineId': '2a94aaf80aa31094790ce40da6fdfc03a9a145c5',
  'computerDnsName': 'windowsvmos',
  'creationDateTimeUtc': '2021-08-12T18:53:06.5259227Z',
  'lastUpdateDateTimeUtc': '2021-08-12T18:54:20.4259984Z',
"""
```

---

