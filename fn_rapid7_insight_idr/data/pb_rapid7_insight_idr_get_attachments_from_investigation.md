<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v51.0.0.2.575
-->

# Playbook - Rapid7 InsightIDR: Get Attachments from Investigation

### API Name
`rapid7_insight_idr_get_attachments_from_investigation`

### Status
`enabled`

### Activation Type
`Manual`

### Activation Conditions
`incident.plan_status equals Active AND incident.properties.rapid7_insight_idr_rrn has_a_value`

### Object Type
`incident`

### Description
Manual playbook to get the attachments associated with the Rapid7 InsightIDR investigation and add them as attachments to the SOAR case.  Also call the function to pull in new comments from the investigation as attachments often have associated comments with them in Rapid7 InsightIDR.


---
## Function - Rapid7 InsightIDR: Add Attachments to SOAR Case

### API Name
`rapid7_insight_idr_add_attachments_to_soar_case`

### Output Name
`add_attachments_results`

### Message Destination
`fn_rapid7_insight_idr`

### Function-Input Script
```python
inputs.rapid7_insight_idr_incident_id = incident.id
inputs.rapid7_insight_idr_rrn = incident.properties.rapid7_insight_idr_rrn
```

---
## Function - Rapid7 InsightIDR: Get Comments from Rapid7 Investigation

### API Name
`rapid7_insight_idr_get_comments`

### Output Name
`get_comments_results`

### Message Destination
`fn_rapid7_insight_idr`

### Function-Input Script
```python
inputs.rapid7_insight_idr_incident_id = incident.id
inputs.rapid7_insight_idr_rrn = incident.properties.rapid7_insight_idr_rrn
```

---

## Local script - Rapid7 InsightIDR: Write add attachments to SOAR case results to a note

### Description
Write add attachments to SOAR case function results to a note

### Script Type
`Local script`

### Object Type
`incident`

### Script Content
```python
results = playbook.functions.results.add_attachments_results

if results.get("success"):
  content = results.get("content", {})
  if content:
    rapid7_attachments = content.get("rapid7_insight_idr_attachments")
    note_text = "<b>Rapid7 InsightIDR: Get Attachments:</b> added {} attachments to incident:<br>".format(len(rapid7_attachments))
    for attachment_name in rapid7_attachments:
      note_text = note_text + "<br>{}".format(attachment_name)
else:
  note_text = "<b>Rapid7 InsightIDR: Get Attachments</b> failed to get <b>ALL</b> attachments from Rapid7 InsightIDR. Retry later:<br> {0}.".format(results.get("reason", None))
incident.addNote(note_text)

```

---
## Local script - Rapid7 InsightIDR: write get comments function result to a note

### Description
Write get comments function result to an incident note in SOAR.

### Script Type
`Local script`

### Object Type
`incident`

### Script Content
```python
results = playbook.functions.results.get_comments_results

if results.get("success"):
  content = results.get("content", {})
  if content:
    note_text = "<b>Rapid7 InsightIDR: Get Comments</b> playbook created {0} notes in SOAR".format(content.get("count"))
  else:
    note_text = "<b>Rapid7 InsightIDR: Get Comments</b> function failed to get notes from Rapid7 InsightIDR"
else:
  note_text = "<b>Rapid7 InsightIDR: Get Comments</b> function failed to get notes from Rapid7 InsightIDR"
  
incident.addNote(note_text)
```

---

