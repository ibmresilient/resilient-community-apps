<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
-->

# Outbound Email Reply to Message

## Function - Outbound Email: Send Email 2

### API Name
`send_email2`

### Output Name
`outbound_email_results`

### Message Destination
`email_outbound`

### Pre-Processing Script
```python
import hashlib
import time

# change this reflect a different message-id domain, as neeced
MESSAGE_ID_DOMAIN = "qradarsoar.ibm.com"

NEW_LINE = '\n'

if rule.properties.get('mail_message_id'):
  # generate a message-id
  seed_value = str(int(time.time()*1000))
  uuid_hash = hashlib.md5(seed_value.encode()).hexdigest()
  msg_id = "{}-{}-{}-{}-{}".format(uuid_hash[0:8], uuid_hash[8:12], uuid_hash[12:16], uuid_hash[16:20], uuid_hash[20:])
  inputs.mail_message_id = "{}@{}".format(msg_id, MESSAGE_ID_DOMAIN)

inputs.mail_attachments = rule.properties.mail_attachments
inputs.mail_body = rule.properties.mail_body.content if rule.properties.mail_body else None
inputs.mail_cc = rule.properties.mail_cc
inputs.mail_to = row['from']
inputs.mail_from = rule.properties.mail_from
inputs.mail_importance = rule.properties.mail_importance if rule.properties.mail_importance else None
inputs.mail_in_reply_to = row['message_id']
inputs.mail_incident_id = incident.id
inputs.mail_subject = "re: {}".format(row['subject'])
inputs.mail_template_label = rule.properties.mail_template_select

if rule.properties.mail_merge_body:
  inputs.mail_merge_body = True
  original_email = f"""Sent: xxx
From: {row['from']}
{row['recipients'].content}
Subject: {row['subject']}

{row['body'].content.replace("<br>", NEW_LINE)}"""
  
  if inputs.mail_body:
    inputs.mail_body = f"{inputs.mail_body}<hr>"
  inputs.mail_body = f"{inputs.mail_body if inputs.mail_body else ''}<div style='border-left: 2px solid gray'><div style='white-space: pre;margin-left: 5px'>{original_email}</div></div>"
```

### Post-Processing Script
```python
None
```

---

