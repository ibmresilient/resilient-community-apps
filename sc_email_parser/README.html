<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="search" title="Search" href="../search.html" />

    <link rel="shortcut icon" href="../_static/IBM_Security_Shield.ico"/><!-- Generated with Sphinx 7.2.6 and Furo 2024.01.29 -->
        <title>IBM SOAR example email message parsing script - QRadar SOAR Apps</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=11eca18f" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">QRadar SOAR Apps</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../_static/IBM_Security_Light.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../_static/IBM_Security_Dark.png" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">QRadar SOAR Apps</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Recently Updated Apps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pb_sans_isc_scan_ip/README.html">ISC SANS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_rapid7_insight_idr/README.html">Rapid7 InsightIDR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_pa_panorama/README.html">Palo Alto Panorama</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_mcafee_epo/README.html">McAfee ePO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rc_data_feed_plugin_odbcfeed/README.html">Data Feed ODBCFeed Plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_relations/README.html">Parent/Child Relationships</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_rest_api/README.html">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_salesforce/README.html">Salesforce</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">App Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../docs/python_api.html">IBM SOAR Python Documentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">All Apps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../fn_abuseipdb/README.html">AbuseIPDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_alienvault_otx/README.html">AlienVault OTX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_anomali_staxx/README.html">Anomali Staxx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_ansible/README.html">Ansible</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_ansible_tower/README.html">Ansible Tower</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_api_void/README.html">APIVoid Threat Analysis APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_aws_guardduty/README.html">Amazon AWS GuardDuty</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_aws_iam/README.html">AWS IAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_aws_utilities/README.html">AWS Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_azure_automation_utilities/README.html">Azure Automation Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_bigfix/README.html">BigFix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_bmc_helix/README.html">BMC Helix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_calendar_invite/README.html">Calendar Invite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_cisco_amp4ep/README.html">Cisco AMP for Endpoints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_cisco_asa/README.html">Cisco ASA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_cisco_enforcement/README.html">Cisco Umbrella Enforcement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_cisco_umbrella_inv/README.html">Cisco Umbrella Investigate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_clamav/README.html">ClamAV</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_cloud_foundry/README.html">Cloud Foundry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_components/README.html">App Host Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_create_webex_meeting/README.html">Cisco WebEx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_create_zoom_meeting/README.html">Zoom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_cve_search/README.html">CVE Search</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_darktrace/README.html">Darktrace <!-- omit in toc --></a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_datatable_utils/README.html">Datatable Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_elasticsearch/README.html">ElasticSearch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_email_header_validation/README.html">Email Header Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_exchange/README.html">Microsoft Exchange</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_exchange_online/README.html">Microsoft Exchange Online</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_extrahop/README.html">ExtraHop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_geocoding/README.html">Google Geocoding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_github/README.html">GitHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_google_cloud_dlp/README.html">Google Cloud DLP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_google_cloud_scc/README.html">Google Cloud Security Command Center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_googlesafebrowsing/README.html">Google Safe Browsing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_greynoise/README.html">GreyNoise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_grpc_interface/README.html">gRPC Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_hibp/README.html">Have I Been Pwned</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_html2pdf/README.html">HTML to PDF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_icdx/README.html">Symantec ICDx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_incident_utils/README.html">Incident Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_ioc_parser_v2/README.html">IOC Parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_ipinfo/README.html">IPInfo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_isitphishing/README.html">IsItPhishing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_jira/README.html">Jira</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_joe_sandbox_analysis/README.html">Joe Sandbox Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_kafka/README.html">Kafka</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_ldap_utilities/README.html">SOAR LDAP Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_maas360/README.html">MaaS360</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_mandiant/README.html">Mandiant Threat Intelligence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_mcafee_atd/README.html">McAfee ATD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_mcafee_esm/README.html">McAfee ESM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_mcafee_opendxl/README.html">McAfee OpenDXL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_mcafee_tie/README.html">McAfee TIE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_microsoft_defender/README.html">Microsoft Defender</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_microsoft_security_graph/README.html">Microsoft Security Graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_microsoft_sentinel/README.html">Microsoft Sentinel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_misp/README.html">MISP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_mitre_integration/README.html">MITRE ATT&amp;CK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_mxtoolbox/README.html">About MxToolBox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_netdevice/README.html">netMiko</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_network_utilities/README.html">Network Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_ocr/README.html">Image OCR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_odbc_query/README.html">ODBC Query</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_outbound_email/README.html">Outbound Email</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_pagerduty/README.html">PagerDuty</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_parse_utilities/README.html">Parse Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_passivetotal/README.html">PassiveTotal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_pastebin/README.html">PasteBin Creator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_phish_ai/README.html">Phish.AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_phish_tank/README.html">PhishTank Lookup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_pipl/README.html">Pipl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_playbook_maker/README.html">Playbook Maker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_playbook_utils/README.html">Playbook Utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_proofpoint_tap/README.html">Proofpoint TAP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_proofpoint_trap/README.html">Proofpoint TRAP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_pulsedive/README.html">Pulsedive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_qradar_advisor/README.html">QRadar Advisor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_qradar_enhanced_data/README.html">QRadar Enhanced Data Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_qradar_integration/README.html">QRadar Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_query_tor_network/README.html">TOR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_randori/README.html">Randori</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_reaqta/README.html">QRadar EDR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_remedy/README.html">Remedy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_rsa_netwitness/README.html">RSA NetWitness</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_soar_utils/README.html">SOAR Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_scheduler/README.html">Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_secureworks_ctp/README.html">Secureworks CTP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_sentinelone/README.html">SentinelOne</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_sep/README.html">Symantec Endpoint Protection</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../fn_service_now/README.html">ServiceNow</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of ServiceNow</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../fn_service_now/docs/install_guide/README.html">ServiceNow Installation Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fn_service_now/docs/customize_snow_guide/README.html">ServiceNow Customization Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fn_service_now/docs/customize_resilient_guide/README.html">SOAR Customization Guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../fn_shadowserver/README.html">Shadowserver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_shodan/README.html">Shodan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_siemplify/README.html">Siemplify</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_slack/README.html">Slack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_snapshot_url/README.html">Snapshot URL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_spamhaus_query/README.html">Spamhaus Lookup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_splunk_integration/README.html">Splunk</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_symantec_dlp/README.html">Symantec DLP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_task_utils/README.html">Task Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_teams/README.html">Microsoft Teams</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_threatminer/README.html">ThreatMiner</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_timer/README.html">Timer Function</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_trusteer_ppd/README.html">Trusteer Pinpoint Detect</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_twilio/README.html">Twilio SMS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_twitter_most_popular/README.html">Twitter Search API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_url_to_dns/README.html">URL to DNS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_urlhaus/README.html">URLhaus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_urlscanio/README.html">URLScan.io</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_utilities/README.html">Utilities (Deprecated)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_virustotal/README.html">VirusTotal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_vmray_analyzer/README.html">VMRay Sandbox Analyzer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_watson_translate/README.html">Watson Translate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_webex/README.html">Cisco Webex</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_whois/README.html">Whois</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_whois_rdap/README.html">Whois RDAP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_wiki/README.html">SOAR Wiki</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_xforce/README.html">IBM XForce Collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_yeti/README.html">Yeti</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fn_zia/README.html">Zscaler Internet Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rc_data_feed/README.html">Data Feed Extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rc_data_feed_plugin_elasticfeed/README.html">Data Feed Elasticsearch Plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rc_data_feed_plugin_kafkafeed/README.html">Data Feed KafkaFeed Plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rc_data_feed_plugin_splunkfeed/README.html">Data Feed plugin for Splunk</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rc-cts-abuseipdb/README.html">AbuseIPDB Threat Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rc-cts-haveibeenpwned/README.html">Have I Been Pwned Threat Searcher</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rc-cts-mcafeetie/README.html">McAfee TIE Threat Searcher</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rc-cts-passivetotal/README.html">RiskIQ PassiveTotal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rc-cts-shadowserver/README.html">ShadowServer Threat Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rc-cts-urlscanio/README.html">URLScan IO Threat Searcher</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="ibm-soar-example-email-message-parsing-script">
<h1>IBM SOAR example email message parsing script<a class="headerlink" href="#ibm-soar-example-email-message-parsing-script" title="Link to this heading">#</a></h1>
<p>This package consists of the <strong>RuleAndScript.res</strong> and <strong>ScriptAlone.res</strong> IBM SOAR configuration files. The first file contains an example email parsing script and a rule to run it automatically. The <strong>ScriptAlone.res</strong> file contains the script without the rule.</p>
<section id="history">
<h2>History<a class="headerlink" href="#history" title="Link to this heading">#</a></h2>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-right"><p>Version</p></th>
<th class="head text-right"><p>Date</p></th>
<th class="head text-right"><p>Comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-right"><p>2.3.2</p></td>
<td class="text-right"><p>2/2023</p></td>
<td class="text-right"><p>Fix index error</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>2.3.1</p></td>
<td class="text-right"><p>10/2022</p></td>
<td class="text-right"><p>Fix for defanging logic</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>2.3.0</p></td>
<td class="text-right"><p>9/2022</p></td>
<td class="text-right"><p>Support for Outbound Email 2.0 conversations</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>2.2.0</p></td>
<td class="text-right"><p>7/2021</p></td>
<td class="text-right"><p>Support for Python 3</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>2.0.2</p></td>
<td class="text-right"><p>4/2020</p></td>
<td class="text-right"><p>Bug fixes for phishing incident type</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>2.0.1</p></td>
<td class="text-right"><p>10/2019</p></td>
<td class="text-right"><p>Fix when email address contains unicode characters</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>2.0.0</p></td>
<td class="text-right"><p>7/2019</p></td>
<td class="text-right"><p>Unicode bug fixes</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>1.0.1</p></td>
<td class="text-right"><p>2/2019</p></td>
<td class="text-right"><p>Added automatic rule for script execution</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>1.0.0</p></td>
<td class="text-right"><p>1/2019</p></td>
<td class="text-right"><p>Initial release</p></td>
</tr>
</tbody>
</table>
</div>
<section id="changes-for-v2-3-0">
<h3>Changes for v2.3.0<a class="headerlink" href="#changes-for-v2-3-0" title="Link to this heading">#</a></h3>
<p>Version of the 2.3.0 of the parsing script introduces the ability to capture an email’s Message-ID header. This value will be used to create email conversations based on the case’s incoming email.
Version 2.0.0 of <a class="reference external" href="https://exchange.xforce.ibmcloud.com/hub/extension/caafba4e4f6d130e7db30ed4d5e53504">Outbound Email</a> will import a custom incident field (<code class="docutils literal notranslate"><span class="pre">email_message_id</span></code>) for retention of this information, along with new functionality to create outbound email conversations.</p>
<p>If you want to use this parsing script without the fn_outbound_email app, you can manually create the incident field <code class="docutils literal notranslate"><span class="pre">email_message_id</span></code> and add it to a case tab, such as <code class="docutils literal notranslate"><span class="pre">Email</span></code>.
The below images show the creation of the <code class="docutils literal notranslate"><span class="pre">email_message_id</span></code> custom field and its assignment to a tab. The script will continue to execute if this field is absent.</p>
<p><img alt="screenshot: main" src="../_images/creating_email_message_id.png" />
<img alt="screenshot: main" src="../_images/layouts2.png" /></p>
<p>Also in <a class="reference external" href="https://exchange.xforce.ibmcloud.com/hub/extension/caafba4e4f6d130e7db30ed4d5e53504">Outbound Email 2.0</a>, a datatable is introduced to capture email conversations:</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Type</p></th>
<th class="head text-left"><p>API Name</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Datatable</p></td>
<td class="text-left"><p>email_conversations</p></td>
</tr>
</tbody>
</table>
</div>
<p>This datatable is used to capture email conversation information for both inbound and outbound messages within an incident. If you’re not using Outbound Email 2.0 or greater, this generic email script will continue to work without this datatable.</p>
<p>If you are using Outbound Email 2.0 or greater, you can edit this script to enable the logic to populate the inbound email message into the incident’s <code class="docutils literal notranslate"><span class="pre">Email</span> <span class="pre">Conversations</span></code> datatable. Modify line 10, SAVE_CONVERSATION = True, to perform this action</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## Uncomment if you&#39;re using Outbound EMail 2.0 or greater and want to capture the inbound email in the Email Conversation datatable</span>
<span class="c1">#processor.add_email_conversation(emailmessage.headers, processor.emailContents, [attachment.suggested_filename for attachment in emailmessage.attachments])</span>
</pre></div>
</div>
<p>Be aware that any url, mailto email address, url etc. is modified so that it is no longer clickable. This is done to reduce the possibility of clicking on a malicious link (such as in a phishing email). See the image below for an altered email representation.</p>
<p><img alt="Defanged Email Conversation" src="../_images/email_conversations_datatable.png" /></p>
</section>
</section>
<section id="installation-instructions">
<h2>Installation instructions<a class="headerlink" href="#installation-instructions" title="Link to this heading">#</a></h2>
<p>Before installing, verify that your environment meets the following prerequisites:</p>
<ul class="simple">
<li><p>IBM SOAR platform is version 39 or later.</p></li>
<li><p>You have a IBM SOAR account to use for the installation. This can be any account that has the permission to view and modify administrator and customization settings, and read and update incidents. You need to know the account username and password.</p></li>
</ul>
<section id="procedure">
<h3>Procedure<a class="headerlink" href="#procedure" title="Link to this heading">#</a></h3>
<p><strong>Important:</strong> Repeatedly importing the <strong>.res</strong> files will overwrite any changes you have made to the script and rule.</p>
<ol class="arabic simple">
<li><p>Log on to the IBM SOAR platform using a suitable account.</p></li>
<li><p>Navigate to <strong>Administrator Settings</strong>.</p></li>
<li><p>Select the <strong>Organization</strong> tab.</p></li>
<li><p>Select the <strong>Import</strong> link.</p></li>
<li><p>Select the <strong>+ Import settings</strong> button.</p></li>
<li><p>If you are upgrading from a previous version of this package, select the <strong>ScriptAlone.res</strong> file from the installation bundle. Otherwise, choose the <strong>RuleAndScript.res</strong> file.</p></li>
<li><p>Select <strong>Open</strong>.</p></li>
<li><p>Select <strong>Proceed</strong>.</p></li>
</ol>
</section>
<section id="result">
<h3>Result<a class="headerlink" href="#result" title="Link to this heading">#</a></h3>
<p>After installing from <strong>RuleAndScript.res</strong>, the IBM SOAR platform will have a new Python script called “Generic email script v2.3.0” and a new rule called “Process email message v2.3.0”. The rule runs the script when it is triggered by a new email message being received by the IBM SOAR platform. If instead you imported <strong>ScriptAlone.res</strong> then you will only have the new script and not the rule.</p>
<p><strong>Note</strong>: This new rule is disabled by default. To enable:</p>
<ol class="arabic simple">
<li><p>Navigate to <strong>Customization Settings</strong>.</p></li>
<li><p>Select the “Rules” tab.</p></li>
<li><p>Modify the “Generic email script v2.3.0” with any custom Allowlist IP address changes</p></li>
<li><p>Enable the rule “Process email message v2.3.0”.
If you are using an older email script:</p></li>
<li><p>Disable any previous email rule this new script is replacing.</p></li>
</ol>
</section>
<section id="operation">
<h3>Operation<a class="headerlink" href="#operation" title="Link to this heading">#</a></h3>
<p>The script is intended to perform generic email parsing on newly created email message objects. It performs the following:</p>
<ul class="simple">
<li><p>Checks if an existing incident exists whose title reflects the email message received.</p>
<ul>
<li><p>If so, it associates the email message with the existing incident.</p></li>
<li><p>If not, it:</p>
<ul>
<li><p>Creates a new incident with a suitable title.</p></li>
<li><p>Associates the email message with the new incident.</p></li>
<li><p>Adds the email message’s subject as an artifact to the new incident.</p></li>
<li><p>Sets the incident’s reporter field to be the email address that sent the message.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Parses the email body text looking for URLs, IP addresses and file hashes. After filtering out invalid and allowlisted values, it adds the remaining data to the incident as artifacts.</p></li>
<li><p>Adds non-inline email message attachments to the incident.</p></li>
</ul>
<p><strong>NOTE:</strong> If you installed the previous version of this script, be aware that the previous rules and scripts are not replaced. Therefore, if you import <strong>RuleAndScript.res</strong> you could have multiple rules that are triggered by the creation of an email message. In this case, you may want to review your rules and remove those whose conditions overlap.</p>
<p>An email message can only be associated with one incident. If two scripts run on email message creation, and each script associates the email message with a different incident, then neither script will appear to have an effect and the email message will appear in the IBM SOAR <code class="docutils literal notranslate"><span class="pre">Inbox</span></code> tab.</p>
</section>
</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Link to this heading">#</a></h2>
<section id="the-incident-owner">
<h3>The incident owner<a class="headerlink" href="#the-incident-owner" title="Link to this heading">#</a></h3>
<p>New incidents need an owner, either an individual identified by their email address or a group name. In the provided script, every incident is owned by the user admin&#64;co3sys.com. This should be changed to reflect your IBM SOAR platform. For example, to change the owner to l1&#64;businessname.com, locate line 25 of the script:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># The new incident owner - the email address of a user or the name of a group and cannot be blank.</span>
<span class="c1"># Change this value to reflect who will be the owner of the incident before running the script.</span>
<span class="n">newIncidentOwner</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</pre></div>
</div>
<p>Edit the line:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># The new incident owner - the email address of a user or the name of a group and cannot be blank.</span>
<span class="c1"># Change this value to reflect who will be the owner of the incident before running the script.</span>
<span class="n">newIncidentOwner</span> <span class="o">=</span> <span class="s2">&quot;l1@businessname.com&quot;</span>
</pre></div>
</div>
</section>
<section id="allowlisting">
<h3>Allowlisting<a class="headerlink" href="#allowlisting" title="Link to this heading">#</a></h3>
<p>A allowlists is a list of trustworthy data items that should not become suspicious artifacts, for example your own email server’s IP address.
There are two categories of allowlist used in the script: IP address and URL domain. These allowlists are configured by altering data in the script.</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Variable Name</p></th>
<th class="head text-right"><p>Line number</p></th>
<th class="head text-left"><p>Purpose</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">ipV4AllowList</span></code></p></td>
<td class="text-right"><p>23</p></td>
<td class="text-left"><p>IP v4 allowlist</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">ipV6AllowList</span></code></p></td>
<td class="text-right"><p>42</p></td>
<td class="text-left"><p>IP v6 allowlist</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">domainAllowList</span></code></p></td>
<td class="text-right"><p>63</p></td>
<td class="text-left"><p>URL domain allowlist</p></td>
</tr>
</tbody>
</table>
</div>
<p>Initially these allowlists are comprised of commented out entries which serve as examples of the data you might want to exclude from consideration. The allowlists will have no effect unless you uncomment the entries and make a grammatically correct list, or add some entries of your own.
Please note that, compared to version v1 of the script, the allowlist variable location has changed and formats of the entries have been simplified.</p>
<section id="ip-address-allowlists">
<h4>IP address allowlists<a class="headerlink" href="#ip-address-allowlists" title="Link to this heading">#</a></h4>
<p>The IP address allowlists are divided into separate IPv4 and IPv6 lists. These lists apply to the IP addresses retrieved by pattern matching in the body of the email message. If an IP address appears on a allowlist, it is not added as an artifact to the incident.</p>
<p>There are two categories of IP allowlist entry, CIDR (Classless Inter-Domain Routing) and IPRange. For example, in IP V4, IBM owns the <code class="docutils literal notranslate"><span class="pre">9</span></code> class A network. You may want to also allowlist an IP range, such as <code class="docutils literal notranslate"><span class="pre">12.0.0.1</span> <span class="pre">-</span> <span class="pre">12.5.5.5</span></code>. To add these criteria to the allowlist you would add the following to ipV4AllowList:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>  <span class="s2">&quot;9.0.0.0/8&quot;</span><span class="p">,</span>
  <span class="s2">&quot;12.0.0.1-12.5.5.5&quot;</span>
</pre></div>
</div>
<p>You may also want to allowlist an explicit IP address, such as <code class="docutils literal notranslate"><span class="pre">13.13.13.13</span></code>. This would be specified by:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>  <span class="s2">&quot;13.13.13.13&quot;</span>
</pre></div>
</div>
<p>IP v6 allowlists operate similarly. For example to allowlist a V6 CIDR <code class="docutils literal notranslate"><span class="pre">aaaa::/16</span></code> you would add <code class="docutils literal notranslate"><span class="pre">CIDR(&quot;aaaa::/16&quot;)</span></code> to ipV6AllowList. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Allowlist for IP V4 addresses</span>
<span class="n">ipV4AllowList</span> <span class="o">=</span> <span class="n">AllowList</span><span class="p">([</span>
  <span class="o">...</span>
<span class="p">])</span>

<span class="c1"># Allowlist for IP V6 addresses</span>
<span class="n">ipV6AllowList</span> <span class="o">=</span> <span class="n">AllowList</span><span class="p">([</span>
  <span class="o">...</span>
<span class="p">])</span>
</pre></div>
</div>
<p>should become:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Allowlist for IP V4 addresses</span>
<span class="n">ipV4AllowList</span> <span class="o">=</span> <span class="n">AllowList</span><span class="p">([</span>
  <span class="s2">&quot;9.0.0.0/8&quot;</span><span class="p">,</span>
  <span class="s2">&quot;12.0.0.1-12.5.5.5&quot;</span><span class="p">,</span>
  <span class="s2">&quot;13.13.13.13&quot;</span>
<span class="p">])</span>

<span class="c1"># Allowlist for IP V6 addresses</span>
<span class="n">ipV6AllowList</span> <span class="o">=</span> <span class="n">AllowList</span><span class="p">([</span>
  <span class="s2">&quot;aaaa::/16&quot;</span>
<span class="p">])</span>
</pre></div>
</div>
</section>
<section id="url-domain-allowlists">
<h4>URL domain allowlists<a class="headerlink" href="#url-domain-allowlists" title="Link to this heading">#</a></h4>
<p>The domain allowlist applies to URLs found in the body of the email. If a allowlisted domain is discovered in a potential URL artifact, then it is not added to the incident. Domains can be added explicitly, such as <code class="docutils literal notranslate"><span class="pre">mail.businessname.com</span></code>, or using a wildcard, such as <code class="docutils literal notranslate"><span class="pre">*.otherbusinessname.com</span></code>. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Domain allowlist</span>
<span class="n">domainAllowList</span> <span class="o">=</span> <span class="p">[</span>
  <span class="c1">#&quot;*.ibm.com&quot;</span>
<span class="p">]</span>
</pre></div>
</div>
<p>would become:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Domain allowlist</span>
<span class="n">domainAllowList</span> <span class="o">=</span> <span class="n">AllowList</span><span class="p">([</span>
  <span class="s2">&quot;mail.businessname.com&quot;</span><span class="p">,</span>
  <span class="s2">&quot;*.otherbusinessname.com&quot;</span>
<span class="p">])</span>
</pre></div>
</div>
<p>Please note that the allowlist entries <code class="docutils literal notranslate"><span class="pre">*.otherbusinessname.com</span></code> and <code class="docutils literal notranslate"><span class="pre">otherbusinessname.com</span></code> have the same effect of allowlisting any address in the <code class="docutils literal notranslate"><span class="pre">otherbusinessname.com</span></code> domain.</p>
</section>
</section>
</section>
</section>
<section id="extension-and-customization">
<h1>Extension and Customization<a class="headerlink" href="#extension-and-customization" title="Link to this heading">#</a></h1>
<p>Please refer to the IBM SOAR Incident Response Platform Playbook Designer Guide for details on writing and customizing scripts. This guide is available from the Help/Contact menu in the IBM SOAR platform.</p>
<p>There are two approaches to customization of the mechanism:</p>
<ul class="simple">
<li><p>Running multiple scripts for the same email</p></li>
<li><p>Modifying the supplied script</p></li>
</ul>
<p>For a variety of reasons, adding more scripts is generally a better idea than adding more complexity to one script. The IBM SOAR platform could be expected to ingest multiple categories of email messages from different integrations. Some of the processing of the email messages could be common, and some processing could be category- or integration-specific. Keeping the common processing in one script, and the specialized processing in others would allow a cleaner and more maintainable implementation.</p>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Link to this heading">#</a></h2>
<section id="extending-the-solution-to-deal-with-phishing-reports">
<h3>Extending the solution to deal with Phishing reports<a class="headerlink" href="#extending-the-solution-to-deal-with-phishing-reports" title="Link to this heading">#</a></h3>
<p>Scenario: Emails arriving in a particular mailbox reflect individuals forwarding suspected phishing messages. The scripts operating on these email messages should, in addition to the generic processing, record the reporter’s email address as possibly having been the target of a phishing attack, and record the sender of the forwarded phishing email as suspicious.</p>
<p>A solution:
Add the following script to the IBM SOAR platform:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">addArtifact</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">artifactType</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;This method adds new artifacts to the incident derived from matches of the the regular expression</span>
<span class="sd">  parameter within the email body contents.</span>
<span class="sd">  Parameter &quot;regex&quot; - a regular expression to match against the email body contents.</span>
<span class="sd">  Parameter &quot;artifactType&quot; - the type of the artifact(s).</span>
<span class="sd">  Parameter &quot;description&quot; - the description of the artifact(s).</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">dataList</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">emailmessage</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">content</span><span class="p">))</span> <span class="c1"># Using a set to enforce uniqueness</span>
  <span class="k">if</span> <span class="n">dataList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span>
    <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">theArtifact</span><span class="p">:</span> <span class="n">incident</span><span class="o">.</span><span class="n">addArtifact</span><span class="p">(</span><span class="n">artifactType</span><span class="p">,</span> <span class="n">theArtifact</span><span class="p">,</span> <span class="n">description</span><span class="p">),</span> <span class="n">dataList</span><span class="p">)</span>

<span class="c1">###</span>
<span class="c1"># Mainline starts here</span>
<span class="c1">###</span>

<span class="c1"># Add &quot;Phishing&quot; as an incident type for the associated incident</span>
<span class="n">incident</span><span class="o">.</span><span class="n">incident_type_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Phishing&quot;</span><span class="p">)</span>

<span class="c1"># Add the email sender information to the incident as the recipient of the phishing attempt</span>
<span class="n">reportingUserInfo</span> <span class="o">=</span> <span class="n">emailmessage</span><span class="o">.</span><span class="n">from</span><span class="o">.</span><span class="n">address</span>
<span class="k">if</span> <span class="n">emailmessage</span><span class="o">.</span><span class="n">from</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
  <span class="n">reportingUserInfo</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> &lt;</span><span class="si">{1}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">emailmessage</span><span class="o">.</span><span class="n">from</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">emailmessage</span><span class="o">.</span><span class="n">from</span><span class="o">.</span><span class="n">address</span><span class="p">)</span>
<span class="n">incident</span><span class="o">.</span><span class="n">addArtifact</span><span class="p">(</span><span class="s2">&quot;Email Recipient&quot;</span><span class="p">,</span> <span class="n">reportingUserInfo</span><span class="p">,</span> <span class="s2">&quot;Recipient of suspicious email&quot;</span><span class="p">)</span>

<span class="c1"># Extract email sender information on the assumption that a phishing email is being forwarded</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">emailmessage</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">content</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
  <span class="n">addArtifact</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;From: (.*)\n&quot;</span><span class="p">,</span> <span class="s2">&quot;Email Sender&quot;</span><span class="p">,</span> <span class="s2">&quot;Suspicious email sender&quot;</span><span class="p">)</span>
  <span class="n">addArtifact</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Reply-To: (.*)\n&quot;</span><span class="p">,</span> <span class="s2">&quot;Email Sender&quot;</span><span class="p">,</span> <span class="s2">&quot;Suspicious email sender (Reply-To)&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Run the script as part of a rule that includes a condition that helps identify the email message as a phishing report. The script should run either as part of a multi-script rule that first runs the generic script, or as a separate rule that runs afterwards. It is important that the phishing-specific script should run after the generic script because the generic script causes the <code class="docutils literal notranslate"><span class="pre">incident</span></code> variable to be set, and the phishing-specific script shown above expects this to have been done already.</p>
<p>NOTE: If you choose to implement the solution as one script, not two, then be sure that you add the Phishing incident type to the incident at a point in the script when the incident object exists. For example, the following command should occur after the incident is created or found.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">incident</span><span class="o">.</span><span class="n">incident_type_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Phishing&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="campaign-identifier">
<h3>Campaign identifier<a class="headerlink" href="#campaign-identifier" title="Link to this heading">#</a></h3>
<p>Scenario: The email message subject on its own might not be enough to collect related email messages into one incident.
It may be that the email message subject is not specific or reliable enough to use as the way to collect related emails. In particular, there may be an attack taking place where multiple attack vectors are being employed in a single campaign, which may result in many different kinds of email messages being received for this one campaign.
One solution to the problem is to create a new field in an incident to contain a campaign identifier. This identifier could be either derived from the email message contents, or chosen from a hard-coded list when the campaign is recognized by the parsing script.</p>
<p>A solution:</p>
<ol class="arabic simple">
<li><p>Create a new incident custom field for the campaign identifier of type Text.</p></li>
<li><p>Copy the generic parsing script into a new script.</p></li>
<li><p>Modify the new script to create a value for the campaign identifier either by selecting some text from the email message contents, or selecting from a hard-coded list of campaign identifiers if certain criteria are met.</p></li>
<li><p>To associate the email message with a relevant existing incident, search for incidents whose campaign identifier field is the same as the campaign identifier value for the email message. This would replace the search based on email message subject.</p></li>
<li><p>If no suitable incident is found, create a new incident and set its campaign identifier field to be the campaign identifier value.</p></li>
<li><p>Modify the rules so that the new script runs instead of the generic script.</p></li>
</ol>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">IBM SOAR example email message parsing script</a><ul>
<li><a class="reference internal" href="#history">History</a><ul>
<li><a class="reference internal" href="#changes-for-v2-3-0">Changes for v2.3.0</a></li>
</ul>
</li>
<li><a class="reference internal" href="#installation-instructions">Installation instructions</a><ul>
<li><a class="reference internal" href="#procedure">Procedure</a></li>
<li><a class="reference internal" href="#result">Result</a></li>
<li><a class="reference internal" href="#operation">Operation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuration">Configuration</a><ul>
<li><a class="reference internal" href="#the-incident-owner">The incident owner</a></li>
<li><a class="reference internal" href="#allowlisting">Allowlisting</a><ul>
<li><a class="reference internal" href="#ip-address-allowlists">IP address allowlists</a></li>
<li><a class="reference internal" href="#url-domain-allowlists">URL domain allowlists</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#extension-and-customization">Extension and Customization</a><ul>
<li><a class="reference internal" href="#examples">Examples</a><ul>
<li><a class="reference internal" href="#extending-the-solution-to-deal-with-phishing-reports">Extending the solution to deal with Phishing reports</a></li>
<li><a class="reference internal" href="#campaign-identifier">Campaign identifier</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=32e29ea5"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script src="../_static/js/custom.js?v=a365c389"></script>
    </body>
</html>