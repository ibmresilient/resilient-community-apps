<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v51.0.6.0.1543
-->

# Playbook - On Call Manager: Create Event - Example (PB)

### API Name
`on_call_manager_create_event`

### Status
`enabled`

### Activation Type
`Manual`

### Activation Conditions
`incident.properties.ocm_incident_id not_has_a_value`

### Activation Form Elements
| Input Field Label | API Name | Element Type | Tooltip | Requirement |
| ----------------- | -------- | ------------ | ------- | ----------- |
| Event Type | `ocm_type_eventtype` | text | Description of the type of the event. E.g. Utilization, System status, Threshold breach | Optional |
| Priority | `ocm_event_priority` | select | Priority | Optional |
| Resource Name | `ocm_resource_name` | text | The name of the resource causing the event. Identifies the primary resource that the event is affecting | Always |
| Severity | `ocm_event_severity` | select | Severity | Always |
| Status or Threshold | `ocm_type_statusorthreshold` | text | The status or the threshold causing the event. E.g. Down, 95%, Unavailable | Optional |
| Summary | `ocm_event_summary` | text | Contains text which describes the event condition | Always |

### Object Type
`incident`

### Description
Creates an event in On Call Manager


---
## Function - On Call Manager: Create Event

### API Name
`on_call_manager_create_event`

### Output Name
`ocm_create_event_return`

### Message Destination
`fn_ocm`

### Function-Input Script
```python
inputs.ocm_soar_inc_id = incident.id
inputs.ocm_resource_name = playbook.inputs.ocm_resource_name
inputs.ocm_event_summary = playbook.inputs.ocm_event_summary
inputs.ocm_event_severity = playbook.inputs.ocm_event_severity

if getattr(playbook.inputs, "ocm_event_priority", None):
  inputs.ocm_event_priority = playbook.inputs.ocm_event_priority
if not getattr(playbook.inputs, "ocm_type_statusorthreshold", None) and not getattr(playbook.inputs, "ocm_type_eventtype", None):
  helper.fail("Either ocm_type_statusorthreshold or ocm_type_eventtype must be given.")
if getattr(playbook.inputs, "ocm_type_statusorthreshold", None):
  inputs.ocm_type_statusorthreshold = playbook.inputs.ocm_type_statusorthreshold
if getattr(playbook.inputs, "ocm_type_eventtype", None):
  inputs.ocm_type_eventtype = playbook.inputs.ocm_type_eventtype

# Example input for adding custom properties to the On Call Manager event.
#inputs.ocm_event_details = {"subject":"Example subject", "reason":"something happened", "country":"US", "region":"NA"}
```

---
## Function - On Call Manager: Get Event

### API Name
`on_call_manager_get_event`

### Output Name
`ocm_get_event_results`

### Message Destination
`fn_ocm`

### Function-Input Script
```python
# Both eventid and deduplicationKey are required inputs
results = playbook.functions.results.ocm_create_event_return
content = results.get("content", {})
if content:
  inputs.ocm_deduplicationkey = content.get("deduplicationKey", None)
  inputs.ocm_eventid = content.get("eventid", None)
```

---
## Function - On Call Manager: Get Incident

### API Name
`on_call_manager_get_incident`

### Output Name
`ocm_get_incident_results`

### Message Destination
`fn_ocm`

### Function-Input Script
```python
results = playbook.functions.results.ocm_get_event_results
incident_id = results.get("content", {}).get("incidentUuid", None)
if incident_id:
  inputs.ocm_incident_id = incident_id
```

---

## Local script - On Call Manager: Create Event output

### Description


### Script Type
`Local script`

### Object Type
`incident`

### Script Content
```python
from json import dumps
results = playbook.functions.results.ocm_create_event_return
if results.get("success", None):
  incident.addNote(f"On Call Manager: Create Event was successful and returned:\n{dumps(results.get('content', {}), indent=4)}")
else:
  incident.addNote(f"On Call Manager: Create Event failed with reason:\n{results.get('reason', None)}")
```

---
## Local script - On Call Manager: Get Incident return

### Description


### Script Type
`Local script`

### Object Type
`incident`

### Script Content
```python
from datetime import datetime
results = playbook.functions.results.ocm_get_incident_results
if results.get("success", None):
  incident.properties.ocm_tab_visible = True
  inc = results.get("content", {})
  incident.name = inc.get("summary", None)
  incident.description = inc.get("description", None)
  incident.properties.ocm_incident_assigned_owner = inc.get("owner", None)
  incident.properties.ocm_incident_assigned_team = inc.get("team", None)
  incident.properties.ocm_incident_description = inc.get("description", None)
  incident.properties.ocm_incident_display_id = inc.get("displayId", None)
  incident.properties.ocm_incident_id = inc.get("id", None)
  incident.properties.ocm_incident_priority = inc.get("priority", None)
  incident.properties.ocm_incident_state = inc.get("state", None)
  incident.properties.ocm_incident_summary = inc.get("summary", None)
  incident.properties.ocm_incident_last_changed_time = int(datetime.strptime(inc.get("lastChanged", None)[:-1], "%Y-%m-%dT%H:%M:%S.%f").timestamp()*1000) if inc.get("lastChanged", None) else None
else:
  incident.addNote(f"On Call Manager: Get Incident failed with reason:\n{results.get('reason', {})}")
```

---
## Local script - On Call Manager: Get Event return

### Description


### Script Type
`Local script`

### Object Type
`incident`

### Script Content
```python
results = playbook.functions.results.ocm_get_event_results
if not results.get("success", None):
  incident.addNote(f"On Call Manager: Get Event failed with reason:\n{results.get('reason', None)}")
```

---

