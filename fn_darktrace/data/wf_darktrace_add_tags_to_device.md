<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
-->

# Darktrace: Add Tags to Device

## Function - Darktrace: Add Device Tags

### API Name
`darktrace_add_device_tags`

### Output Name
`None`

### Message Destination
`fn_darktrace`

### Pre-Processing Script
```python
inputs.darktrace_device_id = row.darktrace_device_dt_id.get("content")
inputs.darktrace_device_tags = rule.properties.darktrace_device_tags
```

### Post-Processing Script
```python
SPAN_FORMATTER = "<span class='label' rel='tooltip' title='{0}'>{0}</span>"

if results.success:
  added_tags = " ".join(SPAN_FORMATTER.format(tag) for tag in results.content.get("added_tags"))
  error_tags = " ".join(SPAN_FORMATTER.format(tag) for tag in results.content.get("error_tags"))
  all_tags = " ".join(SPAN_FORMATTER.format(tag) for tag in results.content.get("all_tags"))
  
  msg = ""
  if added_tags:
    msg += "Successfully added tag(s) {0} to device {1}.".format(added_tags, row.darktrace_device_dt_id.get("content"))
  if error_tags:
    if msg:
      msg += "\n"
    msg += "Failed to add tag(s) {0} because they weren't found in Darktrace. Create them in Darktrace first then you can add them to the device.".format(error_tags)
    
  incident.addNote(msg)
  row.darktrace_device_dt_tags = all_tags
else:
  incident.addNote("Failed to add tags {0} to device {1}. Error: {2}".format(results.inputs.get("darktrace_device_tags"), row.darktrace_device_dt_id, results.reason))
```

---

