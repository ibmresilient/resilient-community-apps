{"action_order": [], "actions": [{"automations": [], "conditions": [{"evaluation_id": null, "field_name": "artifact.type", "method": "in", "type": null, "value": ["IP Address", "DNS Name", "URL", "Malware MD5 Hash", "Malware SHA-256 Hash"]}], "enabled": true, "export_key": "VirusTotal Scan", "id": 27, "logic_type": "all", "message_destinations": [], "name": "VirusTotal Scan", "object_type": "artifact", "tags": [], "timeout_seconds": 86400, "type": 0, "uuid": "bde3f80c-377c-475f-8ca0-5446fe02b7cc", "view_items": [], "workflows": ["virustotal_scan_hits"]}], "apps": [], "automatic_tasks": [], "export_date": 1653498041299, "export_format_version": 2, "export_type": null, "fields": [{"export_key": "incident/internal_customizations_field", "id": 0, "input_type": "text", "internal": true, "name": "internal_customizations_field", "read_only": true, "text": "Customizations Field (internal)", "type_id": 0, "uuid": "bfeec2d4-3770-11e8-ad39-4a0004044aa1"}], "functions": [], "geos": null, "groups": null, "id": 102, "inbound_destinations": [], "inbound_mailboxes": null, "incident_artifact_types": [], "incident_types": [{"update_date": 1653498039810, "create_date": 1653498039810, "uuid": "bfeec2d4-3770-11e8-ad39-4a0004044aa0", "description": "Customization Packages (internal)", "export_key": "Customization Packages (internal)", "name": "Customization Packages (internal)", "enabled": false, "system": false, "parent_id": null, "hidden": false, "id": 0}], "industries": null, "layouts": [], "locale": null, "message_destinations": [], "notifications": null, "overrides": [], "phases": [], "playbooks": null, "regulators": null, "roles": [], "scripts": [], "server_version": {"build_number": 49, "major": 43, "minor": 1, "version": "43.1.49"}, "tags": [], "task_order": [], "timeframes": null, "types": [], "workflows": [{"actions": [], "content": {"version": 115, "workflow_id": "virustotal_scan_hits", "xml": "<?xml version=\"1.0\" encoding=\"UTF-8\"?><definitions xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\" xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\" xmlns:omgdc=\"http://www.omg.org/spec/DD/20100524/DC\" xmlns:omgdi=\"http://www.omg.org/spec/DD/20100524/DI\" xmlns:resilient=\"http://resilient.ibm.com/bpmn\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" targetNamespace=\"http://www.camunda.org/test\"><process id=\"virustotal_scan_hits\" isExecutable=\"true\" name=\"VirusTotal Scan Hits\"><documentation>Perform lookups for artifacts including ip addresses, hashes, domains, and URLS and creates a hit for the artifact if it is deemed potentially malicious by VirusTotal.</documentation><startEvent id=\"StartEvent_155asxm\"><outgoing>SequenceFlow_1mjkb36</outgoing></startEvent><endEvent id=\"EndEvent_1epcalm\"><incoming>SequenceFlow_0ylzp9k</incoming></endEvent><sequenceFlow id=\"SequenceFlow_1mjkb36\" sourceRef=\"StartEvent_155asxm\" targetRef=\"ServiceTask_0m8jdoy\"/><serviceTask id=\"ServiceTask_0m8jdoy\" name=\"VirusTotal\" resilient:type=\"function\"><extensionElements><resilient:function uuid=\"d108590a-21f9-4e42-92c4-d2a6fe39c9b4\">{\"inputs\":{},\"post_processing_script\":\"if results:\\n  scan = results.get('scan')\\n  \\n  if scan.get('positives') is not None:\\n    if scan.get('positives') &gt; 0:\\n      hit = [\\n      {\\n        'name': 'Detection Ratio',\\n        'type': 'number',\\n        'value': '{} / {}'.format(scan.get('positives'), scan.get('total'))\\n      },\\n      {\\n        'name': 'VirusTotal Report',\\n        'type': 'uri',\\n        'value': '{}'.format(scan.get('permalink'))\\n      },\\n      {\\n        \\\"name\\\": \\\"Scan Date\\\",\\n        \\\"type\\\": \\\"string\\\",\\n        \\\"value\\\": \\\"{}\\\".format(scan.get('scan_date'))\\n      }\\n  ]\\n  elif artifact.type == 'DNS Name' or 'IP Address':\\n    test_for_positive = scan.get('detected_urls')\\n    if test_for_positive is not None:\\n      sample = test_for_positive[0]\\n      if sample.get('positives', -1) &gt; 0:\\n        if artifact.type == 'DNS Name':\\n          url_fragment = \\\"domain\\\"\\n        else:\\n          url_fragment = \\\"ip-address\\\"\\n        hit = [\\n                  {\\n                    'name': 'Detected URL\\\\'s Detection Ratio',\\n                    'type': 'number',\\n                    'value': '{} / {}'.format(sample.get('positives'), sample.get('total'))\\n                  },\\n                  {\\n                    'name': 'VirusTotal Report',\\n                    'type': 'uri',\\n                    'value': 'https://www.virustotal.com/{}/{}/information/'.format(url_fragment, artifact.value)\\n                  },\\n                  {\\n                    \\\"name\\\": \\\"Detected URL\\\\'s Scan Date\\\",\\n                    \\\"type\\\": \\\"string\\\",\\n                    \\\"value\\\": \\\"{}\\\".format(sample.get('scan_date'))\\n                  }\\n                ]\\n  else:\\n    hit = [\\n            {\\n              \\\"name\\\": \\\"Artifact Value\\\",\\n              \\\"type\\\": \\\"string\\\",\\n              \\\"value\\\": \\\"{}\\\".format(artifact.value)\\n            },\\n            {\\n              \\\"name\\\": \\\"Verbose Message\\\",\\n              \\\"type\\\": \\\"string\\\",\\n              \\\"value\\\": \\\"{}\\\".format(scan['verbose_msg'])\\n            },\\n            {\\n              'name': 'VirusTotal Report',\\n              'type': 'uri',\\n              'value': '{}'.format(scan.get('permalink'))\\n            }\\n          ]\\n  artifact.addHit(\\\"VirusTotal hits added.\\\", hit)\\n  \\n  if results.scan.get('md5') is not None:\\n    incident.addArtifact('Malware MD5 Hash', scan.get('md5'), None)\\n  \\n  if results.scan.get('sha1') is not None:\\n    incident.addArtifact('Malware SHA-1 Hash', scan.get('sha1'), None)\\n    \\n  if results.scan.get('sha256') is not None:\\n    incident.addArtifact('Malware SHA-256 Hash', scan.get('sha256'), None)\\nelse:\\n  incident.addNote('VirusTotal has failed')\",\"post_processing_script_language\":\"python3\",\"pre_processing_script\":\"typeLookup = { 'Email Attachment': 'file', 'Malware Sample': 'file', 'Malware MD5 Hash': 'hash', 'Malware SHA-1 Hash': 'hash', 'Malware SHA-256 Hash': 'hash', 'Other File': 'file', 'RCF 822 Email Message Fife': 'file', 'File Name': 'filename',\\n 'URL': 'url', 'IP Address': 'ip', 'DNS Name':'domain'}\\nif artifact.type in typeLookup:\\n  inputs.vt_type = typeLookup.get(artifact.type, artifact.type)\\nelse:\\n  inputs.vt_type = artifact.type\\n\\ninputs.incident_id = incident.id\\ninputs.artifact_id = artifact.id\\ninputs.vt_data = artifact.value\",\"pre_processing_script_language\":\"python3\"}</resilient:function></extensionElements><incoming>SequenceFlow_1mjkb36</incoming><outgoing>SequenceFlow_0ylzp9k</outgoing></serviceTask><sequenceFlow id=\"SequenceFlow_0ylzp9k\" sourceRef=\"ServiceTask_0m8jdoy\" targetRef=\"EndEvent_1epcalm\"/><textAnnotation id=\"TextAnnotation_1kxxiyt\"><text>Start your workflow here</text></textAnnotation><association id=\"Association_1seuj48\" sourceRef=\"StartEvent_155asxm\" targetRef=\"TextAnnotation_1kxxiyt\"/><textAnnotation id=\"TextAnnotation_0pzv89z\"><text>Results are returned as a hit in the artifact</text></textAnnotation><association id=\"Association_0yx8oyz\" sourceRef=\"ServiceTask_0m8jdoy\" targetRef=\"TextAnnotation_0pzv89z\"/></process><bpmndi:BPMNDiagram id=\"BPMNDiagram_1\"><bpmndi:BPMNPlane bpmnElement=\"undefined\" id=\"BPMNPlane_1\"><bpmndi:BPMNShape bpmnElement=\"StartEvent_155asxm\" id=\"StartEvent_155asxm_di\"><omgdc:Bounds height=\"36\" width=\"36\" x=\"162\" y=\"188\"/><bpmndi:BPMNLabel><omgdc:Bounds height=\"0\" width=\"90\" x=\"157\" y=\"223\"/></bpmndi:BPMNLabel></bpmndi:BPMNShape><bpmndi:BPMNShape bpmnElement=\"TextAnnotation_1kxxiyt\" id=\"TextAnnotation_1kxxiyt_di\"><omgdc:Bounds height=\"30\" width=\"100\" x=\"99\" y=\"254\"/></bpmndi:BPMNShape><bpmndi:BPMNEdge bpmnElement=\"Association_1seuj48\" id=\"Association_1seuj48_di\"><omgdi:waypoint x=\"169\" xsi:type=\"omgdc:Point\" y=\"220\"/><omgdi:waypoint x=\"153\" xsi:type=\"omgdc:Point\" y=\"254\"/></bpmndi:BPMNEdge><bpmndi:BPMNShape bpmnElement=\"EndEvent_1epcalm\" id=\"EndEvent_1epcalm_di\"><omgdc:Bounds height=\"36\" width=\"36\" x=\"550.1052009456265\" y=\"188\"/><bpmndi:BPMNLabel><omgdc:Bounds height=\"13\" width=\"0\" x=\"568.1052009456265\" y=\"227\"/></bpmndi:BPMNLabel></bpmndi:BPMNShape><bpmndi:BPMNEdge bpmnElement=\"SequenceFlow_1mjkb36\" id=\"SequenceFlow_1mjkb36_di\"><omgdi:waypoint x=\"198\" xsi:type=\"omgdc:Point\" y=\"206\"/><omgdi:waypoint x=\"320\" xsi:type=\"omgdc:Point\" y=\"206\"/><bpmndi:BPMNLabel><omgdc:Bounds height=\"13\" width=\"0\" x=\"259\" y=\"184.5\"/></bpmndi:BPMNLabel></bpmndi:BPMNEdge><bpmndi:BPMNShape bpmnElement=\"ServiceTask_0m8jdoy\" id=\"ServiceTask_0m8jdoy_di\"><omgdc:Bounds height=\"80\" width=\"100\" x=\"319.6205673758865\" y=\"166\"/></bpmndi:BPMNShape><bpmndi:BPMNEdge bpmnElement=\"SequenceFlow_0ylzp9k\" id=\"SequenceFlow_0ylzp9k_di\"><omgdi:waypoint x=\"420\" xsi:type=\"omgdc:Point\" y=\"206\"/><omgdi:waypoint x=\"550\" xsi:type=\"omgdc:Point\" y=\"206\"/><bpmndi:BPMNLabel><omgdc:Bounds height=\"13\" width=\"0\" x=\"485\" y=\"184\"/></bpmndi:BPMNLabel></bpmndi:BPMNEdge><bpmndi:BPMNShape bpmnElement=\"TextAnnotation_0pzv89z\" id=\"TextAnnotation_0pzv89z_di\"><omgdc:Bounds height=\"47\" width=\"105\" x=\"419\" y=\"79\"/></bpmndi:BPMNShape><bpmndi:BPMNEdge bpmnElement=\"Association_0yx8oyz\" id=\"Association_0yx8oyz_di\"><omgdi:waypoint x=\"410\" xsi:type=\"omgdc:Point\" y=\"166\"/><omgdi:waypoint x=\"449\" xsi:type=\"omgdc:Point\" y=\"126\"/></bpmndi:BPMNEdge></bpmndi:BPMNPlane></bpmndi:BPMNDiagram></definitions>"}, "content_version": 115, "creator_id": "admin@example.com", "description": "Perform lookups for artifacts including ip addresses, hashes, domains, and URLS and creates a hit for the artifact if it is deemed potentially malicious by VirusTotal.", "export_key": "virustotal_scan_hits", "last_modified_by": "admin@example.com", "last_modified_time": 1653494162507, "name": "VirusTotal Scan Hits", "object_type": "artifact", "programmatic_name": "virustotal_scan_hits", "tags": [], "uuid": "ca84a31a-54bd-43e6-9613-46220be82a4d", "workflow_id": 22}], "workspaces": []}