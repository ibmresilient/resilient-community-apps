<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-circuits codegen
-->

# Example: PhishTank: Submit URL


## Function - Phish Tank Submit URL

### API Name
`fn_phish_tank_submit_url`

### Function Output Name
`None`

### Pre-Processing Script
```python
# Get the url from the Artifact's Value
inputs.phish_tank_check_url = artifact.value
```

### Post-Processing Script
```python
def append_artifact_description(the_artifact, the_text):
  """Appends the_text to the_artifact.description safely
  handling unicode"""
  
  new_description = u""
  
  if the_artifact.description is None:
    current_description = None
  else:
    current_description = the_artifact.description.get("content", None)

  if current_description is not None:
    new_description = u"{0}<br>---<br>{1}".format(unicode(current_description), unicode(the_text))

  else:
    new_description = u"{0}".format(unicode(the_text))

  the_artifact.description = helper.createRichText(new_description)


if results.success:
  
  # Get the PhishTank Results
  phish_tank_results = results.content.get("results", {})
  url = phish_tank_results.get("url", u"")
  in_database = phish_tank_results.get("in_database", False)
  is_verified = phish_tank_results.get("verified", False)
  is_valid = phish_tank_results.get("valid", False)
  
  # Define the comment and msg to be appended to the Artifact's Description
  comment = u""
  msg = u"""<b>PhishTank Lookup</b> has complete
            <br><b>URL:</b> {0}</b>
            <br><b>Found in Database:</b> {1}""".format(url, unicode(in_database))

  if not in_database:
    comment = u"Nothing known about this url"
  
  else:
    phish_id = phish_tank_results.get("phish_id")
    phish_detail_page_url = phish_tank_results.get("phish_detail_page")
    
    msg = u"""{0}
          <br><b>Phish ID:</b> {1}
          <br><b>Valid Phish:</b> {2}
          <br><b>Verified:</b> {3}
          <br><b>Link to PhishTank: <a href={4}>{4}</a></b>""".format(msg, phish_id, u"Yes" if is_valid else u"No", u"Yes" if is_verified else "No", phish_detail_page_url)
    
    if is_verified and is_valid:
      comment = u"Verified: Is a phishing site"
  
    elif is_verified and not is_valid:
      comment = u"This site is not a phishing site"
      
    elif not is_verified:
      comment = u"This url has not been verified"
  
  msg = u"""{0}<br><br><b>Comment:</b> {1}""".format(msg, comment)
  
  append_artifact_description(artifact, msg)
  incident.addNote(helper.createRichText(msg))
```
---
