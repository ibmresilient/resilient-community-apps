<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-circuits codegen
-->

# Example: ICDx Get Event

## Function - ICDx: Get Event

### API Name
`icdx_get_event`

### Output Name
`None`

### Message Destination
`fn_icdx`

### Pre-Processing Script
```python
inputs.icdx_uuid = row.icdx_uuid

```

### Post-Processing Script
```python
"""
Example of return data 

results = {
            "inputs":{
                "icdx_uuid": The UUID we ran the request with
            },
            "success": True or False,
            "event":  {
              Object containing the ICDx Event data
            },
            "artifacts": {
              Object containing the artifacts we parsed from the event. 
              Structure is name_of_artifact:artifact_data
            },
            "artifact_keys_as_list": [
              List containing the types of artifacts we parsed from the event.
            ],
            "artifact_values_as_list": [
              List containing the artifact data we parsed from the event.
            ]
          }

"""

# Add a note detailing what happened
noteText = u"""<br><b>Get Event request executed on ICDx :</b>
                <br>UUID Provided: <b>{0}</b>""".format(results.inputs["icdx_uuid"])
                
if results.success:
  noteText += u"""<br>Query successful and found an event with matching UUID."""
                  
  if results.event['type'] != None:
    noteText += u"""<br> Type of Event : <b>{0}</b>""".format(results.event["type"])
  else:
    noteText += u"""<br> Event Type ID : <b>{0}</b>""".format(results.event["type_id"])
    
  noteText += u"""<br> Event was gathered from the <b>{0}</b> archive""".format(results.event["log_name"])
  if len(results.artifact_keys_as_list) > 0:
    noteText += """<br>Artifacts generated from Event: <b>{0}</b>""".format("['{}']".format("', '".join(results.artifact_keys_as_list)))
  else:
    noteText += """<br><b>No artifacts generated from Event.</b>"""
else:
  noteText += u"""<br>Query did not find a corresponding event or an exception occured. 
  Check the action status for more information"""
  
incident.addNote(helper.createRichText(noteText))  


# First save the UUID as an artifact, exposing it to artifact level workflows 
incident.addArtifact('String', results.inputs["icdx_uuid"], 'Escalated from ICDx Event with UUID {}. Gathered from the ICDx Utilities Integration'.format(results.inputs["icdx_uuid"]))

""" Will only work in v31 upwards
if results.artifacts not None:
  for artifact_type, artifact_values in results.artifacts.items():
    for artifact_value in artifact_values:
      incident.addArtifact(artifact_type, artifact_value, 'Escalated from ICDx Event with UUID {}. Gathered from the ICDx Utilities Integration'.format(results.inputs["icdx_uuid"]))
"""

# Parse over the keys and values and add them as artifacts
if results.artifact_keys_as_list != None and results.artifact_values_as_list != None:
  for artifact_type, artifact_values in zip(results.artifact_keys_as_list,results.artifact_values_as_list):
    for artifact_value in artifact_values:
      incident.addArtifact(artifact_type, artifact_value, 'Escalated from ICDx Event with UUID {}. Gathered from the ICDx Utilities Integration'.format(results.inputs["icdx_uuid"]))

```

---

