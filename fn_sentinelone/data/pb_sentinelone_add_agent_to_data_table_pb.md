<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v50.0.151
-->

# Playbook - SentinelOne: Add Agent to Data Table (PB)

### API Name
`sentinelone_add_agent_to_data_table_pb`

### Status
`enabled`

### Activation Type
`Automatic`

### Activation Conditions
`incident.properties.sentinelone_agent_id has_a_value AND incident.properties.sentinelone_threat_id has_a_value AND object_added`

### Object Type
`incident`

### Description
Add information from an agent managed by SentinelOne to the SentinelOne Agent data table.


---
## Function - SentinelOne: Get Agent Details

### API Name
`sentinelone_get_agent_details`

### Output Name
`get_agent_results`

### Message Destination
`fn_sentinelone`

### Function-Input Script
```python
inputs.sentinelone_agent_id = incident.properties.sentinelone_agent_id
```

---

## Local script - SentinelOne: Write Agent Details to Data Table

### Description


### Script Type
`Local script`

### Object Type
`incident`

### Script Content
```python
from datetime import datetime
import json

results = playbook.functions.results.get_agent_results
if results.get("success", False):
  note = "<b>SentinelOne: Add Agent to Data Table (PB): </b> \n"
  content = results.get("content", False)
  if content:
    data = content.get("data", False)
    if data:
      data_len = len(data)
      note = "{0} {1} agent added to SentinelOne Agent data table.".format(note, data_len)
      for agent in data:
        agent_row = incident.addRow("sentinelone_agents_dt")
        agent_row.sentinelone_dt_query_date = datetime.now()
        agent_row.sentinelone_dt_agent_id = agent.get("id")
        networkStatus = agent.get("networkStatus")
        display_color = "green" if networkStatus =="connected" else "red"
        networkStatus = u"""<p style= "color:{color}">{status}</p>""".format(color=display_color, status=networkStatus)
        agent_row.sentinelone_dt_network_status = helper.createRichText(networkStatus)
        agent_row.sentinelone_dt_computername = agent.get("computerName")
        agent_row.sentinelone_dt_external_ip = agent.get("externalIp")
        agent_row.sentinelone_dt_site = agent.get("siteName")
        agent_row.sentinelone_dt_agent_version = agent.get("agentVersion")
        agent_row.sentinelone_dt_threat_count = agent.get("activeThreats")
        agent_row.sentinelone_dt_domain = agent.get("domain")
        agent_row.sentinelone_dt_os_name = agent.get("osName")
        agent_row.sentinelone_dt_uuid = agent.get("uuid")
        agent_row.sentinelone_dt_is_active = agent.get("isActive")
        agent_row.sentinelone_dt_registered = agent.get("registeredAt")
        agent_row.sentinelone_dt_created = agent.get("createdAt")
        agent_row.sentinelone_dt_updated = agent.get("updatedAt")
    else:
      note = "{0} No data returned from function.".format(note)
  else:
    note = "{0} No content data returned from function.".format(note)
else:
  note = "{0} function did not return success.".format(note)

incident.addNote(helper.createRichText(note))
```

---

