<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v50.0.151
-->

# Playbook - SentinelOne: Update Case in SOAR

### API Name
`sentinelone_update_case_in_soar`

### Status
`enabled`

### Activation Type
`Automatic`

### Activation Conditions
`incident.plan_status equals Active AND incident.properties.sentinelone_threat_id has_a_value AND object_added`

### Object Type
`incident`

### Description
Automatic playbook to update the SentinelOne case in SOAR.


---
## Function - SentinelOne: Get Threat Details

### API Name
`sentinelone_get_threat_details`

### Output Name
`get_threat_details_results`

### Message Destination
`fn_sentinelone`

### Function-Input Script
```python
inputs.sentinelone_threat_id = incident.properties.sentinelone_threat_id
```

---

## Local script - SentinelOne: Update Case with threat info

### Description
Update custom fields and add artifact with threat information from SentinelOne threat.

### Script Type
`Local script`

### Object Type
`incident`

### Script Content
```python
results = playbook.functions.results.get_threat_details_results

success = results.get("success", False)
if success:
  content = results.get("content", False)
  if content:
    data = content.get("data", [])
    if data and isinstance(data, list):
      threat_data = data[0]
      threat_info = threat_data.get("threatInfo", False)
      if threat_info:

        incident.properties.sentinelone_classification = threat_info.get("classification")
        incident.properties.sentinelone_confidence_level = threat_info.get("confidenceLevel")
        incident.properties.sentinelone_incident_status = threat_info.get("incidentStatus")
        incident.properties.sentinelone_mitigation_status = threat_info.get("mitigationStatus")
        incident.properties.sentinelone_threat_analyst_verdict = threat_info.get("analystVerdict")
        incident.properties.sentinelone_mitigation_status_description = threat_info.get("mitigationStatusDescription")
        
        entity_url = content.get("entity_url", False)
        if entity_url:
          threat_url_link = "<a target='blank' href='{0}'>{1}</a>".format(entity_url, threat_info.get("threatId"))
          incident.properties.sentinelone_threat_overview_url = threat_url_link
            
        # CREATE ARTIFACTS
        # Create any artifacts from the threat or agent info here
        agent_realtime_info = threat_data.get("agentRealtimeInfo", False)
        if agent_realtime_info and agent_realtime_info.get("agentComputerName"):
            incident.addArtifact("System Name", agent_realtime_info.get("agentComputerName"), "Created by SentinelOne")

        agent_detection_info = threat_data.get("agentDetectionInfo")
        if agent_detection_info and agent_detection_info.get("externalIp", False):
            incident.addArtifact("IP Address", agent_detection_info.get("externalIp"), "Created by SentinelOne")
            
        if threat_info.get("processUser"):
            incident.addArtifact("Process Name", threat_info.get("processUser"), "Created by SentinelOne")
           
        if threat_info.get("sha1"):
            incident.addArtifact("Malware SHA-1 Hash", threat_info.get("sha1"), "Created by SentinelOne")
            
        if threat_info.get("filePath"):
            incident.addArtifact("File Path", threat_info.get("filePath"), "Created by SentinelOne")
            
        if threat_info.get("threatName"):
            threat_name = threat_info.get("threatName")
            threat_name = threat_name.replace('\\', '\\\\')
            threat_name = threat_name.replace('"', '\\"')
            incident.addArtifact("File Name", threat_name, "Created by SentinelOne")
      else:
        incident.addNote("SentinelOne: Update Case: Unable to get threat info data to update case.")
    else: 
      incident.addNote("SentinelOne: Update Case: Unable to get data to update case.")
  else:
    incident.addNote("SentinelOne: Update Case: Unable to get content data to update case.")
else:
  incident.addNote("SentinelOne: Update Case: Unable to get threat data to update case.")
            
```

---

