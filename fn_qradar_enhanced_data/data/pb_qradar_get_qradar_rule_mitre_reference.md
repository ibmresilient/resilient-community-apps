<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v51.0.6.0.1543
-->

# Playbook - QRadar Get MITRE Reference From Rules

### API Name
`qradar_get_qradar_rule_mitre_reference`

### Status
`enabled`

### Activation Type
`Manual`

### Activation Conditions
`incident.properties.qradar_id has_a_value`

### Object Type
`incident`

### Description
Using the QRadar ID for the offense in question, this playbook will retrieve the related MITRE Tactics and Techniques from QRadar based on the defined rules.


---
## Function - QRadar Get Offense MITRE Reference

### API Name
`qradar_get_offense_mitre_reference`

### Output Name
`mitre_results`

### Message Destination
`fn_qradar_enhanced_data`

### Function-Input Script
```python
inputs.qradar_offense_id = incident.properties.qradar_id
inputs.qradar_label = incident.properties.qradar_destination
inputs.soar_incident_id = incident.id
inputs.soar_table_name = "qradar_rules_and_mitre_tactics_and_techniques"
```

---

## Local script - Post-process

### Description


### Script Type
`Local script`

### Object Type
`incident`

### Script Content
```python
mitre_results = playbook.functions.results.mitre_results

if mitre_results.get("success"):
  for item in mitre_results.get("content", {}).get('rules'):
    mapping = item.get('mapping')
    if mapping:
      for tactic in list(mapping):
        techniques = mapping.get(tactic).get('techniques')
        if techniques:
          for technique in list(techniques):
            new_row = incident.addRow('qradar_rules_and_mitre_tactics_and_techniques')
            new_row.rule_id = item.get('id')
            new_row.rule_identifier = item.get('identifier')
            new_row.rule_name = item.get('name')
            new_row.mitre_tactic = tactic
            new_row.mitre_tactic_id = mapping.get(tactic).get('id')
            new_row.tactic_confidence_level = mapping.get(tactic).get('confidence')
            new_row.mitre_technique = technique
            new_row.mitre_technique_id = techniques.get(technique).get('id')
            new_row.technique_confidence_level = techniques.get(technique).get('confidence')
        else:
          new_row = incident.addRow('qradar_rules_and_mitre_tactics_and_techniques')
          new_row.rule_id = item.get('id')
          new_row.rule_identifier = item.get('identifier')
          new_row.rule_name = item.get('name')
          new_row.mitre_tactic = tactic
          new_row.mitre_tactic_id = mapping.get(tactic).get('id')
          new_row.tactic_confidence_level = mapping.get(tactic).get('confidence')
    else:
      new_row = incident.addRow('qradar_rules_and_mitre_tactics_and_techniques')
      new_row.rule_id = item.get('id')
      new_row.rule_identifier = item.get('identifier')
      new_row.rule_name = item.get('name')
```

---

