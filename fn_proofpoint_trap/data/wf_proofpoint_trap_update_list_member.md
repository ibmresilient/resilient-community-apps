<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v51.0.5.0.1475
-->

# Example: Proofpoint TRAP: Update List Member

## Function - Proofpoint TRAP: Update List Member

### API Name
`fn_proofpoint_trap_update_list_member`

### Output Name
`None`

### Message Destination
`fn_proofpoint_trap`

### Pre-Processing Script
```python
inputs.trap_list_id = row.list_id
inputs.trap_member_id = row.member_id
inputs.trap_description = rule.properties.trap_description
inputs.trap_expiration =  rule.properties.trap_expiration
inputs.trap_duration =  rule.properties.trap_duration
```

### Post-Processing Script
```python
##  ProofPoint Trap - fn_proofpoint_trap_update_list_member ##
# Example result:

"""
Results {'inputs': {u'trap_list_id': 2, u'trap_expiration': 1567527591000, u'trap_description': u'Test',
                    u'trap_member_id': 8, u'trap_duration': 10},
         'metrics': {'package': 'fn-proofpoint-trap', 'timestamp': '2019-09-03 17:19:57', 'package_version': '1.0.0',
                     'host': 'myhost.ibm.com', 'version': '1.0', 'execution_time_ms': 33
                     }, 'success': True,
         'content': {u'user_id': None, u'description': u'Updated IP to block', u'deleted': False,
                     u'created_at': u'2017-01-11T03:47:15Z', u'enabled': True, u'updated_at': u'2017-01-11T03:47:15Z',
                     u'host': {u'created_at': u'2017-01-11T03:47:15Z', u'updated_at': u'2017-01-11T03:47:15Z',
                               u'host': u'75.76.13.144', u'ttl': 0, u'resolution_state': 4, u'id': 20
                               },
                     u'response_id': None, u'expiration': u'2018-12-18T19:08:56Z', u'list_id': 2, u'host_id': 20,
                     u'hash_reputation_id': None, u'id': 8, u'reverse_user_id': None
                     },
         'raw': '{"user_id": null, "description": "Updated IP to block", "deleted": false, "created_at": "2017-01-11T03:47:15Z", '
                '"enabled": true, "updated_at": "2017-01-11T03:47:15Z", "host": {"created_at": "2017-01-11T03:47:15Z", '
                '"updated_at": "2017-01-11T03:47:15Z", "host": "75.76.13.144", "ttl": 0, "resolution_state": 4, "id": 20}, '
                '"response_id": null, "expiration": "2018-12-18T19:08:56Z", "list_id": 2, "host_id": 20, "hash_reputation_id": null, '
                '"id": 8, "reverse_user_id": null}',
         'reason': None,
         'version': '1.0'
}
"""

#  Globals
# List of fields in datatable "Proofpoint TRAP List Members" for fn_proofpoint_trap_get_list_members script
DATA_TBL_FIELDS = ["query_execution_time", "member_id", "list_id", "member_description", "expiration", "created_at", "status"]
DATA_TBL_FIELDS_HOST = ["created_at", "updated_at", "host", "resolution_state", "ttl"]
FN_NAME = "fn_proofpoint_trap_update_list_member"
WF_NAME = "Example: Proofpoint TRAP: Update List Member"
MEMBER = results.content
QUERY_EXECUTION_DATE = results["metrics"]["timestamp"]

# Processing


def main():
    note_text = ''
    if MEMBER:
        note_text = "ProofPoint Trap Integration Integration: Workflow <b>{0}</b>: There was a valid result returned for Resilient function " \
                   "<b>{1}</b>".format(WF_NAME, FN_NAME)

        row.query_execution_date = QUERY_EXECUTION_DATE
        row.member_id = MEMBER["id"]
        row.member_description = MEMBER["description"]
        for f in DATA_TBL_FIELDS:
            if f in ["query_execution_time", "member_id", "member_description", "status"]:
                continue
            if MEMBER[f]:
                  row[f] = MEMBER[f]
        if MEMBER["enabled"]:
            row.status = "Enabled"
        host = MEMBER["host"]
        if host:
            for d in DATA_TBL_FIELDS_HOST:
                if isinstance(host[d], int):
                    row[d] = str(host[d])
                else:
                    row[d] = host[d]
    else:
        noteText += "ProofPoint Trap Integration: Workflow <b>{0}</b>: There were <b>no</b> results returned  for " \
                    "list id <b>{1}</b> for Resilient function <b>{3}</b>".format(WF_NAME, INPUTS["trap_list_id"], FN_NAME)

    incident.addNote(helper.createRichText(note_text))

if __name__ == "__main__":
    main()
```

---

