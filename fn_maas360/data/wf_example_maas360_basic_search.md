<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-circuits codegen
-->

# Example: MaaS360 Basic Search

## Function - MaaS360 Basic Search

### API Name
`maas360_basic_search`

### Output Name
`None`

### Message Destination
`fn_maas360`

### Pre-Processing Script
```python
inputs.maas360_device_id = rule.properties.maas360_rule_device_id if rule.properties.maas360_rule_device_id is not None else inputs.maas360_device_id
inputs.maas360_partial_device_name = rule.properties.maas360_rule_device_name if rule.properties.maas360_rule_device_name is not None else inputs.maas360_partial_device_name
inputs.maas360_email = rule.properties.maas360_rule_email if rule.properties.maas360_rule_email is not None else inputs.maas360_email
inputs.maas360_imei_meid = rule.properties.maas360_rule_imei_meid if rule.properties.maas360_rule_imei_meid is not None else inputs.maas360_imei_meid
inputs.maas360_partial_phone_no = rule.properties.maas360_rule_phone_no if rule.properties.maas360_rule_phone_no is not None else inputs.maas360_partial_phone_no
inputs.maas360_platform_name = rule.properties.maas360_rule_platform_name if rule.properties.maas360_rule_platform_name is not None else inputs.maas360_platform_name
inputs.maas360_partial_username = rule.properties.maas360_rule_username if rule.properties.maas360_rule_username is not None else inputs.maas360_partial_username
```

### Post-Processing Script
```python
from java.util import Date

def add_row(device):
  device_dt = incident.addRow("maas360_device_dt")
  device_dt.maas360_timestamp = Date()
  device_dt.maas360_deviceid = device.get("maas360DeviceID")
  device_dt.maas360_devicename = device.get("deviceName")
  device_dt.maas360_username = device.get("username")
  device_dt.maas360_platformname = device.get("platformName")
  device_dt.maas360_devicetype = device.get("deviceType")
  device_dt.maas360_lastreported = device.get("lastReported")
  device_dt.maas360_devicestatus = device.get("deviceStatus")

# Print empty string instead of None
def string_value(value):
  return value if value is not None else ""

def add_results_note(inputs, number_devices_found):
  noteText = u"""{} device/s found in MaaS360 database with search parameters: 
    - partialDeviceName: '{}' 
    - partialUsername: '{}'
    - partialPhoneNumber: '{}'
    - imeiMeid: '{}'
    - platformName: '{}'
    - maas360DeviceId: '{}'
    - email: '{}'""".format(
      number_devices_found,
      string_value(inputs.get("maas360_partial_device_name")), 
      string_value(inputs.get("maas360_partial_username")), 
      string_value(inputs.get("maas360_partial_phone_no")), 
      string_value(inputs.get("maas360_imei_meid")),
      string_value(inputs.get("maas360_platform_name").get("name")) if inputs.get("maas360_platform_name") else "",
      string_value(inputs.get("maas360_device_id")),
      string_value(inputs.get("maas360_email"))
      )
  incident.addNote(noteText)

########################
# Mainline starts here #
########################

if results and results.get("success"):
  count = 0
  content = results.get("content")
  if content:
    count = content.get("count")
    if count > 0:
      # Add a row for each Device found
      devices_list = [content.get("device")] if count == 1 else content.get("device")
      map(lambda device: add_row(device), devices_list)
  
  # Write results to a Note
  inputs = results.get("inputs")
  add_results_note(inputs, count)
```

---

