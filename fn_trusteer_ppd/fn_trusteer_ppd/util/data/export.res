{
  "action_order": [],
  "actions": [
    {
      "automations": [
        {
          "scripts_to_run": "Trusteer PPD: Create Case from Email v1.0.0",
          "type": "run_script",
          "value": null
        }
      ],
      "conditions": [
        {
          "evaluation_id": null,
          "field_name": "__emailmessage.body",
          "method": "contains",
          "type": null,
          "value": "Trusteer"
        },
        {
          "evaluation_id": null,
          "field_name": "__emailmessage.subject",
          "method": "contains",
          "type": null,
          "value": "New Feed"
        },
        {
          "evaluation_id": null,
          "field_name": null,
          "method": "object_added",
          "type": null,
          "value": null
        }
      ],
      "enabled": true,
      "export_key": "Trusteer PPD: Parse Trusteer Email v1.0.0",
      "id": 42,
      "logic_type": "all",
      "message_destinations": [],
      "name": "Trusteer PPD: Parse Trusteer Email v1.0.0",
      "object_type": "__emailmessage",
      "tags": [],
      "timeout_seconds": 86400,
      "type": 0,
      "uuid": "8b5a4f26-e817-4a5c-a9d1-8a5560009035",
      "view_items": [],
      "workflows": []
    }
  ],
  "apps": [],
  "automatic_tasks": [],
  "export_date": 1678224288402,
  "export_format_version": 2,
  "export_type": null,
  "fields": [
    {
      "allow_default_value": false,
      "blank_option": false,
      "calculated": false,
      "changeable": true,
      "chosen": false,
      "default_chosen_by_server": false,
      "deprecated": false,
      "export_key": "__function/trusteer_ppd_device_id",
      "hide_notification": false,
      "id": 364,
      "input_type": "text",
      "internal": false,
      "is_tracked": false,
      "name": "trusteer_ppd_device_id",
      "operation_perms": {},
      "operations": [],
      "placeholder": "",
      "prefix": null,
      "read_only": false,
      "rich_text": false,
      "tags": [],
      "templates": [],
      "text": "trusteer_ppd_device_id",
      "tooltip": "",
      "type_id": 11,
      "uuid": "94c68cd3-fbc1-4d8b-8fad-38d337f1d15a",
      "values": []
    },
    {
      "allow_default_value": false,
      "blank_option": true,
      "calculated": false,
      "changeable": true,
      "chosen": false,
      "default_chosen_by_server": false,
      "deprecated": false,
      "export_key": "__function/trusteer_ppd_fraud_mo",
      "hide_notification": false,
      "id": 386,
      "input_type": "select",
      "internal": false,
      "is_tracked": false,
      "name": "trusteer_ppd_fraud_mo",
      "operation_perms": {},
      "operations": [],
      "placeholder": "",
      "prefix": null,
      "read_only": false,
      "rich_text": false,
      "tags": [],
      "templates": [],
      "text": "trusteer_ppd_fraud_mo",
      "tooltip": "If you set feedback to confirmed_fraud and confirm that the session was fraudulent, you can also set the specific type of fraud that occurred. If you are not sure of the type of fraud, do not set the fraud_mo field.",
      "type_id": 11,
      "uuid": "c28e15bf-cf29-43ca-ab31-2f970856a58c",
      "values": [
        {
          "default": false,
          "enabled": true,
          "hidden": false,
          "label": "account_takeover",
          "properties": null,
          "uuid": "3b0c855d-b6c8-4bc9-94c1-eb5ae9f715c8",
          "value": 196
        },
        {
          "default": false,
          "enabled": true,
          "hidden": false,
          "label": "remote_access_tool",
          "properties": null,
          "uuid": "9df281ae-23dc-4392-81de-e1bb4c969c20",
          "value": 197
        },
        {
          "default": false,
          "enabled": true,
          "hidden": false,
          "label": "first_party",
          "properties": null,
          "uuid": "da1b11f2-3e9f-46da-882c-72fc0beb226e",
          "value": 198
        },
        {
          "default": false,
          "enabled": true,
          "hidden": false,
          "label": "social_engineering",
          "properties": null,
          "uuid": "2893a025-544d-43b9-8691-4c3a5905e9d5",
          "value": 199
        },
        {
          "default": false,
          "enabled": true,
          "hidden": false,
          "label": "stolen_device",
          "properties": null,
          "uuid": "b91cfe37-4a74-4e4f-9aa0-c7ce7639d729",
          "value": 200
        },
        {
          "default": false,
          "enabled": true,
          "hidden": false,
          "label": "mule_account",
          "properties": null,
          "uuid": "557ae445-af24-418a-9553-44cb33ae599e",
          "value": 201
        }
      ]
    },
    {
      "allow_default_value": false,
      "blank_option": false,
      "calculated": false,
      "changeable": true,
      "chosen": false,
      "default_chosen_by_server": false,
      "deprecated": false,
      "export_key": "__function/trusteer_ppd_feedback",
      "hide_notification": false,
      "id": 387,
      "input_type": "select",
      "internal": false,
      "is_tracked": false,
      "name": "trusteer_ppd_feedback",
      "operation_perms": {},
      "operations": [],
      "placeholder": "",
      "prefix": null,
      "read_only": false,
      "required": "always",
      "rich_text": false,
      "tags": [],
      "templates": [],
      "text": "trusteer_ppd_feedback",
      "tooltip": "",
      "type_id": 11,
      "uuid": "e838b1bc-74c3-4e17-9238-f585ae20cdb1",
      "values": [
        {
          "default": false,
          "enabled": true,
          "hidden": false,
          "label": "confirmed_fraud",
          "properties": null,
          "uuid": "6bf41799-a023-4e45-8b39-e6a58f5d6f5e",
          "value": 202
        },
        {
          "default": false,
          "enabled": true,
          "hidden": false,
          "label": "confirmed_legitimate",
          "properties": null,
          "uuid": "74858565-dcf5-4940-b710-600b2f869887",
          "value": 203
        },
        {
          "default": false,
          "enabled": true,
          "hidden": false,
          "label": "undetermined",
          "properties": null,
          "uuid": "b767b74c-c81e-437d-a75b-8bde0f38b13e",
          "value": 204
        },
        {
          "default": false,
          "enabled": true,
          "hidden": false,
          "label": "pending_confirmation",
          "properties": null,
          "uuid": "6bf08009-bc9e-4114-a7ae-e44785fe1a01",
          "value": 205
        }
      ]
    },
    {
      "allow_default_value": false,
      "blank_option": false,
      "calculated": false,
      "changeable": true,
      "chosen": false,
      "default_chosen_by_server": false,
      "deprecated": false,
      "export_key": "__function/trusteer_ppd_classification",
      "hide_notification": false,
      "id": 385,
      "input_type": "text",
      "internal": false,
      "is_tracked": false,
      "name": "trusteer_ppd_classification",
      "operation_perms": {},
      "operations": [],
      "placeholder": "",
      "prefix": null,
      "read_only": false,
      "required": "always",
      "rich_text": false,
      "tags": [],
      "templates": [],
      "text": "trusteer_ppd_classification",
      "tooltip": "",
      "type_id": 11,
      "uuid": "f3ab3008-8cd9-4193-84cc-aed6c2235390",
      "values": []
    },
    {
      "allow_default_value": false,
      "blank_option": false,
      "calculated": false,
      "changeable": true,
      "chosen": false,
      "default_chosen_by_server": false,
      "deprecated": false,
      "export_key": "__function/trusteer_ppd_session_id",
      "hide_notification": false,
      "id": 378,
      "input_type": "text",
      "internal": false,
      "is_tracked": false,
      "name": "trusteer_ppd_session_id",
      "operation_perms": {},
      "operations": [],
      "placeholder": "",
      "prefix": null,
      "read_only": false,
      "required": "always",
      "rich_text": false,
      "tags": [],
      "templates": [],
      "text": "trusteer_ppd_session_id",
      "tooltip": "",
      "type_id": 11,
      "uuid": "0a74af58-481e-4376-8a6f-78b5e14196ab",
      "values": []
    },
    {
      "allow_default_value": false,
      "blank_option": false,
      "calculated": false,
      "changeable": true,
      "chosen": false,
      "default_chosen_by_server": false,
      "deprecated": false,
      "export_key": "__function/trusteer_ppd_puid",
      "hide_notification": false,
      "id": 349,
      "input_type": "text",
      "internal": false,
      "is_tracked": false,
      "name": "trusteer_ppd_puid",
      "operation_perms": {},
      "operations": [],
      "placeholder": "",
      "prefix": null,
      "read_only": false,
      "rich_text": false,
      "tags": [],
      "templates": [],
      "text": "trusteer_ppd_puid",
      "tooltip": "",
      "type_id": 11,
      "uuid": "25f7afc6-af7e-4180-9c3b-c5e1532fcaf5",
      "values": []
    },
    {
      "allow_default_value": false,
      "blank_option": false,
      "calculated": false,
      "changeable": true,
      "chosen": false,
      "default_chosen_by_server": false,
      "deprecated": false,
      "export_key": "__function/trusteer_ppd_application_id",
      "hide_notification": false,
      "id": 377,
      "input_type": "text",
      "internal": false,
      "is_tracked": false,
      "name": "trusteer_ppd_application_id",
      "operation_perms": {},
      "operations": [],
      "placeholder": "",
      "prefix": null,
      "read_only": false,
      "required": "always",
      "rich_text": false,
      "tags": [],
      "templates": [],
      "text": "trusteer_ppd_application_id",
      "tooltip": "",
      "type_id": 11,
      "uuid": "595d60ca-7d9f-4ccb-89a7-ab0326cfa71e",
      "values": []
    },
    {
      "allow_default_value": false,
      "blank_option": false,
      "calculated": false,
      "changeable": true,
      "chosen": false,
      "default_chosen_by_server": false,
      "deprecated": false,
      "export_key": "__function/incident_id",
      "hide_notification": false,
      "id": 300,
      "input_type": "number",
      "internal": false,
      "is_tracked": false,
      "name": "incident_id",
      "operation_perms": {},
      "operations": [],
      "placeholder": "",
      "prefix": null,
      "read_only": false,
      "required": "always",
      "rich_text": false,
      "tags": [],
      "templates": [],
      "text": "incident_id",
      "tooltip": "",
      "type_id": 11,
      "uuid": "68e6aeb2-30a3-4103-b8ef-aef67489a5b0",
      "values": []
    },
    {
      "allow_default_value": false,
      "blank_option": false,
      "calculated": false,
      "changeable": true,
      "chosen": false,
      "default_chosen_by_server": false,
      "deprecated": false,
      "export_key": "incident/trusteer_ppd_link_to_puid",
      "hide_notification": false,
      "id": 340,
      "input_type": "textarea",
      "internal": false,
      "is_tracked": false,
      "name": "trusteer_ppd_link_to_puid",
      "operation_perms": {},
      "operations": [],
      "placeholder": "",
      "prefix": "properties",
      "read_only": false,
      "rich_text": true,
      "short_text": "",
      "tags": [],
      "templates": [],
      "text": "Link to PUID",
      "tooltip": "",
      "type_id": 0,
      "uuid": "a098449e-472c-4114-8721-4b4d9b395a90",
      "values": []
    },
    {
      "allow_default_value": false,
      "blank_option": false,
      "calculated": false,
      "changeable": true,
      "chosen": false,
      "default_chosen_by_server": false,
      "deprecated": false,
      "export_key": "incident/trusteer_ppd_puid",
      "hide_notification": false,
      "id": 348,
      "input_type": "text",
      "internal": false,
      "is_tracked": false,
      "name": "trusteer_ppd_puid",
      "operation_perms": {},
      "operations": [],
      "placeholder": "",
      "prefix": "properties",
      "read_only": false,
      "rich_text": false,
      "short_text": "",
      "tags": [],
      "templates": [],
      "text": "PUID",
      "tooltip": "Permanent User ID",
      "type_id": 0,
      "uuid": "d29976a1-b520-427f-8948-5ff4c0a9ec94",
      "values": []
    },
    {
      "allow_default_value": false,
      "blank_option": false,
      "calculated": false,
      "changeable": true,
      "chosen": false,
      "default_chosen_by_server": false,
      "deprecated": false,
      "export_key": "incident/trusteer_ppd_application_id",
      "hide_notification": false,
      "id": 341,
      "input_type": "text",
      "internal": false,
      "is_tracked": false,
      "name": "trusteer_ppd_application_id",
      "operation_perms": {},
      "operations": [],
      "placeholder": "",
      "prefix": "properties",
      "read_only": false,
      "rich_text": false,
      "short_text": "",
      "tags": [],
      "templates": [],
      "text": "Application ID",
      "tooltip": "",
      "type_id": 0,
      "uuid": "70d6911c-d99c-4d5c-b6ad-c62cf402b2f5",
      "values": []
    },
    {
      "export_key": "incident/internal_customizations_field",
      "id": 0,
      "input_type": "text",
      "internal": true,
      "name": "internal_customizations_field",
      "read_only": true,
      "text": "Customizations Field (internal)",
      "type_id": 0,
      "uuid": "bfeec2d4-3770-11e8-ad39-4a0004044aa1"
    }
  ],
  "functions": [
    {
      "created_date": 1675716135418,
      "description": {
        "content": "Return the URL links to the Trusteer session PUIDs and the devices.",
        "format": "text"
      },
      "destination_handle": "fn_trusteer_ppd",
      "display_name": "Trusteer PPD: Get URL Links to Trusteer",
      "export_key": "trusteer_ppd_get_url_links_to_trusteer",
      "id": 14,
      "last_modified_by": {
        "display_name": "Admin User",
        "id": 1,
        "name": "admin@example.com",
        "type": "user"
      },
      "last_modified_time": 1675716135449,
      "name": "trusteer_ppd_get_url_links_to_trusteer",
      "tags": [],
      "uuid": "98578308-8c7b-4f7e-8990-88a0b809a58b",
      "version": 1,
      "view_items": [
        {
          "content": "25f7afc6-af7e-4180-9c3b-c5e1532fcaf5",
          "element": "field_uuid",
          "field_type": "__function",
          "show_if": null,
          "show_link_header": false,
          "step_label": null
        },
        {
          "content": "94c68cd3-fbc1-4d8b-8fad-38d337f1d15a",
          "element": "field_uuid",
          "field_type": "__function",
          "show_if": null,
          "show_link_header": false,
          "step_label": null
        }
      ],
      "workflows": []
    },
    {
      "created_date": 1676317337631,
      "description": {
        "content": "Update the alert classification in Trusteer to one of: \nconfirmed_fraud\nconfirmed_legitimate\nundetermined\npending_confirmation  \n\nIf the feedback is confirmed_fraud, then the optional fraud_mo parameter can provide more information: \naccount_takeover\nremote_access_tool\nfirst_party\nsocial_engineering\nstolen_device\nmule_account",
        "format": "text"
      },
      "destination_handle": "fn_trusteer_ppd",
      "display_name": "Trusteer PPD: Update Alert Classification",
      "export_key": "trusteer_ppd_update_alert_classification",
      "id": 15,
      "last_modified_by": {
        "display_name": "Admin User",
        "id": 1,
        "name": "admin@example.com",
        "type": "user"
      },
      "last_modified_time": 1677774643071,
      "name": "trusteer_ppd_update_alert_classification",
      "tags": [],
      "uuid": "33cacd1a-2705-4218-8ea0-7217c0444506",
      "version": 9,
      "view_items": [
        {
          "content": "0a74af58-481e-4376-8a6f-78b5e14196ab",
          "element": "field_uuid",
          "field_type": "__function",
          "show_if": null,
          "show_link_header": false,
          "step_label": null
        },
        {
          "content": "595d60ca-7d9f-4ccb-89a7-ab0326cfa71e",
          "element": "field_uuid",
          "field_type": "__function",
          "show_if": null,
          "show_link_header": false,
          "step_label": null
        },
        {
          "content": "e838b1bc-74c3-4e17-9238-f585ae20cdb1",
          "element": "field_uuid",
          "field_type": "__function",
          "show_if": null,
          "show_link_header": false,
          "step_label": null
        },
        {
          "content": "c28e15bf-cf29-43ca-ab31-2f970856a58c",
          "element": "field_uuid",
          "field_type": "__function",
          "show_if": null,
          "show_link_header": false,
          "step_label": null
        }
      ],
      "workflows": []
    },
    {
      "created_date": 1677616587493,
      "description": {
        "content": "Update the Trusteer Alert data table Classification column for all rows with the same session ID.",
        "format": "text"
      },
      "destination_handle": "fn_trusteer_ppd",
      "display_name": "Trusteer PPD: Update Classification in Alert Datatable",
      "export_key": "trusteer_ppd_update_classification_in_alert_datatable",
      "id": 16,
      "last_modified_by": {
        "display_name": "Admin User",
        "id": 1,
        "name": "admin@example.com",
        "type": "user"
      },
      "last_modified_time": 1677617018324,
      "name": "trusteer_ppd_update_classification_in_alert_datatable",
      "tags": [],
      "uuid": "55eed36e-3fbb-4e4b-9920-2ea13089da31",
      "version": 2,
      "view_items": [
        {
          "content": "68e6aeb2-30a3-4103-b8ef-aef67489a5b0",
          "element": "field_uuid",
          "field_type": "__function",
          "show_if": null,
          "show_link_header": false,
          "step_label": null
        },
        {
          "content": "0a74af58-481e-4376-8a6f-78b5e14196ab",
          "element": "field_uuid",
          "field_type": "__function",
          "show_if": null,
          "show_link_header": false,
          "step_label": null
        },
        {
          "content": "f3ab3008-8cd9-4193-84cc-aed6c2235390",
          "element": "field_uuid",
          "field_type": "__function",
          "show_if": null,
          "show_link_header": false,
          "step_label": null
        }
      ],
      "workflows": []
    }
  ],
  "geos": null,
  "groups": null,
  "id": 233,
  "inbound_destinations": [],
  "inbound_mailboxes": null,
  "incident_artifact_types": [
    {
      "default_scan_option": "unsupported",
      "desc": "Device ID from Trusteer Pinpoint Detect Alert",
      "enabled": true,
      "export_key": "trusteer_ppd_device_id",
      "file": false,
      "id": 0,
      "multi_aware": false,
      "name": "Trusteer Device ID",
      "parse_as_csv": false,
      "programmatic_name": "trusteer_ppd_device_id",
      "reg_exp": null,
      "system": false,
      "tags": [],
      "use_for_relationships": true,
      "uuid": "2afc6fb0-86ed-4d9e-8eae-9c450bb275b6",
      "version": 2
    }
  ],
  "incident_types": [
    {
      "create_date": 1678224286335,
      "description": "Customization Packages (internal)",
      "enabled": false,
      "export_key": "Customization Packages (internal)",
      "hidden": false,
      "id": 0,
      "name": "Customization Packages (internal)",
      "parent_id": null,
      "system": false,
      "update_date": 1678224286335,
      "uuid": "bfeec2d4-3770-11e8-ad39-4a0004044aa0"
    }
  ],
  "industries": null,
  "layouts": [],
  "locale": null,
  "message_destinations": [
    {
      "api_keys": [],
      "destination_type": 0,
      "expect_ack": true,
      "export_key": "fn_trusteer_ppd",
      "name": "fn_trusteer_ppd",
      "programmatic_name": "fn_trusteer_ppd",
      "tags": [],
      "users": [
        "admin@example.com"
      ],
      "uuid": "b35ba6b9-bbdd-47a7-9fff-a31f70428a59"
    }
  ],
  "notifications": null,
  "overrides": null,
  "phases": [],
  "playbooks": [
    {
      "activation_type": "manual",
      "content": {
        "content_version": 3,
        "xml": "\u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\u003cdefinitions xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\" xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\" xmlns:omgdc=\"http://www.omg.org/spec/DD/20100524/DC\" xmlns:omgdi=\"http://www.omg.org/spec/DD/20100524/DI\" xmlns:resilient=\"http://resilient.ibm.com/bpmn\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" targetNamespace=\"http://www.camunda.org/test\"\u003e\u003cprocess id=\"playbook_585a718a_b30e_43ed_be1a_01021dab06ce\" isExecutable=\"true\" name=\"playbook_585a718a_b30e_43ed_be1a_01021dab06ce\"\u003e\u003cdocumentation/\u003e\u003cstartEvent id=\"StartEvent_155asxm\"\u003e\u003coutgoing\u003eFlow_0k140fy\u003c/outgoing\u003e\u003c/startEvent\u003e\u003cscriptTask id=\"ScriptTask_1\" name=\"Trusteer PPD: Create Artifacts\"\u003e\u003cextensionElements\u003e\u003cresilient:script uuid=\"3c819446-45fa-4649-b61d-21543c856bd3\"/\u003e\u003c/extensionElements\u003e\u003cincoming\u003eFlow_0k140fy\u003c/incoming\u003e\u003coutgoing\u003eFlow_0ggl6yg\u003c/outgoing\u003e\u003cscript\u003escript\u003c/script\u003e\u003c/scriptTask\u003e\u003csequenceFlow id=\"Flow_0k140fy\" sourceRef=\"StartEvent_155asxm\" targetRef=\"ScriptTask_1\"/\u003e\u003cendEvent id=\"EndPoint_2\" resilient:documentation=\"End point\"\u003e\u003cincoming\u003eFlow_0ggl6yg\u003c/incoming\u003e\u003c/endEvent\u003e\u003csequenceFlow id=\"Flow_0ggl6yg\" sourceRef=\"ScriptTask_1\" targetRef=\"EndPoint_2\"/\u003e\u003c/process\u003e\u003cbpmndi:BPMNDiagram id=\"BPMNDiagram_1\"\u003e\u003cbpmndi:BPMNPlane bpmnElement=\"playbook_585a718a_b30e_43ed_be1a_01021dab06ce\" id=\"BPMNPlane_1\"\u003e\u003cbpmndi:BPMNEdge bpmnElement=\"Flow_0ggl6yg\" id=\"Flow_0ggl6yg_di\"\u003e\u003comgdi:waypoint x=\"721\" y=\"312\"/\u003e\u003comgdi:waypoint x=\"721\" y=\"394\"/\u003e\u003c/bpmndi:BPMNEdge\u003e\u003cbpmndi:BPMNEdge bpmnElement=\"Flow_0k140fy\" id=\"Flow_0k140fy_di\"\u003e\u003comgdi:waypoint x=\"721\" y=\"117\"/\u003e\u003comgdi:waypoint x=\"721\" y=\"228\"/\u003e\u003c/bpmndi:BPMNEdge\u003e\u003cbpmndi:BPMNShape bpmnElement=\"StartEvent_155asxm\" id=\"StartEvent_155asxm_di\"\u003e\u003comgdc:Bounds height=\"52\" width=\"199.65\" x=\"621\" y=\"65\"/\u003e\u003cbpmndi:BPMNLabel\u003e\u003comgdc:Bounds height=\"0\" width=\"90\" x=\"616\" y=\"100\"/\u003e\u003c/bpmndi:BPMNLabel\u003e\u003c/bpmndi:BPMNShape\u003e\u003cbpmndi:BPMNShape bpmnElement=\"ScriptTask_1\" id=\"ScriptTask_1_di\"\u003e\u003comgdc:Bounds height=\"84\" width=\"196\" x=\"623\" y=\"228.35000610351562\"/\u003e\u003c/bpmndi:BPMNShape\u003e\u003cbpmndi:BPMNShape bpmnElement=\"EndPoint_2\" id=\"EndPoint_2_di\"\u003e\u003comgdc:Bounds height=\"52\" width=\"132.15\" x=\"655\" y=\"394.3500061035156\"/\u003e\u003c/bpmndi:BPMNShape\u003e\u003c/bpmndi:BPMNPlane\u003e\u003c/bpmndi:BPMNDiagram\u003e\u003c/definitions\u003e"
      },
      "create_date": 1676407953300,
      "creator_principal": {
        "display_name": "Admin User",
        "id": 1,
        "name": "admin@example.com",
        "type": "user"
      },
      "deployment_id": "playbook_585a718a_b30e_43ed_be1a_01021dab06ce",
      "description": {
        "content": "Manual playbook that runs off a row of the Trusteer Alerts data table. Create artifacts from the columns of the Trusteer Alerts data table.",
        "format": "text"
      },
      "display_name": "Trusteer PPD: Create Artifacts",
      "export_key": "trusteer_ppd_create_artifacts",
      "field_type_handle": "playbook_585a718a_b30e_43ed_be1a_01021dab06ce",
      "fields_type": {
        "actions": [],
        "display_name": "Trusteer PPD: Create Artifacts",
        "export_key": "playbook_585a718a_b30e_43ed_be1a_01021dab06ce",
        "fields": {},
        "for_actions": false,
        "for_custom_fields": false,
        "for_notifications": false,
        "for_workflows": false,
        "id": null,
        "parent_types": [
          "__playbook"
        ],
        "properties": {
          "can_create": false,
          "can_destroy": false,
          "for_who": []
        },
        "scripts": [],
        "tags": [],
        "type_id": 28,
        "type_name": "playbook_585a718a_b30e_43ed_be1a_01021dab06ce",
        "uuid": "5f321ba6-b7e8-4442-aa66-eb62cb3782ef"
      },
      "has_logical_errors": false,
      "id": 29,
      "is_deleted": false,
      "is_locked": false,
      "last_modified_principal": {
        "display_name": "Admin User",
        "id": 1,
        "name": "admin@example.com",
        "type": "user"
      },
      "last_modified_time": 1677772820511,
      "local_scripts": [],
      "manual_settings": {
        "activation_conditions": {
          "conditions": [],
          "logic_type": "all"
        },
        "view_items": []
      },
      "name": "trusteer_ppd_create_artifacts",
      "object_type": "trusteer_ppd_dt_trusteer_alerts",
      "status": "enabled",
      "tag": {
        "display_name": "Playbook_585a718a-b30e-43ed-be1a-01021dab06ce",
        "id": 29,
        "name": "playbook_585a718a_b30e_43ed_be1a_01021dab06ce",
        "type": "playbook",
        "uuid": "0273b25f-4126-485f-9a7e-041fe51b0a98"
      },
      "tags": [],
      "type": "default",
      "uuid": "585a718a-b30e-43ed-be1a-01021dab06ce",
      "version": 7
    },
    {
      "activation_type": "manual",
      "content": {
        "content_version": 47,
        "xml": "\u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\u003cdefinitions xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\" xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\" xmlns:omgdc=\"http://www.omg.org/spec/DD/20100524/DC\" xmlns:omgdi=\"http://www.omg.org/spec/DD/20100524/DI\" xmlns:resilient=\"http://resilient.ibm.com/bpmn\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" targetNamespace=\"http://www.camunda.org/test\"\u003e\u003cprocess id=\"playbook_cf8abd3f_ae68_4a56_81e4_80f6b20de483\" isExecutable=\"true\" name=\"playbook_cf8abd3f_ae68_4a56_81e4_80f6b20de483\"\u003e\u003cdocumentation/\u003e\u003cstartEvent id=\"StartEvent_155asxm\"\u003e\u003coutgoing\u003eFlow_1glhule\u003c/outgoing\u003e\u003c/startEvent\u003e\u003cendEvent id=\"EndPoint_1\" resilient:documentation=\"End point\"\u003e\u003cincoming\u003eFlow_0asrmep\u003c/incoming\u003e\u003cincoming\u003eFlow_1wzj3p8\u003c/incoming\u003e\u003c/endEvent\u003e\u003csequenceFlow id=\"Flow_1glhule\" sourceRef=\"StartEvent_155asxm\" targetRef=\"ServiceTask_3\"/\u003e\u003cserviceTask id=\"ServiceTask_3\" name=\"Trusteer PPD: Update Alert Classification\" resilient:type=\"function\"\u003e\u003cextensionElements\u003e\u003cresilient:function uuid=\"33cacd1a-2705-4218-8ea0-7217c0444506\"\u003e{\"inputs\":{},\"pre_processing_script\":\"classification_map = { \\n  \\\"Pending\\\": {\\\"feedback\\\": \\\"pending_confirmation\\\", \\\"fraud_mo\\\": None},\\n  \\\"Confirmed legitimate\\\": {\\\"feedback\\\": \\\"confirmed_legitimate\\\", \\\"fraud_mo\\\": None},\\n  \\\"Undetermined\\\": {\\\"feedback\\\": \\\"undetermined\\\", \\\"fraud_mo\\\": None},\\n  \\\"Confirmed fraud\\\": {\\\"feedback\\\": \\\"confirmed_fraud\\\", \\\"fraud_mo\\\": None},\\n  \\\"Confirmed fraud (Account takeover)\\\": {\\\"feedback\\\": \\\"pending_confirmation\\\", \\\"fraud_mo\\\": \\\"account_takeover\\\"},\\n  \\\"Confirmed fraud (First-party)\\\": {\\\"feedback\\\": \\\"confirmed_fraud\\\", \\\"fraud_mo\\\": \\\"first_party\\\"},\\n  \\\"Confirmed fraud (Mule account)\\\": {\\\"feedback\\\": \\\"confirmed_fraud\\\", \\\"fraud_mo\\\": \\\"mule_account\\\"},\\n  \\\"Confirmed fraud (Remote access tool)\\\":{\\\"feedback\\\": \\\"confirmed_fraud\\\", \\\"fraud_mo\\\": \\\"remote_access_tool\\\"},\\n  \\\"Confirmed fraud (Social engineering)\\\":{\\\"feedback\\\": \\\"confirmed_fraud\\\", \\\"fraud_mo\\\": \\\"social_engineering\\\"},\\n  \\\"Confirmed fraud (Stolen device)\\\": {\\\"feedback\\\": \\\"confirmed_fraud\\\", \\\"fraud_mo\\\": \\\"stolen_device\\\"}\\n}\\nmapped_classification = classification_map.get(playbook.inputs.trusteer_ppd_classification)\\ninputs.trusteer_ppd_feedback = mapped_classification.get(\\\"feedback\\\")\\ninputs.trusteer_ppd_fraud_mo = mapped_classification.get(\\\"fraud_mo\\\")\\n        \\ninputs.trusteer_ppd_application_id = incident.properties.trusteer_ppd_application_id\\ninputs.trusteer_ppd_session_id = row.trusteer_ppd_dt_session_id\\n\",\"pre_processing_script_language\":\"python3\",\"result_name\":\"alert_classification\"}\u003c/resilient:function\u003e\u003c/extensionElements\u003e\u003cincoming\u003eFlow_1glhule\u003c/incoming\u003e\u003coutgoing\u003eFlow_03h6dz5\u003c/outgoing\u003e\u003c/serviceTask\u003e\u003csequenceFlow id=\"Flow_03h6dz5\" sourceRef=\"ServiceTask_3\" targetRef=\"ConditionPoint_6\"/\u003e\u003cserviceTask id=\"ServiceTask_4\" name=\"Trusteer PPD: Update Classification in Alert Datatable\" resilient:type=\"function\"\u003e\u003cextensionElements\u003e\u003cresilient:function uuid=\"55eed36e-3fbb-4e4b-9920-2ea13089da31\"\u003e{\"inputs\":{},\"pre_processing_script\":\"inputs.incident_id = incident.id\\ninputs.trusteer_ppd_session_id = row.trusteer_ppd_dt_session_id\\ninputs.trusteer_ppd_classification = playbook.inputs.trusteer_ppd_classification\",\"pre_processing_script_language\":\"python3\",\"result_name\":\"alert_datatable_update\"}\u003c/resilient:function\u003e\u003c/extensionElements\u003e\u003cincoming\u003eFlow_1t5rxy1\u003c/incoming\u003e\u003coutgoing\u003eFlow_0g1b01c\u003c/outgoing\u003e\u003c/serviceTask\u003e\u003csequenceFlow id=\"Flow_0g1b01c\" sourceRef=\"ServiceTask_4\" targetRef=\"ScriptTask_5\"/\u003e\u003cscriptTask id=\"ScriptTask_5\" name=\"Trusteer PPD: Alert Data table status\"\u003e\u003cextensionElements\u003e\u003cresilient:script uuid=\"66ac30c2-c2e2-4066-8b36-531269eaa4cb\"/\u003e\u003c/extensionElements\u003e\u003cincoming\u003eFlow_0g1b01c\u003c/incoming\u003e\u003coutgoing\u003eFlow_0asrmep\u003c/outgoing\u003e\u003cscript\u003escript\u003c/script\u003e\u003c/scriptTask\u003e\u003csequenceFlow id=\"Flow_0asrmep\" sourceRef=\"ScriptTask_5\" targetRef=\"EndPoint_1\"/\u003e\u003cexclusiveGateway default=\"Flow_07880df\" id=\"ConditionPoint_6\" resilient:documentation=\"Test Classification Update\"\u003e\u003cextensionElements/\u003e\u003cincoming\u003eFlow_03h6dz5\u003c/incoming\u003e\u003coutgoing\u003eFlow_1t5rxy1\u003c/outgoing\u003e\u003coutgoing\u003eFlow_07880df\u003c/outgoing\u003e\u003c/exclusiveGateway\u003e\u003cscriptTask id=\"ScriptTask_7\" name=\"Trusteer PPD: Update Alert Classification Failure\"\u003e\u003cextensionElements\u003e\u003cresilient:script uuid=\"6a64bb10-a82a-46d2-9719-25fb8b7b398f\"/\u003e\u003c/extensionElements\u003e\u003cincoming\u003eFlow_07880df\u003c/incoming\u003e\u003coutgoing\u003eFlow_1wzj3p8\u003c/outgoing\u003e\u003cscript\u003escript\u003c/script\u003e\u003c/scriptTask\u003e\u003csequenceFlow id=\"Flow_1wzj3p8\" sourceRef=\"ScriptTask_7\" targetRef=\"EndPoint_1\"/\u003e\u003csequenceFlow id=\"Flow_1t5rxy1\" name=\"Get Classifcation Update Result\" sourceRef=\"ConditionPoint_6\" targetRef=\"ServiceTask_4\"\u003e\u003cextensionElements\u003e\u003cresilient:condition label=\"Get Classifcation Update Result\" order=\"0\"/\u003e\u003c/extensionElements\u003e\u003cconditionExpression language=\"resilient-conditions\" xsi:type=\"tFormalExpression\"\u003e{\"conditions\":[{\"evaluation_id\":null,\"field_name\":null,\"method\":\"script\",\"type\":null,\"value\":{\"script_text\":\"result = True if playbook.functions.results.alert_classification.content.status  == \\\"success\\\" else False\",\"final_expression_text\":\"result\",\"final_expression_only_boolean\":true,\"language\":\"python3\"}}],\"logic_type\":\"all\",\"script_language\":null}\u003c/conditionExpression\u003e\u003c/sequenceFlow\u003e\u003csequenceFlow id=\"Flow_07880df\" name=\"Else\" sourceRef=\"ConditionPoint_6\" targetRef=\"ScriptTask_7\"/\u003e\u003c/process\u003e\u003cbpmndi:BPMNDiagram id=\"BPMNDiagram_1\"\u003e\u003cbpmndi:BPMNPlane bpmnElement=\"playbook_cf8abd3f_ae68_4a56_81e4_80f6b20de483\" id=\"BPMNPlane_1\"\u003e\u003cbpmndi:BPMNEdge bpmnElement=\"Flow_07880df\" id=\"Flow_07880df_di\"\u003e\u003comgdi:waypoint x=\"721\" y=\"296\"/\u003e\u003comgdi:waypoint x=\"721\" y=\"350\"/\u003e\u003comgdi:waypoint x=\"900\" y=\"350\"/\u003e\u003comgdi:waypoint x=\"900\" y=\"438\"/\u003e\u003cbpmndi:BPMNLabel\u003e\u003comgdc:Bounds height=\"14\" width=\"23\" x=\"826\" y=\"333\"/\u003e\u003c/bpmndi:BPMNLabel\u003e\u003c/bpmndi:BPMNEdge\u003e\u003cbpmndi:BPMNEdge bpmnElement=\"Flow_1t5rxy1\" id=\"Flow_1t5rxy1_di\"\u003e\u003comgdi:waypoint x=\"721\" y=\"296\"/\u003e\u003comgdi:waypoint x=\"721\" y=\"350\"/\u003e\u003comgdi:waypoint x=\"480\" y=\"350\"/\u003e\u003comgdi:waypoint x=\"480\" y=\"438\"/\u003e\u003cbpmndi:BPMNLabel\u003e\u003comgdc:Bounds height=\"27\" width=\"86\" x=\"574\" y=\"302\"/\u003e\u003c/bpmndi:BPMNLabel\u003e\u003c/bpmndi:BPMNEdge\u003e\u003cbpmndi:BPMNEdge bpmnElement=\"Flow_1wzj3p8\" id=\"Flow_1wzj3p8_di\"\u003e\u003comgdi:waypoint x=\"900\" y=\"522\"/\u003e\u003comgdi:waypoint x=\"900\" y=\"690\"/\u003e\u003comgdi:waypoint x=\"787\" y=\"690\"/\u003e\u003c/bpmndi:BPMNEdge\u003e\u003cbpmndi:BPMNEdge bpmnElement=\"Flow_0asrmep\" id=\"Flow_0asrmep_di\"\u003e\u003comgdi:waypoint x=\"480\" y=\"652\"/\u003e\u003comgdi:waypoint x=\"480\" y=\"690\"/\u003e\u003comgdi:waypoint x=\"655\" y=\"690\"/\u003e\u003c/bpmndi:BPMNEdge\u003e\u003cbpmndi:BPMNEdge bpmnElement=\"Flow_0g1b01c\" id=\"Flow_0g1b01c_di\"\u003e\u003comgdi:waypoint x=\"480\" y=\"522\"/\u003e\u003comgdi:waypoint x=\"480\" y=\"568\"/\u003e\u003c/bpmndi:BPMNEdge\u003e\u003cbpmndi:BPMNEdge bpmnElement=\"Flow_03h6dz5\" id=\"Flow_03h6dz5_di\"\u003e\u003comgdi:waypoint x=\"709\" y=\"162\"/\u003e\u003comgdi:waypoint x=\"709\" y=\"203\"/\u003e\u003comgdi:waypoint x=\"742\" y=\"203\"/\u003e\u003comgdi:waypoint x=\"742\" y=\"244\"/\u003e\u003c/bpmndi:BPMNEdge\u003e\u003cbpmndi:BPMNEdge bpmnElement=\"Flow_1glhule\" id=\"Flow_1glhule_di\"\u003e\u003comgdi:waypoint x=\"709\" y=\"36\"/\u003e\u003comgdi:waypoint x=\"709\" y=\"78\"/\u003e\u003c/bpmndi:BPMNEdge\u003e\u003cbpmndi:BPMNShape bpmnElement=\"StartEvent_155asxm\" id=\"StartEvent_155asxm_di\"\u003e\u003comgdc:Bounds height=\"52\" width=\"199.65\" x=\"615\" y=\"-16\"/\u003e\u003cbpmndi:BPMNLabel\u003e\u003comgdc:Bounds height=\"0\" width=\"90\" x=\"616\" y=\"100\"/\u003e\u003c/bpmndi:BPMNLabel\u003e\u003c/bpmndi:BPMNShape\u003e\u003cbpmndi:BPMNShape bpmnElement=\"EndPoint_1\" id=\"EndPoint_1_di\"\u003e\u003comgdc:Bounds height=\"52\" width=\"132.15\" x=\"655\" y=\"664\"/\u003e\u003c/bpmndi:BPMNShape\u003e\u003cbpmndi:BPMNShape bpmnElement=\"ServiceTask_3\" id=\"ServiceTask_3_di\"\u003e\u003comgdc:Bounds height=\"84\" width=\"196\" x=\"611\" y=\"78\"/\u003e\u003c/bpmndi:BPMNShape\u003e\u003cbpmndi:BPMNShape bpmnElement=\"ServiceTask_4\" id=\"ServiceTask_4_di\"\u003e\u003comgdc:Bounds height=\"84\" width=\"196\" x=\"382\" y=\"438\"/\u003e\u003c/bpmndi:BPMNShape\u003e\u003cbpmndi:BPMNShape bpmnElement=\"ScriptTask_5\" id=\"ScriptTask_5_di\"\u003e\u003comgdc:Bounds height=\"84\" width=\"196\" x=\"382\" y=\"568\"/\u003e\u003c/bpmndi:BPMNShape\u003e\u003cbpmndi:BPMNShape bpmnElement=\"ScriptTask_7\" id=\"ScriptTask_7_di\"\u003e\u003comgdc:Bounds height=\"84\" width=\"196\" x=\"821.5\" y=\"437.8500061035156\"/\u003e\u003c/bpmndi:BPMNShape\u003e\u003cbpmndi:BPMNShape bpmnElement=\"ConditionPoint_6\" id=\"ConditionPoint_6_di\" isMarkerVisible=\"true\"\u003e\u003comgdc:Bounds height=\"52\" width=\"314.267\" x=\"564\" y=\"244\"/\u003e\u003c/bpmndi:BPMNShape\u003e\u003c/bpmndi:BPMNPlane\u003e\u003c/bpmndi:BPMNDiagram\u003e\u003c/definitions\u003e"
      },
      "create_date": 1676316038154,
      "creator_principal": {
        "display_name": "Admin User",
        "id": 1,
        "name": "admin@example.com",
        "type": "user"
      },
      "deployment_id": "playbook_cf8abd3f_ae68_4a56_81e4_80f6b20de483",
      "description": {
        "content": "Send classification feedback to Trusteer on the  session alert.  Update the Classification column in the Trusteer Alerts data table for each alert with the same session ID as the playbook row from which the playbook is executed.",
        "format": "text"
      },
      "display_name": "Trusteer PPD: Update Classification in Trusteer",
      "export_key": "trusteer_ppd_update_classification_in_trusteer",
      "field_type_handle": "playbook_cf8abd3f_ae68_4a56_81e4_80f6b20de483",
      "fields_type": {
        "actions": [],
        "display_name": "Trusteer PPD: Update Classification in Trusteer",
        "export_key": "playbook_cf8abd3f_ae68_4a56_81e4_80f6b20de483",
        "fields": {
          "trusteer_ppd_classification": {
            "allow_default_value": false,
            "blank_option": false,
            "calculated": false,
            "changeable": true,
            "chosen": false,
            "default_chosen_by_server": false,
            "deprecated": false,
            "export_key": "playbook_cf8abd3f_ae68_4a56_81e4_80f6b20de483/trusteer_ppd_classification",
            "hide_notification": false,
            "id": 384,
            "input_type": "select",
            "internal": false,
            "is_tracked": false,
            "name": "trusteer_ppd_classification",
            "operation_perms": {},
            "operations": [],
            "placeholder": "",
            "prefix": null,
            "read_only": false,
            "required": "always",
            "rich_text": false,
            "tags": [],
            "templates": [],
            "text": "Classification",
            "tooltip": "",
            "type_id": 1031,
            "uuid": "fb3cc883-00cf-48b3-babd-b231bde3b643",
            "values": [
              {
                "default": false,
                "enabled": true,
                "hidden": false,
                "label": "Pending",
                "properties": null,
                "uuid": "aed12781-6d2f-4d4b-884f-517fb257d2b5",
                "value": 186
              },
              {
                "default": false,
                "enabled": true,
                "hidden": false,
                "label": "Confirmed legitimate",
                "properties": null,
                "uuid": "0b78a516-01f3-41da-8da0-4f1084b4e999",
                "value": 187
              },
              {
                "default": false,
                "enabled": true,
                "hidden": false,
                "label": "Undetermined",
                "properties": null,
                "uuid": "bf7feacd-1d1c-4147-8eaa-44c361e1777d",
                "value": 188
              },
              {
                "default": false,
                "enabled": true,
                "hidden": false,
                "label": "Confirmed fraud",
                "properties": null,
                "uuid": "70dfa127-bc73-4a0e-9424-7e489e280bfb",
                "value": 189
              },
              {
                "default": false,
                "enabled": true,
                "hidden": false,
                "label": "Confirmed fraud (Account takeover)",
                "properties": null,
                "uuid": "aef3ce89-a95c-4a27-868d-466e8ff1906a",
                "value": 190
              },
              {
                "default": false,
                "enabled": true,
                "hidden": false,
                "label": "Confirmed fraud (First-party)",
                "properties": null,
                "uuid": "73569f0a-d37a-40ea-b17a-877f286ad284",
                "value": 191
              },
              {
                "default": false,
                "enabled": true,
                "hidden": false,
                "label": "Confirmed fraud (Mule account)",
                "properties": null,
                "uuid": "58b09fb5-0f9d-4d33-9afe-38923756cd3f",
                "value": 192
              },
              {
                "default": false,
                "enabled": true,
                "hidden": false,
                "label": "Confirmed fraud (Remote access tool)",
                "properties": null,
                "uuid": "44891bbc-3eca-4cb2-ab3d-2cecc0782f44",
                "value": 193
              },
              {
                "default": false,
                "enabled": true,
                "hidden": false,
                "label": "Confirmed fraud (Social engineering)",
                "properties": null,
                "uuid": "adeaefbf-739d-4f87-a711-3169873f7034",
                "value": 194
              },
              {
                "default": false,
                "enabled": true,
                "hidden": false,
                "label": "Confirmed fraud (Stolen device)",
                "properties": null,
                "uuid": "0749a922-57b6-4b47-9463-074f0e5f1009",
                "value": 195
              }
            ]
          }
        },
        "for_actions": false,
        "for_custom_fields": false,
        "for_notifications": false,
        "for_workflows": false,
        "id": null,
        "parent_types": [
          "__playbook"
        ],
        "properties": {
          "can_create": false,
          "can_destroy": false,
          "for_who": []
        },
        "scripts": [],
        "tags": [],
        "type_id": 28,
        "type_name": "playbook_cf8abd3f_ae68_4a56_81e4_80f6b20de483",
        "uuid": "5dc0e371-6c7c-402d-b804-2a0ae78ac7df"
      },
      "has_logical_errors": false,
      "id": 28,
      "is_deleted": false,
      "is_locked": false,
      "last_modified_principal": {
        "display_name": "Admin User",
        "id": 1,
        "name": "admin@example.com",
        "type": "user"
      },
      "last_modified_time": 1677858961672,
      "local_scripts": [
        {
          "actions": [],
          "created_date": 1677618985540,
          "description": "Write results of updating the Trusteer Alerts data table.",
          "enabled": false,
          "export_key": "Trusteer PPD: Alert Data table status",
          "id": 38,
          "language": "python3",
          "last_modified_by": "admin@example.com",
          "last_modified_time": 1677618985558,
          "name": "Trusteer PPD: Alert Data table status",
          "object_type": "trusteer_ppd_dt_trusteer_alerts",
          "playbook_handle": "trusteer_ppd_update_classification_in_trusteer",
          "programmatic_name": "trusteer_ppd_update_classification_in_trusteer_trusteer_ppd_alert_data_table_status",
          "script_text": "results = playbook.functions.results.alert_datatable_update\n\nif not results.success:\n  incident.addNote(\"Trusteer PPD: ERROR: Unable to update Trusteer Alerts data table to classification \u003cb\u003e{}\u003c/b\u003e\".format(playbook.inputs.trusteer_ppd_classification))\nelse:\n  incident.addNote(\"Trusteer PPD: Updated Trusteer PPD Alerts data table sessions: \u003cb\u003e{0}\u003c/b\u003e to classification:\u003cb\u003e{1}\u003c/b\u003e \".format(row.trusteer_ppd_dt_session_id, playbook.inputs.trusteer_ppd_classification))",
          "tags": [],
          "uuid": "66ac30c2-c2e2-4066-8b36-531269eaa4cb"
        },
        {
          "actions": [],
          "created_date": 1676317032056,
          "description": "Write the results of function to update the classification of the alert in Trusteer.",
          "enabled": false,
          "export_key": "Trusteer PPD: Update Alert Classification Failure",
          "id": 34,
          "language": "python3",
          "last_modified_by": "admin@example.com",
          "last_modified_time": 1677858896662,
          "name": "Trusteer PPD: Update Alert Classification Failure",
          "object_type": "trusteer_ppd_dt_trusteer_alerts",
          "playbook_handle": "trusteer_ppd_update_classification_in_trusteer",
          "programmatic_name": "trusteer_ppd_update_classification_in_trusteer_trusteer_ppd_update_alert_classification",
          "script_text": "incident.addNote(\"Trusteer PPD: ERROR: Unable to Update Alert Classification to \u003cb\u003e{0}\u003c/b\u003e in Trusteer: {1}\".format(playbook.inputs.trusteer_ppd_classification, playbook.functions.results.alert_classification.content))",
          "tags": [],
          "uuid": "6a64bb10-a82a-46d2-9719-25fb8b7b398f"
        }
      ],
      "manual_settings": {
        "activation_conditions": {
          "conditions": [],
          "logic_type": "all"
        },
        "view_items": [
          {
            "content": "fb3cc883-00cf-48b3-babd-b231bde3b643",
            "element": "field_uuid",
            "field_type": "playbook_cf8abd3f_ae68_4a56_81e4_80f6b20de483",
            "show_if": null,
            "show_link_header": false,
            "step_label": null
          }
        ]
      },
      "name": "trusteer_ppd_update_classification_in_trusteer",
      "object_type": "trusteer_ppd_dt_trusteer_alerts",
      "status": "enabled",
      "tag": {
        "display_name": "Playbook_cf8abd3f-ae68-4a56-81e4-80f6b20de483",
        "id": 28,
        "name": "playbook_cf8abd3f_ae68_4a56_81e4_80f6b20de483",
        "type": "playbook",
        "uuid": "1e817f5e-e9d4-49db-a546-759f200a3390"
      },
      "tags": [],
      "type": "default",
      "uuid": "cf8abd3f-ae68-4a56-81e4-80f6b20de483",
      "version": 57
    },
    {
      "activation_details": {
        "activation_conditions": {
          "conditions": [
            {
              "evaluation_id": null,
              "field_name": "trusteer_ppd_dt_trusteer_alerts.trusteer_ppd_dt_device_id_and_link",
              "method": "has_a_value",
              "type": null,
              "value": null
            },
            {
              "evaluation_id": null,
              "field_name": null,
              "method": "object_added",
              "type": null,
              "value": null
            }
          ],
          "logic_type": "all"
        }
      },
      "activation_type": "automatic",
      "content": {
        "content_version": 23,
        "xml": "\u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\u003cdefinitions xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\" xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\" xmlns:omgdc=\"http://www.omg.org/spec/DD/20100524/DC\" xmlns:omgdi=\"http://www.omg.org/spec/DD/20100524/DI\" xmlns:resilient=\"http://resilient.ibm.com/bpmn\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" targetNamespace=\"http://www.camunda.org/test\"\u003e\u003cprocess id=\"playbook_43a6ca4e_440e_4956_97ca_3352394b7c84\" isExecutable=\"true\" name=\"playbook_43a6ca4e_440e_4956_97ca_3352394b7c84\"\u003e\u003cdocumentation/\u003e\u003cstartEvent id=\"StartEvent_155asxm\"\u003e\u003coutgoing\u003eFlow_04y8fua\u003c/outgoing\u003e\u003c/startEvent\u003e\u003cserviceTask id=\"ServiceTask_1\" name=\"Trusteer PPD: Get URL Links to Trusteer\" resilient:type=\"function\"\u003e\u003cextensionElements\u003e\u003cresilient:function uuid=\"98578308-8c7b-4f7e-8990-88a0b809a58b\"\u003e{\"inputs\":{},\"pre_processing_script\":\"inputs.trusteer_ppd_device_id = row.trusteer_ppd_dt_device_id_and_link.content\",\"pre_processing_script_language\":\"python3\",\"result_name\":\"trusteer_ppd_result\"}\u003c/resilient:function\u003e\u003c/extensionElements\u003e\u003cincoming\u003eFlow_04y8fua\u003c/incoming\u003e\u003coutgoing\u003eFlow_10egj7a\u003c/outgoing\u003e\u003c/serviceTask\u003e\u003csequenceFlow id=\"Flow_04y8fua\" sourceRef=\"StartEvent_155asxm\" targetRef=\"ServiceTask_1\"/\u003e\u003cendEvent id=\"EndPoint_2\" resilient:documentation=\"End point\"\u003e\u003cincoming\u003eFlow_0jw9mpj\u003c/incoming\u003e\u003c/endEvent\u003e\u003cscriptTask id=\"ScriptTask_3\" name=\"Trusteer PPD: Update Device URL Link\"\u003e\u003cextensionElements\u003e\u003cresilient:script uuid=\"9c17cd29-58a8-46c3-92ec-4cb850b7fb6d\"/\u003e\u003c/extensionElements\u003e\u003cincoming\u003eFlow_10egj7a\u003c/incoming\u003e\u003coutgoing\u003eFlow_0jw9mpj\u003c/outgoing\u003e\u003cscript\u003escript\u003c/script\u003e\u003c/scriptTask\u003e\u003csequenceFlow id=\"Flow_10egj7a\" sourceRef=\"ServiceTask_1\" targetRef=\"ScriptTask_3\"/\u003e\u003csequenceFlow id=\"Flow_0jw9mpj\" sourceRef=\"ScriptTask_3\" targetRef=\"EndPoint_2\"/\u003e\u003c/process\u003e\u003cbpmndi:BPMNDiagram id=\"BPMNDiagram_1\"\u003e\u003cbpmndi:BPMNPlane bpmnElement=\"playbook_43a6ca4e_440e_4956_97ca_3352394b7c84\" id=\"BPMNPlane_1\"\u003e\u003cbpmndi:BPMNEdge bpmnElement=\"Flow_0jw9mpj\" id=\"Flow_0jw9mpj_di\"\u003e\u003comgdi:waypoint x=\"721\" y=\"422\"/\u003e\u003comgdi:waypoint x=\"721\" y=\"504\"/\u003e\u003c/bpmndi:BPMNEdge\u003e\u003cbpmndi:BPMNEdge bpmnElement=\"Flow_10egj7a\" id=\"Flow_10egj7a_di\"\u003e\u003comgdi:waypoint x=\"721\" y=\"282\"/\u003e\u003comgdi:waypoint x=\"721\" y=\"338\"/\u003e\u003c/bpmndi:BPMNEdge\u003e\u003cbpmndi:BPMNEdge bpmnElement=\"Flow_04y8fua\" id=\"Flow_04y8fua_di\"\u003e\u003comgdi:waypoint x=\"721\" y=\"117\"/\u003e\u003comgdi:waypoint x=\"721\" y=\"198\"/\u003e\u003c/bpmndi:BPMNEdge\u003e\u003cbpmndi:BPMNShape bpmnElement=\"StartEvent_155asxm\" id=\"StartEvent_155asxm_di\"\u003e\u003comgdc:Bounds height=\"52\" width=\"199.65\" x=\"621\" y=\"65\"/\u003e\u003cbpmndi:BPMNLabel\u003e\u003comgdc:Bounds height=\"0\" width=\"90\" x=\"616\" y=\"100\"/\u003e\u003c/bpmndi:BPMNLabel\u003e\u003c/bpmndi:BPMNShape\u003e\u003cbpmndi:BPMNShape bpmnElement=\"ServiceTask_1\" id=\"ServiceTask_1_di\"\u003e\u003comgdc:Bounds height=\"84\" width=\"196\" x=\"623\" y=\"198.35000610351562\"/\u003e\u003c/bpmndi:BPMNShape\u003e\u003cbpmndi:BPMNShape bpmnElement=\"EndPoint_2\" id=\"EndPoint_2_di\"\u003e\u003comgdc:Bounds height=\"52\" width=\"132.15\" x=\"655\" y=\"504.3500061035156\"/\u003e\u003c/bpmndi:BPMNShape\u003e\u003cbpmndi:BPMNShape bpmnElement=\"ScriptTask_3\" id=\"ScriptTask_3_di\"\u003e\u003comgdc:Bounds height=\"84\" width=\"196\" x=\"623.325\" y=\"338.3500061035156\"/\u003e\u003c/bpmndi:BPMNShape\u003e\u003c/bpmndi:BPMNPlane\u003e\u003c/bpmndi:BPMNDiagram\u003e\u003c/definitions\u003e"
      },
      "create_date": 1676298470246,
      "creator_principal": {
        "display_name": "Admin User",
        "id": 1,
        "name": "admin@example.com",
        "type": "user"
      },
      "deployment_id": "playbook_43a6ca4e_440e_4956_97ca_3352394b7c84",
      "description": {
        "content": "Automatic playbook that is executed when an alert is added to the Trusteer Alerts data table and update the Device ID cell with a link back to the device in Trusteer.",
        "format": "text"
      },
      "display_name": "Trusteer PPD: Update Device URL Link",
      "export_key": "trusteer_ppd_update_device_url_link",
      "field_type_handle": "playbook_43a6ca4e_440e_4956_97ca_3352394b7c84",
      "fields_type": {
        "actions": [],
        "display_name": "Trusteer PPD: Update Device URL Link",
        "export_key": "playbook_43a6ca4e_440e_4956_97ca_3352394b7c84",
        "fields": {},
        "for_actions": false,
        "for_custom_fields": false,
        "for_notifications": false,
        "for_workflows": false,
        "id": null,
        "parent_types": [
          "__playbook"
        ],
        "properties": {
          "can_create": false,
          "can_destroy": false,
          "for_who": []
        },
        "scripts": [],
        "tags": [],
        "type_id": 28,
        "type_name": "playbook_43a6ca4e_440e_4956_97ca_3352394b7c84",
        "uuid": "41c0b1b9-55a8-42cc-af2d-b7f1a44a6f1f"
      },
      "has_logical_errors": false,
      "id": 26,
      "is_deleted": false,
      "is_locked": false,
      "last_modified_principal": {
        "display_name": "Admin User",
        "id": 1,
        "name": "admin@example.com",
        "type": "user"
      },
      "last_modified_time": 1677772502363,
      "local_scripts": [
        {
          "actions": [],
          "created_date": 1676298818010,
          "description": "",
          "enabled": false,
          "export_key": "Trusteer PPD: Update Device URL Link",
          "id": 32,
          "language": "python3",
          "last_modified_by": "admin@example.com",
          "last_modified_time": 1677446528150,
          "name": "Trusteer PPD: Update Device URL Link",
          "object_type": "trusteer_ppd_dt_trusteer_alerts",
          "playbook_handle": "trusteer_ppd_update_device_url_link",
          "programmatic_name": "trusteer_ppd_update_device_url_link_trusteer_ppd_update_device_url_link",
          "script_text": "result = playbook.functions.results.trusteer_ppd_result\nif not result.success:\n  incident.addNote(\"Trusteer PPD: Function to get URL links was not successful.\")\nelse:\n  content = result.get(\"content\", {})\n\n  link_url_device_id = content.get(\"link_url_device_id\", {})\n  if link_url_device_id:\n    ref_html = u\"\"\"\u003ca href=\u0027{0}\u0027\u003e{1}\u003c/a\u003e\"\"\".format(link_url_device_id, result.inputs.trusteer_ppd_device_id)\n    row.trusteer_ppd_dt_device_id_and_link = helper.createRichText(ref_html)\n  else:\n    incident.addNote(\"Trusteer PPD: Function to get URL links has no content.\")",
          "tags": [],
          "uuid": "9c17cd29-58a8-46c3-92ec-4cb850b7fb6d"
        }
      ],
      "name": "trusteer_ppd_update_device_url_link",
      "object_type": "trusteer_ppd_dt_trusteer_alerts",
      "status": "enabled",
      "tag": {
        "display_name": "Playbook_43a6ca4e-440e-4956-97ca-3352394b7c84",
        "id": 26,
        "name": "playbook_43a6ca4e_440e_4956_97ca_3352394b7c84",
        "type": "playbook",
        "uuid": "2759ac88-fd0b-4f7e-a2cb-4cf7c4726716"
      },
      "tags": [],
      "type": "default",
      "uuid": "43a6ca4e-440e-4956-97ca-3352394b7c84",
      "version": 28
    },
    {
      "activation_details": {
        "activation_conditions": {
          "conditions": [
            {
              "evaluation_id": null,
              "field_name": "incident.plan_status",
              "method": "equals",
              "type": null,
              "value": "Active"
            },
            {
              "evaluation_id": null,
              "field_name": "incident.properties.trusteer_ppd_puid",
              "method": "has_a_value",
              "type": null,
              "value": null
            },
            {
              "evaluation_id": null,
              "field_name": null,
              "method": "object_added",
              "type": null,
              "value": null
            }
          ],
          "logic_type": "all"
        }
      },
      "activation_type": "automatic",
      "content": {
        "content_version": 5,
        "xml": "\u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\u003cdefinitions xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\" xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\" xmlns:omgdc=\"http://www.omg.org/spec/DD/20100524/DC\" xmlns:omgdi=\"http://www.omg.org/spec/DD/20100524/DI\" xmlns:resilient=\"http://resilient.ibm.com/bpmn\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" targetNamespace=\"http://www.camunda.org/test\"\u003e\u003cprocess id=\"playbook_d7f391d3_86f2_460c_9580_3f38848172f4\" isExecutable=\"true\" name=\"playbook_d7f391d3_86f2_460c_9580_3f38848172f4\"\u003e\u003cdocumentation/\u003e\u003cstartEvent id=\"StartEvent_155asxm\"\u003e\u003coutgoing\u003eFlow_1hr4ds4\u003c/outgoing\u003e\u003c/startEvent\u003e\u003cserviceTask id=\"ServiceTask_1\" name=\"Trusteer PPD: Get URL Links to Trusteer\" resilient:type=\"function\"\u003e\u003cextensionElements\u003e\u003cresilient:function uuid=\"98578308-8c7b-4f7e-8990-88a0b809a58b\"\u003e{\"inputs\":{},\"pre_processing_script\":\"inputs.trusteer_ppd_puid = incident.properties.trusteer_ppd_puid\",\"pre_processing_script_language\":\"python3\",\"result_name\":\"trusteer_ppd_result\"}\u003c/resilient:function\u003e\u003c/extensionElements\u003e\u003cincoming\u003eFlow_1hr4ds4\u003c/incoming\u003e\u003coutgoing\u003eFlow_1iq80ym\u003c/outgoing\u003e\u003c/serviceTask\u003e\u003csequenceFlow id=\"Flow_1hr4ds4\" sourceRef=\"StartEvent_155asxm\" targetRef=\"ServiceTask_1\"/\u003e\u003cscriptTask id=\"ScriptTask_2\" name=\"Trusteer PPD: Update URL PUID Link to Trusteer\"\u003e\u003cextensionElements\u003e\u003cresilient:script uuid=\"7d0e03a8-d31c-419d-b46e-2304dcc98a38\"/\u003e\u003c/extensionElements\u003e\u003cincoming\u003eFlow_1iq80ym\u003c/incoming\u003e\u003coutgoing\u003eFlow_02bztye\u003c/outgoing\u003e\u003cscript\u003escript\u003c/script\u003e\u003c/scriptTask\u003e\u003csequenceFlow id=\"Flow_1iq80ym\" sourceRef=\"ServiceTask_1\" targetRef=\"ScriptTask_2\"/\u003e\u003cendEvent id=\"EndPoint_3\" resilient:documentation=\"End point\"\u003e\u003cincoming\u003eFlow_02bztye\u003c/incoming\u003e\u003c/endEvent\u003e\u003csequenceFlow id=\"Flow_02bztye\" sourceRef=\"ScriptTask_2\" targetRef=\"EndPoint_3\"/\u003e\u003c/process\u003e\u003cbpmndi:BPMNDiagram id=\"BPMNDiagram_1\"\u003e\u003cbpmndi:BPMNPlane bpmnElement=\"playbook_d7f391d3_86f2_460c_9580_3f38848172f4\" id=\"BPMNPlane_1\"\u003e\u003cbpmndi:BPMNEdge bpmnElement=\"Flow_02bztye\" id=\"Flow_02bztye_di\"\u003e\u003comgdi:waypoint x=\"721\" y=\"402\"/\u003e\u003comgdi:waypoint x=\"721\" y=\"484\"/\u003e\u003c/bpmndi:BPMNEdge\u003e\u003cbpmndi:BPMNEdge bpmnElement=\"Flow_1iq80ym\" id=\"Flow_1iq80ym_di\"\u003e\u003comgdi:waypoint x=\"721\" y=\"252\"/\u003e\u003comgdi:waypoint x=\"721\" y=\"318\"/\u003e\u003c/bpmndi:BPMNEdge\u003e\u003cbpmndi:BPMNEdge bpmnElement=\"Flow_1hr4ds4\" id=\"Flow_1hr4ds4_di\"\u003e\u003comgdi:waypoint x=\"721\" y=\"117\"/\u003e\u003comgdi:waypoint x=\"721\" y=\"168\"/\u003e\u003c/bpmndi:BPMNEdge\u003e\u003cbpmndi:BPMNShape bpmnElement=\"StartEvent_155asxm\" id=\"StartEvent_155asxm_di\"\u003e\u003comgdc:Bounds height=\"52\" width=\"187.083\" x=\"627\" y=\"65\"/\u003e\u003cbpmndi:BPMNLabel\u003e\u003comgdc:Bounds height=\"0\" width=\"90\" x=\"616\" y=\"100\"/\u003e\u003c/bpmndi:BPMNLabel\u003e\u003c/bpmndi:BPMNShape\u003e\u003cbpmndi:BPMNShape bpmnElement=\"ServiceTask_1\" id=\"ServiceTask_1_di\"\u003e\u003comgdc:Bounds height=\"84\" width=\"196\" x=\"623\" y=\"168\"/\u003e\u003c/bpmndi:BPMNShape\u003e\u003cbpmndi:BPMNShape bpmnElement=\"ScriptTask_2\" id=\"ScriptTask_2_di\"\u003e\u003comgdc:Bounds height=\"84\" width=\"196\" x=\"623\" y=\"317.6499938964844\"/\u003e\u003c/bpmndi:BPMNShape\u003e\u003cbpmndi:BPMNShape bpmnElement=\"EndPoint_3\" id=\"EndPoint_3_di\"\u003e\u003comgdc:Bounds height=\"52\" width=\"132.15\" x=\"655\" y=\"483.6499938964844\"/\u003e\u003c/bpmndi:BPMNShape\u003e\u003c/bpmndi:BPMNPlane\u003e\u003c/bpmndi:BPMNDiagram\u003e\u003c/definitions\u003e"
      },
      "create_date": 1676302990570,
      "creator_principal": {
        "display_name": "Admin User",
        "id": 1,
        "name": "admin@example.com",
        "type": "user"
      },
      "deployment_id": "playbook_d7f391d3_86f2_460c_9580_3f38848172f4",
      "description": {
        "content": "Automatic playbook that is executed when a Trusteer case is created. Update the PUID link custom field with a URL link to the customer account in Trusteer.",
        "format": "text"
      },
      "display_name": "Trusteer PPD: Update PUID URL Link",
      "export_key": "trusteer_ppd_update_puid_url_link",
      "field_type_handle": "playbook_d7f391d3_86f2_460c_9580_3f38848172f4",
      "fields_type": {
        "actions": [],
        "display_name": "Trusteer PPD: Update PUID URL Link",
        "export_key": "playbook_d7f391d3_86f2_460c_9580_3f38848172f4",
        "fields": {},
        "for_actions": false,
        "for_custom_fields": false,
        "for_notifications": false,
        "for_workflows": false,
        "id": null,
        "parent_types": [
          "__playbook"
        ],
        "properties": {
          "can_create": false,
          "can_destroy": false,
          "for_who": []
        },
        "scripts": [],
        "tags": [],
        "type_id": 28,
        "type_name": "playbook_d7f391d3_86f2_460c_9580_3f38848172f4",
        "uuid": "93bbea5d-c8a0-4fcb-be2a-93513f0b6724"
      },
      "has_logical_errors": false,
      "id": 27,
      "is_deleted": false,
      "is_locked": false,
      "last_modified_principal": {
        "display_name": "Admin User",
        "id": 1,
        "name": "admin@example.com",
        "type": "user"
      },
      "last_modified_time": 1677772729925,
      "local_scripts": [
        {
          "actions": [],
          "created_date": 1676302990738,
          "description": "Update the custom field containing the links back to Trusteer PUID.",
          "enabled": false,
          "export_key": "Trusteer PPD: Update URL PUID Link to Trusteer",
          "id": 33,
          "language": "python3",
          "last_modified_by": "admin@example.com",
          "last_modified_time": 1676303898858,
          "name": "Trusteer PPD: Update URL PUID Link to Trusteer",
          "object_type": "incident",
          "playbook_handle": "trusteer_ppd_update_puid_url_link",
          "programmatic_name": "trusteer_ppd_update_puid_url_link_trusteer_ppd_update_url_links_trusteer_ppd_update_url_links_to_trusteer",
          "script_text": "result = playbook.functions.results.trusteer_ppd_result\nif not result.success:\n  incident.addNote(\"Trusteer PPD: Function to get PUID URL link was not successful.\")\nelse:\n  content = result.get(\"content\", {})\n  link_url_puid = content.get(\"link_url_puid\", {})\n  if link_url_puid:\n    ref_html = u\"\"\"\u003ca href=\u0027{0}\u0027\u003eLink\u003c/a\u003e\"\"\".format(link_url_puid)\n    incident.properties.trusteer_ppd_link_to_puid = helper.createRichText(ref_html)\n  else:\n    incident.addNote(\"Trusteer PPD: Function to get PUID URL link has no content.\")",
          "tags": [],
          "uuid": "7d0e03a8-d31c-419d-b46e-2304dcc98a38"
        }
      ],
      "name": "trusteer_ppd_update_puid_url_link",
      "object_type": "incident",
      "status": "enabled",
      "tag": {
        "display_name": "playbook_d7f391d3-86f2-460c-9580-3f38848172f4",
        "id": 27,
        "name": "playbook_d7f391d3-86f2-460c-9580-3f38848172f4",
        "type": "playbook",
        "uuid": "6f717fa1-2342-480a-ba12-8eba055a170e"
      },
      "tags": [],
      "type": "default",
      "uuid": "d7f391d3-86f2-460c-9580-3f38848172f4",
      "version": 9
    }
  ],
  "regulators": null,
  "roles": [],
  "scripts": [
    {
      "actions": [],
      "created_date": 1676407887592,
      "description": "This script will create artifacts from the items in a row of the Trusteer Alerts data table.",
      "enabled": false,
      "export_key": "Trusteer PPD: Create Artifacts",
      "id": 35,
      "language": "python3",
      "last_modified_by": "admin@example.com",
      "last_modified_time": 1677446004856,
      "name": "Trusteer PPD: Create Artifacts",
      "object_type": "incident",
      "playbook_handle": null,
      "programmatic_name": "trusteer_ppd_create_artifacts",
      "script_text": "artifact_value = row.trusteer_ppd_dt_user_ip_address\nif artifact_value:\n  incident.addArtifact(\"IP Address\", artifact_value, \"Created by Trusteer PPD.\")\n  \ndevice_link = row.trusteer_ppd_dt_device_id_and_link.content\nif device_link:\n  # Parse the device ID out of the HTML text link\n  parsed_device_id = device_link.split(\u0027\"\u003e\u0027)\n  if parsed_device_id[1]:\n    device_id = parsed_device_id[1].split(\u0027\u003c/a\u003e\u0027)\n    if device_id[0]:\n      incident.addArtifact(\"trusteer_ppd_device_id\", device_id[0], \"Created by Trusteer PPD.\")",
      "tags": [],
      "uuid": "3c819446-45fa-4649-b61d-21543c856bd3"
    },
    {
      "actions": [],
      "created_date": 1674841244946,
      "description": "Parse an email from Trusteer Pinpoint Detect and create a case if there is not an Active case with the PUID already in SOAR.  Otherwise, add a new row to Trusteer Alerts data table in the case with the associated PUID and populate with information from the current email.",
      "enabled": false,
      "export_key": "Trusteer PPD: Create Case from Email v1.0.0",
      "id": 29,
      "language": "python3",
      "last_modified_by": "admin@example.com",
      "last_modified_time": 1678224224251,
      "name": "Trusteer PPD: Create Case from Email v1.0.0",
      "object_type": "__emailmessage",
      "playbook_handle": null,
      "programmatic_name": "trusteer_ppd_create_case_from_email",
      "script_text": "# (c) Copyright IBM Corp. 2010, 2023. All Rights Reserved.\nimport re\nimport time\nimport calendar\nfrom datetime import datetime\n\n# The new incident owner - the email address of a user or the name of a group and cannot be blank.\n# Change this value to reflect who will be the owner of the incident before running the script.\nnew_case_owner = Trusteer Pinpoint Detect case owner\"\n\n# Change to True if you have Outbound Email 2.0+ installed and wish to capture the inbound email as a conversation \nSAVE_CONVERSATION = False\n\n# pattern used to find and extract the email message-id\nMESSAGE_PATTERN = re.compile(r\"([^\u003c\u003e]+)\")\n# check for any combination of upper/lowercase http/https/news/telnet/file. Characters repeated for readability\nDEFANG_PATTERN = re.compile(r\"(https|http|ftps|ftp|mailto|news|file|mailto):\", re.IGNORECASE)\n# possible message-id names\nMESSAGE_ID_LIST =  [\"message-id\", \"x-original-message-id\", \"x-microsoft-original-message-id\", \"x-google-original-message-id\"]\n# Supported Feed type from Trusteer\nTRUSTEER_PPD_FEED_ITEM_TYPE_SUPPORTED = \"Pinpoint Criminal Detection suspicious access detected\"\n\n# Trusteer PPD email key names\nACTIVITY = \"Activity\"\nAPPLICATION_ID = \"Application ID\"\nEVENT_RECEIVED_AT = \"Event received at\"\nFEED_ITEM_TYPE = \"Feed item type\"\nCITY_NAME = \"City name\"\nCOUNTRY_NAME = \"Country name\"\nDETECTED_AT = \"Detected at\"\nGLOBAL_DEVICE_ID = \"Global Device ID\"\nIS_TARGETED = \"Is Targeted\"\nMALWARE = \"Malware\"\nNEW_DEVICE_INDICATION = \"New Device Indication\"\nORGANIZATION = \"Organization\"\nPERMANENT_USER_ID = \"Permanent User ID\"\nREASON = \"Reason\"\nREASON_ID = \"Reason ID\"\nRECOMMENDATION = \"Recommendation\"\nRESOLUTION_ID = \"Resolution ID\"\nRISK_SCORE = \"Risk Score\"\nSESSION_ID = \"Session ID\"\nTRUSTEER_ENDPOINT_PROTECTION_DEVICE_ID = \"Trusteer Endpoint Protection Device ID\"\nUSER_IP_ADDRESS = \"User IP Address\"\nUSER_AGENT_STRING = \"User Agent String\"\n\nCOUNTRY_NAMES = {\n    \"N/A\": \"-\",\n    \"AFG\": \"Afghanistan\",\n    \"ALA\": \"\u00c5land Islands\",\n    \"ALB\": \"Albania\",\n    \"DZA\": \"Algeria\",\n    \"ASM\": \"American Samoa\",\n    \"AND\": \"Andorra\",\n    \"AGO\": \"Angola\",\n    \"AIA\": \"Anguilla\",\n    \"ATA\": \"Antarctica\",\n    \"ATG\": \"Antigua and Barbuda\",\n    \"ARG\": \"Argentina\",\n    \"ARM\": \"Armenia\",\n    \"ABW\": \"Aruba\",\n    \"AUS\": \"Australia\",\n    \"AUT\": \"Austria\",\n    \"AZE\": \"Azerbaijan\",\n    \"BHS\": \"Bahamas\",\n    \"BHR\": \"Bahrain\",\n    \"BGD\": \"Bangladesh\",\n    \"BRB\": \"Barbados\",\n    \"BLR\": \"Belarus\",\n    \"BEL\": \"Belgium\",\n    \"BLZ\": \"Belize\",\n    \"BEN\": \"Benin\",\n    \"BMU\": \"Bermuda\",\n    \"BTN\": \"Bhutan\",\n    \"BOL\": \"Plurinational State of Bolivia\",\n    \"BES\": \"Sint Eustatius and Saba Bonaire\",\n    \"BIH\": \"Bosnia and Herzegovina\",\n    \"BWA\": \"Botswana\",\n    \"BVT\": \"Bouvet Island\",\n    \"BRA\": \"Brazil\",\n    \"IOT\": \"British Indian Ocean Territory\",\n    \"VGB\": \"British Virgin Islands\",\n    \"BRN\": \"Brunei Darussalam\",\n    \"BGR\": \"Bulgaria\",\n    \"BFA\": \"Burkina Faso\",\n    \"BDI\": \"Burundi\",\n    \"KHM\": \"Cambodia\",\n    \"CMR\": \"Cameroon\",\n    \"CAN\": \"Canada\",\n    \"CPV\": \"Cape Verde\",\n    \"CYM\": \"Cayman Islands\",\n    \"CAF\": \"Central African Republic\",\n    \"TCD\": \"Chad\",\n    \"CHL\": \"Chile\",\n    \"CHN\": \"China\",\n    \"CXR\": \"Christmas Island\",\n    \"CCK\": \"Cocos (Keeling) Islands\",\n    \"COL\": \"Colombia\",\n    \"COM\": \"Comoros\",\n    \"COK\": \"Cook Islands\",\n    \"CRI\": \"Costa Rica\",\n    \"HRV\": \"Croatia\",\n    \"CUB\": \"Cuba\",\n    \"CUW\": \"Cura\u00e7ao\",\n    \"CYP\": \"Cyprus\",\n    \"CZE\": \"Czech Republic\",\n    \"COD\": \"The Democratic Republic of the Congo\",\n    \"DNK\": \"Denmark\",\n    \"DJI\": \"Djibouti\",\n    \"DMA\": \"Dominica\",\n    \"DOM\": \"Dominican Republic\",\n    \"TLS\": \"Timor-Leste\",\n    \"ECU\": \"Ecuador\",\n    \"EGY\": \"Egypt\",\n    \"SLV\": \"El Salvador\",\n    \"GNQ\": \"Equatorial Guinea\",\n    \"ERI\": \"Eritrea\",\n    \"EST\": \"Estonia\",\n    \"ETH\": \"Ethiopia\",\n    \"FLK\": \"Falkland Islands (Malvinas)\",\n    \"FRO\": \"Faroe Islands\",\n    \"FJI\": \"Fiji\",\n    \"FIN\": \"Finland\",\n    \"FRA\": \"France\",\n    \"GUF\": \"French Guiana\",\n    \"PYF\": \"French Polynesia\",\n    \"ATF\": \"French Southern Territories\",\n    \"GAB\": \"Gabon\",\n    \"GMB\": \"Gambia\",\n    \"GEO\": \"Georgia (Country)\",\n    \"DEU\": \"Germany\",\n    \"GHA\": \"Ghana\",\n    \"GIB\": \"Gibraltar\",\n    \"GRC\": \"Greece\",\n    \"GRL\": \"Greenland\",\n    \"GRD\": \"Grenada\",\n    \"GLP\": \"Guadeloupe\",\n    \"GUM\": \"United States\",\n    \"GTM\": \"Guatemala\",\n    \"GGY\": \"Guernsey\",\n    \"GIN\": \"Guinea\",\n    \"GNB\": \"Guinea-Bissau\",\n    \"GUY\": \"Guyana\",\n    \"HTI\": \"Haiti\",\n    \"HMD\": \"Heard Island and McDonald Islands\",\n    \"HND\": \"Honduras\",\n    \"HKG\": \"Hong Kong S.A.R. of the PRC\",\n    \"HUN\": \"Hungary\",\n    \"ISL\": \"Iceland\",\n    \"IND\": \"India\",\n    \"IDN\": \"Indonesia\",\n    \"IRN\": \"Iran\",\n    \"IRQ\": \"Iraq\",\n    \"IRL\": \"Ireland\",\n    \"IMN\": \"Isle of Man\",\n    \"ISR\": \"Israel\",\n    \"ITA\": \"Italy\",\n    \"CIV\": \"The Republic of C\u00f4te d\u0027Ivoire,\",\n    \"JAM\": \"Jamaica\",\n    \"JPN\": \"Japan\",\n    \"JEY\": \"Jersey\",\n    \"JOR\": \"Jordan\",\n    \"KAZ\": \"Kazakhstan\",\n    \"KEN\": \"Kenya\",\n    \"KIR\": \"Kiribati\",\n    \"XXK\": \"Kosovo\",\n    \"KWT\": \"Kuwait\",\n    \"KGZ\": \"Kyrgyzstan\",\n    \"LAO\": \"Laos People\u0027s Democratic Republic\",\n    \"LVA\": \"Latvia\",\n    \"LBN\": \"Lebanon\",\n    \"LSO\": \"Lesotho\",\n    \"LBR\": \"Liberia\",\n    \"LBY\": \"Libya\",\n    \"LIE\": \"Liechtenstein\",\n    \"LTU\": \"Lithuania\",\n    \"LUX\": \"Luxembourg\",\n    \"MAC\": \"Macao S.A.R. of the PRC\",\n    \"MKD\": \"Republic of Macedonia\",\n    \"MDG\": \"Madagascar\",\n    \"MWI\": \"Malawi\",\n    \"MYS\": \"Malaysia\",\n    \"MDV\": \"Maldives\",\n    \"MLI\": \"Mali\",\n    \"MLT\": \"Malta\",\n    \"MHL\": \"Marshall Islands\",\n    \"MTQ\": \"Martinique\",\n    \"MRT\": \"Mauritania\",\n    \"MUS\": \"Mauritius\",\n    \"MYT\": \"Mayotte\",\n    \"MEX\": \"Mexico\",\n    \"FSM\": \"Federated States of Micronesia\",\n    \"MDA\": \"Republic of Moldova\",\n    \"MCO\": \"Monaco\",\n    \"MNG\": \"Mongolia\",\n    \"MNE\": \"Montenegro\",\n    \"MSR\": \"Montserrat\",\n    \"MAR\": \"Morocco\",\n    \"MOZ\": \"Mozambique\",\n    \"MMR\": \"Myanmar\",\n    \"NAM\": \"Namibia\",\n    \"NRU\": \"Nauru\",\n    \"NPL\": \"Nepal\",\n    \"NLD\": \"Netherlands\",\n    \"NCL\": \"New Caledonia\",\n    \"NZL\": \"New Zealand\",\n    \"NIC\": \"Nicaragua\",\n    \"NER\": \"Niger\",\n    \"NGA\": \"Nigeria\",\n    \"NIU\": \"Niue\",\n    \"NFK\": \"Norfolk Island\",\n    \"PRK\": \"Democratic People\u0027s Republic of Korea\",\n    \"MNP\": \"Northern Mariana Islands\",\n    \"NOR\": \"Norway\",\n    \"OMN\": \"Oman\",\n    \"PAK\": \"Pakistan\",\n    \"PLW\": \"Palau\",\n    \"PSE\": \"State of Palestine\",\n    \"PAN\": \"Panama\",\n    \"PNG\": \"Papua New Guinea\",\n    \"PRY\": \"Paraguay\",\n    \"PER\": \"Peru\",\n    \"PHL\": \"Philippines\",\n    \"PCN\": \"Pitcairn\",\n    \"POL\": \"Poland\",\n    \"PRT\": \"Portugal\",\n    \"PRI\": \"Puerto Rico\",\n    \"QAT\": \"Qatar\",\n    \"COG\": \"Congo\",\n    \"REU\": \"R\u00e9union\",\n    \"ROU\": \"Romania\",\n    \"RUS\": \"Russia Federation\",\n    \"RWA\": \"Rwanda\",\n    \"BLM\": \"Saint Barth\u00e9lemy\",\n    \"SHN\": \"Ascension and Tristan Da Cunha Saint Helena\",\n    \"KNA\": \"Saint Kitts and Nevis\",\n    \"LCA\": \"Saint Lucia\",\n    \"MAF\": \"Saint Martin (French Part)\",\n    \"SPM\": \"Saint Pierre and Miquelon\",\n    \"VCT\": \"Saint Vincent and the Grenadines\",\n    \"WSM\": \"Samoa\",\n    \"SMR\": \"San Marino\",\n    \"STP\": \"Sao Tome and Principe\",\n    \"SAU\": \"Saudi Arabia\",\n    \"SEN\": \"Senegal\",\n    \"SRB\": \"Serbia\",\n    \"SCG\": \"Serbia and Montenegro\",\n    \"SYC\": \"Seychelles\",\n    \"SLE\": \"Sierra Leone\",\n    \"SGP\": \"Singapore\",\n    \"SXM\": \"Sint Maarten (Dutch Part)\",\n    \"SVK\": \"Slovakia\",\n    \"SVN\": \"Slovenia\",\n    \"SLB\": \"Solomon Islands\",\n    \"SOM\": \"Somalia\",\n    \"ZAF\": \"South Africa\",\n    \"SGS\": \"South Georgia and the South Sandwich Islands\",\n    \"KOR\": \"Republic of Korea\",\n    \"SSD\": \"South Sudan\",\n    \"ESP\": \"Spain\",\n    \"LKA\": \"Sri Lanka\",\n    \"SDN\": \"Sudan\",\n    \"SUR\": \"Suriname\",\n    \"SJM\": \"Svalbard and Jan Mayen\",\n    \"SWZ\": \"Swaziland\",\n    \"SWE\": \"Sweden\",\n    \"CHE\": \"Switzerland\",\n    \"SYR\": \"Syrian Arab Republic\",\n    \"TWN\": \"Taiwan\",\n    \"TJK\": \"Tajikistan\",\n    \"TZA\": \"Tanzania\",\n    \"THA\": \"Thailand\",\n    \"TGO\": \"Togo\",\n    \"TKL\": \"Tokelau\",\n    \"TON\": \"Tonga\",\n    \"TTO\": \"Trinidad and Tobago\",\n    \"TUN\": \"Tunisia\",\n    \"TUR\": \"Turkey\",\n    \"TKM\": \"Turkmenistan\",\n    \"TCA\": \"Turks and Caicos Islands\",\n    \"TUV\": \"Tuvalu\",\n    \"VIR\": \"U.S. Virgin Islands\",\n    \"UGA\": \"Uganda\",\n    \"UKR\": \"Ukraine\",\n    \"ARE\": \"United Arab Emirates\",\n    \"GBR\": \"United Kingdom\",\n    \"USA\": \"United States\",\n    \"UMI\": \"United States Minor Outlying Islands\",\n    \"URY\": \"Uruguay\",\n    \"UZB\": \"Uzbekistan\",\n    \"VUT\": \"Vanuatu\",\n    \"VAT\": \"Holy See (Vatican City State)\",\n    \"VEN\": \"Bolivarian Republic of Venezuela\",\n    \"VNM\": \"Viet Nam\",\n    \"WLF\": \"Wallis and Futuna\",\n    \"ESH\": \"Western Sahara\",\n    \"YEM\": \"Yemen\",\n    \"ZMB\": \"Zambia\",\n    \"ZWE\": \"Zimbabwe\"\n}\nclass EmailProcessor(object):\n    \"\"\" A class that facilitates processing the body contents of an email message.\n    Once the EmailProcessor class has been instantiated, the other methods can be used to add artifacts to the\n    incident.\n    \"\"\"\n\n    # The body of the email - the plaintext and html versions of the same email, if present\n    email_contents = []\n    email_contents_json = {}\n\n    def __init__(self):\n        \"\"\"The EmailProcessor constructor.\n        As initialization it retrieves the email body as both text and HTML.\n        \"\"\"\n        if (emailmessage.body.content is not None):\n            self.email_contents = emailmessage.body.content\n        if (len(self.email_contents) == 0):\n            log.error(\"Email message has no contents!\")\n        else:\n            self.email_contents_json = self.build_dict(self.email_contents)\n\n    def add_info_to_case(self):\n        # Make sure the feed type is correct.\n        if self.email_contents_json.get(FEED_ITEM_TYPE) != TRUSTEER_PPD_FEED_ITEM_TYPE_SUPPORTED:\n            log.error(\"Only Feed item type: %s is supported!\", TRUSTEER_PPD_FEED_ITEM_TYPE_SUPPORTED)\n\n        # Fill in case fields with info from the Trusteer Pinpoint Detect email\n        newReporterInfo = emailmessage.sender.address\n        if hasattr(emailmessage.sender, \"name\") and emailmessage.sender.name is not None:\n            newReporterInfo = u\"{0} \u003c{1}\u003e\".format(\n                emailmessage.sender.name, emailmessage.sender.address)\n            log.info(u\"Adding reporter field \\\"{0}\\\"\".format(newReporterInfo))\n            incident.reporter = newReporterInfo\n\n        # Fill in incident data\n        incident.description = \"Trusteer Pinpoint Detect Alert\"\n        incident.discovered_date = self.soar_datetimeformat(self.email_contents_json.get(EVENT_RECEIVED_AT))\n        incident.start_date = self.soar_datetimeformat(self.email_contents_json.get(EVENT_RECEIVED_AT))\n        incident.plan_status = \"A\"\n        incident.severity_code = self.soar_severity(self.email_contents_json.get(RISK_SCORE))\n        incident.properties.trusteer_ppd_puid = self.email_contents_json.get(PERMANENT_USER_ID)\n        incident.properties.trusteer_ppd_application_id = self.email_contents_json.get(APPLICATION_ID)\n\n    def update_alert_data_table(self):\n        # Add a new row to the Trusteer Alert data table\n        alert_row = incident.addRow(\u0027trusteer_ppd_dt_trusteer_alerts\u0027)\n        alert_row.trusteer_ppd_dt_date_added = int(datetime.now().timestamp()*1000) \n        alert_row.trusteer_ppd_dt_session_id = self.email_contents_json.get(SESSION_ID)\n        alert_row.trusteer_ppd_dt_activity = self.email_contents_json.get(ACTIVITY)\n        alert_row.trusteer_ppd_dt_event_received_at = self.soar_datetimeformat(self.email_contents_json.get(EVENT_RECEIVED_AT))\n        alert_row.trusteer_ppd_dt_user_ip_address = self.email_contents_json.get(USER_IP_ADDRESS)\n        alert_row.trusteer_ppd_dt_device_id_and_link = {\u0027format\u0027:\u0027html\u0027, \u0027content\u0027: self.email_contents_json.get(GLOBAL_DEVICE_ID)}\n        alert_row.trusteer_ppd_dt_new_device_indication = bool(self.email_contents_json.get(NEW_DEVICE_INDICATION))\n        alert_row.trusteer_ppd_dt_organization = self.email_contents_json.get(ORGANIZATION)\n        alert_row.trusteer_ppd_dt_reason = self.email_contents_json.get(REASON)\n        alert_row.trusteer_ppd_dt_recommendation = self.email_contents_json.get(RECOMMENDATION)\n        if self.email_contents_json.get(COUNTRY_NAME) != \u0027N/A\u0027:\n            alert_row.trusteer_ppd_dt_country = COUNTRY_NAMES.get(self.email_contents_json.get(COUNTRY_NAME), \"-\")\n        alert_row.trusteer_ppd_dt_city = self.email_contents_json.get(CITY_NAME)\n        if self.email_contents_json.get(RISK_SCORE) != \u0027N/A\u0027:\n            alert_row.trusteer_ppd_dt_risk_score = int(self.email_contents_json.get(RISK_SCORE))\n\n    def add_artifacts(self):\n        # Add any Trusteer information (not in the data table) as artifacts here.\n        artifact_description = \"Trusteer PPD created artifact.\"\n        if self.email_contents_json.get(USER_AGENT_STRING) and (self.email_contents_json.get(USER_AGENT_STRING) != \u0027N/A\u0027):\n            artifact_value = self.email_contents_json.get(USER_AGENT_STRING)\n            incident.addArtifact(\"User Agent\", artifact_value, artifact_description)\n        if self.email_contents_json.get(MALWARE) and (self.email_contents_json.get(MALWARE) != \u0027N/A\u0027):\n            artifact_value = self.email_contents_json.get(MALWARE)\n            incident.addArtifact(\"Malware Family/Variant\", artifact_value, artifact_description)\n        if self.email_contents_json.get(DETECTED_AT) and (self.email_contents_json.get(DETECTED_AT) != \u0027N/A\u0027):\n            artifact_value = self.email_contents_json.get(DETECTED_AT)\n            incident.addArtifact(\"URL\", artifact_value, artifact_description)\n            \n    def add_incident_note(self):\n        # Add a note containing the email contents\n        incident.addNote(\"Email from Trusteer Pinpoint Detect:\u003cbr\u003e {0}\".format(self.email_contents))\n\n    def get_trusteer_ppd_puid(self):\n        trusteer_ppd_puid = self.email_contents_json.get(PERMANENT_USER_ID, None)\n        if trusteer_ppd_puid is None:\n            log.error(\"Email message has no  Pinpoint Detect Permanent User ID!\")\n        return trusteer_ppd_puid\n\n    @staticmethod\n    def build_dict(content):\n        \"\"\"\n        Builds a dictionary from either the key, value pairs in the email\n        One key, value pair per line, so split on end of line character.\n        :param content: email plain text content\n        :return: Dictionary\n        \"\"\"\n        temp_dict = {}\n        if content is not None:\n            lines = content.split(\"\\n\")\n            for line in lines:\n                keyval = line.strip().split(\": \", 1)\n                if len(keyval) == 2:\n                    temp_dict[keyval[0].strip()] = keyval[1].strip()\n        return temp_dict\n\n    def processAttachments(self):\n        \"\"\" A method to process the email attachments, if present. Each non-inline email attachment is added as an\n        attachment to the incident, and its name is added as an artifact. Inline attachments are assumed to be unimportant.\n        No return value.\n        \"\"\"\n        for attachment in emailmessage.attachments:\n            if not attachment.inline:\n                incident.addEmailAttachment(attachment.id)\n                incident.addArtifact(\n                    \"Email Attachment Name\", attachment.suggested_filename, \"\")\n\n    @staticmethod\n    def soar_severity(risk_score):\n        if risk_score and risk_score != \u0027N/A\u0027:\n            risk_score = int(risk_score)\n            if risk_score \u003c= 200:\n                return \u0027Low\u0027\n            elif risk_score \u003e= 201 and risk_score \u003c= 499:\n                return \u0027Medium\u0027\n            else:\n                return \u0027High\u0027\n        else: \n            return None\n\n    @staticmethod\n    def soar_datetimeformat(value, date_format=\"%Y-%m-%d %H:%M:%S UTC\", split_at=None):\n        if not value:\n            return value\n\n        if split_at:\n            utc_time = time.strptime(value[:value.rfind(split_at)], date_format)\n        else:\n            utc_time = time.strptime(value, date_format)\n        return calendar.timegm(utc_time) * 1000\n\n    @staticmethod\n    def get_message_id(headers):\n        msg_id = None\n        #represent the header keys as lower case for matching\n        header_keys = {k.lower(): k for k in headers.keys()}\n\n        # looks for the headers in order of importance\n        for msg_hdr in MESSAGE_ID_LIST:\n            if msg_hdr in header_keys:\n                msg_id = headers[header_keys[msg_hdr]][0]\n                break\n\n        # remove brackets \u003c\u003e\n        match = MESSAGE_PATTERN.findall(msg_id.strip()) if msg_id else None \n        if match:\n            return match[0]\n            \n    @staticmethod\n    def save_message_id(headers):\n        # extract the message ID and retain\n        msg_id = processor.get_message_id(headers)\n        if msg_id and hasattr(incident.properties, \u0027email_message_id\u0027):\n            incident.properties.email_message_id = msg_id\n\n    @staticmethod\n    def add_email_conversation(headers, msg_body, msg_attachments):\n        # attempt to add to incident datatable, if present\n      \n        def handle_list(value):\n            # convert a list to comma separate list, if neccessary\n            if value and isinstance(value, list):\n                return \", \".join(value)\n        \n            return value\n        \n        try:\n            row = incident.addRow(\u0027email_conversations\u0027)\n            row[\u0027date_sent\u0027] = int(time.time()*1000) # TODO ts from headers.get(\"Date\")\n            row[\u0027source\u0027] = \"inbound\"\n            row[\u0027inbound_id\u0027] = emailmessage.id\n            row[\u0027recipients\u0027] = helper.createRichText(\"To: {}\u003cbr\u003eCc: {}\u003cbr\u003eBcc: {}\".format(handle_list(headers.get(\"To\")), handle_list(headers.get(\"CC\", \u0027\u0027)), handle_list(headers.get(\"BCC\", \u0027\u0027))))\n            row[\u0027from\u0027] = handle_list(headers.get(\"From\"))\n            row[\u0027subject\u0027] = handle_list(headers.get(\"Subject\"))\n            row[\u0027body\u0027] = DEFANG_PATTERN.sub(r\"x_\\1_x:\", msg_body)\n            row[\u0027attachments\u0027] = \", \".join(msg_attachments)\n            row[\u0027message_id\u0027] = processor.get_message_id(headers)\n            row[\u0027in_reply_to\u0027] = handle_list(headers.get(\"References\"))\n            row[\u0027importance\u0027] = handle_list((headers.get(\"Importance\") or {\"1\": \"high\", \"2\": \"normal\", \"3\": \"low\"}.get(headers.get(\"X-Priority\"), \"normal\")))\n        except Exception as err:\n            log.warn(str(err))\n\n###\n# Mainline starts here\n###\n\n# Create the email processor object, loading it with the email message body content.\nprocessor = EmailProcessor()\n\n# Check to see if a similar incident already exists\n# We will search for an incident which has the same name as we would give a new incident\ntrusteer_ppd_puid = processor.get_trusteer_ppd_puid()\nquery_builder.equals(fields.incident.plan_status, \"A\")\nquery_builder.equals(fields.incident.trusteer_ppd_puid, trusteer_ppd_puid)\nquery = query_builder.build()\ncases = helper.findIncidents(query)\n\nif len(cases) == 0:\n  # Create a suitable title for an incident based on the email\n    new_case_title = \"Trusteer PUID {0} via mailbox {1}\".format(trusteer_ppd_puid, emailmessage.inbound_mailbox)\n    \n    # A similar case does not already exist. Create a new case and associate the email with it.\n    log.info(u\"Creating new case {0}\".format(new_case_title))\n\n    # Create an incident with a title based on the email subject, owned identified by variable newIncidentOwner\n    emailmessage.createAssociatedIncident(new_case_title, new_case_owner)\n\n    # Add PUID as aa User Account artifact\n    incident.addArtifact(\"User Account\", trusteer_ppd_puid, \"Permanent User ID from Trusteer\")\n\n    # Update custom fields of the new case\n    processor.add_info_to_case()\n\n    # add message-id for easy tracking\n    processor.save_message_id(emailmessage.headers)\nelse:\n    # A similar case already exists. Associate the email with this preexisting case.\n    log.info(u\"Associating with existing case {0}\".format(cases[0].id))\n    emailmessage.associateWithIncident(cases[0])\n\n# Update the alert data table\nprocessor.update_alert_data_table()\n\n# Add any artifacts from the email\nprocessor.add_artifacts()\n\n# Add incident note with contents of the email\nprocessor.add_incident_note()\n\n# Add email message attachments to incident\nprocessor.processAttachments()\n\nif SAVE_CONVERSATION:\n    processor.add_email_conversation(emailmessage.headers, \n        emailmessage.getBodyHtmlRaw() if emailmessage.getBodyHtmlRaw() else emailmessage.body.content, \n        [attachment.suggested_filename for attachment in emailmessage.attachments])",
      "tags": [],
      "uuid": "89d7ae06-382e-4222-be63-5292ec13445a"
    }
  ],
  "server_version": {
    "build_number": 7899,
    "major": 45,
    "minor": 0,
    "version": "45.0.7899"
  },
  "tags": [],
  "task_order": [],
  "timeframes": null,
  "types": [
    {
      "actions": [],
      "display_name": "Trusteer Alerts",
      "export_key": "trusteer_ppd_dt_trusteer_alerts",
      "fields": {
        "trusteer_ppd_dt_activity": {
          "allow_default_value": false,
          "blank_option": true,
          "calculated": false,
          "changeable": true,
          "chosen": true,
          "default_chosen_by_server": false,
          "deprecated": false,
          "export_key": "trusteer_ppd_dt_trusteer_alerts/trusteer_ppd_dt_activity",
          "hide_notification": false,
          "id": 356,
          "input_type": "text",
          "internal": false,
          "is_tracked": false,
          "name": "trusteer_ppd_dt_activity",
          "operation_perms": {},
          "operations": [],
          "order": 4,
          "placeholder": "",
          "prefix": null,
          "read_only": false,
          "rich_text": false,
          "short_text": "",
          "tags": [],
          "templates": [],
          "text": "Activity",
          "tooltip": "",
          "type_id": 1027,
          "uuid": "9e86174e-1bed-482e-b1e2-3b1901a3bb7c",
          "values": [],
          "width": 67
        },
        "trusteer_ppd_dt_city": {
          "allow_default_value": false,
          "blank_option": true,
          "calculated": false,
          "changeable": true,
          "chosen": true,
          "default_chosen_by_server": false,
          "deprecated": false,
          "export_key": "trusteer_ppd_dt_trusteer_alerts/trusteer_ppd_dt_city",
          "hide_notification": false,
          "id": 366,
          "input_type": "text",
          "internal": false,
          "is_tracked": false,
          "name": "trusteer_ppd_dt_city",
          "operation_perms": {},
          "operations": [],
          "order": 12,
          "placeholder": "",
          "prefix": null,
          "read_only": false,
          "rich_text": false,
          "short_text": "",
          "tags": [],
          "templates": [],
          "text": "City",
          "tooltip": "",
          "type_id": 1027,
          "uuid": "a892bb25-8feb-4faf-8a16-09aa17475e82",
          "values": [],
          "width": 30
        },
        "trusteer_ppd_dt_classification": {
          "allow_default_value": false,
          "blank_option": false,
          "calculated": false,
          "changeable": true,
          "chosen": false,
          "default_chosen_by_server": false,
          "deprecated": false,
          "export_key": "trusteer_ppd_dt_trusteer_alerts/trusteer_ppd_dt_classification",
          "hide_notification": false,
          "id": 388,
          "input_type": "text",
          "internal": false,
          "is_tracked": false,
          "name": "trusteer_ppd_dt_classification",
          "operation_perms": {},
          "operations": [],
          "order": 7,
          "placeholder": "",
          "prefix": null,
          "read_only": false,
          "rich_text": false,
          "short_text": "",
          "tags": [],
          "templates": [],
          "text": "Classification",
          "tooltip": "",
          "type_id": 1027,
          "uuid": "167b732e-02ed-4bec-891e-07cd0873b897",
          "values": [],
          "width": 104
        },
        "trusteer_ppd_dt_country": {
          "allow_default_value": false,
          "blank_option": true,
          "calculated": false,
          "changeable": true,
          "chosen": true,
          "default_chosen_by_server": false,
          "deprecated": false,
          "export_key": "trusteer_ppd_dt_trusteer_alerts/trusteer_ppd_dt_country",
          "hide_notification": false,
          "id": 367,
          "input_type": "text",
          "internal": false,
          "is_tracked": false,
          "name": "trusteer_ppd_dt_country",
          "operation_perms": {},
          "operations": [],
          "order": 11,
          "placeholder": "",
          "prefix": null,
          "read_only": false,
          "rich_text": false,
          "short_text": "",
          "tags": [],
          "templates": [],
          "text": "Country",
          "tooltip": "",
          "type_id": 1027,
          "uuid": "b43e0370-88ed-444b-956b-1ed2f1e668aa",
          "values": [],
          "width": 60
        },
        "trusteer_ppd_dt_date_added": {
          "allow_default_value": false,
          "blank_option": false,
          "calculated": false,
          "changeable": true,
          "chosen": false,
          "default_chosen_by_server": false,
          "deprecated": false,
          "export_key": "trusteer_ppd_dt_trusteer_alerts/trusteer_ppd_dt_date_added",
          "hide_notification": false,
          "id": 389,
          "input_type": "datetimepicker",
          "internal": false,
          "is_tracked": false,
          "name": "trusteer_ppd_dt_date_added",
          "operation_perms": {},
          "operations": [],
          "order": 0,
          "placeholder": "",
          "prefix": null,
          "read_only": false,
          "rich_text": false,
          "short_text": "",
          "tags": [],
          "templates": [],
          "text": "SOAR Added",
          "tooltip": "",
          "type_id": 1027,
          "uuid": "6da57da8-af20-48c9-ad72-ac892ce92b77",
          "values": [],
          "width": 50
        },
        "trusteer_ppd_dt_device_id_and_link": {
          "allow_default_value": false,
          "blank_option": true,
          "calculated": false,
          "changeable": true,
          "chosen": true,
          "default_chosen_by_server": false,
          "deprecated": false,
          "export_key": "trusteer_ppd_dt_trusteer_alerts/trusteer_ppd_dt_device_id_and_link",
          "hide_notification": false,
          "id": 373,
          "input_type": "textarea",
          "internal": false,
          "is_tracked": false,
          "name": "trusteer_ppd_dt_device_id_and_link",
          "operation_perms": {},
          "operations": [],
          "order": 8,
          "placeholder": "",
          "prefix": null,
          "read_only": false,
          "rich_text": true,
          "short_text": "",
          "tags": [],
          "templates": [],
          "text": "Device ID",
          "tooltip": "",
          "type_id": 1027,
          "uuid": "ed68e809-9406-4ada-86f5-79bfe169e688",
          "values": [],
          "width": 51
        },
        "trusteer_ppd_dt_event_received_at": {
          "allow_default_value": false,
          "blank_option": true,
          "calculated": false,
          "changeable": true,
          "chosen": true,
          "default_chosen_by_server": false,
          "deprecated": false,
          "export_key": "trusteer_ppd_dt_trusteer_alerts/trusteer_ppd_dt_event_received_at",
          "hide_notification": false,
          "id": 359,
          "input_type": "datetimepicker",
          "internal": false,
          "is_tracked": false,
          "name": "trusteer_ppd_dt_event_received_at",
          "operation_perms": {},
          "operations": [],
          "order": 1,
          "placeholder": "",
          "prefix": null,
          "read_only": false,
          "rich_text": false,
          "short_text": "",
          "tags": [],
          "templates": [],
          "text": "Event Received At",
          "tooltip": "",
          "type_id": 1027,
          "uuid": "63cf6e9b-eb32-4d8b-a324-7e34e86ba01c",
          "values": [],
          "width": 108
        },
        "trusteer_ppd_dt_new_device_indication": {
          "allow_default_value": false,
          "blank_option": false,
          "calculated": false,
          "changeable": true,
          "chosen": false,
          "default_chosen_by_server": false,
          "deprecated": false,
          "export_key": "trusteer_ppd_dt_trusteer_alerts/trusteer_ppd_dt_new_device_indication",
          "hide_notification": false,
          "id": 371,
          "input_type": "boolean",
          "internal": false,
          "is_tracked": false,
          "name": "trusteer_ppd_dt_new_device_indication",
          "operation_perms": {},
          "operations": [],
          "order": 9,
          "placeholder": "",
          "prefix": null,
          "read_only": false,
          "rich_text": false,
          "short_text": "",
          "tags": [],
          "templates": [],
          "text": "New Device Indication",
          "tooltip": "",
          "type_id": 1027,
          "uuid": "8c28edc1-8e63-464c-b2ce-011cca44283d",
          "values": [],
          "width": 78
        },
        "trusteer_ppd_dt_organization": {
          "allow_default_value": false,
          "blank_option": true,
          "calculated": false,
          "changeable": true,
          "chosen": true,
          "default_chosen_by_server": false,
          "deprecated": false,
          "export_key": "trusteer_ppd_dt_trusteer_alerts/trusteer_ppd_dt_organization",
          "hide_notification": false,
          "id": 365,
          "input_type": "text",
          "internal": false,
          "is_tracked": false,
          "name": "trusteer_ppd_dt_organization",
          "operation_perms": {},
          "operations": [],
          "order": 13,
          "placeholder": "",
          "prefix": null,
          "read_only": false,
          "rich_text": false,
          "short_text": "",
          "tags": [],
          "templates": [],
          "text": "Organization",
          "tooltip": "",
          "type_id": 1027,
          "uuid": "8930e228-85db-4dd8-bb51-638d08ad5abb",
          "values": [],
          "width": 98
        },
        "trusteer_ppd_dt_reason": {
          "allow_default_value": false,
          "blank_option": true,
          "calculated": false,
          "changeable": true,
          "chosen": true,
          "default_chosen_by_server": false,
          "deprecated": false,
          "export_key": "trusteer_ppd_dt_trusteer_alerts/trusteer_ppd_dt_reason",
          "hide_notification": false,
          "id": 361,
          "input_type": "text",
          "internal": false,
          "is_tracked": false,
          "name": "trusteer_ppd_dt_reason",
          "operation_perms": {},
          "operations": [],
          "order": 6,
          "placeholder": "",
          "prefix": null,
          "read_only": false,
          "rich_text": false,
          "short_text": "",
          "tags": [],
          "templates": [],
          "text": "Reason",
          "tooltip": "",
          "type_id": 1027,
          "uuid": "6b584836-66e6-4276-8d33-350b65c4c747",
          "values": [],
          "width": 66
        },
        "trusteer_ppd_dt_recommendation": {
          "allow_default_value": false,
          "blank_option": true,
          "calculated": false,
          "changeable": true,
          "chosen": true,
          "default_chosen_by_server": false,
          "deprecated": false,
          "export_key": "trusteer_ppd_dt_trusteer_alerts/trusteer_ppd_dt_recommendation",
          "hide_notification": false,
          "id": 362,
          "input_type": "text",
          "internal": false,
          "is_tracked": false,
          "name": "trusteer_ppd_dt_recommendation",
          "operation_perms": {},
          "operations": [],
          "order": 5,
          "placeholder": "",
          "prefix": null,
          "read_only": false,
          "rich_text": false,
          "short_text": "",
          "tags": [],
          "templates": [],
          "text": "Recommendation",
          "tooltip": "",
          "type_id": 1027,
          "uuid": "995c8a01-6dfb-438c-800f-c1156ae62feb",
          "values": [],
          "width": 134
        },
        "trusteer_ppd_dt_risk_score": {
          "allow_default_value": false,
          "blank_option": true,
          "calculated": false,
          "changeable": true,
          "chosen": true,
          "default_chosen_by_server": false,
          "deprecated": false,
          "export_key": "trusteer_ppd_dt_trusteer_alerts/trusteer_ppd_dt_risk_score",
          "hide_notification": false,
          "id": 369,
          "input_type": "number",
          "internal": false,
          "is_tracked": false,
          "name": "trusteer_ppd_dt_risk_score",
          "operation_perms": {},
          "operations": [],
          "order": 3,
          "placeholder": "",
          "prefix": null,
          "read_only": false,
          "rich_text": false,
          "short_text": "",
          "tags": [],
          "templates": [],
          "text": "Risk Score",
          "tooltip": "",
          "type_id": 1027,
          "uuid": "5cfdb9c6-a10e-4202-8305-b4a43dcab6e4",
          "values": [],
          "width": 43
        },
        "trusteer_ppd_dt_session_id": {
          "allow_default_value": false,
          "blank_option": true,
          "calculated": false,
          "changeable": true,
          "chosen": true,
          "default_chosen_by_server": false,
          "deprecated": false,
          "export_key": "trusteer_ppd_dt_trusteer_alerts/trusteer_ppd_dt_session_id",
          "hide_notification": false,
          "id": 370,
          "input_type": "text",
          "internal": false,
          "is_tracked": false,
          "name": "trusteer_ppd_dt_session_id",
          "operation_perms": {},
          "operations": [],
          "order": 2,
          "placeholder": "",
          "prefix": null,
          "read_only": false,
          "rich_text": false,
          "short_text": "",
          "tags": [],
          "templates": [],
          "text": "Session ID",
          "tooltip": "",
          "type_id": 1027,
          "uuid": "b5eefdc7-ee57-418e-8697-7172ea11b2e0",
          "values": [],
          "width": 59
        },
        "trusteer_ppd_dt_user_ip_address": {
          "allow_default_value": false,
          "blank_option": true,
          "calculated": false,
          "changeable": true,
          "chosen": true,
          "default_chosen_by_server": false,
          "deprecated": false,
          "export_key": "trusteer_ppd_dt_trusteer_alerts/trusteer_ppd_dt_user_ip_address",
          "hide_notification": false,
          "id": 360,
          "input_type": "text",
          "internal": false,
          "is_tracked": false,
          "name": "trusteer_ppd_dt_user_ip_address",
          "operation_perms": {},
          "operations": [],
          "order": 10,
          "placeholder": "",
          "prefix": null,
          "read_only": false,
          "rich_text": false,
          "short_text": "",
          "tags": [],
          "templates": [],
          "text": "IP Address",
          "tooltip": "",
          "type_id": 1027,
          "uuid": "8f547715-5606-4a48-8a11-22f73c3eaeed",
          "values": [],
          "width": 73
        }
      },
      "for_actions": false,
      "for_custom_fields": false,
      "for_notifications": false,
      "for_workflows": false,
      "id": null,
      "parent_types": [
        "incident"
      ],
      "properties": {
        "can_create": false,
        "can_destroy": false,
        "for_who": []
      },
      "scripts": [],
      "tags": [],
      "type_id": 8,
      "type_name": "trusteer_ppd_dt_trusteer_alerts",
      "uuid": "120b6fc2-e2d7-4c89-aab7-40a117ce9b21"
    }
  ],
  "workflows": [],
  "workspaces": []
}
