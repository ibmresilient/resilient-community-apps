<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v48.1.1.dev0+gc27ea44c.d20230426
-->

# REST API

## Function - REST API

### API Name
`rest_api`

### Output Name
`None`

### Message Destination
`fn_rest_api`

### Pre-Processing Script
```python
# rest_api_url, rest_api_method and rest_api_verify are mandatory fields.
# rest_api_headers, rest_api_cookies, rest_api_body can accept 2 different formats.
#
# 1. New-line separated (Legacy)
#    ---------------------------
#
#    This format allows for specifying inputs as key-value pairs, separated
#    by a new line. It let's us create quick and easy inputs that is properly
#    formatted for the request. The primary purpose of this format is to retain
#    backwards compatibility.
#
#    Note:  This format doesnot support complex data structures such as lists
#    -----  or nested Key-value pairs.
#
#    Example:
#    -------- 
#      body = """
#      name : user1
#      password : p@ssword1
#      role : admin
#      """             
# 
#      headers = """
#      Content-Type: application/json
#      X-Frooble: Baz
#      Authorization: {{auth_header}}
#
#
#
# 2. JSON format:
#    ------------
#
#    Standard json file format. Supports complex data structures such as lists
#    or nested Key-value pairs.
#
#    Example:
#    --------
#      body = """
#      "name" : "user1",
#      "password" : "p@ssword1",
#      "role" : "admin",
#      "content" : { "site_url" : "www.example.com", "users" : ["user1", "user2"] }
#      """      
#
#
#    Hint:
#    -----
#
#    An easier way to feed inputs to the above mentioned fields would be using
#    python dictionaries. While the inputs dont directly support dict, the in-built 
#    json package can be used to convert a python dict to json string.
#
#    Example:
#    --------
#      import json
#     
#      body = {
#       "name"     : "user1",
#       "password" : "p@ssword1",
#       "role"     : "admin",
#       "content"  : { 
#          "site_url" : "www.example.com",
#          "users"    : ["user1", "user2"]
#          }
#      }
#     
#     inputs.rest_api_body = json.dumps(body) # this converts the dict to a json string
#
# """

method = "POST"

url = "https://www.example.com"

header = """
Authorization : xxxxx
Content-type  : application/json
"""

body = """
"displayName"  : "Assist",
"mailEnabled"  : true,
"mailNickname" : "library",
"securityEnabled" : true,
"groupTypes": ["Unified"]
"""

cookie  = None
verify  = True
timeout = 60
allowed_status_code = "305, 400, 404, 500"

inputs.rest_api_url     = url                          # Endpoint url
inputs.rest_api_headers = header if header else None   # Request headers used for Authorization
inputs.rest_api_cookies = cookie if cookie else None   # Cookies for request
inputs.rest_api_body    = body if body else None       # Request body
inputs.rest_api_verify  = verify if verify else True   # (Boolean) indicates whether to verify SSL certificates.
inputs.rest_api_timeout = timeout if timeout else 600  # Request timeout
inputs.rest_api_allowed_status_codes = allowed_status_code if allowed_status_code else "200" # Status codes in a comma separated fashion
inputs.rest_api_method  = method if method and method in ["GET", "HEAD", "POST", "PUT", "DELETE", "OPTIONS"] else "GET" #REST methods: GET, HEAD, POST, PUT, DELETE and OPTIONS

```

### Post-Processing Script
```python
'''
Set the artifact description to the Response (in plain text) of the REST call

results = {
  "ok": response.ok,
  "url": response.url,
  "status_code": response.status_code,
  "reason": response.reason,
  "cookies": dedup_dict(response.cookies),
  "headers": dedup_dict(response.headers),
  "elapsed": int(response.elapsed.total_seconds() * 1000.0),
  "apparent_encoding": response.apparent_encoding,
  "text": response.text,
  "json": response_json,
  "links": response.links,
}
'''

if not results.success:
  incident.addNote(helper.createRichText(results.reason))

else:
  response_text = results.content.get("text")
  if artifact.description:
    artifact.description = u"{}\n\n{}".format(artifact.description.content, response_text)
  else:
    artifact.description = response_text

```

---

