<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v51.0.5.0.1475
-->

# Playbook - BitSight Cyber Insurance: Get Latest Alerts - Example (PB)

### API Name
`bitsight_cyber_insurance_get_latest_alerts`

### Status
`enabled`

### Activation Type
`Manual`

### Activation Conditions
`-`

### Activation Form Elements
| Input Field Label | API Name | Element Type | Tooltip | Requirement |
| ----------------- | -------- | ------------ | ------- | ----------- |
| Alert Type | `bitsight_ci_alert_type` | select | Filter alerts by the specified alert category. Allowed values: PERCENT_CHANGE, RATING_THRESHOLD, RISK_CATEGORY, NIST_CATEGORY, INFORMATIONAL, PUBLIC_DISCLOSURE, VULNERABILITY, FINDINGS_FILTER | Optional |
| Clear SOAR data table | `bitsight_clear_soar_data_table` | boolean | Remove all the data from a SOAR data table before new data is added. | Optional |
| Company GUID | `bitsight_ci_company_guid` | text | The GUID of a company. | Optional |
| expand | `bitsight_ci_expand` | text |  Include additional alert details. Examples: company_custom_id or details only one can be given. | Optional |
| Folder GUID | `bitsight_ci_folder_guid` | text | Filter alerts by the specified folder. Folder unique identifier. | Optional |
| limit | `bitsight_ci_limit` | number | Set the maximum number of results. The results might include fewer records (even zero), but not more. Defaults to 100. | Optional |
| offset | `bitsight_ci_offset` | number | Set the starting point of the return. Defaults to 0. | Optional |
| Severity | `bitsight_ci_severity` | select | Filter alerts by the specified change severity. Allowed values: CRITICAL, WARN, INCREASE, INFORMATIONAL | Optional |

### Object Type
`incident`

### Description
Get alerts generated during the most recent daily platform update.


---
## Function - BitSight Cyber Insurance: Get Latest Alerts

### API Name
`bitsight_cyber_insurance_get_latest_alerts`

### Output Name
`bitsight_ci_get_latest_alerts_return`

### Message Destination
`fn_bitsight_cyber_insurance`

### Function-Input Script
```python
if getattr(playbook.inputs, "bitsight_ci_alert_type", None):
  inputs.bitsight_ci_alert_type = getattr(playbook.inputs, "bitsight_ci_alert_type", None)
if getattr(playbook.inputs, "bitsight_ci_company_guid", None):
  inputs.bitsight_ci_company_guid = getattr(playbook.inputs, "bitsight_ci_company_guid", None)
if getattr(playbook.inputs, "bitsight_ci_expand", None):
  inputs.bitsight_ci_expand = getattr(playbook.inputs, "bitsight_ci_expand", None)
if getattr(playbook.inputs, "bitsight_ci_folder_guid", None):
  inputs.bitsight_ci_folder_guid = getattr(playbook.inputs, "bitsight_ci_folder_guid", None)
if getattr(playbook.inputs, "bitsight_ci_limit", 100):
  inputs.bitsight_ci_limit = getattr(playbook.inputs, "bitsight_ci_limit", 100)
if getattr(playbook.inputs, "bitsight_ci_offset", None):
  inputs.bitsight_ci_offset = getattr(playbook.inputs, "bitsight_ci_limit", 0)
if getattr(playbook.inputs, "bitsight_ci_severity", None):
  inputs.bitsight_ci_severity = getattr(playbook.inputs, "bitsight_ci_severity", None)
if getattr(playbook.inputs, "bitsight_clear_soar_data_table", None):
  inputs.bitsight_ci_clear_datatable = getattr(playbook.inputs, "bitsight_clear_soar_data_table", None)
  inputs.bitsight_ci_soar_incident_id = incident.id
  inputs.bitsight_ci_soar_datatable_name = "bitsight_cyber_insurance_alerts"
```

---

## Local script - BitSight Cyber Insurance: Get Latest Alerts output

### Description


### Script Type
`Local script`

### Object Type
`incident`

### Script Content
```python
from datetime import datetime
results = playbook.functions.results.bitsight_ci_get_latest_alerts_return
if results.get("success", None):
  if len(results.get("content", [])):
    for alert in results.get('content', []):
      row = incident.addRow("bitsight_cyber_insurance_alerts")
      row['bitsight_queried_time'] = int(datetime.now().timestamp()*1000)
      row['bitsight_ci_alert_guid'] = alert.get("guid", None)
      row["bitsight_ci_alert_type"] = alert.get("alert_type", None)
      row["bitsight_ci_alert_date"] = int(datetime.strptime(alert.get("alert_date", None), "%Y-%m-%d").timestamp()*1000) if alert.get("alert_date", None) else None
      row["bitsight_ci_start_date"] = int(datetime.strptime(alert.get("start_date", None), "%Y-%m-%d").timestamp()*1000) if alert.get("start_date", None) else None
      row["bitsight_ci_company_name"] = alert.get("company_name", None)
      row["bitsight_ci_company_guid"] = alert.get("company_guid", None)
      row["bitsight_ci_company_url"] = alert.get("company_url", None)
      row["bitsight_ci_folder_guid"] = alert.get("folder_guid", None)
      row["bitsight_ci_folder_name"] = alert.get("folder_name", None)
      row["bitsight_ci_severity"] = alert.get("severity", None)
      row["bitsight_ci_trigger"] = alert.get("trigger", None)
      row["bitsight_ci_alert_set_name"] = alert.get("alert_set_name", None)
      row["bitsight_ci_alert_set_guid"] = alert.get("alert_set_guid", None)
  else:
    incident.addNote(f"BitSight Cyber Insurance: Get Latest Alerts returned 0 results.")
else:
  incident.addNote(f"BitSight Cyber Insurance: Get Latest Alerts failed with reason:\n{results.get('reason', None)}")
```

---

