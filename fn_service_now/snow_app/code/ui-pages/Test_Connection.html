<!-- (c) Copyright IBM Corp. 2019. All Rights Reserved. -->

<!-- HTML -->
<?xml version="1.0" encoding="utf-8" ?>
<j:jelly trim="false" xmlns:j="jelly:core" xmlns:g="glide" xmlns:j2="null" xmlns:g2="null">
	<style>
		.res-container {
			margin: auto;
			width: 500px;
			height: 200px;
			border: 2px solid #6ea6ff;
			padding: 10px;
			-webkit-box-shadow: 10px 10px 5px -1px rgba(237,237,237,1);
			-moz-box-shadow: 10px 10px 5px -1px rgba(237,237,237,1);
			box-shadow: 10px 10px 5px -1px rgba(237,237,237,1);
		}
		
		.res-container .res-logo{
			display: block;
			margin-left: auto;
			margin-right: auto;
			height: auto;
			width: 60%;
		}
		
		.res-container h3 {
			text-align: center;
			margin: 20px 0px 20px 0px;
		}
		
		.res-container .btn-primary{
			background-color: #0f62fe;
			border-color: #171717;
			display: block;
			margin-left: auto;
			margin-right: auto;
			width: 35%;
		}

		.res-container p{
			text-align: center;
			margin: 5px;
		}

	</style>
	<div class="res-container">
		<img class="res-logo" alt="ibm_soar_logo" src="ibm_soar_logo.png"/>
		<g:ui_form>
			<h3>Test IBM SOAR Connection</h3>
			<button class="btn btn-primary" type="submit" onclick="doTestConnection()">Test Connection</button>
		</g:ui_form>
		<a target="_blank" rel="noopener noreferrer nofollow" href="system_properties_ui.do?sysparm_title=IBM SOAR Properties$[AMP]sysparm_category=IBM SOAR Properties"> 
			<p>Click here to update IBM SOAR Properties</p>
		</a>
	</div>
</j:jelly>

<!-- Client Script -->
<!-- function doTestConnection(){
	return true;
} -->

<!-- Processing Script -->
<!-- try {

	//Test connection to Resilient
	var resHelper = new ResilientHelper();

	//Instantiate new SNOWRESTHelper
	var snowHelper = new SNOWRESTHelper();

	//Test ServiceNowUsername is valid
	var snUsername = gs.getProperty("x_ibmrt_resilient.ServiceNowUsername");

	if(snowHelper.isValidSnUsername(snUsername) == false){
		throw snUsername + " is not a valid ServiceNow user. Please check your IBM SOAR Properties.";
	}
	
	//Check all allowed ServiceNow tables are valid. Will throw an error if not
	snowHelper.allowedTablesAreValid();

	//If we get here, all tests passed
	gs.addInfoMessage("Connection Test Successful!");

}
catch (errMsg){
	gs.addErrorMessage("Connection Test Failed! Check Application Logs");
	gs.addErrorMessage(errMsg);
	gs.error(errMsg);
} -->