<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v51.0.1.0.695
-->

# Playbook - SNOW: Create Record [Task] (PB)

### API Name
`snow_create_record_task_pb`

### Status
`enabled`

### Activation Type
`Manual`

### Activation Conditions
`-`

### Activation Form Elements
| Input Field Label | API Name | Element Type | Tooltip | Requirement |
| ----------------- | -------- | ------------ | ------- | ----------- |
| SN Assignment Group | `sn_assignment_group` | select | The group this record will be assigned to in ServiceNow | Always |
| SN Initial Note | `sn_initial_note` | textarea | - | Optional |

### Object Type
`task`

### Description
None


---
## Function - SNOW: Lookup sys_id

### API Name
`fn_snow_lookup_sysid`

### Output Name
`assignment_group`

### Message Destination
`fn_service_now`

### Function-Input Script
```python
# The table in ServiceNow to query
inputs.sn_table_name = "sys_user_group"

# The name of the field/table column to query
inputs.sn_query_field = "name"

# The value to equate the cell to
# Get the group name from the Rule Activity Field with:
inputs.sn_query_value = getattr(playbook.inputs, "sn_assignment_group", None)

## OR Set group name statically with:
## inputs.sn_query_value = "IT Securities"
```

---
## Function - SNOW: Lookup sys_id

### API Name
`fn_snow_lookup_sysid`

### Output Name
`caller_id`

### Message Destination
`fn_service_now`

### Function-Input Script
```python
# The table in ServiceNow to query
inputs.sn_table_name = "sys_user"

# The name of the field/table column to query
inputs.sn_query_field = "email"

# The value to equate the cell to
inputs.sn_query_value = "ibmresilient" #our integrations user in ServiceNow
```

---
## Function - SNOW: Create Record

### API Name
`fn_snow_create_record`

### Output Name
`create_record`

### Message Destination
`fn_service_now`

### Function-Input Script
```python
from json import dumps
# Default text of the initial note added to the ServiceNow Record
init_snow_note_text = f"""Record created from IBM SOAR Task ID: {task.id}. Associated IBM SOAR Incident ID: {incident.id}."""

# If the user adds a comment when they invoke the playbook, that comment gets concatenated here
initial_note = None
if getattr(playbook.inputs, "sn_initial_note", None):
  initial_note = getattr(playbook.inputs, "sn_initial_note", None).content
if initial_note:
  init_snow_note_text = f"{init_snow_note_text}\n\n{initial_note}"

# ID of this incident
inputs.incident_id = incident.id

# ID of this task
inputs.task_id = task.id

# Initial work note to attach to created ServiceNow record
inputs.sn_init_work_note = init_snow_note_text

# Any further information you want to send to ServiceNow. Each Key/Value pair is attached to the Request object and accessible in ServiceNow.
# ServiceNow Example: setValue('assignment_group', request.body.data.sn_optional_fields.assignment_group)
inputs.sn_optional_fields = dumps({
  "short_description": f"RES-{incident.id}-{task.id}: {task.name}",
  "assignment_group": playbook.functions.results.assignment_group.get("sys_id"),
  "caller_id": playbook.functions.results.caller_id.get("sys_id")
})
```

---

## Local script - SNOW post-process

### Description


### Script Type
`Local script`

### Object Type
`task`

### Script Content
```python
results = playbook.functions.results.create_record
if results.get("success"):

  note_text = f"""<br>This Task has been created in <b>ServiceNow</b>
              <br><b>ServiceNow ID:</b>  {results.get('sn_ref_id')}
              <br><b>ServiceNow Link:</b> <a href='{results.get('sn_record_link')}'>{results.get('sn_record_link')}</a>"""

  task.addNote(helper.createRichText(note_text))

elif results.get("reason"):
  task.addNote(results.get("reason"))
```

---

