<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-circuits codegen
-->

# Example: SNOW Update Record on Severity Change

## Function - SNOW: Update Record

### API Name
`fn_snow_update_record`

### Output Name
``

### Message Destination
`fn_service_now`

### Pre-Processing Script
```python
# Example: SNOW Update Record on Severity Change

#######################################
### Define pre-processing functions ###
#######################################
def dict_to_json_str(d):
  """Function that converts a dictionary into a JSON string.
     Supports types: basestring, bool, int and nested dicts.
     Does not support lists.
     If the value is None, it sets it to False."""

  json_entry = u'"{0}":{1}'
  json_entry_str = u'"{0}":"{1}"'
  entries = [] 

  for entry in d:
    key = entry
    value = d[entry]

    if value is None:
      value = False

    if isinstance(value, list):
      helper.fail('dict_to_json_str does not support Python Lists')

    if isinstance(value, basestring):
      value = value.replace(u'"', u'\\"')
      entries.append(json_entry_str.format(unicode(key), unicode(value)))
      
    elif isinstance(value, unicode):
      entries.append(json_entry.format(unicode(key), unicode(value)))
    
    elif isinstance(value, bool):
      value = 'true' if value == True else 'false'
      entries.append(json_entry.format(key, value))

    elif isinstance(value, int):
      entries.append(json_entry.format(unicode(key), value))

    elif isinstance(value, dict):
      entries.append(json_entry.format(key, dict_to_json_str(value)))

    else:
      helper.fail('dict_to_json_str does not support this type: {0}'.format(type(value)))

  return u'{0} {1} {2}'.format(u'{', ','.join(entries), u'}')

# Map IBM Resilient severity values to ServiceNow severity values
sn_severity_map = {
  "High": 1,
  "Medium": 2,
  "Low": 3
}

#####################
### Define Inputs ###
#####################

# Get the id of this incident
inputs.incident_id = incident.id

# List all the fields you want to update in the ServiceNow Record here with the ServiceNow field_name being the key
inputs.sn_update_fields = dict_to_json_str({
  "severity": sn_severity_map[incident.severity_code],
})
```

### Post-Processing Script
```python

# Add a Note to the Incident
note_text = u"The Severity of this Incident was updated to {0} in IBM Resilient".format(incident.severity_code)
incident.addNote(note_text)
```

---

## Function - SNOW: Add Note to Record

### API Name
`fn_snow_add_note_to_record`

### Output Name
`None`

### Message Destination
`fn_service_now`

### Pre-Processing Script
```python
#####################
### Define Inputs ###
#####################

inputs.incident_id = incident.id

inputs.sn_note_text = u"The Severity of this Incident was updated to {0} in IBM Resilient".format(incident.severity_code)
```

### Post-Processing Script
```python
None
```

---

