<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
-->

# Example: Jira Open Issue (Task)

## Function - Jira Open Issue

### API Name
`jira_open_issue`

### Output Name
`None`

### Message Destination
`fn_jira`

### Pre-Processing Script
```python
# Example: Jira Open Issue [Task] pre-processing script
def list_to_json_str(l):
  """
  Function that converts a list into a JSON string.
  Supports types: basestring, unicode, bool, int, list and dicts.
  If the value is None, it sets it to False.
  """
  list_as_str = ''
  json_entry = u'{0},'
  json_entry_str = u'"{0}",'

  for value in l:
    if not value:
      value = False

    if isinstance(value, list):
      list_as_str += json_entry.format(list_to_json_str(value))

    elif isinstance(value, dict):
      list_as_str += json_entry.format(dict_to_json_str(value))

    elif isinstance(value, basestring):
      value = value.replace(u'"', u'\\"').replace("\n", "\\n")
      list_as_str += json_entry_str.format(unicode(value))

    elif isinstance(value, unicode):
      list_as_str += json_entry.format(unicode(value))

    elif isinstance(value, bool):
      list_as_str += json_entry.format('true' if value else 'false')

    elif isinstance(value, int):
      list_as_str += json_entry.format(value)

    else:
      helper.fail('list_to_json_str does not support this type: {}'.format(type(value)))

  return u'{} {} {}'.format(u'[', list_as_str[:-1], u']')

def dict_to_json_str(d):
  """
  Function that converts a dictionary into a JSON string.
  Supports types: basestring, unicode, bool, int, list and nested dicts.
  If the value is None, it sets it to False.
  """

  json_entry = u'"{0}":{1}'
  json_entry_str = u'"{0}":"{1}"'
  entries = []

  for entry in d:
    key = entry
    value = d[entry] 
    
    if not value:
      value = False

    if isinstance(value, list):
      entries.append(json_entry.format(unicode(key), list_to_json_str(value)))

    elif isinstance(value, dict):
      entries.append(json_entry.format(key, dict_to_json_str(value)))

    elif isinstance(value, basestring):
      value = value.replace(u'"', u'\\"').replace("\n", "\\n")
      entries.append(json_entry_str.format(unicode(key), unicode(value)))

    elif isinstance(value, unicode):
      entries.append(json_entry.format(unicode(key), unicode(value)))

    elif isinstance(value, bool):
      entries.append(json_entry.format(key, 'true' if value else 'false'))

    elif isinstance(value, int):
      entries.append(json_entry.format(unicode(key), value))

    else:
      helper.fail('dict_to_json_str does not support this type: {}'.format(type(value)))

  return u'{} {} {}'.format(u'{', ','.join(entries), u'}')

inputs.jira_label = rule.properties.jira_label

# ID of this incident
inputs.incident_id = incident.id

# ID of this task
inputs.task_id = task.id

# A map for JIRA priorities
priority_map = { "Low": {"name": "Low"}, "Medium": {"name": "Medium"}, "High": {"name": "High"} }
jira_priority = priority_map.get(incident.severity_code, {"name": "Low"})

# Define JIRA fields here
inputs.jira_fields = dict_to_json_str({
  "project": rule.properties.jira_project_id,
  "issuetype": rule.properties.jira_issue_type,
  "priority": jira_priority,
  "summary": u"IBM SOAR: {}".format(unicode(task.name)),
  "description": task.instructions.content if task.get("instructions") else "Created in IBM SOAR"
})
```

### Post-Processing Script
```python
from java.util import Date
time_now = Date().time

if results.get("success"):
  results_content = results.get("content", {})
  incident.properties.soar_case_last_updated = Date()

  url = "<a href='{}' target='blank'>{}</a>".format(results_content.get("issue_url"), results_content.get("issue_key"))

  # Add Note
  task.addNote(helper.createRichText("Added Jira Issue: {}\nTo server labeled: {}".format(url, rule.properties.jira_label)))

  # Add server label to be used for automatic rules
  incident.properties.jira_server = rule.properties.jira_label

  # Add Row to Jira Data Table
  # default is jira_task_references but can be changed by changing 'jira_dt_name' in app.config
  row = incident.addRow(results_content.get("jira_dt_name"))
  row['date'] = time_now
  row['task_id'] = task.id
  row['task'] = task.name
  row['jira_link'] = helper.createRichText(url)
  row['jira_issue_id_col'] = results_content.get("issue_key")
  row['status'] = 'Open'
  row['server'] = rule.properties.jira_label
```

---

