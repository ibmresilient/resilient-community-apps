<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v51.0.1.0.695
-->

# Playbook - Example: Create Jira Issue (Task)

### API Name
`example_create_jira_issue_task`

### Status
`enabled`

### Activation Type
`Manual`

### Activation Conditions
`task.status equals Open`

### Activation Form Elements
| Input Field Label | API Name | Element Type | Tooltip | Requirement |
| ----------------- | -------- | ------------ | ------- | ----------- |
| Jira Issue Type | `jira_issue_type` | select | The type of issue to create in Jira Story/Bug etc. | Always |
| Jira Label | `jira_label` | text | Label of the Jira server to use | Optional |
| Jira Project ID | `jira_project_id` | select | The id of the project you want to send this to in your Jira system. Ex: "JRA" | Always |

### Object Type
`task`

### Description
Create a Jira issue from a SOAR task


---
## Function - Jira Open Issue

### API Name
`jira_open_issue`

### Output Name
`create_result`

### Message Destination
`fn_jira`

### Function-Input Script
```python
# Example: Jira Open Issue [Task] pre-processing script
from json import dumps

if getattr(playbook.inputs, "jira_label"):
  inputs.jira_label = playbook.inputs.jira_label
elif incident.properties.jira_server:
  inputs.jira_label = incident.properties.jira_server

# ID of this incident
inputs.incident_id = incident.id

# ID of this task
inputs.task_id = task.id

# A map for JIRA priorities
priority_map = { "Lowest": {"name": "Lowest"}, "Low": {"name": "Low"}, "Medium": {"name": "Medium"}, "High": {"name": "High"}, "Highest": {"name": "Highest"} }
jira_priority = priority_map.get(incident.severity_code, {"name": "Low"})

# Define JIRA fields here
inputs.jira_fields = dumps({
  "project": playbook.inputs.jira_project_id,
  "issuetype": playbook.inputs.jira_issue_type,
  "priority": jira_priority,
  "summary": "IBM SOAR: {}".format(str(task.name)),
  "description": task.instructions.content if task.get("instructions") else "Created in IBM SOAR"
})
```

---

## Local script - Jira Open Issue Task Post-process

### Description


### Script Type
`Local script`

### Object Type
`task`

### Script Content
```python
from datetime import datetime
time_now = datetime.now()
create_result = playbook.functions.results.create_result

if create_result.get("success"):
  results_content = create_result.get("content", {})
  issue_key = results_content.get("issue_key")

  url = "<a href='{}' target='blank'>{}</a>".format(results_content.get("issue_url"), issue_key)

  # Add Note
  task.addNote(helper.createRichText("Added Jira Issue: {}\nTo server labeled: {}".format(url, playbook.inputs.jira_label)))

  # This is needed for the poller to pick up this incident
  incident.properties.jira_linked_to_incident = True

  # Add server label to be used for automatic rules
  incident.properties.jira_server = playbook.inputs.jira_label

  # Add Row to Jira Data Table
  # default is jira_task_references but can be changed by changing 'jira_dt_name' in app.config
  row = incident.addRow(results_content.get("jira_dt_name"))
  row['date'] = time_now
  row['task_id'] = task.id
  row['task'] = task.name
  row['jira_link'] = helper.createRichText(url)
  row['jira_issue_id_col'] = issue_key
  row['status'] = 'Open'
  row['server'] = playbook.inputs.jira_label
  row['last_updated'] = time_now
  row['issue_type'] = results_content.get("issue", {}).get("fields", {}).get("issuetype", {}).get("name")
```

---

