<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v50.0.151
-->

# Playbook - Example: Create Jira Issue

### API Name
`example_create_jira_issue`

### Status
`enabled`

### Activation Type
`Manual`

### Activation Conditions
`incident.properties.jira_internal_url not_has_a_value`

### Activation Form Elements
| Input Field Label | API Name | Element Type | Tooltip | Requirement |
| ----------------- | -------- | ------------ | ------- | ----------- |
| Jira Issue Type | `jira_issue_type` | select | The type of issue to create in Jira Story/Bug etc. | Always |
| Jira Label | `jira_label` | text | Label of the Jira server to use | Optional |
| Jira Project ID | `jira_project_id` | select | The id of the project you want to send this to in your Jira system. Ex: "JRA" | Always |

### Object Type
`incident`

### Description
Create a Jira issue from the SOAR incident


---
## Function - Jira Open Issue

### API Name
`jira_open_issue`

### Output Name
`create_result`

### Message Destination
`fn_jira`

### Function-Input Script
```python
from json import dumps
if playbook.inputs.jira_label:
  inputs.jira_label = playbook.inputs.jira_label
else:
  inputs.jira_label = incident.properties.jira_label

# ID of this incident
inputs.incident_id = incident.id

# A map for JIRA priorities
priority_map = { "Lowest": {"name": "Lowest"}, "Low": {"name": "Low"}, "Medium": {"name": "Medium"}, "High": {"name": "High"}, "Highest": {"name": "Highest"} }
jira_priority = priority_map.get(incident.severity_code, {"name": "Low"})

# Define JIRA fields here
inputs.jira_fields = dumps({
  "project": playbook.inputs.jira_project_id,
  "issuetype": playbook.inputs.jira_issue_type,
  "priority": jira_priority,
  "summary": f"IBM SOAR: {incident.name}",
  "description": incident.description.content if incident.get("description") else "Created in IBM SOAR"
})
```

---

## Local script - Post-process

### Description


### Script Type
`Local script`

### Object Type
`incident`

### Script Content
```python
create_result = playbook.functions.results.create_result
if create_result.get("success"):
  results_content = create_result.get("content", {})
  issue_key = results_content.get("issue_key")
  incident.properties.jira_url = "<a href='{}' target='blank'>{}</a>".format(results_content.get("issue_url"), issue_key)
  incident.properties.jira_internal_url = results_content.get("issue_url_internal")
  incident.properties.jira_issue_id = issue_key
  incident.properties.jira_server = playbook.inputs.jira_label
  incident.properties.jira_project_key = issue_key[:issue_key.index("-")]
  incident.properties.jira_issue_status = "To Do"
  # This is needed for the poller to pick up this incident
  incident.properties.jira_linked_to_incident = True
  incident.properties.jira_issue_type = results_content.get("issue", {}).get("fields", {}).get("issuetype", {}).get("name")
```

---

