<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v51.0.2.0.974
-->

# Playbook - PagerDuty: Create Incident from SOAR (PB)

### API Name
`pagerduty_create_incident_on_creation_pb`

### Status
`disabled`

### Activation Type
`Automatic`

### Activation Conditions
`incident.properties.pd_incident_id not_has_a_value AND incident.properties.pd_incident_service_name has_a_value AND object_added`

### Object Type
`incident`

### Description
Automatically create a PagerDuty incident from a SOAR incident when SOAR incident is created. For this playbook to execute, the SOAR incident field, PagerDuty Incident Service Name, has to have a value.


---
## Function - PagerDuty Create Incident

### API Name
`pagerduty_create_incident`

### Output Name
`create_incident`

### Message Destination
`pagerduty`

### Function-Input Script
```python
inputs.pd_service = incident.properties.pd_incident_service_name
inputs.incidentID = incident.id
inputs.pd_title = f"SOAR: {incident.name}"
inputs.pd_incident_key = f'RES-{str(incident.id)}'

priority = { 'Low': 'p3', 'Medium': 'p2', 'High': 'p1' }
if incident.severity_code in priority:
  inputs.pd_priority = priority.get(incident.severity_code)
else:
  inputs.pd_priority = 'p4' # lowest

if incident.description:
  inputs.pd_description = incident.description
```

---

## Global script - PagerDuty Create Incident Post-Process Script

### Description


### Script Type
`Global script`

### Object Type
`incident`

### Script Content
```python
results = playbook.functions.results.create_incident
if results.get("success"):
  pdResult = results.get("content", {}).get("pd", {}).get('incident', {})
  incident.properties.pd_incident_id  = pdResult.get('id')
  incident.properties.pd_incident_url = "<a href='{}' target='blank'>Link</a>".format(pdResult.get('html_url'))
  incident.properties.pd_incident_service_name = pdResult.get("service", {}).get("id")
  incident.addNote(f"Incident with ID: {pdResult.get('id')} was successfully created on PagerDuty")
```

---

