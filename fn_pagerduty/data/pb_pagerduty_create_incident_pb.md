<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v50.1.197
-->

# Playbook - PagerDuty: Create Incident (PB)

### API Name
`pagerduty_create_incident_pb`

### Status
`enabled`

### Activation Type
`Manual`

### Activation Conditions
`incident.properties.pd_incident_id not_has_a_value`

### Activation Form Elements
| Input Field Label | API Name | Element Type | Tooltip | Requirement |
| ----------------- | -------- | ------------ | ------- | ----------- |
| Escalation policy name from pagerduty | `pd_escalation_policy` | text | If left empty, it will be set to 'default'. | Optional |
| Incident Description | `pd_description` | text | - | Optional |
| Pagerduty Service Name | `pd_service` | text | - | Always |

### Object Type
`incident`

### Description
Create a PagerDuty Incident based on a Resilient Incident.


---
## Function - PagerDuty Create Incident

### API Name
`pagerduty_create_incident`

### Output Name
`create_incident`

### Message Destination
`pagerduty`

### Function-Input Script
```python
if not playbook.inputs.pd_escalation_policy:
  inputs.pd_escalation_policy = "default"
else:
  inputs.pd_escalation_policy = playbook.inputs.pd_escalation_policy

inputs.pd_service = playbook.inputs.pd_service
inputs.incidentID = incident.id
inputs.pd_title = "SOAR: {}".format(incident.name)
inputs.pd_incident_key = 'RES-'+str(incident.id)
    
priority = { 'Low': 'p3', 'Medium': 'p2', 'High': 'p1' }
if incident.severity_code in priority:
  inputs.pd_priority = priority.get(incident.severity_code)
else:
  inputs.pd_priority = 'p4' # lowest
    
if not incident.description is None:
  inputs.pd_description = incident.description

```

---

## Local script - PagerDuty Create Incident Post-Process Script

### Description


### Script Type
`Local script`

### Object Type
`incident`

### Script Content
```python
results = playbook.functions.results.create_incident

incident.properties.pd_incident_id  = results.pd['incident']['id']
incident.properties.pd_incident_url = "<a href='{}' target='blank'>Link</a>".format(results.pd['incident']['html_url'])
incident.addNote("Incident Created On PagerDuty")
```

---

