<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v52.0.0.0.927
-->

# Playbook - VMware CBC: Refetch Device in Row

### API Name
`vmware_cbc_refetch_device_in_row`

### Status
`enabled`

### Activation Type
`Manual`

### Activation Conditions
`-`

### Object Type
`vmware_cbc_device_dt`

### Description
Get the device data on the device in this row and add to a new row in the data table.  Use to compare device query results over time.


---
## Function - VMware CBC: Get Alert By ID

### API Name
`vmware_cbc_get_alert_by_id`

### Output Name
`get_alert_by_id_results`

### Message Destination
`vmware_carbon_black_cloud`

### Function-Input Script
```python
inputs.vmware_cbc_alert_id = incident.properties.vmware_cbc_alert_id
```

---
## Function - VMware CBC: Get Device By ID

### API Name
`vmware_cbc_get_device_by_id`

### Output Name
`get_device_by_id_results`

### Message Destination
`vmware_carbon_black_cloud`

### Function-Input Script
```python
inputs.vmware_cbc_device_id = row.cbc_device_id
```

---

## Local script - VMware CBC: Update CBC Device data table with alert data

### Description
Update the CBC Device data table with alert data and write on note.

### Script Type
`Local script`

### Object Type
`vmware_cbc_device_dt`

### Script Content
```python
from datetime import datetime

results = playbook.functions.results.get_alert_by_id_results

if results.get("success", False):
  content = results.get("content", {})
  if content:
    alert = content.get("alert", {})
    if alert:
      row.cbc_query_date = datetime.now()
      row.cbc_device_id = str(alert.get("device_id")) if alert.get("device_id", None) else None
      row.cbc_device_policy_id =   str(alert.get("device_policy_id", None)) if alert.get("device_policy_id", None) else None
      row.cbc_device_name =        alert.get("device_name", None)
      row.cbc_device_policy =      alert.get("device_policy", None)
      row.cbc_device_os_version =  alert.get("device_os_version", None)
      row.cbc_device_username =    alert.get("device_username", None)
      row.cbc_device_external_ip = alert.get("device_external_ip", None)
      row.cbc_device_internal_ip = alert.get("device_internal_ip", None)
      row.cbc_device_location =    alert.get("device_location", None)

      note_text = "<b>VMware CBC: Refetch CBC Device Row from Alert:</b> Update complete."
    else:
      note_text = "<b>VMware CBC: Refetch CBC Device Row from Alert:</b> No alert found."
  else:
    note_text = "<b>VMware CBC: Refetch CBC Device Row from Alert:</b> No alert found (no content)."
else:
  reason = results.get("reason", None)
  note_text = f"<bVMware CBC: Refetch CBC Device Row from Alert:</b> Update did not complete. Reason: {reason}"
    
incident.addNote(note_text)
```

---
## Global script - VMware CBC: Populate CBC Device Row from Device

### Description
Write the results of get device by ID function to the Device data table.

### Script Type
`Global script`

### Object Type
`vmware_cbc_device_dt`

### Script Content
```python
results = playbook.functions.results.get_device_by_id_results

if results.get("success", False):
  content = results.get("content", {})
  if content:
    device = content.get("device", None)
    if device:
      row.cbc_device_quarantined = device.get("quarantined", None)
      row.cbc_device_status = device.get("status", None)
      sensor_states =  device.get("sensor_states", None) 
      row.cbc_sensor_state = ", ".join(sensor_states) if isinstance(sensor_states, list) else None
      note_text = f"<b>VMware CBC: Populate Device Row from Device:</b> Update complete."
    else:
      note_text = f"<b>VMware CBC: Populate Device Row from Device:</b> Unable to get device data to update CBC Device data table."
  else:
    note_text = f"<b>VMware CBC: Populate Device Row from Device:</b> Unable to get device data to update CBC Device data table - no content."
else:
  reason = results.get("reason", None)
  note_text = f"<b>VMware CBC: Populate Device Row from Device:</b> Unable to get device data to update CBC Device data table.<br> reason: {reason}"
  
incident.addNote(note_text)

```

---

