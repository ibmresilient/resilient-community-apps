<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
-->

# ReaQta: Get Alert Information

## Function - ReaQta: Get Alert Information

### API Name
`reaqta_get_alert_information`

### Output Name
`None`

### Message Destination
`fn_reaqta`

### Pre-Processing Script
```python
inputs.reaqta_alert_id = incident.properties.reaqta_id
inputs.reaqta_hive = incident.properties.reaqta_hive
```

### Post-Processing Script
```python
TRIGGERCONDITION_LOOKUP = {
    0: "Code Injection",
    1: "Process Impersonated",
    2: "Signature Forged",
    3: "Incident Correlated",
    4: "DLL Sideloaded",
    5: "Suspicious Script Executed",
    6: "Policies Triggered",
    7: "Anomalous Behaviour Detected",
    8: "Token Stolen",
    9: "Ransomware Behavior Detected",
    10: "Privilege Escalated",
    11: "External Trigger",
    12: "Detection Strategy",
    13: "Antimalware Detection"
  }

if not results.success:
  incident.addNote("ReaQta: Get Alert Information failed: {}".format(results.reason))
else:
  content = results.content
  alert_url = '<a href="{0}" target="blank">{0}</a>'.format(content.get("alert_url"))
  incident.properties.reaqta_alert_link = helper.createRichText(alert_url)
  incident.properties.reaqta_endpoint_id = content.get("endpointId")
  incident.properties.reaqta_trigger_condition = TRIGGERCONDITION_LOOKUP.get(content.get("triggerCondition"))
  incident.properties.reaqta_impact = content.get("impact")
  
  endpoint = content.get("endpoint", {})
  incident.properties.reaqta_tags = ", ".join(content.get("tags", []))
  incident.properties.reaqta_groups = ", ".join([ group.get("name") for group in endpoint.get("groups", []) ])
  incident.properties.reaqta_machine_info = "Machine Name: {}\nOS: {}\nDomain: {}\nCPU: {}"\
                          .format(endpoint.get('name'),
                                  endpoint.get('os'),
                                  endpoint.get('domain'),
                                  endpoint.get('cpuDescr'))
                                  
  # populate datatable with trigger events
  for event in content.get('triggerEvents', []):
    row = incident.addRow('reaqta_trigger_events')
    row['happened_at'] = event.get('happenedAt_ts')
    row['category'] = event.get('category')
    row['relevance'] = event.get('relevance')
    row['severity'] = event.get('severity')
    
    process = event.get('process', {})
    program = process.get('program', {})
    if program:
      row['process_pid'] = process.get('pid')
      row['program_path'] = program.get('path')
      row['sha256_hash'] = program.get('sha256')
    
    if event.get('category') == "etw" and event.get('data'):
      data = event.get('data')
      row['windows_event_account'] = "{}\\{}".format(data.get('etwTargetDomainName'), data.get('etwTargetUserName'))
      row['windows_event_workstation'] = data.get('etwWorkstationName')
      row['windows_event_description'] = data.get('etwEventDescription')
      row['windows_event_ipport'] = "{}/{}".format(data.get('etwIpAddress'), data.get('etwIpPort'))
      
    if event.get('category') == "policies" and event.get('data'):
      data = event.get('data')
      row['policy_match'] = data.get('matched', [])[0]['policyTitle']
      
    
    # create artifacts from the trigger event
    if program:
      incident.addArtifact("Malware SHA-256 Hash", program.get('sha256'), "")
      incident.addArtifact("File Path", program.get('path'), "")
      incident.addArtifact("File Name", program.get('filename'), "")
    if process:
      incident.addArtifact("User Account", process.get('user'), "")
    
  # create artifacts from endpoint
  endpoint_name = endpoint.get("name")
  incident.addArtifact("IP Address", endpoint.get("localAddr"), "Endpoint: {}".format(endpoint_name))
  incident.addArtifact("System Name", endpoint_name, "")

```

---

