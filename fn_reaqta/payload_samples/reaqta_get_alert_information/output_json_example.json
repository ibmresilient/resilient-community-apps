{
  "version": 2.0,
  "success": true,
  "reason": null,
  "content": {
    "id": "1015597023501484034",
    "localId": "1015596879049656322",
    "endpointId": "982370521729466368",
    "triggerCondition": 12,
    "endpoint": {
      "id": "982370521729466368",
      "machineId": "0c0dcd602f5d65aed629d4199c8f665955c434050d68a634eaf4ba0e1058b7ce",
      "osType": 1,
      "cpuVendor": 1,
      "arch": 2,
      "cpuDescr": "Intel(R) Core(TM) i7-10750H CPU @ 2.60GHz",
      "kernel": "10.0",
      "os": "Windows 10 Enterprise",
      "name": "IBM-PF36LBRC",
      "state": 1,
      "registrationTime": "2023-04-24T21:50:33.146Z",
      "agentVersion": "3.10.1",
      "componentsVersions": [
        {
          "name": "keeper",
          "version": "3.10.1",
          "build": "27.1668701555901.commit"
        },
        {
          "name": "probos",
          "version": "3.5.0",
          "build": "3.5.0"
        },
        {
          "name": "rqtsentry",
          "version": "3.6.1",
          "build": "119.1632119719010.commit"
        },
        {
          "name": "rqtnetsentry",
          "version": "3.10.0",
          "build": "45.1666597836648.commit"
        },
        {
          "name": "installer",
          "version": "3.10.1",
          "build": ""
        }
      ],
      "isVirtualMachine": false,
      "isDomainController": false,
      "isServer": false,
      "sessionStart": "2023-07-07T21:20:29.083Z",
      "sessionEnd": "2023-07-07T22:10:29.109Z",
      "lastSeenAt": "2023-07-07T22:05:29.109Z",
      "disconnectionReason": 0,
      "localAddr": "192.168.1.97",
      "hvStatus": 19,
      "macs": [
        "5c:e4:2a:2c:f3:a7",
        "90:2e:16:c4:f7:7d"
      ],
      "isolated": false,
      "isolationStatus": "PENDING_ISOLATION",
      "isolationStatusFailure": null,
      "connected": false,
      "tags": [],
      "groups": [
        {
          "id": "988899645751033863",
          "name": "Example Group",
          "description": "This is an example group.",
          "parentGroupId": "988899392910000135"
        },
        {
          "id": "988899392910000135",
          "name": "Example Client"
        }
      ],
      "avInstalled": false
    },
    "triggerEvents": [
      {
        "id": "1015597023866388481",
        "category": "hive",
        "localId": "1015596878957389825",
        "endpointId": "982370521729466368",
        "receivedAt": "2023-07-07T13:39:59.370Z",
        "happenedAt": "2023-07-07T13:39:24.821Z",
        "relevance": 0,
        "severity": "none",
        "trigger": true,
        "manuallyAdded": false,
        "process": {
          "id": "982370521729466368:27136:1688737164600",
          "parentId": "982370521729466368:18816:1688737159302",
          "endpointId": "982370521729466368",
          "program": {
            "path": "c:\\windows\\system32\\net.exe",
            "filename": "net.exe",
            "md5": "bb1ae49b6b7c53499e94613761a6ac56",
            "sha1": "76866dde54ee3fa5bc8efefb9d44e6bf859973aa",
            "sha256": "afbe51517092256504f797f6a5abc02515a09d603e8c046ae31d7d7855568e91",
            "certInfo": {
              "signer": "Microsoft Windows",
              "issuer": "Microsoft Windows Production PCA 2011",
              "trusted": true,
              "expired": false
            },
            "size": 81920,
            "arch": "x64",
            "fsName": "net.exe"
          },
          "user": "NT AUTHORITY\\SYSTEM",
          "pid": 27136,
          "startTime": "2023-07-07T13:39:24.600Z",
          "ppid": 18816,
          "pstartTime": "2023-07-07T13:39:19.302Z",
          "userSID": "S-1-5-18",
          "privilegeLevel": "SYSTEM",
          "noGui": false,
          "logonId": "0x3e7"
        },
        "eventType": 2,
        "data": {
          "cmdLine": "\"C:\\windows\\system32\\net.exe\" accounts",
          "cmdLineArgs": [
            "C:\\windows\\system32\\net.exe",
            "accounts"
          ],
          "_t": "l"
        },
        "happenedAt_ts": 1688737164000
      },
      {
        "id": "1015597023866392577",
        "category": "policies",
        "localId": "1015596878957393921",
        "endpointId": "982370521729466368",
        "receivedAt": "2023-07-07T13:39:59.370Z",
        "happenedAt": "2023-07-07T13:39:24.821Z",
        "relevance": 100,
        "severity": "high",
        "trigger": true,
        "manuallyAdded": false,
        "process": {
          "id": "982370521729466368:27136:1688737164600",
          "parentId": "982370521729466368:18816:1688737159302",
          "endpointId": "982370521729466368",
          "program": {
            "path": "c:\\windows\\system32\\net.exe",
            "filename": "net.exe",
            "md5": "bb1ae49b6b7c53499e94613761a6ac56",
            "sha1": "76866dde54ee3fa5bc8efefb9d44e6bf859973aa",
            "sha256": "afbe51517092256504f797f6a5abc02515a09d603e8c046ae31d7d7855568e91",
            "certInfo": {
              "signer": "Microsoft Windows",
              "issuer": "Microsoft Windows Production PCA 2011",
              "trusted": true,
              "expired": false
            },
            "size": 81920,
            "arch": "x64",
            "fsName": "net.exe"
          },
          "user": "NT AUTHORITY\\SYSTEM",
          "pid": 27136,
          "startTime": "2023-07-07T13:39:24.600Z",
          "ppid": 18816,
          "pstartTime": "2023-07-07T13:39:19.302Z",
          "userSID": "S-1-5-18",
          "privilegeLevel": "SYSTEM",
          "noGui": false,
          "logonId": "0x3e7"
        },
        "eventType": 49,
        "data": {
          "matched": [
            {
              "policyId": "992023020967034884",
              "versionId": "1004361409577877509",
              "policyTitle": "Potential APT",
              "policyDescription": "",
              "scope": "global",
              "groups": [],
              "matcher": {
                "id": "992023020967043078",
                "script": "-- Title: Potential APT\n-- Description: This policy will notify every time a series of suspicious app runs within a stipulated timeframe\n-- Binding Events: Process Created\n-- Platform: Windows\n--\n-- Configuration parameters:\n--      app_count :            Number of app_count before triggering and incident\n--      time_span_millis :     Time span between the app_count could happen. Definied in milliseconds.\n--\n-- Adjust the variables accordingly\n-- The timezone is the local time\n\napp_count = 3\ntime_span_millis = 1*60*1000 -- 1 min\n\n------------------ DO NOT CHANGE THE CODE BELOW ---------------------\n\nlocal function notify(event)\n    title = \"Potential APT Detected: \" .. event.process.get_parent_ofn()\n    notes = title\n    impact = 80\n    tags = {\"apt\"}\n    create_alert({event}, title, impact, notes, tags)\n    msg_box (title)\nend\n\n\nlocal apps = {\n    \"net.exe\",\n    \"systeminfo.exe\",\n    \"hostname.exe\",\n    \"whoami.exe\",\n    \"tasklist.exe\"\n}\n\nlocal function match_app(app)\n    for key, value in pairs(apps) do\n        if app:lower():find(value) then\n            return true\n        end\n    end\n    return false\nend\n\nlocal app = match_app(event.process.get_ofn())\n\nif not app then\n    return\nend\n\n\nif tbox == nil then\n    tbox = timebox.new(app_count, time_span_millis)\nend\n\nif tbox:count() then\n    if event.parentProcess then kill_process(event.parentProcess.pid, event.parentProcess.startTime) end\n    kill_process(event)\n    notify(event)\nend",
                "osTypes": [
                  1
                ],
                "eventTypes": [
                  2
                ],
                "type": 28
              }
            }
          ],
          "_t": "r"
        },
        "happenedAt_ts": 1688737164000
      }
    ],
    "totalEventCount": 9,
    "byTypeEventCount": [
      {
        "type": 2,
        "count": 6
      },
      {
        "type": 3,
        "count": 1
      },
      {
        "type": 30,
        "count": 1
      },
      {
        "type": 49,
        "count": 1
      }
    ],
    "impact": 80,
    "severity": "medium",
    "closed": true,
    "closedAt": "2023-07-09T00:00:03.317Z",
    "lastChangedAt": "2023-07-10T04:46:44.747Z",
    "activityState": "archived",
    "terminationReason": 1,
    "receivedAt": "2023-07-07T13:39:59.283Z",
    "happenedAt": "2023-07-07T13:39:24.843Z",
    "tags": [
      "apt"
    ],
    "notes": "Potential APT Detected: powershell.exe\nIBM SOAR 07/07/2023 21:40:16\nPotential APT Detected: powershell.exe\n\n[SOAR Case - 2131](https://9.30.211.113:443/#incidents/2131)\nIBM SOAR 07/07/2023 13:40:42\nPotential APT Detected: powershell.exe\nIBM SOAR 07/07/2023 21:40:16\nPotential APT Detected: powershell.exe\n\n[SOAR Case - 2131](https://9.30.211.113:443/#incidents/2131)\n\n[SOAR Case - 2560](https://9.30.24.113:443/#incidents/2560)\nIBM SOAR 07/07/2023 13:38:32\nPotential APT Detected: powershell.exe\nIBM SOAR 07/07/2023 21:40:16\nPotential APT Detected: powershell.exe\n\n[SOAR Case - 2131](https://9.30.211.113:443/#incidents/2131)\nIBM SOAR 07/07/2023 13:40:42\nPotential APT Detected: powershell.exe\nIBM SOAR 07/07/2023 21:40:16\nPotential APT Detected: powershell.exe\n\n[SOAR Case - 2131](https://9.30.211.113:443/#incidents/2131)\n\n[SOAR Case - 2560](https://9.30.24.113:443/#incidents/2560)\n\n[SOAR Case - 17024](https://169.44.147.200:443/#incidents/17024)\nIBM SOAR 10/07/2023 12:46:44\nEndpoint Machine Isolated",
    "endpointState": {
      "osType": 1,
      "cpuVendor": 1,
      "arch": 2,
      "cpuDescr": "Intel(R) Core(TM) i7-10750H CPU @ 2.60GHz",
      "kernel": "10.0",
      "os": "Windows 10 Enterprise",
      "hvStatus": 19,
      "name": "IBM-PF36LBRC",
      "isolated": false,
      "localAddr": "192.168.1.97",
      "macs": [
        "5c:e4:2a:2c:f3:a7",
        "90:2e:16:c4:f7:7d"
      ],
      "componentsVersions": [
        {
          "name": "rqtsentry",
          "version": "3.6.1",
          "build": "119.1632119719010.commit"
        },
        {
          "name": "installer",
          "version": "3.10.1",
          "build": ""
        },
        {
          "name": "probos",
          "version": "3.5.0",
          "build": "3.5.0"
        },
        {
          "name": "keeper",
          "version": "3.10.1",
          "build": "27.1668701555901.commit"
        },
        {
          "name": "rqtnetsentry",
          "version": "3.10.0",
          "build": "45.1666597836648.commit"
        }
      ],
      "endpointVersion": "3.10.1",
      "tags": [],
      "groups": [
        {
          "id": "988899645751033863",
          "name": "Example Group",
          "description": "This is an example group.",
          "parentGroupId": "988899392910000135"
        },
        {
          "id": "988899392910000135",
          "name": "Example Client"
        }
      ]
    },
    "title": "Destra: Potential APT Detected: powershell.exe",
    "alert_url": "https://rhiveam.techzone.ibm.com/alerts/1015597023501484034"
  },
  "raw": null,
  "inputs": {
    "reaqta_alert_id": "1015597023501484034",
    "reaqta_hive": "rhiveam"
  },
  "metrics": {
    "version": "1.0",
    "package": "fn-reaqta",
    "package_version": "1.1.0",
    "host": "Henry's IBM 16 inch Macbook Pro",
    "execution_time_ms": 604,
    "timestamp": "2023-07-10 12:50:31"
  }
}