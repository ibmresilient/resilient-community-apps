<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v51.0.5.0.1475
-->

# Playbook - SOAR Utils: SOAR Search - Example (PB)

### API Name
`soar_utils_soar_search_example_pb`

### Status
`enabled`

### Activation Type
`Manual`

### Activation Conditions
`-`

### Object Type
`attachment`

### Description
This function searches the SOAR platform for incident data according to the criteria specified, and returns the results to your playbook. It can be used to find incidents containing data that matches any string, incidents currently assigned to a given user, or a very wide range of other search conditions.

NOTE: The search results may include data from incidents that the current SOAR user (the person who triggered the workflow) cannot access. Often your SOAR users have the Default role that allows them to only see incidents where they are members. This function runs with the permissions of your app account, which typically may have much wider access privileges. Use with caution, to avoid information disclosure.


---
## Function - SOAR Utilities: SOAR Search

### API Name
`soar_utils_soar_search`

### Output Name
`soar_search_result`

### Message Destination
`fn_soar_utils`

### Function-Input Script
```python
from json import dumps

# Search for other occurrences of the same file attachment in Resilient.

# The search template determines the type(s) of object to search, and the filter conditions.
# This can be used to search within a specific incident field, or to search only incidents that meet other criteria.
# Refer to SearchExInputDTO in the REST API documentation for additional details of this data structure.

# Example search template
json_template = {
  "types": ["attachment"],
  "filters": {
    "incident": [{
        "conditions": [{"field_name": "plan_status", "method": "in", "value": ["A"]}]
      }]
  }
}

inputs.soar_search_template = dumps(json_template)
# The search query can be a simple string.
inputs.soar_search_query = attachment.name
```

---

## Local script - SOAR Utils: search through SOAR

### Description
Search the SOAR contents.

### Script Type
`Local script`

### Object Type
`attachment`

### Script Content
```python
results = playbook.functions.results.soar_search_result

# Build the list of result links
result_info = []
for result in results.results:
    inc_id = result["result"].get("inc_id", "Unknown ID")
    inc_name = result["result"].get("inc_name", "Unnamed Incident")
    obj_name = result.get("obj_name", "Unknown Object")
    
    link = f"<a href='#incidents/{inc_id}'>{inc_name}</a>"
    result_info.append(f"<p>{link} - {obj_name}</p>")

# Construct the final HTML note
if not result_info:
    html = "<div><b>SOAR Utils: SOAR Search - Example (PB):</b><br>No results found.</div>"
else:
    html = (
        "<div>"
        "<p><b>SOAR Utils: SOAR search - Example (PB):</b></p>"
        + "".join(result_info) +
        "</div>"
    )

incident.addNote(html)

```

---

