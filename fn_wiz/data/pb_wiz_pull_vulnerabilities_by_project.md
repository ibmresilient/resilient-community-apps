<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v51.0.1.1.824
-->

# Playbook - Wiz: Pull Vulnerabilities by Project

### API Name
`wiz_pull_vulnerabilities_by_project`

### Status
`enabled`

### Activation Type
`Manual`

### Activation Conditions
`-`

### Object Type
`wiz_projects_table`

### Description
Pull vulnerabilities associated with a given project ID and add to vulnerabilities data table. Queries project vulnerabilities for those with "HIGH" and "CRITICAL" Vendor Severity scores that are also "OPEN".


---
## Function - Wiz: Pull Vulnerabilities

### API Name
`wiz_pull_vulnerabilities`

### Output Name
`vulnerability_results`

### Message Destination
`fn_wiz`

### Function-Input Script
```python
# Get id for this specific project in the data table row
inputs.wiz_project_ids = row.project_id

# OPTIONAL: Specify the maximum desired number of results, returns max of 50 results by default
# inputs.wiz_num_results = 
```

---

## Local script - Wiz: Populate Vulnerabilities Data Table

### Description
Add rows to Vulnerabilities Data table based n results from Wiz query

### Script Type
`Local script`

### Object Type
`wiz_projects_table`

### Script Content
```python
from datetime import datetime

def get_projects(vuln):
  """
  Get a string of the project names affected by this vulnerability 
  :param vuln (dict): vulnerability object
  """
  projects = vuln.get('projects', [])
  if projects:
    project_names = [p.get('name') for p in projects]
    return ", ".join(project_names)
  
  return "-"
  
results = playbook.functions.results.vulnerability_results

if not results.success:
    incident.addNote(f"<b>Wiz: Pull Vulnerabilities by Project ID:</b> Unable to get vulnerability data to update Wiz Vulnerabilities data table: {results.reason}")
else:
  content = results.get('content', {})
  if content:
    vulnerabilities = content.get('response', [])
    for vuln in vulnerabilities:
      vuln_row = incident.addRow("wiz_vulnerabilities_table")
      vuln_row["date_added"] = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
      vuln_row["vulnerability_description"] = vuln.get('description', '')
      vuln_row["vulnerability_name"] = vuln.get('name', '')
      vuln_row["affected_projects"] = get_projects(vuln)
      vuln_row["vendor_severity"] = vuln.get('vendorSeverity', '')
      vuln_row["remediation"] = vuln.get('remediation', '')
      vuln_row["vulnerable_asset_id"] = vuln.get('vulnerableAsset', {}).get('id', '')
      vuln_row["vulnerable_asset_type"] = vuln.get('vulnerableAsset', {}).get('type', '')
      vuln_row["vulnerable_asset_os"] = vuln.get('vulnerableAsset', {}).get('operatingSystem', '')
      
    incident.addNote(f"<b>Wiz: Pull Vulnerabilities by Project ID:</b> Added {len(vulnerabilities)} vulnerabilities to Wiz Vulnerabilities data table for project with ID {row.project_id}")
  else:
    incident.addNote("<b>Wiz: Pull Vulnerabilities by Project ID:</b> No content found to add to vulnerabilities data table")

```

---

