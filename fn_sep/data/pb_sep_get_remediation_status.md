<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v51.0.2.2.1096
-->

# Playbook - SEP: Get Remediation status - Example (PB)

### API Name
`sep_get_remediation_status`

### Status
`enabled`

### Activation Type
`Manual`

### Activation Conditions
`sep_eoc_scan_results.remediation_status has_a_value AND (sep_eoc_scan_results.remediation_status contains In progress OR sep_eoc_scan_results.remediation_status contains Waiting/Not received OR sep_eoc_scan_results.remediation_status contains Received)`

### Object Type
`sep_eoc_scan_results`

### Description
Get the status of a remediation scan command.


---
## Function - SEP - Get Command Status

### API Name
`fn_sep_get_command_status`

### Output Name
`get_command_results`

### Message Destination
`fn_sep`

### Function-Input Script
```python
inputs.sep_incident_id = incident.id
inputs.sep_commandid = row.remediation_commandid
inputs.sep_status_type = "remediation"
```

---

## Local script - get command status output

### Description


### Script Type
`Local script`

### Object Type
`sep_eoc_scan_results`

### Script Content
```python
## Symantec Endpoint Protection - fn_sep_get_command_status script ##
# Globals
# List of fields in datatable fn_sep_get_command_status script
DATA_TBL_FIELDS = ["query_execution_date", "remediation_status"]
FN_NAME = "fn_sep_get_command_status"
WF_NAME = "Get Remediation status"
STATUS_TYPE = "remediate"
results = playbook.functions.results.get_command_results
REMEDITATE_EXECUTION_DATE = results.get("metrics", {}).get("timestamp")
C_OUTER = results.get("content", {})
QUERY_EXECUTION_DATE = results.get("metrics", {}).get("timestamp")

# Processing
remediation_command_state = C_OUTER.get("overall_command_state")
total_remediation_count = C_OUTER.get("total_remediation_count")
total_remediation_ep_count = C_OUTER.get("total_remediation_ep_count")
total_fail_remediation_count = C_OUTER.get("total_fail_remediation_count")
total_ep_count = C_OUTER.get("total_ep_count")
att_name = C_OUTER.get("att_name")

note_text = ''
att_note = ''
if C_OUTER:
  if total_remediation_count > 0:
    att_note = "<br>Added full result as an attachment. Attachment name: <b>{0}</b>.".format(att_name)
  note_text = "Symantec SEP Integration:\nPlaybook <b>{0}</b>:\nRemediate artifact returned <b>{1}</b> remediated " \
              "artifacts on <b>{2}</b> out of a total of <b>{3}</b> endpoints for artifact with type <b>{4}</b> " \
              "and value <b>{5}</b> for SOAR function <b>{7}</b>.{6}" \
      .format(WF_NAME, total_remediation_count, total_remediation_ep_count, total_ep_count, row.artifact_type,
              row.artifact_value, att_note, FN_NAME)

  if remediation_command_state == "Completed":
    if total_fail_remediation_count == 0 and total_remediation_count > 0:
      row.remediation_status = "{0} at {1}. For remediation results see note/attachment.".format(remediation_command_state, REMEDITATE_EXECUTION_DATE)
    elif total_fail_remediation_count == 0 and total_remediation_count == 0:
      row.remediation_status = "No match found"
    elif total_fail_remediation_count > 0:
      row.remediation_status = "Failed"
  else:
    row.remediation_status = remediation_command_state
else:
  row.remediation_status = remediation_command_state
  note_text += "Symantec SEP Integration:\nPlaybook <b>{0}</b>:\nRemediate artifact returned <b>no</b> results for " \
               "for artifact with type <b>{1}</b> and value <b>{2}</b> for SOAR function <b>{3}</b>"\
      .format(WF_NAME, row.artifact_type, row.artifact_value, FN_NAME)
incident.addNote(helper.createRichText(note_text))

```

---

