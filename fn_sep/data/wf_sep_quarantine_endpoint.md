<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
-->

# Example: SEP - Quarantine Endpoint

## Function - SEP - Quarantine Endpoints

### API Name
`fn_sep_quarantine_endpoints`

### Output Name
`quarantine_ep_results`

### Message Destination
`fn_sep`

### Pre-Processing Script
```python
inputs.sep_computer_ids = row.uniqueId
endpoint_quarantine_status = row.endpoint_quarantine_status["content"]

# 2 different rules using - Quarantine or Un-quarantine  based on row value. (w rules using Workflow)
inputs.sep_undo = True if endpoint_quarantine_status == "Quarantined" else False

```

### Post-Processing Script
```python
##  Symantec Endpoint Protection  - fn_sep_quarantine_endpoints script ##
# Example result:
"""
Result: { 'inputs': {u'sep_undo': False, u'sep_computer_ids': u'89AD1BBB0946C25D25E6C0984E971D8A'},
         'metrics': {'package': 'fn-sep', 'timestamp': '2019-05-14 14:42:09', 'package_version': '1.0.0',
                     'host': 'myhost', 'version': '1.0', 'execution_time_ms': 1102
                    }, 'success': True,
         'content': {u'commandID_computer': u'79AD5636B73A4C0D828938AE1E5B2C13'},
         'raw': '{"commandID_computer": "79AD5636B73A4C0D828938AE1E5B2C13"}',
         'reason': None,
         'version': '1.0'
}

"""
#  Globals
# List of fields in datatable fn_sep_quarantine_endpoints script
DATA_TBL_FIELDS = ["quarantine_commandid"]
fn_name = "fn_sep_quarantine_endpoints"
wf_name = "Quarantine Endpoint"
# Processing
content = results.content
inputs = results.inputs
query_execution_date = results["metrics"]["timestamp"]

if content  is not None:
    note_text = "Symantec SEP Integration: Workflow <b>{0}</b>: Executed with command id <b>{1}</b> for endpoint " \
                "<b>{2}</b> for Resilient function <b>{3}</b>"\
        .format(wf_name, content["commandID_computer"], row.computerName, fn_name)
    row.query_execution_date = query_execution_date
    row.quarantine_commandid = content["commandID_computer"]

else:
    note_text += "Symantec SEP Integration: Workflow <b>{0}</b>: There was <b>no</b> results returned for Resilient function <b>{1}</b>" \
                 .format(wf_name, fn_name)

incident.addNote(helper.createRichText(note_text))

```

---

## Function - SEP - Get Command Status

### API Name
`fn_sep_get_command_status`

### Output Name
``

### Message Destination
`fn_sep`

### Pre-Processing Script
```python
quarantine_ep_content = workflow.properties.quarantine_ep_results.content
inputs.sep_incident_id = incident.id
inputs.sep_commandid = quarantine_ep_content["commandID_computer"]
inputs.sep_status_type = "quarantine"
```

### Post-Processing Script
```python
##  Symantec Endpoint Protection  - fn_sep_get_command_status script ##
# Example result:
"""
Result: { 'inputs': {u'sep_status_type': u'quarantine', u'sep_commandid': u'7D3670DDF5A64A99B3721BF8A375B302'},
          'metrics': {'package': 'fn-sep', 'timestamp': '2019-04-26 15:25:55', 'package_version': '1.0.0',
                      'host': 'myhost', 'version': '1.0', 'execution_time_ms': 1256},
          'success': True,
          'content': {u'sort': [{u'direction': u'ASC', u'property': u'Begintime', u'ascending': True}], 'command_state': 'Completed', u'number': 0, u'firstPage': True, ': 0, u'content': [{u'computerName': u'WIN-N5KGH4CP3N3', u'subStateId u'binaryFileId': None, u'lastUpdateTime':
                        u'2019-04-26T11:05:27Z', u'domainName': u'Default', u'hardwareKey': u'DC7D24D6465566D2941F35BC8D17801E',
                        u'subStateDesc': u'', u'stateId': 3, u'computerId': u'89AD1BBB0946C25D25E6C0984E971D8A', u'computerIp': u'9.70.194.94', u'beginTime': u'2019-04-26T11:05:27Z', u'currentLoginUserName': u'Administrator', u'resultInXML': u'', 'command_status_id': 3}], u'lastPage': True, u'totalPages': 1, u'numberOfElements': 1, u'totalElements': 1, u'size': 20},
          'raw': '{"sort": [{"direction": "ASC", "property": "Begintime", "ascending": true}], "command_state": "Completed", "number": 0, "firstPage": true, "content": [{"computerName": "WIN-N5KGH4CP3N3", "subStateId": 0, "binaryFileId": null, "lastUpdateTime": "2019-04-26T11:05:27Z", "domainName": "Default", "hardwareKey": "DC7D24D6465566D2941F35BC8D17801E", "subStateDesc": "", "stateId": 3, "computerId": "89AD1BBB0946C25D25E6C0984E971D8A", "computerIp": "9.70.194.94", "beginTime": "2019-04-26T11:05:27Z", "currentLoginUserName": "Administrator", "resultInXML": "", "command_status_id": 3}], "lastPage": true, "totalPages": 1, "numberOfElements": 1, "totalElements": 1, "size": 20}', 'reason': None, 'version': '1.0'
}
"""
#  Globals
# List of fields in datatable fn_sep_get_command_status script
DATA_TBL_FIELDS = ["quarantine_status", "quarantine_command_state", "endpoint_quarantine_status"]
FN_NAME = "fn_sep_get_command_status"
WF_NAME = "Quarantine Endpoint"
STATUS_TYPE = "quarantine"
FINAL_STATUSES = {
    0: "Not received",
    1: "Received",
    2: "In progress",
    3: "Completed",
    4: "Rejected",
    5: "Canceled",
    6: "Failed"
}

C_OUTER = results.content
QUERY_EXECUTION_DATE = results["metrics"]["timestamp"]
# Processing

def main():

    endpoint_quarantine_status = row.endpoint_quarantine_status["content"]
    status_msg = "Un-quarantine" if endpoint_quarantine_status == "Quarantined" else "Quarantine"
    note_text = ''
    quarantine_command_state = C_OUTER["overall_command_state"]

    if C_OUTER is not None and len(C_OUTER["content"]) > 0:
        row.quarantine_command_state = quarantine_command_state
        row.query_execution_date = QUERY_EXECUTION_DATE
        computer = C_OUTER["content"][0]
        note_text = "Symantec SEP Integration: Workflow <b>{0}</b>: <b>{1}</b> command status for command id <b>{2}</b> " \
                    "for computer <b>{3}</b> was <b>{4}</b> for Resilient function <b>{5}</b>"\
            .format(WF_NAME, status_msg, row.quarantine_commandid, row.computerName, FINAL_STATUSES[computer["stateId"]], FN_NAME)
        if quarantine_command_state == "Completed":
            row.quarantine_command_state = FINAL_STATUSES[computer["stateId"]]
        else:
            row.quarantine_command_state = quarantine_command_state

    else:
        note_text += "Symantec SEP Integration: Workflow <b>{0}</b>: There were <b>no</b> results returned for Resilient function <b>{1}</b>" \
            .format(WF_NAME, FN_NAME)

    incident.addNote(helper.createRichText(note_text))

if __name__ == "__main__":
    main()
```

---

## Function - SEP - Get Computers

### API Name
`fn_sep_get_computers`

### Output Name
`None`

### Message Destination
`fn_sep`

### Pre-Processing Script
```python
inputs.sep_computername = row.computer_name
```

### Post-Processing Script
```python
##  Symantec Endpoint Protection  - fn_sep_get_computers script ##
# Example result:
"""
Result: {
      "input_params": {"sep_computername": "myhostname", "sep_domain": null, "sep_lastupdate": null, "sep_order: null,
      "sep_os": null, "sep_pageindex": null, "sep_pageindex": null, "sep_sort": null},
      "query_execution_time": "2018-08-09 12:34:15",
      "content"
                {
                  "sort": [
                    {
                      "direction": "ASC",
                      "property": "COMPUTER_NAME",
                      "ascending": true
                    }
                  ],
                  "number": 0,
                  "firstPage": true,
                  "content": [
                    {
                      "profileVersion": "14.2.1031",
                      "elamOnOff": 1,
                      "avEngineOnOff": 1,
                      "profileChecksum": null,
                      "atpDeviceId": null,
                      "processorType": "Intel64 Family 6 Model 15 Stepping 1",
                      "oslanguage": "en-US",
                      "licenseId": null,
                      "licenseStatus": -1,
                      "group": {
                        "domain": {
                          "id": "908090000946C25D330E919313D23887",
                          "name": "Default"
                        },
                        "name": "My Company",
                        "fullPathName": null,
                        "externalReferenceId": null,
                        "source": null,
                        "id": "CAD80F000946C25D6C150831060AA326"
                      },
                      "uuid": "EA650B42-D10A-7F9F-A1D2-0A58C4F4CEB1",
                      "groupUpdateProvider": false,
                      "edrStatus": 0,
                      "freeDisk": 56538476544,
                      "diskDrive": "C:\\",
                      "osFunction": "Server",
                      "processorClock": 2394,
                      "mobilePhone": "",
                      "jobTitle": "",
                      "lastHeuristicThreatTime": 0,
                      "osname": "Windows Server 2012",
                      "winServers": [
                        "0.0.0.0",
                        "0.0.0.0"
                      ],
                      "deploymentMessage": "",
                      "idsSerialNo": "",
                      "employeeNumber": "",
                      "snacLicenseId": null,
                      "lastSiteId": "EE75B0850946C25D5287B58B5173A37C",
                      "uwf": 2,
                      "currentClientId": "256B2B130946C25D40C83823AA2E5D4C",
                      "osbitness": "x64",
                      "lastScanTime": 1550825941000,
                      "email": "",
                      "securityVirtualAppliance": null,
                      "worstInfectionIdx": "0",
                      "encryptedDevicePassword": null,
                      "lastServerId": "7D6AAA6F0946C25D170B3A2D442500B6",
                      "kernel": null,
                      "lastUpdateTime": 1550835481557,
                      "ptpOnOff": 1,
                      "majorVersion": 14,
                      "lastConnectedIpAddr": "9.70.194.93",
                      "agentVersion": "14.2.1031.0100",
                      "deploymentRunningVersion": "14.2.1031.0100",
                      "agentTimeStamp": 1550835481557,
                      "osminor": 2,
                      "osMajor": 6,
                      "deploymentTargetVersion": "14.2.1031.0100",
                      "osMinor": 2,
                      "osFlavorNumber": 79,
                      "logicalCpus": 0,
                      "deploymentPreVersion": "",
                      "hypervisorVendorId": "0",
                      "fbwf": 2,
                      "osversion": "6.2",
                      "dnsServers": [
                        "9.70.192.29",
                        "FEC0:0000:0000:FFFF:0000:0000:0000:0001"
                      ],
                      "vsicStatus": 3,
                      "deleted": 0,
                      "deploymentStatus": "302456832",
                      "computerTimeStamp": 1550758769451,
                      "bwf": 2,
                      "totalDiskSpace": 81567,
                      "homePhone": "",
                      "daOnOff": 1,
                      "computerDescription": "",
                      "pepOnOff": 1,
                      "bashStatus": 1,
                      "agentUsn": 525374,
                      "osName": "Windows Server 2012",
                      "patternIdx": "F592051A3024B9BD77C1FC9EE1D1ADC9",
                      "employeeStatus": "",
                      "tmpDevice": null,
                      "rebootRequired": 0,
                      "subnetMasks": [
                        "255.255.255.0",
                        "64"
                      ],
                      "minorVersion": 2,
                      "osservicePack": "",
                      "lastSiteName": "My Site",
                      "cidsEngineVersion": "0.0.0.0",
                      "lastDeploymentTime": 1550585147000,
                      "isGrace": 0,
                      "computerUsn": 501645,
                      "agentId": "6E5AA5CB0946C25D40C83823BB5107E6",
                      "cidsBrowserFfOnOff": 1,
                      "domainOrWorkgroup": "WORKGROUP",
                      "svaId": null,
                      "loginDomain": "LocalComputer",
                      "lastServerName": "WIN-4OA0GKJN830",
                      "contentUpdate": 1,
                      "writeFiltersStatus": null,
                      "infected": 0,
                      "memory": 6441979904,
                      "freeMem": 2910998528,
                      "officePhone": "",
                      "lastVirusTime": 1550597487000,
                      "telemetryMid": "890E283B-41D3-4340-A397-66F6AFCAF33E",
                      "idsVersion": "",
                      "cidsBrowserIeOnOff": 1,
                      "publicKey": "BgIAAACkAABSU0ExAAgAAAEAAQDfMtYpvbC2ZOrpGFbK76tuyp2MZ7/6EGsFrqAV3ZBMfvMllksVObpPYvDSc5vCjtzthb1301VADLAspayGytsdAj5z8+LLpOnJkHNg9tIunm1lLkBTitevI6G+nNjyKd7uPn3+bxjk1LL8g1exL2C2SMPEXubdUa1N5xwmhhPHp6PSIAjY74QUcNyplfvylMS9QRWoQ70mqNy9tLLef6+qCYWTqGa7QKXS0WUJs8sJMzWfCrpeMVAmU5/s3yEu+OI+9RKgOeSfy7wRzmAWHQTofjHkYGYqwXcwwLX7AbWjdcpYo0Kaecf8e5t2ZvWyR362EaNxn0HYSjpKraY1hLK1",
                      "quarantineDesc": "Host Integrity check is disabled.\n Host Integrity policy has been disabled by the administrator.",
                      "cidsDrvMulfCode": 0,
                      "biosVersion": "INTEL  - 6040000 PhoenixBIOS 4.0 Release 6.0",
                      "rebootReason": "",
                      "telemetryHwid": "A942D8EB-32C3-E42F-FE83-723FDC431F32",
                      "cidsSilentMode": 0,
                      "creationTime": 1550585043812,
                      "macAddresses": [
                        "00-50-56-8B-A6-C3",
                        "00-50-56-8B-A6-C3"
                      ],
                      "idsChecksum": null,
                      "operatingSystem": "Windows Server 2012 ",
                      "osmajor": 6,
                      "virtualizationPlatform": "Unknown",
                      "ipAddresses": [
                        "9.70.194.93",
                        "FE80:0000:0000:0000:FC67:074E:CD22:0188"
                      ],
                      "physicalCpus": 1,
                      "osBitness": "x64",
                      "cidsDefsetVersion": "190220061",
                      "cidsDrvOnOff": 1,
                      "computerName": "WIN-4OA0GKJN830",
                      "logonUserName": "Administrator",
                      "licenseExpiry": 0,
                      "osLanguage": "en-US",
                      "gateways": [
                        "9.70.194.1",
                        "9.70.194.1",
                        "0.0.0.0",
                        "0.0.0.0"
                      ],
                      "uniqueId": "D31AA16E0946C25D40C83823C500518B",
                      "department": "",
                      "isNpvdiClient": 0,
                      "dhcpServer": "0.0.0.0",
                      "osfunction": "Server",
                      "description": "",
                      "osflavorNumber": 79,
                      "tpmDevice": "0",
                      "onlineStatus": 1,
                      "lastDownloadTime": 1550585418144,
                      "apOnOff": 1,
                      "timeZone": 480,
                      "fullName": "",
                      "osVersion": "6.2",
                      "attributeExtension": "",
                      "atpServer": "",
                      "tamperOnOff": 1,
                      "osServicePack": "",
                      "agentType": "105",
                      "serialNumber": "VMware-42 0b 65 ea 0a d1 9f 7f-a1 d2 0a 58 c4 f4 ce b1",
                      "osElamStatus": 0,
                      "installType": "0",
                      "profileSerialNo": "CAD8-01/26/2019 08:00:11 062",
                      "hardwareKey": "1771D79454E53469DF4B290C06C104C9",
                      "firewallOnOff": 1
                    }
                  ],
                  "lastPage": true,
                  "totalPages": 1,
                  "size": 20,
                  "totalElements": 2,
                  "numberOfElements": 2
                }
}
"""
#  Globals
# List of fields in datatable fn_amp_get_computers script
DATA_TBL_FIELDS = ["query_execution_date", "endpoint_quarantine_status"]
FN_NAME = "fn_sep_get_computers"
WF_NAME = "Quarantine Endpoint"
C_OUTER = results.content
QUERY_EXECUTION_DATE = results["metrics"]["timestamp"]


# Processing
def main():
    note_text = ''
    if C_OUTER is not None and len(C_OUTER["content"]) > 0:
        row.query_execution_date = QUERY_EXECUTION_DATE
        computer = C_OUTER["content"][0]
        ep_name = computer["computerName"]
        ep_osname = computer.get("osname", "")
        if "windows" in ep_osname.lower():
            if "host integrity check passed" not in computer["quarantineDesc"].lower():
                row.endpoint_quarantine_status = "Quarantined"
            else:
                row.endpoint_quarantine_status = "Un-Quarantined"
            note_text = "Symantec SEP Integration: Workflow <b>{0}</b>: Quarantine status of endpoint <b>{1}</b> is <b>{2}</b> for Resilient function <b>{3}</b>"\
            .format(WF_NAME, ep_name, row.endpoint_quarantine_status, FN_NAME)
        else:
            newrow.endpoint_quarantine_status = ""

    else:
        note_text += "Symantec SEP Integration: Workflow <b>{0}</b>: There were <b>no</b> results returned for Resilient function <b>{1}</b>"\
            .format(WF_NAME, FN_NAME)
    if len(note_text) > 0:
        incident.addNote(helper.createRichText(note_text))
    
if __name__ == "__main__":
    main()
```

---

