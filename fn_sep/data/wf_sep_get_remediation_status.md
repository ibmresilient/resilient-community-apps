<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
-->

# Example: SEP - Get Remediation status

## Function - SEP - Get Command Status

### API Name
`fn_sep_get_command_status`

### Output Name
`None`

### Message Destination
`fn_sep`

### Pre-Processing Script
```python
inputs.sep_incident_id = incident.id
inputs.sep_commandid = row.remediation_commandid
inputs.sep_status_type = "remediation"
```

### Post-Processing Script
```python
##  Symantec Endpoint Protection  - fn_sep_get_command_status script ##
# Example result:
"""
Result: {
    'inputs': {u'sep_commandid': u'2F260501C22842ABBA7EB0805D92EFE0'},
    'metrics': {'package': 'fn-sep', 'timestamp': '2019-03-01 12:46:27', 'package_version': '1.0.0', 'host': 'myhost', 'version': '1.0',
    'execution_time_ms': 1085},
    'success': True,
    'content':
                {
                  "sort": [
                    {
                      "direction": "ASC",
                      "property": "Begintime",
                      "ascending": true
                    }
                  ],
                  "number": 0,
                  "firstPage": true,
                  "content": [
                    {
                      "computerName": "ep1",
                      "subStateId": 0,
                      "binaryFileId": null,
                      "lastUpdateTime": null,
                      "domainName": "Default",
                      "hardwareKey": "1771D79454E53469DF4B290C06C104C9",
                      "subStateDesc": null,
                      "stateId": 0,
                      "computerId": "D31AA16E0946C25D40C83823C500518B",
                      "computerIp": "192.168.194.93",
                      "beginTime": null,
                      "currentLoginUserName": "Administrator",
                      "resultInXML": null
                    },
                    {
                      "computerName": "ep2",
                      "subStateId": 0,
                      "binaryFileId": null,
                      "lastUpdateTime": null,
                      "domainName": "Default",
                      "hardwareKey": "DC7D24D6465566D2941F35BC8D17801E",
                      "subStateDesc": null,
                      "stateId": 0,
                      "computerId": "89AD1BBB0946C25D25E6C0984E971D8A",
                      "computerIp": "192.168.194.94",
                      "beginTime": null,
                      "currentLoginUserName": "Administrator",
                      "resultInXML": null
                    }
                  ],
                  "lastPage": true,
                  "totalPages": 1,
                  "size": 20,
                  "totalElements": 2,
                  "numberOfElements": 2
                }
}
"""
#  Globals
# List of fields in datatable fn_sep_get_command_status script
DATA_TBL_FIELDS = ["query_execution_date", "remediation_status"]
FN_NAME = "fn_sep_get_command_status"
WF_NAME = "Get Remediation status"
STATUS_TYPE = "remediate"
REMEDITATE_EXECUTION_DATE = results["metrics"]["timestamp"]
C_OUTER = results.content
QUERY_EXECUTION_DATE = results["metrics"]["timestamp"]

# Processing

def main():
    remediation_command_state = C_OUTER["overall_command_state"]
    total_remediation_count = C_OUTER["total_remediation_count"]
    total_remediation_ep_count = C_OUTER["total_remediation_ep_count"]
    total_fail_remediation_count = C_OUTER["total_fail_remediation_count"]
    total_ep_count = C_OUTER["total_ep_count"]
    att_name = C_OUTER["att_name"]

    note_text = ''
    att_note = ''
    if C_OUTER is not None:
        if total_remediation_count > 0:
            att_note = "<br>Added full result as an attachment. Attachment name : <b>{0}</b>.".format(att_name)
            
        note_text = u"Symantec SEP Integration: Workflow <b>{0}</b>: Remediate artifact returned <b>{1}</b> remediated " \
                    "artifacts on <b>{2}</b> out of a total of <b>{3}</b> endpoints for artifact with type <b>{4}</b> " \
                    "and value <b>{5}</b> for Resilient function <b>{7}</b>.{6}" \
            .format(WF_NAME, total_remediation_count, total_remediation_ep_count, total_ep_count, row.artifact_type,
                    unicode(row.artifact_value), att_note, FN_NAME)

        if remediation_command_state == "Completed":
            if total_fail_remediation_count == 0 and total_remediation_count > 0:
                row.remediation_status = u"{0} at {1}. For remediation results see note/attachment.".format(remediation_command_state, REMEDITATE_EXECUTION_DATE)
            elif total_fail_remediation_count == 0 and total_remediation_count == 0:
                row.remediation_status = "No match found"
            elif total_fail_remediation_count > 0:
                row.remediation_status = "Failed"
        else:
            row.remediation_status = remediation_command_state
    else:
        row.remediation_status = remediation_command_state
        note_text += u"Symantec SEP Integration: Workflow <b>{0}</b>: Remediate artifact returned <b>no</b> results for " \
                     "for artifact with type <b>{1}</b> and value <b>{2}</b> for Resilient function <b>{3}</b>"\
            .format(WF_NAME, row.artifact_type, unicode(row.artifact_value), FN_NAME)
    incident.addNote(helper.createRichText(note_text))


if __name__ == "__main__":
    main()

```

---

