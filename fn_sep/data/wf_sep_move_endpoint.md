<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
-->

# Example: SEP - Move Endpoint

## Function - SEP - Get Groups

### API Name
`fn_sep_get_groups`

### Output Name
`get_groups_results`

### Message Destination
`fn_sep`

### Pre-Processing Script
```python
inputs.sep_fullpathname = rule.properties.sep_fullpathname
inputs.sep_domain = row.domain_id

```

### Post-Processing Script
```python
##  Symantec Endpoint Protection  - fn_sep_get_groups script ##
# Example result:
"""
Result: {
         'content': {
                      "sort": [
                        {
                          "direction": "ASC",
                          "property": "NAME",
                          "ascending": true
                        }
                      ],
                      "number": 0,
                      "firstPage": true,
                      "content": [
                        {
                          "policyDate": 1548489611062,
                          "domain": {
                            "id": "908090000946C25D330E919313D23887",
                            "name": "Default"
                          },
                          "numberOfRegisteredUsers": 1,
                          "description": "",
                          "created": 1548481072007,
                          "policySerialNumber": "4CBD-01/26/2019 08:00:11 062",
                          "lastModified": 1548481072007,
                          "fullPathName": "My Company\\Default Group",
                          "createdBy": "AF3C39A10A320801000000DBF200C60A",
                          "numberOfPhysicalComputers": 1,
                          "customIpsNumber": "",
                          "id": "4CBD63EE0946C25D1011DB1872A1736A",
                          "policyInheritanceEnabled": true,
                          "name": "Default Group"
                        },
                        {
                          "policyDate": 1548489611062,
                          "domain": {
                            "id": "908090000946C25D330E919313D23887",
                            "name": "Default"
                          },
                          "numberOfRegisteredUsers": 1,
                          "description": "",
                          "created": 1548481072007,
                          "policySerialNumber": "CAD8-01/26/2019 08:00:11 062",
                          "lastModified": 1548481072007,
                          "fullPathName": "My Company",
                          "createdBy": "AF3C39A10A320801000000DBF200C60A",
                          "number OfPhysicalComputers": 1,
                          "customIpsNumber": "",
                          "id": "CAD80F000946C25D6C150831060AA326",
                          "policyInheritanceEnabled": false,
                          "name": "My Company"
                        }
                      ],
                      "lastPage": true,
                      "totalPages": 1,
                      "size": 25,
                      "totalElements": 2,
                      "numberOfElements": 2
                     }

}
"""

content = results.content
fn_name = "fn_symc_sep_get_groups"
wf_name = "Move Endpoint"
note_text = ''

if content is not None and len(content["content"]) > 0:
    groups = content["content"]
    if len(groups) > 1:
        note_text = "Symantec SEP Integration: Workflow: <b>{0}</b> : There were too many results <b>{1}</b> returned " \
                    "for Resilient function <b>{2}</b>".format(wf_name, len(groups), fn_name)
    else:
        workflow.addProperty("single_group", {})
        workflow.addProperty("sep_oldpathname", {"oldPathName": row.group_name})
        workflow.addProperty("sep_fullpathname", {"fullPathName": groups[0]["fullPathName"]})
else:
    note_text += "Symantec SEP Integration: Workflow: <b>{0}</b> : There were <b>no</b> results returned for Resilient " \
                 "function <b>{1}</b>".format(wf_name, fn_name)
if note_text:
    incident.addNote(helper.createRichText(note_text))


```

---

## Function - SEP - Move endpoint

### API Name
`fn_sep_move_endpoint`

### Output Name
``

### Message Destination
`fn_sep`

### Pre-Processing Script
```python
content =  workflow.properties.get_groups_results.content
full_path_name = content["content"][0]["fullPathName"]
inputs.sep_hardwarekey = row.hardwareKey
inputs.sep_groupid = content["content"][0]["id"]

```

### Post-Processing Script
```python
##  Symantec Endpoint Protection  - fn_sep_move_client script ##
# Example result:
"""
Result: {'inputs': {u'sep_hardwarekey': u'B791D1DF2BB8AA77D19B10E3BB395B81', u'sep_groupid': u'CC00A6170946C25D35BD115E41F2F92C'}, 
         'metrics': {'package': 'fn-sep', 'timestamp': '2019-05-29 12:17:17', 'package_version': '1.0.0', 'host': 'myhost', 
                     'version': '1.0', 'execution_time_ms': 1782}, 
         'success': True, 
         'content': [{u'responseMessage': u'OK', u'responseCode': u'200'}], 
         'raw': '[{"responseMessage": "OK", "responseCode": "200"}]', 
         'reason': None, 
         'version': '1.0'
 }
"""
#  Globals
# List of fields in datatable fn_amp_get_computers script
FN_NAME = "fn_set_move_client"
WF_NAME = "Move Endpoint"
CONTENT = results.content
HW_KEY = results["inputs"]["sep_hardwarekey"]
GROUP_ID = results["inputs"]["sep_groupid"]
QUERY_EXECUTION_DATE = results["metrics"]["timestamp"]
# Processing

def main():
    note_text = ''
    if CONTENT is not None:
        response_msg = CONTENT[0]["responseMessage"]
        if response_msg == "OK":
            oldfullpath = workflow.properties.get("sep_oldpathname", None)["oldPathName"]
            fullpathname = workflow.properties.get("sep_fullpathname", None)["fullPathName"]
            note_text = "Symantec SEP Integration: Workflow: <b>{0}</b> : Successfully moved computer <b>{1}</b> " \
                       "from group <b>{2}</b> to group <b>{3}</b> for Resilient function <b>{4}</b>."\
                .format(WF_NAME, row.computerName, oldfullpath, fullpathname, FN_NAME)
            row.group_id = GROUP_ID
            if fullpathname is not None:
              row.group_name = fullpathname
        else:
            note_text = "Symantec SEP Integration: Workflow: <b>{0}</b> : Unsuccessful move of computer <b>{1}</b> " \
                       "to group with id <b>{2}</b>. Received response <b>{3}</b> for Resilient function <b>{4}</b>."\
                .format(WF_NAME, row.computerName, GROUP_ID, response_msg, FN_NAME)
    else:
      noteText = "Symantec SEP Integration: Workflow: <b>{0}</b> : Move unsuccessful for computer with hardware id <b>{1}</b> " \
                 "to group with id <b>{2}</b> for Resilient function <b>{3}</b>."\
          .format(WF_NAME, HW_KEY, GROUP_ID, FN_NAME)
    
    incident.addNote(helper.createRichText(note_text))

if __name__ == "__main__":
    main()
```

---

