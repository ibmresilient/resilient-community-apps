<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
-->

# Example: SEP - Get Groups information

## Function - SEP - Get Domains

### API Name
`fn_sep_get_domains`

### Output Name
`get_domains_results`

### Message Destination
`fn_sep`

### Pre-Processing Script
```python
None
```

### Post-Processing Script
```python
fn_name = "fn_sep_get_domains"
wf_name = "Example: SEP - Get Groups information"
content = results.content
domainid = None
for i in range(len(content)):
  if content[i]["name"] ==  rule.properties.sep_domain_name:
    domainid = content[i]["id"]
    break
if domainid is not None:
    workflow.addProperty("domid_exists", {})
else:
    note_text = u"Symantec SEP Integration: Workflow <b>{0}</b>: The domain name  <b>{1}</b> was not found " \
                u"for Resilient function <b>{2}</b>.".format(wf_name, unicode(rule.properties.sep_domain_name), fn_name)
    incident.addNote(helper.createRichText(note_text))
```

---

## Function - SEP - Get Groups

### API Name
`fn_sep_get_groups`

### Output Name
`None`

### Message Destination
`fn_sep`

### Pre-Processing Script
```python
domain_content_results =  workflow.properties.get_domains_results
domain_content = domain_content_results.content

for i in range(len(domain_content)):
  if domain_content[i]["name"] ==  rule.properties.sep_domain_name:
    inputs.sep_domain = domain_content[i]["id"]
    break
```

### Post-Processing Script
```python
##  Symantec Endpoint Protection  - fn_sep_get_groups script ##
# Example result:
"""
Result: {
         'content': {
                      "sort": [
                        {
                          "direction": "ASC",
                          "property": "NAME",
                          "ascending": true
                        }
                      ],
                      "number": 0,
                      "firstPage": true,
                      "content": [
                        {
                          "policyDate": 1548489611062,
                          "domain": {
                            "id": "908090000946C25D330E919313D23887",
                            "name": "Default"
                          },
                          "numberOfRegisteredUsers": 1,
                          "description": "",
                          "created": 1548481072007,
                          "policySerialNumber": "4CBD-01/26/2019 08:00:11 062",
                          "lastModified": 1548481072007,
                          "fullPathName": "My Company\\Default Group",
                          "createdBy": "AF3C39A10A320801000000DBF200C60A",
                          "numberOfPhysicalComputers": 1,
                          "customIpsNumber": "",
                          "id": "4CBD63EE0946C25D1011DB1872A1736A",
                          "policyInheritanceEnabled": true,
                          "name": "Default Group"
                        },
                        {
                          "policyDate": 1548489611062,
                          "domain": {
                            "id": "908090000946C25D330E919313D23887",
                            "name": "Default"
                          },
                          "numberOfRegisteredUsers": 1,
                          "description": "",
                          "created": 1548481072007,
                          "policySerialNumber": "CAD8-01/26/2019 08:00:11 062",
                          "lastModified": 1548481072007,
                          "fullPathName": "My Company",
                          "createdBy": "AF3C39A10A320801000000DBF200C60A",
                          "number OfPhysicalComputers": 1,
                          "customIpsNumber": "",
                          "id": "CAD80F000946C25D6C150831060AA326",
                          "policyInheritanceEnabled": false,
                          "name": "My Company"
                        }
                      ],
                      "lastPage": true,
                      "totalPages": 1,
                      "size": 25,
                      "totalElements": 2,
                      "numberOfElements": 2
                     }

}
"""
#  Globals
# List of fields in datatable fn_amp_get_groups script
DATA_TBL_FIELDS = ["query_execution_time", "group_name", "group_id", "group_description", "fullPathName",
                   "numberOfPhysicalComputers","policyInheritanceEnabled"]
FN_NAME = "fn_symc_sep_get_groups"
WF_NAME = "Get Groups information"
DATA_TBL_FIELDS_DOM = ["domain_name", "domain_id"]
C_OUTER = results.content
QUERY_EXECUTION_DATE = results["metrics"]["timestamp"]
DOMAIN_NAME = rule.properties.sep_domain_name

# Processing
def main():
    note_text = ''
    if C_OUTER is not None:
        note_text = "Symantec SEP Integration: Workflow <b>{0}</b>: There were <b>{1}</b> results returned for domain " \
                    "<b>{2}</b> for Resilient function <b>{3}</b>"\
            .format(WF_NAME, results["content"]["numberOfElements"], DOMAIN_NAME, FN_NAME)
        groups = C_OUTER["content"]
        for i in range(len(groups)):
            newrow = incident.addRow("sep_groups")
            newrow.query_execution_date = QUERY_EXECUTION_DATE
            for f in DATA_TBL_FIELDS:
                try:
                    f_base = f.split('_')[1]
                except:
                    f_base = f
                if f == "query_execution_time":
                    continue
                if groups[i][f_base] is not None:
                      newrow[f] = groups[i][f_base]

            domain = groups[i]["domain"]
            if domain is not None:
                for d in DATA_TBL_FIELDS_DOM:
                    d_base = d.split('_')[1]
                    newrow[d] = domain[d_base]

    else:
        note_text += "Symantec SEP Integration: Workflow <b>{0}</b>: There were <b>no</b> results returned for domain " \
                     "<b>{1}</b>for Resilient function <b>{2}</b>".format(WF_NAME, DOMAIN_NAME, FN_NAME)

    incident.addNote(helper.createRichText(note_text))

if __name__ == "__main__":
    main()
```

---

