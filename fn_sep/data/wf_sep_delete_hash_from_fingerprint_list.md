<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
-->

# Example: SEP - Delete Hash from Blacklist

## Function - SEP - Get Domains

### API Name
`fn_sep_get_domains`

### Output Name
`get_domains_results`

### Message Destination
`fn_sep`

### Pre-Processing Script
```python
None
```

### Post-Processing Script
```python
fn_name = "fn_sep_get_domains"
wf_name = "Delete Hash from Fingerprint List"
content = results.content
domainid = None
for i in range(len(content)):
  if content[i]["name"] ==  rule.properties.sep_domain_name:
    domainid = content[i]["id"]
    break
if domainid is not None:
    workflow.addProperty("domid_exists", {})
else:
    note_text = u"Symantec SEP Integration: Workflow <b>{0}</b>: The domain name  <b>{1}</b> was not found " \
                u"for Resilient function <b>{2}</b>.".format(wf_name, unicode(rule.properties.sep_domain_name), fn_name)
    incident.addNote(helper.createRichText(note_text))
```

---

## Function - SEP - Get Fingerprint List

### API Name
`fn_sep_get_fingerprint_list`

### Output Name
`fpl_content_results`

### Message Destination
`fn_sep`

### Pre-Processing Script
```python
domain_content_results =  workflow.properties.get_domains_results
domain_content = domain_content_results.content

for i in range(len(domain_content)):
  if domain_content[i]["name"] ==  rule.properties.sep_domain_name:
    inputs.sep_domainid = domain_content[i]["id"]
    break

inputs.sep_fingerprintlist_name = rule.properties.sep_fingerprintlist_name
```

### Post-Processing Script
```python
##  Symantec Endpoint Protection  - fn_sep_get_fingerprint_list script ##
# Example result:
"""
Result:{'inputs': {u'sep_fingerprintlist_name': u'Blacklist_2', u'sep_domainid': u'908090000946C25D330E919313D23887'},
        'metrics': {'package': 'fn-sep', 'timestamp': '2019-05-28 16:23:05', 'package_version': '1.0.0',
                    'host': 'myhost', 'version': '1.0', 'execution_time_ms': 1153},
        'success': True,
        'content': {u'description': u'Hash of type Malware MD5 Hash', u'hashType': u'MD5', u'source': u'WEBSERVICE',
                    u'groupIds': [u'7E4BB119A9FE9DC526EDABFB1EE261B8'], u'data': [u'482F9B6E0CC4C1DBBD772AAAF088CB3A'],
                    u'id': u'E60B061FDD844EBF9778D4BD2AC3942A', u'name': u'Blacklist_2'},
        'raw': '{"description": "Hash of type Malware MD5 Hash", "hashType": "MD5", "source": "WEBSERVICE", '
               '"groupIds": ["7E4BB119A9FE9DC526EDABFB1EE261B8"], "data": ["482F9B6E0CC4C1DBBD772AAAF088CB3A"], '
               '"id": "E60B061FDD844EBF9778D4BD2AC3942A", "name": "Blacklist_2"}',
        'reason': None,
        'version': '1.0'
 }
"""
#  Globals
# List of fields in datatable fn_sep_get_fingerprint_list script
FN_NAME = "fn_get_fingerprint_list"
WF_NAME = "Delete Hash from Fingerprint List"
CONTENT = results.content
INPUTS = results.inputs

def main():
    fpl_exists = hash_in_list = last_hash_in_list = False
    if CONTENT is not None:
        if "errorCode" in CONTENT and CONTENT["errorCode"] == 410:
            # The finger print list doesn't already exist.
            pass
        elif "data" in CONTENT:
            # Finger print list exists set flag for gateway.
            fpl_exists = True
            workflow.addProperty("fpl_exists", {})
            # Add property  whcih can be used by delete fingerprint list function if called.
            workflow.addProperty("sep_fingerprintlist_name", {"fingerprintlist_name": INPUTS["sep_fingerprintlist_name"]})
        if "data" in CONTENT and artifact.value.upper() in [d.upper() for d in CONTENT["data"]]:
            # Finger print list exists and hash in list set flag for hash in list.
            hash_in_list = True
            workflow.addProperty("hash_in_list", {})
            if len(CONTENT["data"]) == 1:
                # This is the last hash value, delete list instead.
                last_hash_in_list = True
                workflow.addProperty("last_hash_in_list", {})

    if not hash_in_list:
        note_text = u"Symantec SEP Integration: Workflow <b>{0}</b>: The hash <b>{1}</b> has not been detected in the " \
                    u"fingerprint list <b>{2}</b> for domain id <b>{3}</b> for Resilient function <b>{3}</b>."\
            .format(WF_NAME, artifact.value, unicode(INPUTS["sep_fingerprintlist_name"]),
                    INPUTS["sep_domainid"], FN_NAME)
        incident.addNote(helper.createRichText(note_text))

    if last_hash_in_list:
        note_text = u"Symantec SEP Integration: Workflow <b>{0}</b>: The hash <b>{1}</b> is the only hash in the fingerprint " \
                    u"list <b>{2}</b> for domain id <b>{3}</b> for Resilient function <b>{4}</b>."\
            .format(WF_NAME, artifact.value, unicode(INPUTS["sep_fingerprintlist_name"]),
                    INPUTS["sep_domainid"], FN_NAME)
        incident.addNote(helper.createRichText(note_text))

if __name__ == "__main__":
    main()
```

---

## Function - SEP - Update Fingerprint List

### API Name
`fn_sep_update_fingerprint_list`

### Output Name
``

### Message Destination
`fn_sep`

### Pre-Processing Script
```python
domain_content_results =  workflow.properties.get_domains_results
fpl_content_results = workflow.properties.fpl_content_results
domain_content = domain_content_results.content
fpl_content = fpl_content_results.content

inputs.sep_hash_value = artifact.value

for i in range(len(domain_content)):
  if domain_content[i]["name"] ==  rule.properties.sep_domain_name:
    inputs.sep_domainid = domain_content[i]["id"]
    break

if artifact.description is not None:
    inputs.sep_description = artifact.description.content
else:
    inputs.sep_description = u"Hash of type {}".format(unicode(artifact.type))
    
if fpl_content["name"] ==  rule.properties.sep_fingerprintlist_name:
    inputs.sep_fingerprintlist_id = fpl_content["id"]


if fpl_content["name"] ==  rule.properties.sep_fingerprintlist_name:
    inputs.sep_fingerprintlist_id = fpl_content["id"]
    inputs.sep_fingerprintlist_name = fpl_content["name"]
    if fpl_content["data"] is not None:
        inputs.sep_hash_value = ','.join([hv for hv in fpl_content["data"] if hv.lower() != artifact.value.lower()])

```

### Post-Processing Script
```python
##  Symantec Endpoint Protection  - fn_sep_update_fingerprint_list script ##
# Example result:
"""
Result: {'inputs': {u'sep_description': u'Hash of type Malware MD5 Hash', u'sep_fingerprintlist_name': u'Blacklist_2',
                   u'sep_hash_value': u'0B26E313ED4A7CA6904B0E9369E5B957,482F9B6E0CC4C1DBBD772AAAF088CB3A',
                   u'sep_domainid': u'A9B4B7160946C25D24B6AA458EF5557F',
                   u'sep_fingerprintlist_id': u'D132F4BA85D64E9F941906C2ECBF3F5F'
                   },
        'metrics': {'package': 'fn-sep', 'timestamp': '2019-05-14 10:48:45', 'package_version': '1.0.0',
                    'host': 'myhost.com', 'version': '1.0', 'execution_time_ms': 1131
                    }, 'success': True,
                    'content': '',
                    'raw': '""',
                    'reason': None,
                    'version': '1.0'

}
"""
FN_NAME = "fn_sep_update_fingerprint_list"
WF_NAME = "Delete Hash from Fingerprint List"
CONTENT = results.content
INPUTS = results.inputs

def main():
    if CONTENT is not None:
        # If we got here we assume we are successsful, no status messgae is returned by api.
        note_text = u"Symantec SEP Integration: Workflow <b>{0}</b>: Successfully removed MD5 hash <b>{1}</b> from fingerprint " \
                    u"list <b>{2}</b> for Resilient function <b>{3}</b>"\
            .format(WF_NAME, artifact.value, unicode(INPUTS["sep_fingerprintlist_name"]),
                    FN_NAME)

    else:
        note_text += "Symantec SEP Integration: Workflow <b>{0}</b>: There was <b>no</b> results returned for Resilient " \
                     "function <b>{1}</b>".format(WF_NAME, FN_NAME)

    incident.addNote(helper.createRichText(note_text))

if __name__ == "__main__":
    main()
```

---

## Function - SEP - Delete Fingerprint List

### API Name
`fn_sep_delete_fingerprint_list`

### Output Name
`None`

### Message Destination
`fn_sep`

### Pre-Processing Script
```python
fpl_content_results = workflow.properties.fpl_content_results
fpl_content = fpl_content_results.content
    
if fpl_content["name"] ==  rule.properties.sep_fingerprintlist_name:
    inputs.sep_fingerprintlist_id = fpl_content["id"]


```

### Post-Processing Script
```python
##  Symantec Endpoint Protection  - fn_sep_delete_fingerprint_list script ##
# Example result:
"""
Result: {'inputs': {u'sep_fingerprintlist_id': u'2728515A08A4481B8207623558254F60'},
         'metrics': {'package': 'fn-sep', 'timestamp': '2019-05-14 11:49:38', 'package_version': '1.0.0',
                    'host': 'myhost.com', 'version': '1.0', 'execution_time_ms': 1137
                    },
         'success': True,
         'content': '',
         'raw': '""',
         'reason': None,
         'version': '1.0'

}
"""

FN_NAME = "fn_sep_update_fingerprint_list"
WF_NAME = "Delete Fingerprint List"
CONTENT = results.content
FP_LIST_NAME = workflow.properties.get("sep_fingerprintlist_name", None)["fingerprintlist_name"]

def main():
    if CONTENT is not None:
        # If we got here we assume we are successsful, no status messgage is returned by api.
        note_text = u"Symantec SEP Integration: Workflow <b>{0}</b>: Successfully deleted fingerprint list <b>{1}</b> " \
                    u"for Resilient function <b>{2}</b>"\
            .format(WF_NAME, unicode(FP_LIST_NAME), FN_NAME)
    else:
        note_text += "Symantec SEP Integration: Workflow <b>{0}</b>: There was <b>no</b> results returned for Resilient " \
                     "function <b>{1}</b>".format(WF_NAME, FN_NAME)

    incident.addNote(helper.createRichText(note_text))

if __name__ == "__main__":
    main()

```

---

