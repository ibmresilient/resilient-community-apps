<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
-->

# Example: SEP - Get Upload status

## Function - SEP - Get Command Status

### API Name
`fn_sep_get_command_status`

### Output Name
``

### Message Destination
`fn_sep`

### Pre-Processing Script
```python
inputs.sep_commandid = row.upload_commandid
inputs.sep_status_type = "upload"
```

### Post-Processing Script
```python
##  Symantec Endpoint Protection  - fn_sep_get_command_status script ##
# Example result:
"""
Result: { 'inputs': {u'sep_status_type': u'quarantine', u'sep_commandid': u'7D3670DDF5A64A99B3721BF8A375B302'},
          'metrics': {'package': 'fn-sep', 'timestamp': '2019-04-26 15:25:55', 'package_version': '1.0.0',
                      'host': 'myhost', 'version': '1.0', 'execution_time_ms': 1256},
          'success': True,
          'content': {u'sort': [{u'direction': u'ASC', u'property': u'Begintime', u'ascending': True}], 'command_state': 'Completed', u'number': 0, u'firstPage': True, ': 0, u'content': [{u'computerName': u'WIN-N5KGH4CP3N3', u'subStateId u'binaryFileId': None, u'lastUpdateTime':
                        u'2019-04-26T11:05:27Z', u'domainName': u'Default', u'hardwareKey': u'DC7D24D6465566D2941F35BC8D17801E',
                        u'subStateDesc': u'', u'stateId': 3, u'computerId': u'89AD1BBB0946C25D25E6C0984E971D8A', u'computerIp': u'9.70.194.94', u'beginTime': u'2019-04-26T11:05:27Z', u'currentLoginUserName': u'Administrator', u'resultInXML': u'', 'command_status_id': 3}], u'lastPage': True, u'totalPages': 1, u'numberOfElements': 1, u'totalElements': 1, u'size': 20},
          'raw': '{"sort": [{"direction": "ASC", "property": "Begintime", "ascending": true}], "command_state": "Completed", "number": 0, "firstPage": true, "content": [{"computerName": "WIN-N5KGH4CP3N3", "subStateId": 0, "binaryFileId": null, "lastUpdateTime": "2019-04-26T11:05:27Z", "domainName": "Default", "hardwareKey": "DC7D24D6465566D2941F35BC8D17801E", "subStateDesc": "", "stateId": 3, "computerId": "89AD1BBB0946C25D25E6C0984E971D8A", "computerIp": "9.70.194.94", "beginTime": "2019-04-26T11:05:27Z", "currentLoginUserName": "Administrator", "resultInXML": "", "command_status_id": 3}], "lastPage": true, "totalPages": 1, "numberOfElements": 1, "totalElements": 1, "size": 20}', 'reason': None, 'version': '1.0'
}
"""
#  Globals
# List of fields in datatable fn_sep_get_command_status script
DATA_TBL_FIELDS = ["query_execution_date", "file_upload_status"]
FN_NAME = "fn_sep_get_command_status"
WF_NAME = "Get Upload status"
STATUS_TYPE = "upload"
FINAL_STATUSES = {
    0: "Initial / Not received",
    1: "Received",
    2: "In progress",
    3: "Completed".format(STATUS_TYPE.capitalize()),
    4: "Rejected".format(STATUS_TYPE.capitalize()),
    5: "Canceled".format(STATUS_TYPE.capitalize()),
    6: "Failed".format(STATUS_TYPE.capitalize())
}

# Processing
C_OUTER = results.content
INPUTS = results.inputs
QUERY_EXECUTION_DATE = results["metrics"]["timestamp"]

def main():
    upload_command_state = C_OUTER["overall_command_state"]
    note_text = ''
    if C_OUTER is not None and len(C_OUTER["content"]) > 0:
        row.query_execution_date = QUERY_EXECUTION_DATE
        computer = C_OUTER["content"][0]
        if upload_command_state == "Completed":
            row.file_upload_status = FINAL_STATUSES[computer["stateId"]]
            if computer["stateId"] == 3:
                row.file_id = computer["binaryFileId"]
            if FINAL_STATUSES[computer["stateId"]] == "Completed":
                note_text = u"Symantec SEP Integration: Workflow <b>{0}</b>: Upload command completed with status <b>{1}</b> " \
                            "for command id <b>{2}</b> for artifact with type <b>{3}</b> and value <b>{4}</b> for Resilient function <b>{5}</b>"\
                    .format(WF_NAME, FINAL_STATUSES[computer["stateId"]], INPUTS["sep_commandid"], row.artifact_type,
                    unicode(row.artifact_value), FN_NAME)
            else:
                note_text = u"Symantec SEP Integration: Workflow <b>{0}</b>: Upload command in <b>{1}</b> state for command " \
                            "id <b>{2}</b> for artifact with type <b>{3}</b> and value <b>{4}</b> for Resilient function " \
                            "<b>{5}</b>.<br>Note: Upload only supports executable file types." \
                            "<br>Please review console/logs on the Symantec SEPM server for further details if required." \
                    .format(WF_NAME, FINAL_STATUSES[computer["stateId"]], INPUTS["sep_commandid"], row.artifact_type, 
                        unicode(row.artifact_value), FN_NAME)
        else:
            note_text = u"Symantec SEP Integration: Workflow <b>{0}</b>: Upload command in <b>{1}</b> state for command id " \
                        "<b>{2}</b> for artifact with type <b>{3}</b> and value <b>{4}</b> for Resilient function <b>{5}</b>"\
                .format(WF_NAME, FINAL_STATUSES[computer["stateId"]], INPUTS["sep_commandid"], row.artifact_type,
                        unicode(row.artifact_value), FN_NAME)
            row.file_upload_status = upload_command_state
    else:
        note_text += "Symantec SEP Integration: Workflow <b>{0}</b>: There were <b>no</b> results returned for Resilient function <b>{1}</b>"\
            .format(WF_NAME, FN_NAME)

    incident.addNote(helper.createRichText(note_text))

if __name__ == "__main__":
    main()
```

---

