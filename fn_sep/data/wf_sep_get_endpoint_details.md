<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
-->

# Example: SEP - Get Endpoint Details

## Function - SEP - Get Computers

### API Name
`fn_sep_get_computers`

### Output Name
`None`

### Message Destination
`fn_sep`

### Pre-Processing Script
```python
inputs.sep_computername = row.computer_name
```

### Post-Processing Script
```python
##  Symantec Endpoint Protection  - fn_sep_get_computers script ##
# Example result:
"""
Result: {'inputs': {u'sep_computername': u'WIN-4OA0GKJN830'}, 
         'metrics': {'package': 'fn-sep', 'timestamp': '2019-05-23 18:40:17', 'package_version': '1.0.0', 
         'host': 'myhost', 'version': '1.0', 'execution_time_ms': 1966}, 
         'success': True, 
         'content': {u'sort': [{u'direction': u'ASC', u'property': u'COMPUTER_NAME', u'ascending': True}], u'number': 0, 
                     u'firstPage': True, u'content': [{u'profileVersion': u'14.2.1031', u'elamOnOff': 1, 
                     u'avEngineOnOff': 1, u'profileChecksum': None, u'atpDeviceId': None, 
                     u'processorType': u'Intel64 Family 6 Model 15 Stepping 1', u'oslanguage': u'en-US', 
                     u'licenseId': None, u'licenseStatus': -1, 
                     u'group': {u'domain': {u'id': u'908090000946C25D330E919313D23887', u'name': u'Default'}, u'name': u'My Company\\JP_TEST_GROUP_1', u'fullPathName': None, u'externalReferenceId': None, u'source': None, u'id': u'8E20F39B0946C25D118925C2E28C2D59'}, 
                     u'uuid': u'EA650B42-D10A-7F9F-A1D2-0A58C4F4CEB1', 
                     u'groupUpdateProvider': False, 
                     u'edrStatus': 2, u'freeDisk': 40542507008, u'diskDrive': u'C:\\', u'osFunction': u'Server', u'processorClock': 2394, 
                     u'mobilePhone': u'', u'jobTitle': u'', u'last√°HeuristicThreatTime': 0, u'osname': u'Windows Server 2012', 
                     u'winServers': [u'0.0.0.0', u'0.0.0.0'], u'deploymentMessage': u'', u'idsSerialNo': u'', 
                     u'employeeNumber': u'', u'snacLicenseId': None, u'lastSiteId': u'EE75B0850946C25D5287B58B5173A37C', 
                     u'uwf': 2, u'currentClientId': u'256B2B130946C25D40C83823AA2E5D4C', u'osbitness': u'x64', 
                     u'lastScanTime': 1558613245000, u'email': u'', u'securityVirtualAppliance': None, 
                     u'worstInfectionIdx': u'0', u'encryptedDevicePassword': None, u'lastServerId': u'7D6AAA6F0946C25D170B3A2D442500B6', 
                     u'kernel': None, u'lastUpdateTime': 1558632769514, u'ptpOnOff': 1, u'majorVersion': 14, 
                     u'lastConnectedIpAddr': u'9.70.194.93', u'agentVersion': u'14.2.1031.0100', u'deploymentRunningVersion': u'14.2.1031.0100', 
                     u'agentTimeStamp': 1558632769514, u'osminor': 2, u'osMajor': 6, u'deploymentTargetVersion': u'14.2.1031.0100', 
                     u'osMinor': 2, u'osFlavorNumber': 79, u'logicalCpus': 0, u'deploymentPreVersion': u'', u'hypervisorVendorId': u'0', 
                     u'fbwf': 2, u'osversion': u'6.2', u'dnsServers': [u'9.70.192.29', u'FEC0:0000:0000:FFFF:0000:0000:0000:0001'], 
                     u'vsicStatus': 3, u'deleted': 0, u'deploymentStatus': u'302456832', u'computerTimeStamp': 1558622386922, u'bwf': 2, 
                     u'totalDiskSpace': 81567, u'homePhone': u'', u'daOnOff': 1, u'computerDescription': u'', u'pepOnOff': 1, 
                     'timediffLastUpdateTime': 448.98237204551697, u'bashStatus': 1, u'agentUsn': 2545799, u'osName': u'Windows Server 2012', 
                     'readableLastUpdateTime': '2019-05-23 18:32:49', u'patternIdx': u'4A80266952462523E3E5AC3B816032AE', 
                     u'employeeStatus': u'', u'tmpDevice': None, u'rebootRequired': 0, u'subnetMasks': [u'255.255.255.0', u'64'], 
                     u'minorVersion': 2, u'osservicePack': u'', 'timediffLastVirusTime': 5638590.9823720455, u'lastSiteName': u'My Site', 
                     u'cidsEngineVersion': u'0.0.0.0', u'lastDeploymentTime': 1550585147000, u'isGrace': 0, u'computerUsn': 2544267, 
                     u'agentId': u'6E5AA5CB0946C25D40C83823BB5107E6', u'cidsBrowserFfOnOff': 1, u'domainOrWorkgroup': u'WORKGROUP', 
                     u'svaId': None, u'loginDomain': u'LocalComputer', u'lastServerName': u'WIN-4OA0GKJN830', u'contentUpdate': 1, 
                     u'writeFiltersStatus': None, u'infected': 0, 'timediffLastScanTime': 19972.982372045517, u'memory': 6441979904, 
                     u'freeMem': 3117060096, u'officePhone': u'', u'lastVirusTime': 1552994627000, u'telemetryMid': u'890E283B-41D3-4340-A397-66F6AFCAF33E',
                     u'idsVersion': u'', u'cidsBrowserIeOnOff': 1, u'publicKey': u'BgIAAACkAABSU0ExAAgAAAEAAQDfMtYpvbC2ZOrpGFbK76tuyp2MZ7/6EGsFrqAV3ZBMfvMllksVObpPYvDSc5vCjtzthb1301VADLAspayGytsdAj5z8+LLpOnJkHNg9tIunm1lLkBTitevI6G+nNjyKd7uPn3+bxjk1LL8g1exL2C2SMPEXubdUa1N5xwmhhPHp6PSIAjY74QUcNyplfvylMS9QRWoQ70mqNy9tLLef6+qCYWTqGa7QKXS0WUJs8sJMzWfCrpeMVAmU5/s3yEu+OI+9RKgOeSfy7wRzmAWHQTofjHkYGYqwXcwwLX7AbWjdcpYo0Kaecf8e5t2ZvWyR362EaNxn0HYSjpKraY1hLK1', 
                     u'quarantineDesc': u'Host Integrity check passed\n', u'cidsDrvMulfCode': 0, u'biosVersion': u'INTEL  - 6040000 PhoenixBIOS 4.0 Release 6.0', 
                     u'rebootReason': u'', u'telemetryHwid': u'A942D8EB-32C3-E42F-FE83-723FDC431F32', 'readableLastVirusTime': '2019-03-19 11:23:47', 
                     u'cidsSilentMode': 0, u'creationTime': 1550585043812, u'macAddresses': [u'00-50-56-8B-A6-C3', u'00-50-56-8B-A6-C3'], 
                     u'idsChecksum': None, u'operatingSystem': u'Windows Server 2012 ', u'osmajor': 6, u'virtualizationPlatform': u'Unknown', 
                     u'ipAddresses': [u'9.70.194.93', u'FE80:0000:0000:0000:FC67:074E:CD22:0188'], u'physicalCpus': 1, u'osBitness': u'x64', 
                     u'cidsDefsetVersion': u'190522063', u'cidsDrvOnOff': 1, u'computerName': u'WIN-4OA0GKJN830', u'logonUserName': u'Administrator', 
                     u'licenseExpiry': 0, u'osLanguage': u'en-US', u'gateways': [u'9.70.194.1', u'9.70.194.1', u'0.0.0.0', u'0.0.0.0'], 
                     u'uniqueId': u'D31AA16E0946C25D40C83823C500518B', u'department': u'', u'isNpvdiClient': 0, u'dhcpServer': u'0.0.0.0', 
                     u'readableLastScanTime': '2019-05-23 13:07:25', u'osfunction': u'Server', u'description': u'', u'osflavorNumber': 79, 
                     u'tpmDevice': u'0', u'onlineStatus': 1, u'lastDownloadTime': 1558356063096, u'apOnOff': 1, u'timeZone': 480, u'fullName': u'', 
                     u'osVersion': u'6.2', u'attributeExtension': u'', u'atpServer': u'https://9.70.194.99:443', u'tamperOnOff': 1, u'osServicePack': u'', 
                     u'agentType': u'105', u'serialNumber': u'VMware-42 0b 65 ea 0a d1 9f 7f-a1 d2 0a 58 c4 f4 ce b1', u'osElamStatus': 0, u'installType': u'0', 
                     u'profileSerialNo': u'8E20-05/08/2019 07:00:23 015', u'hardwareKey': u'1771D79454E53469DF4B290C06C104C9', u'firewallOnOff': 1}], 
                     u'lastPage': True, u'totalPages': 1, u'numberOfElements': 1, u'totalElements': 1, u'size': 20}, 

         'raw': '<content_as_string>'
         'reason': None, 
         'version': '1.0'}
"""
#  Globals
# List of fields in datatable fn_amp_get_computers script
DATA_TBL_FIELDS = ["query_execution_time", "computerName", "uniqueId", "operatingSystem", "ipAddresses",
                   "sep_description", "domain_name", "domain_id", "hardwareKey", "group_name", "group_id",
                   "infected"]
WF_NAME = "Get Endpoint Details"
FN_NAME = "fn_sep_get_computers"
C_OUTER = results.content
INPUTS = results.inputs
QUERY_EXECUTION_DATE = results["metrics"]["timestamp"]


# Processing

def main():
    note_text = ''
    if C_OUTER is not None:
        note_text = u"Symantec SEP Integration: Workflow <b>{0}</b>: There were <b>{1}</b> results returned for computer name " \
                    "<b>{2}</b> for Resilient function <b>{3}</b>" \
            .format(WF_NAME, results["content"]["numberOfElements"], unicode(INPUTS["sep_computername"]),
                    FN_NAME)

        eps = C_OUTER["content"]
        for i in range(len(eps)):
            ep_osname = eps[i].get("osname", "")
            newrow = incident.addRow("sep_endpoint_details")
            newrow.query_execution_date = QUERY_EXECUTION_DATE
            for f in DATA_TBL_FIELDS:
                f_base = f.split('_')[0]
                if f_base == "query_execution_time":
                    continue
                if eps[i][f_base] is not None:
                    if isinstance(eps[i][f_base], unicode) or isinstance(eps[i][f_base], int) \
                            or isinstance(eps[i][f_base], long) or len(eps[i][f_base]) == 0:
                        if f_base == "onlineStatus":
                            if eps[i][f_base]:
                                newrow[f] = "Online"
                            else:
                                newrow[f] = "Offline"
                        elif f_base == "infected":
                            if eps[i][f_base]:
                                newrow[f] = "Yes"
                            else:
                                newrow[f] = "No"
                        else:
                            newrow[f] = eps[i][f_base]
                    else:
                        newrow[f] = ','.join(eps[i][f_base])

            if "windows" in ep_osname.lower():
                if (eps[i]["quarantineDesc"].find("Host Integrity check passed") == -1):
                    newrow.endpoint_quarantine_status = "Quarantined"
                else:
                    newrow.endpoint_quarantine_status = "Un-Quarantined"
            else:
                newrow.endpoint_quarantine_status = ""

            group = eps[i].group
            if group is not None:
                newrow.group_name = group["name"]
                newrow.group_id = group["id"]
                domain = group["domain"]
                if domain is not None:
                    newrow.domain_name = domain["name"]
                    newrow.domain_id = domain["id"]

    else:
        note_text += u"Symantec SEP Integration: Workflow <b>{0}</b>: There were <b>no</b> results returned for computer " \
                     "name <b>{1}</b> for Resilient function <b>{2}</b>" \
            .format(WF_NAME, unicode(INPUTS["sep_computername"]), FN_NAME)

    incident.addNote(helper.createRichText(note_text))


if __name__ == "__main__":
    main()

```

---

