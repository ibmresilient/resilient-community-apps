<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
-->

# Example: SEP - Upload file to SEPM server

## Function - SEP - Upload File to SEPM

### API Name
`fn_sep_upload_file_to_sepm`

### Output Name
``

### Message Destination
`fn_sep`

### Pre-Processing Script
```python
inputs.sep_computer_ids = row.computer_id
inputs.sep_file_path = row.file_path
inputs.sep_source = rule.properties.sep_source
hash_lengths  = [64, 40, 32]
hvs = [None if h != len(row.hash_value) else row.hash_value for h in hash_lengths]
inputs.sep_sha256 = hvs[0]
inputs.sep_sha1 = hvs[1]
inputs.sep_md5 = hvs[2]
```

### Post-Processing Script
```python
##  Symantec Endpoint Protection  - fn_sep_upload_file_to_sepm script ##
# Example result:
"""
Result: { 'inputs': {u'sep_sha256': u'590f9895c2cbe93d47c3f7a3104fb843edfb5d5741330593d7d302a1e11e0ba5', u'sep_source': u'FILESYSTEM',
                   u'sep_computer_ids': u'89AD1BBB0946C25D25E6C0984E971D8A', u'sep_file_path': u'C:\\temp\\New Text Document.txt',
                   u'sep_sha1': None, u'sep_md5': None
                   },
         'metrics': {'package': 'fn-sep', 'timestamp': '2019-05-14 14:46:08', 'package_version': '1.0.0',
                    'host': 'myhost', 'version': '1.0', 'execution_time_ms': 1226
                   }, 'success': True,
         'content': {u'commandID': u'1BFD8C9B3FD74FF4A2490FFE63314E7A'},
         'raw': '{"commandID": "1BFD8C9B3FD74FF4A2490FFE63314E7A"}',
         'reason': None,
         'version': '1.0'
}

"""
#  Globals
# List of fields in datatable fn_sep_get_command_status script
DATA_TBL_FIELDS = ["commandID"]
fn_name = "fn_sep_upload_file_to_sepm"
wf_name = "Upload file to SEPM server"
content = results.content
inputs = results.inputs
# Processing

if content  is not None:
    noteText = u"Symantec SEP Integration: Workflow <b>{0}</b>: Command excuted with id  <b>{1}</b> for artifact with " \
               "type <b>{2}</b> and value <b>{3}</b> from source <b>{4}</b> for Resilient function <b>{5}</b>"\
        .format(wf_name, content["commandID"], row.artifact_type, unicode(row.artifact_value), inputs["sep_source"], fn_name)
    row.upload_commandid = content["commandID"]

else:
    noteText += "Symantec SEP Integration: Workflow <b>{0}</b>: There was <b>no</b> results returned for Resilient " \
                "function <b>{1}</b>".format(wf_name, fn_name)

incident.addNote(helper.createRichText(noteText))
```

---

## Function - SEP - Get Command Status

### API Name
`fn_sep_get_command_status`

### Output Name
``

### Message Destination
`fn_sep`

### Pre-Processing Script
```python
inputs.sep_commandid = row.upload_commandid
inputs.sep_status_type = "upload"
```

### Post-Processing Script
```python
##  Symantec Endpoint Protection  - fn_sep_get_command_status script ##
# Example result:
"""
Result: { 'inputs': {u'sep_status_type': u'quarantine', u'sep_commandid': u'7D3670DDF5A64A99B3721BF8A375B302'},
          'metrics': {'package': 'fn-sep', 'timestamp': '2019-04-26 15:25:55', 'package_version': '1.0.0',
                      'host': 'myhost', 'version': '1.0', 'execution_time_ms': 1256},
          'success': True,
          'content': {u'sort': [{u'direction': u'ASC', u'property': u'Begintime', u'ascending': True}], 'command_state': 'Completed', u'number': 0, u'firstPage': True, ': 0, u'content': [{u'computerName': u'WIN-N5KGH4CP3N3', u'subStateId u'binaryFileId': None, u'lastUpdateTime':
                        u'2019-04-26T11:05:27Z', u'domainName': u'Default', u'hardwareKey': u'DC7D24D6465566D2941F35BC8D17801E',
                        u'subStateDesc': u'', u'stateId': 3, u'computerId': u'89AD1BBB0946C25D25E6C0984E971D8A', u'computerIp': u'9.70.194.94', u'beginTime': u'2019-04-26T11:05:27Z', u'currentLoginUserName': u'Administrator', u'resultInXML': u'', 'command_status_id': 3}], u'lastPage': True, u'totalPages': 1, u'numberOfElements': 1, u'totalElements': 1, u'size': 20},
          'raw': '{"sort": [{"direction": "ASC", "property": "Begintime", "ascending": true}], "command_state": "Completed", "number": 0, "firstPage": true, "content": [{"computerName": "WIN-N5KGH4CP3N3", "subStateId": 0, "binaryFileId": null, "lastUpdateTime": "2019-04-26T11:05:27Z", "domainName": "Default", "hardwareKey": "DC7D24D6465566D2941F35BC8D17801E", "subStateDesc": "", "stateId": 3, "computerId": "89AD1BBB0946C25D25E6C0984E971D8A", "computerIp": "9.70.194.94", "beginTime": "2019-04-26T11:05:27Z", "currentLoginUserName": "Administrator", "resultInXML": "", "command_status_id": 3}], "lastPage": true, "totalPages": 1, "numberOfElements": 1, "totalElements": 1, "size": 20}', 'reason': None, 'version': '1.0'
}
"""
#  Globals
# List of fields in datatable fn_sep_get_command_status script
DATA_TBL_FIELDS = ["query_execution_date", "file_upload_status"]
FN_NAME = "fn_sep_get_command_status"
WF_NAME = "Upload file to SEPM server"
STATUS_TYPE = "upload"
FINAL_STATUSES = {
    0: "Initial / Not received",
    1: "Received", 
    2: "In progress",
    3: "Completed".format(STATUS_TYPE.capitalize()),
    4: "Rejected".format(STATUS_TYPE.capitalize()),
    5: "Canceled".format(STATUS_TYPE.capitalize()),
    6: "Failed".format(STATUS_TYPE.capitalize())
}
C_OUTER = results.content
INPUTS = results.inputs
QUERY_EXECUTION_DATE = results["metrics"]["timestamp"]
# Processing

def main():
    upload_command_state = C_OUTER["overall_command_state"]
    note_text = ''
    if C_OUTER is not None and len(C_OUTER["content"]) > 0:
        row.query_execution_date = QUERY_EXECUTION_DATE
        computer = C_OUTER["content"][0]
        if upload_command_state == "Completed":
            note_text = u"Symantec SEP Integration: Workflow <b>{0}</b>: Upload command completed with status <b>{1}</b> " \
                        "for command id <b>{2}</b> for artifact with type <b>{3}</b> and value <b>{4}</b> for Resilient function " \
                        "<b>{5}</b>".format(WF_NAME, FINAL_STATUSES[computer["stateId"]], INPUTS["sep_commandid"], row.artifact_type,
                    unicode(row.artifact_value), FN_NAME)
            row.file_upload_status = FINAL_STATUSES[computer["stateId"]]
            if computer["stateId"] == 3:
                row.file_id = computer["binaryFileId"]
        else:
            note_text = u"Symantec SEP Integration: Workflow <b>{0}</b>: Upload command in <b>{1}</b> state for command " \
                        "id <b>{2}</b> for artifact with type <b>{3}</b> and value <b>{4}</b> for Resilient function " \
                   "<b>{5}</b>".format(WF_NAME, FINAL_STATUSES[computer["stateId"]], INPUTS["sep_commandid"], row.artifact_type,
                    unicode(row.artifact_value), FN_NAME)
            row.file_upload_status = upload_command_state
    else:
        note_text = "Symantec SEP Integration: Workflow <b>{0}</b>: There were <b>no</b> results returned for Resilient " \
                    "function <b>{1}</b>".format(WF_NAME, FN_NAME)

    incident.addNote(helper.createRichText(note_text))

if __name__ == "__main__":
    main()
```

---

