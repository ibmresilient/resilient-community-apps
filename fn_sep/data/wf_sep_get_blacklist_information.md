<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
-->

# Example: SEP - Get Blacklist information

## Function - SEP - Get Domains

### API Name
`fn_sep_get_domains`

### Output Name
`get_domains_results`

### Message Destination
`fn_sep`

### Pre-Processing Script
```python
None
```

### Post-Processing Script
```python
fn_name = "fn_sep_get_domains"
wf_name = "Example: SEP - Get Blacklist information"
content = results.content
domainid = None
for i in range(len(content)):
  if content[i]["name"] ==  rule.properties.sep_domain_name:
    domainid = content[i]["id"]
    break
if domainid is not None:
    workflow.addProperty("domid_exists", {})
else:
    note_text = u"Symantec SEP Integration: Workflow <b>{0}</b>: The domain name  <b>{1}</b> was not found " \
                u"for Resilient function <b>{2}</b>.".format(wf_name, unicode(rule.properties.sep_domain_name), fn_name)
    incident.addNote(helper.createRichText(note_text))
```

---

## Function - SEP - Get Fingerprint List

### API Name
`fn_sep_get_fingerprint_list`

### Output Name
`None`

### Message Destination
`fn_sep`

### Pre-Processing Script
```python
domain_content_results =  workflow.properties.get_domains_results
domain_content = domain_content_results.content

for i in range(len(domain_content)):
  if domain_content[i]["name"] ==  rule.properties.sep_domain_name:
    inputs.sep_domainid = domain_content[i]["id"]
    break
inputs.sep_fingerprintlist_name = rule.properties.sep_fingerprintlist_name
```

### Post-Processing Script
```python
##  Symantec Endpoint Protection  - fn_sep_get_fingerprint_list script ##
# Example result:
"""
Result:{'inputs': {u'sep_fingerprintlist_name': u'Blacklist_2', u'sep_domainid': u'908090000946C25D330E919313D23887'}, 
        'metrics': {'package': 'fn-sep', 'timestamp': '2019-05-28 16:23:05', 'package_version': '1.0.0', 
                    'host': 'myhost', 'version': '1.0', 'execution_time_ms': 1153}, 
        'success': True, 
        'content': {u'description': u'Hash of type Malware MD5 Hash', u'hashType': u'MD5', u'source': u'WEBSERVICE', 
                    u'groupIds': [u'7E4BB119A9FE9DC526EDABFB1EE261B8'], u'data': [u'482F9B6E0CC4C1DBBD772AAAF088CB3A'], 
                    u'id': u'E60B061FDD844EBF9778D4BD2AC3942A', u'name': u'Blacklist_2'}, 
        'raw': '{"description": "Hash of type Malware MD5 Hash", "hashType": "MD5", "source": "WEBSERVICE", '
               '"groupIds": ["7E4BB119A9FE9DC526EDABFB1EE261B8"], "data": ["482F9B6E0CC4C1DBBD772AAAF088CB3A"], '
               '"id": "E60B061FDD844EBF9778D4BD2AC3942A", "name": "Blacklist_2"}', 
        'reason': None, 
        'version': '1.0'
 }
"""
#  Globals
# List of fields in datatable fn_sep_get_fingerprint_list script
DATA_TBL_FIELDS = ["domain_name", "list_name", "list_id", "list_description", "hash_values", "group_ids"]
FN_NAME = "fn_sep_get_fingerprint_list"
WF_NAME = "Get Fingerprint List"
CONTENT = results.content
INPUTS = results.inputs
QUERY_EXECUTION_DATE = results["metrics"]["timestamp"]
DOMAIN_NAME = rule.properties.sep_domain_name
# Processing


def main():
    note_text = ''

    if CONTENT is not None:
        if "errorCode" in CONTENT and int(CONTENT["errorCode"]) == 410:
            # The finger print list doesn't exist.
            note_text = u"Symantec SEP Integration: Workflow <b>{0}</b>: The fingerprint list <b>{1}</b> does not exist " \
                        "for domain <b>{2}</b> for Resilient function <b>{3}</b>"\
                .format(WF_NAME, unicode(INPUTS["sep_fingerprintlist_name"]), unicode(DOMAIN_NAME), FN_NAME)
        else:
            note_text = u"Symantec SEP Integration: Workflow <b>{0}</b>: There were <b>{1}</b> results returned for " \
                        "fingerprint list <b>{2}</b> and domain <b>{3}</b> for Resilient function <b>{4}</b>"\
                .format(WF_NAME, len(CONTENT["data"]), unicode(INPUTS["sep_fingerprintlist_name"]),
                        unicode(DOMAIN_NAME), FN_NAME)

            newrow = incident.addRow("sep_fingerprint_lists")
            newrow.query_execution_date = QUERY_EXECUTION_DATE
            newrow.domain_name = rule.properties.sep_domain_name
            newrow.list_name =  CONTENT["name"]
            newrow.list_id =  CONTENT["id"]
            newrow.list_description =  CONTENT["description"]
            newrow.hash_values = ', '.join(CONTENT["data"])
            newrow.group_ids = ', '.join(CONTENT["groupIds"])
    else:
        noteText += u"Symantec SEP Integration: Workflow <b>{0}</b>: There were <b>no</b> results returned  for " \
                    "fingerprint list <b>{1}</b> and domain <b>{2}</b> for Resilient " \
                    "function <b>{3}</b>".format(WF_NAME, unicode(INPUTS["sep_fingerprintlist_name"]),
                                                 unicode(DOMAIN_NAME), FN_NAME)

    incident.addNote(helper.createRichText(note_text))

if __name__ == "__main__":
    main()
```

---

