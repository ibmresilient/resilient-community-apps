# Resilient Functions Integration to Slack

This function creates a Slack message based on a Resilient incident and it's notes. Threaded replies are possible based on a retained Slack thread_id.
Many of the features of posting a Slack message are under customer control including:
- threaded replies
- preserving embedded links
- Slack markdown capability
- posting messages displaying authorship
- Slack user (@user) and channel (#channel) references 

## Installation

To install in "development mode"

    pip install -e ./fn_slack/

After installation, the package will be accessible to `resilient-circuits run`.

To uninstall,

    pip uninstall fn_slack

To package for distribution,

    python ./fn_slack/setup.py sdist

The resulting .tar.gz file can be installed using

    pip install <filename>.tar.gz
    
See the accompanying documentation for how to install to Resilient and configure.
    
This template project was generated by

    `resilient-circuits codegen -p fn_slack -f slack_post_message --workflow create_slack_message create_slack_reply
        --rule 'Create Slack Reply' 'Create Slack Message' --field slack_id`

## Configuration

1. Import the package's customization data into the Resilient Platform through the command:

		`resilient-circuits customize`

	This will create the following custom components:
	* Message Destinations: `slack`
	* Functions: `Slack Post Message`
	* Custom Fields: `Slack ID`
	* Custom datatables: None
	* Workflows: `Create Slack Message`, `Create Slack Reply`
	* Rules: `(Example) Create Slack Message`, `(Example) Create Slack Reply`

2. Update and edit `app.config` by first running:

		`resilient-circuits configure -c`, to start a new configuration file or
		`resilient-circuits configure -u`, to update an existing configuration

   Edit
```
    [fn_slack]
    api_token=xoxp-344599510069-344361958115-344605636853-3532acc3892fa61f3fb84edd695cb99c
    \# When as_user=False, username represents the submission author
    username=Resilient
```
## Customization

1. For the 'Create Slack Message` workflow, review the function's input parameters, particularly slack_channel for your environment

## Use

1. Start Resilient Circuits with:
    `resilient-circuits run`

2. From within Resilient and a given incident, run the manual Action '(Example) Create Slack Message` to share incident data with the Slack channel defined.

3. Posting a note to a shared incident will automatically post the note to Slack