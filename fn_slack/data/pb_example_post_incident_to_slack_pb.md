<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v49.0.4423
-->

# Playbook - Example: Post Incident to Slack (PB)

### API Name
`example_post_incident_to_slack_pb`

### Status
`enabled`

### Activation Type
`manual`

### Object Type
`incident`

### Description
Post a message from the Incident to your Slack channel. Send specifics about the Incident with an optional custom text message.


---
## Function - Post message to Slack

### API Name
`slack_post_message`

### Output Name
`slack_info`

### Message Destination
`slack`

### Function-Input Script
```python
#####################
# Incident data     #
#####################

# Slack additional text message
# Additional text message to include with the Incident, Note, Artifact, Attachment or Task data.
rule_additional_text = playbook.inputs.rule_slack_text if playbook.inputs.rule_slack_text is not None else ''

# "datetime" fields: Assign 0 if it's None
date_occured = incident.start_date if incident.start_date else 0
date_discovered = incident.discovered_date if incident.discovered_date else 0

# Incident id for the URL
incident_id_str = str(incident.id)

# Slack text message in JSON format
# ---------------------------------
# Do not remove first 3 elements "Additional Text", "Resilient URL" and "Type of data",
# the information is used to generate the title of the message.
#
# Add/remove information using the syntax:
# "label": {{ "type": "[string|richtext|boolean|datetime", "data": "resilient field data" }}
#
# Make sure to send "datetime" types as integers and not strings:
# without double quotes: { "type": "datetime", "data": resilient datetime data}  
#
# Text fields like 'incident name', 'description' or 'Slack additional text message' can include double quotes.
# Watch out for embedded double quotes in these text fields and escape with field.replace(u'"', u'\\"') otherwise json.loads will fail.
slack_text = u"""{{
  "Additional Text": {{"type": "string", "data": "{0}" }},
  "Resilient URL": {{"type": "incident", "data": "{1}" }},
  "Type of data": {{"type": "string", "data": "{2}" }},
  "Incident ID": {{"type": "string", "data": "{3}" }},
  "Incident name": {{"type": "string", "data": "{4}" }},
  "Description": {{"type": "richtext", "data": "{5}" }},
  "Incident Types": {{"type": "string", "data": "{6}" }},
  "NIST Attack Vectors": {{"type": "string", "data": "{7}" }},
  "Confirmed": {{"type": "boolean", "data": "{8}" }},
  "Date Created": {{"type": "datetime", "data": {9} }},
  "Date Occurred": {{"type": "datetime", "data": {10} }},
  "Date Discovered": {{"type": "datetime", "data": {11} }},
  "Severity": {{"type": "string", "data": "{12}" }}
}}""".format(
  rule_additional_text.replace(u'"', u'\\"'),
  incident_id_str,
  "Incident",
  incident_id_str,
  incident.name.replace(u'"', u'\\"'),
  incident.description.content.replace(u'"', u'\\"') if incident.description is not None else '',
  incident.incident_type_ids,
  incident.nist_attack_vectors,
  incident.confirmed,
  incident.create_date,
  date_occured,
  date_discovered,
  incident.severity_code)

# ID of this incident
inputs.incident_id = incident.id

# Slack channel name
# Name of the existing Slack Workspace channel or a new Slack channel you are posting to. 
# Channel names can only contain lowercase letters, numbers, hyphens, and underscores, and must be 21 characters or less. 
# If you leave this field empty, function will try to use the slack_channel associated with the Incident or Task found in the Slack Conversations datatable. 
# If there isnâ€™t one defined, the workflow will terminate.
inputs.slack_channel = playbook.inputs.rule_slack_channel if playbook.inputs.rule_slack_channel is not None else playbook.inputs.rule_slack_channel

# Is channel private
# Indicate if the channel you are posting to should be private.
inputs.slack_is_channel_private = playbook.inputs.rule_slack_is_channel_private if playbook.inputs.rule_slack_is_channel_private is not None else playbook.inputs.rule_slack_is_channel_private 

# Slack user emails
# Comma separated list of emails belonging to Slack users in your workspace that will be added to the channel you are posting to.
inputs.slack_participant_emails = playbook.inputs.rule_slack_participant_emails if playbook.inputs.rule_slack_participant_emails is not None else playbook.inputs.rule_slack_participant_emails

# Slack text message
# Container field to retain JSON fields to send to Slack.
inputs.slack_text = slack_text

# Slack Channel ID, faster than finding via channel name
inputs.slack_channel_id = playbook.inputs.slack_channel_id if playbook.inputs.slack_channel_id else playbook.inputs.slack_channel_id

```

---

## Local script - Post message to Slack Post-Process Script

### Description


### Script Type
`Local script`

### Objet Type
`incident`

### Script Content
```python
userinfo = str(playbook.functions.results.slack_info.user_info)
userinfo = userinfo.replace("'", "").replace("[","").replace("]","")
noteText = u"""Incident was posted to <a href='{}'>Slack channel #{}</a>. Members of this channel are: \n{}""".format(playbook.functions.results.slack_info.url, playbook.functions.results.slack_info.channel, userinfo)
incident.addNote(helper.createRichText(noteText))


```

---
