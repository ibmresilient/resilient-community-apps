<!--
  This User README.md is generated by running:
  "resilient-sdk docgen -p fn_spamhaus_query --user-guide"

  It is best edited using a Text Editor with a Markdown Previewer. VS Code
  is a good example. Checkout https://guides.github.com/features/mastering-markdown/
  for tips on writing with Markdown

  If you make manual edits and run docgen again, a .bak file will be created

  Store any screenshots in the "doc/screenshots" directory and reference them like:
  ![screenshot: screenshot_1](./screenshots/screenshot_1.png)
-->

# **User Guide:** fn_spamhaus_query_v1.0.1

## Table of Contents
- [Key Features](#key-features)
- [Function - Spamhaus Query Submit Artifact](#function---spamhaus-query-submit-artifact)
- [Rules](#rules)

---

## Key Features
<!--
  List the Key Features of the Integration
-->
* Look up IP Addresses in Spamhaus Datasets
* Look up Domain Names in Spamhaus Datasets
* Add the enrichment data to the Resilient artifact

---

## Function - Spamhaus Query Submit Artifact
Function to check IP Address & Domain Names against Spamhaus Database to see whether IP Address or Domain Names appears in Spamhaus block list records or not.

 ![screenshot: fn-spamhaus-query-submit-artifact ](./screenshots/fn-spamhaus-query-submit-artifact.png)

<details><summary>Inputs:</summary>
<p>

| Name | Type | Required | Example | Tooltip |
| ---- | :--: | :------: | ------- | ------- |
| `spamhaus_query_string` | `text` | Yes | `IP Address/Domain Name` | IP Adress or Domain Name to be checked against Spamhaus database. |
| `spamhaus_search_resource` | `text` | Yes | `SBL,XBL,PBL,SBL-XBL,ZEN,MSR,AUTHBL,ZRD (domains only),DBL (domains only).` | resource-name is a required enumerated field that represents which blocklist should be queried. |

</p>
</details>

<details><summary>Outputs:</summary>
<p>

```python
results = {
    # TODO: Copy and paste an example of the Function Output within this code block.
    # To view the output of a Function, run resilient-circuits in DEBUG mode and invoke the Function. 
    # The Function results will be printed in the logs: "resilient-circuits run --loglevel=DEBUG"
}
```

</p>
</details>

<details><summary>Workflows</summary>

  <details><summary>Example Pre-Process Script:</summary>
  <p>

  ```python
  inputs.spamhaus_query_string = artifact.value
inputs.spamhaus_search_resource = rule.properties.spamhaus_domain_name_resource
  ```

  </p>
  </details>

  <details><summary>Example Post-Process Script:</summary>
  <p>

  ```python
  results_data = results.get('content')
tmp_text = ""
tmp_desc = artifact.description
if results_data.get('is_in_blocklist'):
     tmp_text = "<br><br><b>This artifact checked against Spamhaus and it is in block list.</b>"
     resp_list = results_data.get('resp')
     for code in resp_list:
          code = str(code)
          tmp_text += "<br><b>code :</b> {}</br>".format(code)
          tmp_text += "<br><b>dataset :</b> {}</br>".format(results_data.get(code).get('dataset'))
          tmp_text += "<br><b>explanation :</b> {}</br>".format(results_data.get(code).get('explanation'))
          tmp_text += "<br><b>URL :</b> </br>{}</br>".format(results_data.get(code).get('URL'))
else:
     tmp_text = "<br><br><b>This artifact checked against Spamhaus Dataset: {} and it is not in block list.</b></br></br>".format(results.get('inputs').get('spamhaus_search_resource'))
if tmp_desc:
     tmp_desc = tmp_desc.get('content')
else:
     tmp_desc = "" 
complete_tmp_text = tmp_desc+tmp_text
rich_text = helper.createRichText(complete_tmp_text)
artifact.description = rich_text
  ```

  </p>
  </details>

</details>

---




## Rules
| Rule Name | Object | Workflow Triggered |
| --------- | ------ | ------------------ |
| Example: SpamHaus: Submit IP Address | artifact | `example_spamhaus_submit_ip_address` |
| Example: SpamHaus: Submit Domain Name | artifact | `example_spamhaus_submit_domain_name` |

---

<!--
## Inform Resilient Users
  Use this section to optionally provide additional information so that Resilient playbook 
  designer can get the maximum benefit of your integration.
-->