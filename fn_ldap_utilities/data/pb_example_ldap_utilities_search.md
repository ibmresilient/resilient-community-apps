<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v49.1.51
-->

# Playbook - Example: LDAP Utilities: Search (PB)

### API Name
`example_ldap_utilities_search`

### Status
`enabled`

### Activation Type
`manual`

### Object Type
`artifact`

### Description
runs a person query against an LDAP server using the person's email address


---
## Function - LDAP Utilities: Search

### API Name
`ldap_utilities_search`

### Output Name
`search_results`

### Message Destination
`fn_ldap_utilities`

### Function-Input Script
```python
# If search filters are given
if playbook.inputs.ldap_search_filter:
  inputs.ldap_search_filter = playbook.inputs.ldap_search_filter
# If filters not given then set them to example filters
else:
  inputs.ldap_search_filter = "(&(objectClass=person)(mail=*%ldap_param%))"

# If search attributes are given
if playbook.inputs.ldap_search_attributes:
  inputs.ldap_search_attributes = playbook.inputs.ldap_search_attributes
# If search attributes not given then set them to example attributes
else:
  inputs.ldap_search_attributes = "*"

inputs.ldap_search_param = artifact.value
# If the incident field ldap_base_dn contains a value then set ldap_search_base to that value
if incident.properties.ldap_base_dn:
  inputs.ldap_search_base = incident.properties.ldap_base_dn
# If a value is given in the rule ldap_search_base field then set ldap_search_base to that value
if playbook.inputs.ldap_search_base:
  inputs.ldap_search_base = playbook.inputs.ldap_search_base

# If the incident field ldap_domain_name contains a value then set ldap_domain_name to that value
if incident.properties.ldap_domain_name:
  inputs.ldap_domain_name = incident.properties.ldap_domain_name
# If a value is given in the rule ldap_domain_name field then set ldap_domain_name to that value
if playbook.inputs.ldap_domain_name:
  inputs.ldap_domain_name = playbook.inputs.ldap_domain_name
```

---

## Local script - post-process

### Description


### Script Type
`Local script`

### Objet Type
`artifact`

### Script Content
```python
results = playbook.functions.results.search_results
ENTRY_TO_DATATABLE_MAP = {
  "uid": "uid",
  "cn": "fullname",
  "sn": "surname",
  "mail": "email_address",
  "telephoneNumber": "telephone_number"
}

# Processing if the function is a success
if results.get("success"):
  for entry in results.get("content", {}).get("entries"):
    row = incident.addRow("ldap_query_results") # Add Row
    for k in ENTRY_TO_DATATABLE_MAP:
      # If Handle for Active Directory else Handle for OpenLdap
      row[ENTRY_TO_DATATABLE_MAP[k]] = "N/A" if not entry.get(k) else ",".join(entry.get(k)) if isinstance(entry[k], list) else entry.get(k)
```

---
