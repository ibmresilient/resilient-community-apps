<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
-->

# Example: LDAP Utilities: Toggle Access

## Function - LDAP Utilities: Search

### API Name
`ldap_utilities_search`

### Output Name
`search_output`

### Message Destination
`fn_ldap_utilities`

### Pre-Processing Script
```python
# Set the ldap_search_base and ldap_search_filter
# using the ldap_param wildcard then get the email
# address the user you want to toggle access for from the artifact's value
inputs.ldap_search_filter = "(&(mail=%ldap_param%))"
inputs.ldap_search_param =  artifact.value

# If the incident field ldap_base_dn contains a value then set ldap_search_base to that value
if incident.properties.ldap_base_dn:
  inputs.ldap_search_base = incident.properties.ldap_base_dn
# If a value is given in the rule ldap_search_base field then set ldap_search_base to that value
if rule.properties.ldap_search_base:
  inputs.ldap_search_base = rule.properties.ldap_search_base

# If the incident field ldap_domain_name contains a value then set ldap_domain_name to that value
if incident.properties.ldap_domain_name:
  inputs.ldap_domain_name = incident.properties.ldap_domain_name
# If a value is given in the rule ldap_domain_name field then set ldap_domain_name to that value
if rule.properties.ldap_domain_name:
  inputs.ldap_domain_name = rule.properties.ldap_domain_name
```

### Post-Processing Script
```python
# No post-processing script here as output being passed into next function
```

---

## Function - LDAP Utilities: Toggle Access

### API Name
`ldap_utilities_toggle_access`

### Output Name
``

### Message Destination
`fn_ldap_utilities`

### Pre-Processing Script
```python
# Once the LDAP Utilities: Search completes, get the DN of the first entry
# which will be the DN of the account you want to set a Toggle Access for
inputs.ldap_domain_name = workflow.properties.search_output.inputs.ldap_domain_name
inputs.ldap_dn = workflow.properties.search_output.content[0]["dn"]
inputs.ldap_toggle_access = rule.properties.ldap_toggle_access
```

### Post-Processing Script
```python
# If the function is successful in updating users access rights,
# a note is added to the incident

if (results.success):
  color = "#45bc27" #green
  if (results.inputs.ldap_toggle_access.get("name") == "Disabled"):
    color = "#ff402b" #red
  noteText = """<br><i style="color: #979ca3"> LDAP Utilities: Toggle Access workflow <u>complete</u>:</i>
                    <b>Email:</b> <u style="color: #7fb0ff">{}</u>
                    <b>Status:</b> <b style="color: {}">{}</b>
                    <b>DN:</b> '{}'""".format(artifact.value, color, results.inputs.ldap_toggle_access.name, results.inputs.ldap_dn)

  incident.addNote(helper.createRichText(noteText))
```

---

