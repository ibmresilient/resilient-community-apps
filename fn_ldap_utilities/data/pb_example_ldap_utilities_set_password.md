<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v51.0.1.0.695
-->

# Playbook - Example: LDAP Utilities: Set Password (PB)

### API Name
`example_ldap_utilities_set_password`

### Status
`enabled`

### Activation Type
`Manual`

### Activation Conditions
`artifact.type equals Email Recipient OR artifact.type equals Email Sender OR artifact.type equals String`

### Activation Form Elements
| Input Field Label | API Name | Element Type | Tooltip | Requirement |
| ----------------- | -------- | ------------ | ------- | ----------- |
| LDAP Domain Name | `ldap_domain_name` | text | Domain name label given to server in app.config | Optional |
| LDAP New Auto Password Length | `ldap_new_auto_password_length` | number | Length of auto generated password | Optional |
| LDAP Return New Password | `ldap_return_new_password` | boolean | - | Optional |
| LDAP Search Base | `ldap_search_base` | text | Search base | Optional |
| LDAP User New Password | `ldap_user_new_password` | text | If this field is empty password will be autogenerated | Optional |

### Object Type
`artifact`

### Description
searches for a user using their email address, gets their DN and sets a new password for that user


---
## Function - LDAP Utilities: Set Password

### API Name
`ldap_utilities_set_password`

### Output Name
`pass_results`

### Message Destination
`fn_ldap_utilities`

### Function-Input Script
```python
results = playbook.functions.results.search_results
# Once the LDAP Utilities: Search completes, get the DN of the first entry
# which will be the DN of the account you want to set a Set a New Password for
inputs.ldap_domain_name = results.get("inputs", {}).get("ldap_domain_name")
inputs.ldap_dn = results.get("content", {}).get("entries", [])[0]["dn"]
inputs.ldap_new_password = getattr(playbook.inputs, "ldap_user_new_password", None)
pass_len = getattr(playbook.inputs, "ldap_new_auto_password_length", None)
if pass_len:
  inputs.ldap_new_auto_password_len = pass_len
inputs.ldap_return_new_password = getattr(playbook.inputs, "ldap_return_new_password", None)
```

---
## Function - LDAP Utilities: Search

### API Name
`ldap_utilities_search`

### Output Name
`search_results`

### Message Destination
`fn_ldap_utilities`

### Function-Input Script
```python
# Set the ldap_search_base and ldap_search_filter
# using the ldap_param wildcard then get the email
# address the user you want to set a new password for from the artifact's value
inputs.ldap_search_filter = "(&(objectClass=person)(mail=%ldap_param%))"
inputs.ldap_search_param =  artifact.value

# If the incident field ldap_base_dn contains a value then set ldap_search_base to that value
if incident.properties.ldap_base_dn:
  inputs.ldap_search_base = incident.properties.ldap_base_dn
# If a value is given in the rule ldap_search_base field then set ldap_search_base to that value
if getattr(playbook.inputs, "ldap_search_base", None):
  inputs.ldap_search_base = getattr(playbook.inputs, "ldap_search_base", None)

# If the incident field ldap_domain_name contains a value then set ldap_domain_name to that value
if incident.properties.ldap_domain_name:
  inputs.ldap_domain_name = incident.properties.ldap_domain_name
# If a value is given in the rule ldap_domain_name field then set ldap_domain_name to that value
if getattr(playbook.inputs, "ldap_domain_name", None):
  inputs.ldap_domain_name = getattr(playbook.inputs, "ldap_domain_name", None)
```

---

## Local script - LDAP Utilities Set Password post-process

### Description


### Script Type
`Local script`

### Object Type
`artifact`

### Script Content
```python
results = playbook.functions.results.pass_results
content = results.get("content", {})
# If the function is successful in changing the users password, a note is added to the incident
if results.get("success"):
  noteText = f"""<br><i style="color: #979ca3"> LDAP MultiDomain Utilities: Set Password workflow <u>complete</u>:</i>
                A New Password has been set for:
                <b>Email:</b> <u style="color: #7fb0ff">{artifact.value}</u>
                <b>DN:</b> '{content.get('user_dn')}'
                <b>New password:</b> '{content.get('ldap_new_password')}'"""

  incident.addNote(helper.createRichText(noteText))
```

---
## Global script - No search results

### Description


### Script Type
`Global script`

### Object Type
`artifact`

### Script Content
```python
incident.addNote(f"No entries found for {artifact.value}")
```

---

