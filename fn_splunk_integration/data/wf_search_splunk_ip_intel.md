<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-circuits codegen
-->

# Example of searching an artifact in Splunk ES

## Function - Splunk Search

### API Name
`splunk_search`

### Output Name
``

### Message Destination
`splunk_es_rest`

### Pre-Processing Script
```python
lookup_map = {
  "DNS Name": ("ip_intel", "domain"),
  "Email Attachment": None,
  "Email Attachment Name": ("file_intel", "file_name"),
  "Email Body": None,
  "Email Recipient": None,
  "Email Sender": ("email_intel", "src_user"),
  "Email Sender Name": ("email_intel", "src_user"),
  "Email Subject": ("email_intel", "subject"),
  "File Name": ("file_intel", "file_name"),
  "File Path": None,
  "HTTP Request Header": None,
  "HTTP Response Header": None,
  "IP Address": ("ip_intel", "ip"),
  "Log File": None,
  "MAC Address": None,
  "Malware Family/Variant": None,
  "Malware MD5 Hash": ("file_intel", "file_hash"),
  "Malware Sample": None,
  "Malware Sample Fuzzy Hash": ("file_intel", "file_hash"),
  "Malware SHA-1 Hash": ("file_intel", "file_hash"),
  "Malware SHA-256 Hash": ("file_intel", "file_hash"),
  "Mutex": None,
  "Network CIDR Range": None,
  "Other File": None,
  "Password": None,
  "Port": None,
  "Process Name": ("process_intel", "process"),
  "Registry Key": ("registry_intel", "registry_value_name"),
  "RFC 822 Email Message File": None,
  "Service": ("service_intel", "service"),
  "String": None,
  "System Name": ("service_intel", "service"),
  "URI Path": None,
  "URL": ("http_intel", "url"),
  "URL Referer": ("http_intel", "http_referrer"),
  "User Account": None,
  "User Agent": ("http_intel", "http_user_agent")
}

if artifact.type in lookup_map and lookup_map[artifact.type]:
  threat_type, threat_field_name = lookup_map[artifact.type]
  inputs.splunk_query_param1 = threat_type
  inputs.splunk_query_param2 = threat_field_name
  inputs.splunk_query_param3 = artifact.value
  inputs.splunk_label = rule.properties.splunk_servers
else:
  helper.fail("Artifact type not supported: {}".format(artifact.type))
```

### Post-Processing Script
```python
# {'events': [OrderedDict([('_key', '4fa89feac1004d7cbfcb974eb79c62e9'), ('ip', 'https://ibm.biz/resilientcommunity'), ('item_key', '4fa89feac1004d7cbfcb974eb79c62e9'), ('threat_key', 'restapi'), ('time', '1598296740.6724114')]), OrderedDict([('_key', '9b14932c75aa4b1f909775bd10cb78d6'), ('ip', 'https://ibm.biz/resilientcommunity'), ('item_key', '9b14932c75aa4b1f909775bd10cb78d6'), ('threat_key', 'restapi'), ('time', '1598296660.9374135')])]}

if results.get("content", None):
  for event in results.content:
    result_row = incident.addRow("splunk_intel_results")
    result_row.create_date = int(float(event.pop("time"))*1000)
    result_row.source = event.pop("threat_key")
    result_row.intel_collection = results.inputs['splunk_query_param1']
    result_row.intel_key = event.pop("_key")
    result_row.splunk_server = rule.properties.splunk_servers
    result_row.status = "Active"
    event.pop("item_key") # not presented
    # what's left is the artifact value
    for k, v in event.items():
      result_row.intel_field = k
      result_row.intel_value = v
      break
else:
  result_row = incident.addRow("splunk_intel_results")
  result_row.intel_value = artifact.value
  result_row.status = "Not Found"
  result_row.splunk_server = rule.properties.splunk_servers
  

```

---

