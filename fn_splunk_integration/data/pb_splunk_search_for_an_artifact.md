<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v50.1.262
-->

# Playbook - Splunk: Search for an Artifact - Example (PB)

### API Name
`splunk_search_for_an_artifact`

### Status
`enabled`

### Activation Type
`Manual`

### Activation Conditions
`-`

### Activation Form Elements
| Input Field Label | API Name | Element Type | Tooltip | Requirement |
| ----------------- | -------- | ------------ | ------- | ----------- |
| Splunk Server | `splunk_server` | text | Enter the label given to the Splunk server in the app.config you wish to use | Optional |

### Object Type
`artifact`

### Description
This is an example playbook calling the "Splunk Search" function to search a Splunk collection based on the artifact type. The results are returned in the Splunk Results datatable.


---
## Function - Splunk Search

### API Name
`splunk_search`

### Output Name
`search`

### Message Destination
`splunk_es_rest`

### Function-Input Script
```python
lookup_map = {
  "DNS Name": ("ip_intel", "domain"),
  "Email Attachment": None,
  "Email Attachment Name": ("file_intel", "file_name"),
  "Email Body": None,
  "Email Recipient": None,
  "Email Sender": ("email_intel", "src_user"),
  "Email Sender Name": ("email_intel", "src_user"),
  "Email Subject": ("email_intel", "subject"),
  "File Name": ("file_intel", "file_name"),
  "File Path": None,
  "HTTP Request Header": None,
  "HTTP Response Header": None,
  "IP Address": ("ip_intel", "ip"),
  "Log File": None,
  "MAC Address": None,
  "Malware Family/Variant": None,
  "Malware MD5 Hash": ("file_intel", "file_hash"),
  "Malware Sample": None,
  "Malware Sample Fuzzy Hash": ("file_intel", "file_hash"),
  "Malware SHA-1 Hash": ("file_intel", "file_hash"),
  "Malware SHA-256 Hash": ("file_intel", "file_hash"),
  "Mutex": None,
  "Network CIDR Range": None,
  "Other File": None,
  "Password": None,
  "Port": None,
  "Process Name": ("process_intel", "process"),
  "Registry Key": ("registry_intel", "registry_value_name"),
  "RFC 822 Email Message File": None,
  "Service": ("service_intel", "service"),
  "String": None,
  "System Name": ("service_intel", "service"),
  "URI Path": None,
  "URL": ("http_intel", "url"),
  "URL Referer": ("http_intel", "http_referrer"),
  "User Account": None,
  "User Agent": ("http_intel", "http_user_agent")
}

if artifact.type in lookup_map and lookup_map.get(artifact.type):
  threat_type, threat_field_name = lookup_map.get(artifact.type)
  inputs.splunk_query_param1 = threat_type
  inputs.splunk_query_param2 = threat_field_name
  inputs.splunk_query_param3 = artifact.value
  inputs.splunk_label = getattr(playbook.inputs, "splunk_server")
else:
  helper.fail("Artifact type not supported: {}".format(artifact.type))

inputs.splunk_query = "| `%param1%` | eval item_key=_key | search %param2%=%param3%"
inputs.splunk_max_return = 10
inputs.splunk_search_time_to_wait = 2
```

---

## Local script - post process

### Description


### Script Type
`Local script`

### Object Type
`artifact`

### Script Content
```python
results = playbook.functions.results.search

if results.get("content", {}):
  for event in results.get("content", {}):
    result_row = incident.addRow("splunk_intel_results")
    result_row.create_date = int(float(event.pop("time"))*1000)
    result_row.source = event.get("threat_key")
    result_row.intel_collection = results.get("inputs", {}).get('splunk_query_param1')
    result_row.intel_key = event.get("_key")
    result_row.splunk_server = getattr(playbook.inputs, "splunk_server")
    result_row.status = "Active" if int(event.get("disabled")) == 0 else "Disabled"
    event.pop("item_key") # not presented
    result_row.intel_field = results.get("inputs", {}).get("splunk_query_param2")
    result_row.intel_value = results.get("inputs", {}).get("splunk_query_param3")
else:
  result_row = incident.addRow("splunk_intel_results")
  result_row.intel_value = artifact.value
  result_row.status = "Not Found"
  result_row.splunk_server = getattr(playbook.inputs, "splunk_server")
```

---

