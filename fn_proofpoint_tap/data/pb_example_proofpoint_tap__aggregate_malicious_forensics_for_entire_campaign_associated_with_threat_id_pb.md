<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v49.0.4423
-->

# Playbook - Example: Proofpoint TAP - Aggregate Malicious Forensics for Entire Campaign Associated with Threat ID (PB)

### API Name
`example_proofpoint_tap__aggregate_malicious_forensics_for_entire_campaign_associated_with_threat_id_pb`

### Status
`enabled`

### Activation Type
`manual`

### Object Type
`artifact`

### Description
Imports additional forensic information based on the given threat identifier. If the threat has been associated with a campaign, it returns aggregate forensics for the entire campaign. Otherwise, it returns aggregate forensics for the individual threat. The returned forensics are filtered to include malicious results only. Results are saved in a note and attachment.


---
## Function - Proofpoint TAP Get Forensics

### API Name
`fn_pp_forensics`

### Output Name
`forensics_results`

### Message Destination
`fn_proofpoint_tap`

### Function-Input Script
```python
inputs.incident_id = incident.id
inputs.proofpoint_threat_id = artifact.value
inputs.proofpoint_aggregate_flag = True
inputs.proofpoint_malicious_flag = True
```

---

## Local script - ProofPoint TAP: Write Aggregate Malicious Forensics for Entire Campaign Associated with Threat ID Re

### Description
Write the results from Aggregate Malicious Forensics for Entire Campaign Associated with Threat ID Results to a note

### Script Type
`Local script`

### Objet Type
`artifact`

### Script Content
```python
results = playbook.functions.results.forensics_results

# results is a Dictionary and reports is a List
if results is not None:
  noteText = "<b>Proofpoint TAP - Aggregate Malicious Forensics for Entire Campaign Associated with Threat ID Results:</b>"
  
  if results.get("success") is True:
    num_reports = results.get("num_reports", 0)
    
    noteText = u"""{}
    <br>Found {} {} with malicious forensics for artifact {}. {}""".format(
      noteText,
      num_reports,
      "report" if num_reports == 1 else "reports",
      artifact.value,
      "Results are saved in an attachment." if num_reports > 0 else "")
  
  elif results.get("success") is False and results.get("note_err_text", None) is not None:
    noteText = u"""{} 
    <br>No Forensics found for Threat ID '{}'. 
    <br>Error: {}.""".format(noteText, artifact.value, results.get("note_err_text"))
  
  else:
    noteText = u"""{} <br>No Forensics found for Threat ID '{}'.""".format(noteText, artifact.value)
  
  incident.addNote(helper.createRichText(noteText))
```

---
