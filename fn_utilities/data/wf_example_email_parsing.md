<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-circuits codegen
-->

# Example: Email Parsing


## Function - Utilities: Attachment to Base64

### API Name
`utilities_attachment_to_base64`

### Output Name
`attachment_content`

### Message Destination
`fn_utilities`

### Pre-Processing Script
```python
# Required inputs are: the incident id and attachment id
inputs.incident_id = incident.id
inputs.attachment_id = attachment.id

# If this is a "task attachment" then we will additionally have a task-id
if task is not None:
  inputs.task_id = task.id
```

### Post-Processing Script
```python
None
```

---


## Function - Utilities: Email Parse

### API Name
`utilities_email_parse`

### Output Name
`None`

### Message Destination
`fn_utilities`

### Pre-Processing Script
```python
# The input is the base64-encoded content that was read in a previous component
# That object has properties:
#  - filename
#  - content_type
#  - size
#  - created
#  - content (the base64-encoded data)
inputs.incident_id = incident.id
inputs.base64content = workflow.properties.attachment_content.content
```

### Post-Processing Script
```python
# The output includes:
#  - headers, a dictionary of all the headers
#  - subject
#  - body_text and body_html (depending on how the email was formatted)
#  - an array of attachments
#  - timestamp

subj = results.subject
all_from = ", ".join(f.email for f in results.from)
all_to = ", ".join(f.email for f in results.to)

# Write a note with the email body
if results.body_html is not None:
  # richtext body
  content = u"<div><p>Subject: {}<br>From: {}<br>To: {}</p>{}</div>".format(subj, all_from, all_to, results.body_html)
  note = helper.createRichText(content)
  incident.addNote(note)
else:
  # Plaintext body
  content = u"Subject: {}\nFrom: {}\nTo: {}\n{}".format(subj, all_from, all_to, results.body_text)
  note = helper.createPlainText(content)
  incident.addNote(note)
  

```

---

