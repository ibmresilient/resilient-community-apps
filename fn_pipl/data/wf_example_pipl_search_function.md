<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v50.1.262
-->

# Example: Pipl search

## Function - Pipl search function

### API Name
`pipl_search_function`

### Output Name
``

### Message Destination
`fn_pipl`

### Pre-Processing Script
```python
# Required inputs are: the artifact_type and artifact_value
inputs.pipl_artifact_type = artifact.type
inputs.pipl_artifact_value = artifact.value
```

### Post-Processing Script
```python
from datetime import datetime

def add_row_to_pipl_datatable(db_timestamp, db_artifact_value, db_match_no, db_property, db_value, db_match, db_inferred):
  pipl_person_data = incident.addRow("pipl_person_data")
  pipl_person_data.pipl_timestamp = db_timestamp
  pipl_person_data.pipl_artifact_value = db_artifact_value
  pipl_person_data.pipl_possible_match_no = db_match_no
  pipl_person_data.pipl_property = db_property
  pipl_person_data.pipl_value = db_value
  pipl_person_data.pipl_match = db_match
  pipl_person_data.pipl_inferred = db_inferred

if results.get("success"):

  # Create a datatable from pipl response
  possible_person_counter = 0
  for person in results.get("person_list", []):
    
    # generate result_id and timestamp
    possible_person_counter += 1
    now = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    
    # 0-1. The level of confidence we have that this is the person youâ€™re looking for.
    match = str(person.get("@match", ""))
    
    # Whether this person is made up solely from data inferred by statistical analysis from your search query. 
    # You can control inference using the minimum_probability parameter, and inference of persons using the infer_persons parameter.
    inferred = str(person.get("@inferred", ""))
    

PERSON_ATTRIBUTE_TO_NAME_MAP = {
  "names"      : "display",
  "username"   : "content",
  "phones"     : "display_international",
  "gender"     : "content",
  "dob"        : "display",
  "address"    : "display",
  "job"        : "display",
  "educations" : "display",
  "user_ids"   : "content",
  "images"     : "url",
  "urls"       : "url"}
emails = person.get("emails", [])
for email in emails:
  add_row_to_pipl_datatable(now, artifact.value, possible_person_counter, "email address", email.get("address", ""), match, inferred)
  add_row_to_pipl_datatable(now, artifact.value, possible_person_counter, "address_md5", email.get("address_md5", ""), match, inferred)
for each_attribute in PERSON_ATTRIBUTE_TO_NAME_MAP:
  for _attribute in person.get(each_attribute, []):
    if each_attribute in ["images", "url"]:
      _attribute_values = """<a href='{0}'>{0}</a>""".format(url.get(PERSON_ATTRIBUTE_TO_NAME_MAP[each_attribute], "")) if url.get(PERSON_ATTRIBUTE_TO_NAME_MAP[each_attribute], "") else ""
    else:
      _attribute_value = _attribute.get(PERSON_ATTRIBUTE_TO_NAME_MAP[each_attribute], "")
    add_row_to_pipl_datatable(now, artifact.value, possible_person_counter, each_attribute, _attribute_value, match, inferred)
      
  # Save the json result as an Note
  raw_data = results.raw_data if results.raw_data else ""
  counter = possible_person_counter if possible_person_counter > 0 else ""
  noteText = """Pipl Data API response for artifact_value {} returned {} {}: \n{}""".format(artifact.value, counter, results.pipl_response, raw_data)
  incident.addNote(noteText)
```

---

