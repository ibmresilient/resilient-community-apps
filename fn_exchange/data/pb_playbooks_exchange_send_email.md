<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v51.0.5.0.1475
-->

# Playbook - Playbooks: Exchange Send Email

### API Name
`playbooks_exchange_send_email`

### Status
`enabled`

### Activation Type
`Manual`

### Activation Conditions
`-`

### Activation Form Elements
| Input Field Label | API Name | Element Type | Tooltip | Requirement |
| ----------------- | -------- | ------------ | ------- | ----------- |
| Body | `exchange_message_body` | textarea | Text for the message body of an email to query or to send, depending on the function. | Optional |
| Email address | `exchange_email` | text | Email account that is used to perform this action. | Optional |
| Recipients | `exchange_email_recipients` | text | Comma separated list of emails addresses | Optional |
| Subject | `exchange_message_subject` | text | Text for the subject of an email to query or send depending on the function. | Optional |

### Object Type
`incident`

### Description
Sends an email to all specified recipients then makes a note with the results.


---
## Function - Exchange Send Email

### API Name
`exchange_send_email`

### Output Name
`output_exchange_send_email`

### Message Destination
`fn_exchange`

### Function-Input Script
```python
# Set inputs
inputs.exchange_email            = getattr(playbook.inputs, "exchange_email", None)
inputs.exchange_message_subject  = getattr(playbook.inputs, "exchange_message_subject", None)
inputs.exchange_email_recipients = getattr(playbook.inputs, "exchange_email_recipients", None)

if playbook.inputs.exchange_message_body and playbook.inputs.exchange_message_body.content:
  inputs.exchange_message_body = playbook.inputs.exchange_message_body.content
```

---

## Local script - Post Processing Email

### Description
Post-processing script that processes the email and adds it to the datatable

### Script Type
`Local script`

### Object Type
`incident`

### Script Content
```python
'''
Example
-------
response = {
  'recipients': ['user1@example.com', 'user2@example.com'],
  'sender': 'sender@example.com',
  'subject': 'Subject',
  'body': 'HTML Body'}
'''

# Enable to write the information from the email to the data-table
enable_write_to_datatables = True


from datetime import datetime

results = playbook.functions.results.output_exchange_send_email

content = results.get("content")
if not results.get("success"):
  text = u"Unable to send email"
  fail_reason = results.get("reason")
  if fail_reason:
    text = u"{0}:\n\tFailure reason: {1}".format(text, fail_reason)
  noteText = helper.createRichText(text)
  incident.addNote(noteText)

else:
  if enable_write_to_datatables:
    message_row = incident.addRow("exchange_email_information_dt")
    message_row.exchange_date_of_retrieval    = datetime.now().strftime('%Y/%m/%d %H:%M:%S')
    message_row.exchange_dt_recipient_email   = str(content.get('recipients'))
    message_row.exchange_dt_sender_email      = content.get('sender')
    message_row.exchange_dt_email_status      = helper.createRichText(u"""<p style= "color:{color}">{status} </p>""".format(
                                                    color="#228B22", status="SENT"))
    message_row.exchange_dt_message_subject   = content.get("msg_subject", "-")
    message_row.exchange_dt_count_attachments = 0

  else:
    text  =  "<b>Exchange email:</b><br />"
    text += f"<br />From: {content.get('sender')}"
    text += f"<br />Recipients: {content.get('recipients')}"
    text += f"<br />Subject: {content.get('msg_subject')}"
    text += f"<br />Body: {content.get('msg_body')}"
    noteText = helper.createRichText(text)
    incident.addNote(noteText)

```

---

