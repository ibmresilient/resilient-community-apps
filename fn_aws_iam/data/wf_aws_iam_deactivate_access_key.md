<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-circuits codegen
-->

# Example: AWS IAM: Deactivate Access Key

## Function - AWS IAM: Update Access Key

### API Name
`fn_aws_iam_update_access_key`

### Output Name
`None`

### Message Destination
`fn_aws_iam`

### Pre-Processing Script
```python
inputs.aws_iam_access_key_id = row.AccessKeyId
inputs.aws_iam_user_name = row.UserName
inputs.aws_iam_status = "Inactive"
```

### Post-Processing Script
```python
##  AWS IAM - fn_aws_iam_update_access_key script ##
# Example result:
"""
OK
Result: {'inputs': {u'aws_iam_user_name': u'iam_test_user', u'aws_iam_access_key_id': u'AKIA4EQBBG2YGLNUPO64', u'aws_iam_status': u'Inactive'},
         'metrics': {'package': 'fn-aws-iam', 'timestamp': '2020-02-19 12:53:48', 'package_version': '1.0.0',
                     'host': 'myhost.ibm.com', 'version': '1.0', 'execution_time_ms': 3023},
         'success': True,
         'content': 'OK',
         'raw': '"OK"',
         'reason': None,
         'version': '1.0'
}
"""
#  Globals
# List of fields in datatable for fn_aws_iam_delete_access_keys  script
DATA_TBL_FIELDS = ["AccessKeyIds"]
FN_NAME = "fn_aws_iam_update_access_key"
WF_NAME = "Deactivate Access Key"
# Processing
CONTENT = results.content
INPUTS = results.inputs

def main():
    note_text = u''
    if CONTENT:
        if CONTENT == "OK":
            note_text = u"AWS IAM Integration: Workflow <b>{0}</b>: The Access Key Id <b>{1}</b> was deactivated " \
                        u"for user <b>{2}</b> for Resilient function <b>{3}</b>."\
                .format(WF_NAME, INPUTS["aws_iam_access_key_id"], INPUTS["aws_iam_user_name"],  FN_NAME)
            row.Status = "Inactive"
        elif CONTENT == u"NoSuchEntity":
            note_text = u"AWS IAM Integration: Workflow <b>{0}</b>: The Access Key Id <b>{1}</b> Not found " \
                        u"for user <b>{2}</b> for Resilient function <b>{3}</b>."\
                .format(WF_NAME, INPUTS["aws_iam_access_key_id"], INPUTS["aws_iam_user_name"],  FN_NAME)
            row.Status = "NoSuchEntity"
    else:
        note_text += u"AWS IAM Integration: Workflow <b>{0}</b>: There were no results returned for " \
                     u"access key id <b>{1}</b> access key  Resilient function <b>{2}</b>."\
            .format(WF_NAME, INPUTS["aws_iam_access_keys"], FN_NAME)

    incident.addNote(helper.createRichText(note_text))
if __name__ == "__main__":
    main()

```

---

