<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-circuits codegen
-->

# Example: AWS IAM: Delete User

## Function - AWS IAM: List Users

### API Name
`fn_aws_iam_list_users`

### Output Name
``

### Message Destination
`fn_aws_iam`

### Pre-Processing Script
```python
inputs.aws_iam_user_name = row.UserName
```

### Post-Processing Script
```python
##  AWS IAM - fn_aws_iam_list_users script ##
# Example result:
"""
Result: {
            'version': '1.0', 'success': True, 'reason': None,
            'content': [{'Path': '/', 'UserName': 'iam_test_User', 'UserId': 'AIDA4EQBBG2YDOLTU6QSM',
                         'Arn': 'arn:aws:iam::123456789123:user/iam_test_User', 'CreateDate': '2019-11-05 15:54:43'},
                        {'Path': '/', 'UserName': 'iam_test_User_2', 'UserId': 'AIDA4EQBBG2YGZOQXT2JB',
                         'Arn': 'arn:aws:iam::123456789123:user/iam_test_User_2',
                         'CreateDate': '2019-10-31 16:23:07', 'PasswordLastUsed': '2019-11-12 10:55:42'}
                       ],
            'raw': '[{"Path": "/", "UserName": "iam_test_User", "UserId": "AIDA4EQBBG2YDOLTU6QSM", "Arn": "arn:aws:iam::834299573936:user/iam_test_User", "CreateDate": "2019-11-05 15:54:43"}, 
            {"Path": "/", "UserName": "iam_test_User_2", "UserId": "AIDA4EQBBG2YGZOQXT2JB", "Arn": "arn:aws:iam::834299573936:user/iam_test_User_2", "CreateDate": "2019-10-31 16:23:07"}]',
            'inputs': {},
            'metrics': {'version': '1.0', 'package': 'fn-aws-iam', 'package_version': '1.0.0',
                        'host': 'myhost.ibm.com', 'execution_time_ms': 7951,
                        'timestamp': '2019-11-14 13:48:30'
                       }
}

"""
import re
#  Globals
# List of fields in datatable fn_aws_iam_list_users script
DATA_TBL_FIELDS = ["UserName", "LoginProfileExists"]
FN_NAME = "fn_aws_iam_list_users"
WF_NAME = "Delete User"
# Processing
INPUTS = results.inputs
CONTENT = results.content
QUERY_EXECUTION_DATE = results["metrics"]["timestamp"]
note_text = ''

def main():
    note_text = ''
    if CONTENT:
        if isinstance(CONTENT, dict) and CONTENT.get("Status") == "NoSuchEntity":
            note_text += "AWS IAM Integration: Workflow <b>{0}</b>: The user <b>{1}</b> was not found for Resilient " \
                         "function <b>{2}</b>."\
                .format(WF_NAME, INPUTS["aws_iam_user_name"], FN_NAME)
            row.Status = "Deleted"
        elif len(CONTENT) == 1:
            note_text = "AWS IAM Integration: Workflow <b>{0}</b>: The user <b>{1}</b> was found " \
                        "for Resilient function <b>{2}</b>."\
                .format(WF_NAME, INPUTS["aws_iam_user_name"], FN_NAME)
            workflow.addProperty("user_exists", {})
            u = CONTENT.pop()
            if u["LoginProfileExists"] is not None and u["LoginProfileExists"].lower() == "yes":
                 workflow.addProperty("has_login_profile", {})
            if u["DefaultUser"] is not None and u["DefaultUser"].lower() == "yes":
                workflow.addProperty("is_default_user", {})
                note_text += "<br>This is the default user and therefore will not be deleted.</br>"
        else:
            note_text = "AWS IAM Integration: : Workflow <b>{0}</b>: Too many results <b>{1}</b> returned for user <b>{2}</b> for " \
                        "Resilient function <b>{3}</b>.".format(WF_NAME, len(CONTENT), INPUTS["aws_iam_user_name"], FN_NAME)
            row.LoginProfileExists = "No"
    else:
        note_text += "AWS IAM Integration: Workflow <b>{0}</b>: There were <b>no</b> results returned for user <b>{1}</b> " \
                     "for Resilient function <b>{2}</b>.".format(WF_NAME, INPUTS["aws_iam_user_name"], FN_NAME)
    
    incident.addNote(helper.createRichText(note_text))
if __name__ == "__main__":
    main()
```

---

## Function - AWS IAM: Delete Login Profile

### API Name
`fn_aws_iam_delete_login_profile`

### Output Name
``

### Message Destination
`fn_aws_iam`

### Pre-Processing Script
```python
inputs.aws_iam_user_name = row.UserName
```

### Post-Processing Script
```python
##  AWS IAM - fn_aws_iam_delete_login_profile script ##
# Example result:
"""
OK
Result: {
         'version': '1.0', 'success': True, 'reason': None,
         'content': 'NoSuchEntity', 'raw': '"NoSuchEntity"',
         'inputs': {'aws_iam_user_name': 'iam_test_User'},
         'metrics': {'version': '1.0', 'package': 'fn-aws-iam', 'package_version': '1.0.0',
                     'host': 'myhost.ie.ibm.com', 'execution_time_ms': 9170, 'timestamp': '2019-11-18 16:24:17'
                     }
}
NosuchEntity
Result: {
         'version': '1.0', 'success': True, 'reason': None,
         'content': 'OK', 'raw': '"OK"',
         'inputs': {'aws_iam_user_name': 'iam_test_User'},
         'metrics': {'version': '1.0', 'package': 'fn-aws-iam', 'package_version': '1.0.0',
                     'host': 'myhost.ie.ibm.com', 'execution_time_ms': 9170, 'timestamp': '2019-11-18 16:24:17'
                     }
}
"""
#  Globals
# List of fields in datatable fn_aws_iam_delete_login_profile  script
DATA_TBL_FIELDS = ["LoginProfileExists"]
FN_NAME = "fn_aws_iam_delete_login_profile"
WF_NAME = "Delete User"
# Processing
CONTENT = results.content
INPUTS = results.inputs
QUERY_EXECUTION_DATE = results["metrics"]["timestamp"]
DEBUG_SCRIPT=False

def main():
    note_text = ''
    if CONTENT:
        if CONTENT == "OK":
            note_text = "AWS IAM Integration: Workflow <b>{0}</b>: Login profile deleted for user <b>{1}</b> for " \
                        "Resilient function <b>{2}</b>.".format(WF_NAME, INPUTS["aws_iam_user_name"], FN_NAME)
            row.LoginProfileExists = "No"
        elif CONTENT == "NoSuchEntity":
            note_text = "AWS IAM Integration: : Workflow <b>{0}</b>: Login profile does not exist for user <b>{1}</b> for " \
                        "Resilient function <b>{2}</b>.".format(WF_NAME, INPUTS["aws_iam_user_name"], FN_NAME)
            row.LoginProfileExists = "No"

    else:
        note_text += "AWS IAM Integration: Workflow <b>{0}</b>: There was no result returned for Resilient function <b>{0}</b>."\
            .format(WF_NAME, FN_NAME)
    if DEBUG_SCRIPT:
        incident.addNote(helper.createRichText(note_text))

if __name__ == "__main__":
    main()
```

---

## Function - AWS IAM: List User Access Key IDs

### API Name
`fn_aws_iam_list_user_access_key_ids`

### Output Name
`list_user_access_keys_results`

### Message Destination
`fn_aws_iam`

### Pre-Processing Script
```python
inputs.aws_iam_user_name = row.UserName
```

### Post-Processing Script
```python
##  AWS IAM - fn_aws_iam_list_user_access_keys script ##
# Example result:
"""
Result: {
          'version': '1.0', 'success': True, 'reason': None,
          'content': [{'UserName': 'iam_test_User', 'AccessKeyId': 'AKIA4EQBBG2YKXYJB55L',
                       'Status': 'Active', 'CreateDate': '2019-11-12 11:09:38'
                       }],
          'raw': '[{"UserName": "iam_test_User", "AccessKeyId": "AKIA4EQBBG2YKXYJB55L",
                  "Status": "Active", "CreateDate": "2019-11-12 11:09:38"}]',
          'inputs': {'aws_iam_user_name': 'iam_test_User'},
          'metrics': {'version': '1.0', 'package': 'fn-aws-iam', 'package_version': '1.0.0',
                      'host': 'myhost.ibm.com', 'execution_time_ms': 5365, 'timestamp': '2019-11-21 10:41:22'}}
"""
#  Globals
# List of fields in datatable fn_aws_iam_list_user_access_keys script
DATA_TBL_FIELDS = ["AccessKeyIds"]
FN_NAME = "fn_aws_iam_list_user_access_keys"
WF_NAME = "Delete User"
# Processing
CONTENT = results.content
INPUTS = results.inputs
DEBUG_SCRIPT=False

def main():
    note_text = ''
    if CONTENT:
        note_text = "AWS IAM Integration: Workflow <b>{0}</b>: There was <b>{1}</b> 'Access key' result(s) returned for user " \
                    "<b>{2}</b> for Resilient function <b>{3}</b>."\
            .format(WF_NAME, len(CONTENT), INPUTS["aws_iam_user_name"], FN_NAME)
        access_key_ids = []
        for ak in CONTENT:
            if ak["AccessKeyId"] is not None:
                workflow.addProperty("has_access_keys", {})
                break
    else:
        note_text = "AWS IAM Integration: Workflow <b>{0}</b>: There was <b>no</b> 'Access key' result(s) returned for " \
                    "user <b>{1}</b> for Resilient function <b>{2}</b>."\
            .format(WF_NAME, INPUTS["aws_iam_user_name"], FN_NAME)
    if DEBUG_SCRIPT:
        incident.addNote(helper.createRichText(note_text))

if __name__ == "__main__":
    main()
```

---

## Function - AWS IAM: Delete Access Keys

### API Name
`fn_aws_iam_delete_access_keys`

### Output Name
``

### Message Destination
`fn_aws_iam`

### Pre-Processing Script
```python
inputs.aws_iam_user_name = row.UserName
content = workflow.properties.list_user_access_keys_results.content
access_key_ids = []
for ak_id in content:
    if ak_id["AccessKeyId"] is not None:
        access_key_ids.append(ak_id["AccessKeyId"])
inputs.aws_iam_access_keys = ",".join(access_key_ids)
```

### Post-Processing Script
```python
##  AWS IAM - fn_aws_iam_delete_access_keys script ##
# Example result:
"""
OK
Result: {
          'version': '1.0', 'success': True, 'reason': None,
          'content': [{'AccessKeyId': 'AKIA4EQBBG2YKXYJB55L', 'Status': 'OK'},
                      {'AccessKeyId': 'AKIA4EQBBG2YKXYJB55M', 'Status': 'NoSuchEntity'}],
          'raw': '[{"AccessKeyId": "AKIA4EQBBG2YKXYJB55L", "Status": "OK"},
                  {"AccessKeyId": "AKIA4EQBBG2YKXYJB55M", "Status": "NoSuchEntity"}]',
          'inputs': {'aws_iam_user_name': 'iam_johnpren_test_User', 'aws_iam_access_keys': 'AKIA4EQBBG2YKXYJB55L,AKIA4EQBBG2YKXYJB55M'},
          'metrics': {'version': '1.0', 'package': 'fn-aws-iam', 'package_version': '1.0.0',
                      'host': 'myhost.ibm.com', 'execution_time_ms': 37199, 'timestamp': '2019-11-21 14:31:13'
                     }
}
"""
#  Globals
# List of fields in datatable for fn_aws_iam_delete_access_keys  script
DATA_TBL_FIELDS = ["AccessKeyIds"]
FN_NAME = "fn_aws_iam_delete_access_keys"
WF_NAME = "Delete User"
# Processing
CONTENT = results.content
INPUTS = results.inputs
QUERY_EXECUTION_DATE = results["metrics"]["timestamp"]
DEBUG_SCRIPT=False

def main():
    note_text = ''
    deleted = 0
    no_such_entity = 0
    deleted_keys = []
    no_such_entity_keys = []
    if CONTENT:
        for ak_status in CONTENT:
            if ak_status["Status"] == "OK":
                deleted += 1
                deleted_keys.append(ak_status["AccessKeyId"])
            else:
                no_such_entity += 1
                no_such_entity_keys.append(ak_status["AccessKeyId"])
        if deleted_keys:
            note_text = "AWS IAM Integration: Workflow <b>{0}</b>: There were <b>{1}</b> Access Key Ids <b>{2}</b> deleted " \
                        "for user <b>{3}</b> for Resilient function <b>{4}</b>."\
                .format(WF_NAME, len(deleted_keys), deleted_keys, INPUTS["aws_iam_user_name"], FN_NAME)
        if no_such_entity:
            note_text = "AWS IAM Integration: : Workflow <b>{0}</b>: There were <b>{1}</b> Access Key Ids <b>{2}</b> " \
                        "which did not exist for user <b>{3}</b> for Resilient function <b>{4}</b>."\
                .format(WF_NAME, len(no_such_entity_keys), no_such_entity_keys, INPUTS["aws_iam_user_name"], FN_NAME)
        row.AccessKeyIds = ""
    else:
        note_text += "AWS IAM Integration: Workflow <b>{0}</b>: There was no result returned for Resilient function <b>{0}</b>."\
            .format(WF_NAME, FN_NAME)
    if DEBUG_SCRIPT:
        incident.addNote(helper.createRichText(note_text))

if __name__ == "__main__":
    main()

```

---

## Function - AWS IAM: List User Policies

### API Name
`fn_aws_iam_list_user_policies`

### Output Name
`list_user_policies_results`

### Message Destination
`fn_aws_iam`

### Pre-Processing Script
```python
inputs.aws_iam_user_name = row.UserName
```

### Post-Processing Script
```python
##  AWS IAM - fn_aws_iam_list_user_groups script ##
# Example result:
"""
Result: {
          'version': '1.0', 'success': True, 'reason': None,
          'content': [{'PolicyName': 'test_pol'},
                      {'PolicyName': 'test_pol_2',
                       'PolicyArn': 'arn:aws:iam::834299573936:policy/test_pol_2'},
                      {'PolicyName': 'AmazonRoute53ReadOnlyAccess',
                       'PolicyArn': 'arn:aws:iam::aws:policy/AmazonRoute53ReadOnlyAccess'}],
          'raw': '[{"PolicyName": "test_pol"}, {"PolicyName": "test_pol_2",
                    "PolicyArn": "arn:aws:iam::834299573936:policy/test_pol_2"},
                    {"PolicyName": "AmazonRoute53ReadOnlyAccess",
                    "PolicyArn": "arn:aws:iam::aws:policy/AmazonRoute53ReadOnlyAccess"}]',
          'inputs': {'aws_iam_user_name': 'iam_test_User'},
          'metrics': {'version': '1.0', 'package': 'fn-aws-iam', 'package_version': '1.0.0',
                      'host': 'myhost.ibm.com', 'execution_time_ms': 87423, 'timestamp': '2019-11-21 11:55:29'
                     }
}
"""
#  Globals
# List of fields in datatable fn_aws_iam_list_user_groups script
DATA_TBL_FIELDS = ["Policies"]
FN_NAME = "fn_aws_iam_list_user_policies"
WF_NAME = "Delete User"
# Processing
CONTENT = results.content
INPUTS = results.inputs
DEBUG_SCRIPT=False

def main():
    note_text = ''
    if CONTENT:
        note_text = "AWS IAM Integration: Workflow <b>{0}</b>: There was <b>{1}</b> 'Policy name' result(s) returned for user " \
                    "<b>{2}</b> for Resilient function <b>{3}</b>."\
            .format(WF_NAME, len(CONTENT), INPUTS["aws_iam_user_name"], FN_NAME)
        policy_names = []
        for pol in CONTENT:
            if pol["PolicyName"] is not None:
                workflow.addProperty("has_policies", {})
                break
    else:
        note_text = "AWS IAM Integration: Workflow <b>{0}</b>: There was <b>no</b> 'Policy name' result(s) returned for " \
                    "user <b>{1}</b> for Resilient function <b>{2}</b>."\
            .format(WF_NAME, INPUTS["aws_iam_user_name"], FN_NAME)
    if DEBUG_SCRIPT:
        incident.addNote(helper.createRichText(note_text))
    
if __name__ == "__main__":
    main()
```

---

## Function - AWS IAM: Detach User policies

### API Name
`fn_aws_iam_detach_user_policies`

### Output Name
`None`

### Message Destination
`fn_aws_iam`

### Pre-Processing Script
```python
inputs.aws_iam_user_name = row.UserName
content = workflow.properties.list_user_policies_results.content
policy_names = []
for pol in content:
    if pol["PolicyName"] is not None:
        policy_names.append(pol["PolicyName"])
inputs.aws_iam_policy_names = ",".join(policy_names)

```

### Post-Processing Script
```python
##  AWS IAM - fn_aws_iam_detach_user_policies script ##
# Example result:
"""
OK
Result: {
          'version': '1.0', 'success': True, 'reason': None,
          'content': [{'PolicyName': 'AWSDenyAll', 'Status': 'OK'}
                      {'PolicyName': 'AWSDenyAll_2', 'Status': 'NoSuchEntity'}],
          'raw': '[{'PolicyName': "AWSDenyAll", 'Status": 'OK'},
                  {'PolicyName': 'AWSDenyAll_2', 'Status': 'NoSuchEntity'}]',
          'inputs': {'aws_iam_arns': 'arn:aws:iam::aws:policy/AWSDenyAll', 'aws_iam_user_name': 'iam_test_User_1'},
          'metrics': {'version': '1.0', 'package': 'fn-aws-iam', 'package_version': '1.0.0', 'host': 'myhost.ibm.com',
                      'execution_time_ms': 790, 'timestamp': '2019-11-29 12:18:30'
                     }
}
"""
#  Globals
# List of fields in datatable for fn_aws_iam_detach_user_policies  script
DATA_TBL_FIELDS = ["Policies"]
FN_NAME = "fn_aws_iam_detach_user_policies"
WF_NAME = "Example: AWS IAM: Delete User"
# Processing
CONTENT = results.content
INPUTS = results.inputs
QUERY_EXECUTION_DATE = results["metrics"]["timestamp"]
DEBUG_SCRIPT = False

def main():
    note_text = ''
    detached = 0
    no_such_entity = 0
    detached_policies = []
    no_such_entity_policies = []
    if CONTENT:
        for pol_stat in CONTENT:
            if pol_stat["Status"] == "OK":
                detached += 1
                detached_policies.append(pol_stat["PolicyName"])
            else:
                no_such_entity += 1
                no_such_entity_policies.append(pol_stat["PolicyName"])
        if detached_policies:
            note_text = "AWS IAM Integration: Workflow <b>{0}</b>: There were <b>{1}</b> Policies <b>{2}</b> detached " \
                        "for user <b>{3}</b> for Resilient function <b>{4}</b>."\
                .format(WF_NAME, len(detached_policies), ", ".join(str(i) for i in detached_policies), INPUTS["aws_iam_user_name"], FN_NAME)
        if no_such_entity:
            note_text = "AWS IAM Integration: : Workflow <b>{0}</b>: There were <b>{1}</b> Policies <b>{2}</b> " \
                        "which did not exist for user <b>{3}</b> for Resilient function <b>{4}</b>."\
                .format(WF_NAME, len(no_such_entity_policies), ", ".join(str(i) for i in no_such_entity_policies), INPUTS["aws_iam_user_name"], FN_NAME)
    else:
        note_text += "AWS IAM Integration: Workflow <b>{0}</b>: There was no result returned for Resilient function <b>{0}</b>."\
            .format(WF_NAME, FN_NAME)
    if DEBUG_SCRIPT:
        incident.addNote(helper.createRichText(note_text))

if __name__ == "__main__":
    main()

```

---

## Function - AWS IAM: List User Groups

### API Name
`fn_aws_iam_list_user_groups`

### Output Name
`list_user_groups_results`

### Message Destination
`fn_aws_iam`

### Pre-Processing Script
```python
inputs.aws_iam_user_name = row.UserName
```

### Post-Processing Script
```python
##  AWS IAM - fn_aws_iam_list_user_groups script ##
# Example result:
"""
Result: {
         'version': '1.0', 'success': True, 'reason': None,
         'content': [{'Path': '/', 'GroupName': 'system-admins', 'GroupId': 'AGPAJUCG3BHM64OGVGCBG',
                      'Arn': 'arn:aws:iam::834299573936:group/system-admins', 'CreateDate': '2017-05-29 20:37:53'}],
                      'raw': '[{"Path": "/", "GroupName": "system-admins", "GroupId": "AGPAJUCG3BHM64OGVGCBG",
                      "Arn": "arn:aws:iam::834299573936:group/system-admins", "CreateDate": "2017-05-29 20:37:53"
                      }
                    ]',
         'inputs': {'aws_iam_user_name': 'iam_test_User'},
         'metrics': {'version': '1.0', 'package': 'fn-aws-iam', 'package_version': '1.0.0', 'host': 'myhost.ibm.com',
                     'execution_time_ms': 1070, 'timestamp': '2019-11-18 10:19:19'
                     }
}
"""
#  Globals
# List of fields in datatable fn_aws_iam_list_user_groups script
DATA_TBL_FIELDS = ["Groups"]
FN_NAME = "fn_aws_iam_list_user_groups"
WF_NAME = "Delete User"
# Processing
CONTENT = results.content
INPUTS = results.inputs
QUERY_EXECUTION_DATE = results["metrics"]["timestamp"]
DEBUG_SCRIPT=False

def main():
    note_text = ''
    if CONTENT:
        note_text = "AWS IAM Integration: Workflow <b>{0}</b>: There was <b>{1}</b> 'Group' result(s) returned for user " \
                    "<b>{2}</b> for Resilient function <b>{3}</b>."\
            .format(WF_NAME, len(CONTENT), INPUTS["aws_iam_user_name"], FN_NAME)
        groups = []
        for grp in CONTENT:
            if grp["GroupName"]:
                workflow.addProperty("is_group_member", {})
                break
    else:
        note_text = "AWS IAM Integration: Workflow <b>{0}</b>: There was <b>no</b> 'Group' result(s) returned for " \
                    "user <b>{1}</b> for Resilient function <b>{2}</b>."\
            .format(WF_NAME, INPUTS["aws_iam_user_name"], FN_NAME)
    if DEBUG_SCRIPT:
        incident.addNote(helper.createRichText(note_text))
if __name__ == "__main__":
    main()
```

---

## Function - AWS IAM: Remove User From Groups

### API Name
`fn_aws_iam_remove_user_from_groups`

### Output Name
`None`

### Message Destination
`fn_aws_iam`

### Pre-Processing Script
```python
inputs.aws_iam_user_name = row.UserName
content = workflow.properties.list_user_groups_results.content
groups = []
for grp in content:
    if grp["GroupName"] is not None:
        groups.append(grp["GroupName"])
inputs.aws_iam_group_names = ",".join(groups)
```

### Post-Processing Script
```python
##  AWS IAM - fn_aws_iam_detach_user_policies script ##
# Example result:
"""
OK
Result: {
          'version': '1.0', 'success': True, 'reason': None,
          'content': [{'PolicyArn': 'arn:aws:iam::aws:policy/AWSDenyAll', 'Status': 'OK'}
                      {'PolicyArn': 'arn:aws:iam::aws:policy/AWSDenyAll_2', 'Status': 'NoSuchEntity'}],
          'raw': '[{'PolicyArn': "arn:aws:iam::aws:policy/AWSDenyAll", 'Status": 'OK'},
                  {'PolicyArn': 'arn:aws:iam::aws:policy/AWSDenyAll_2', 'Status': 'NoSuchEntity'}]',
          'inputs': {'aws_iam_arns': 'arn:aws:iam::aws:policy/AWSDenyAll', 'aws_iam_user_name': 'iam_test_User_1'},
          'metrics': {'version': '1.0', 'package': 'fn-aws-iam', 'package_version': '1.0.0', 'host': 'myhost.ibm.com',
                      'execution_time_ms': 790, 'timestamp': '2019-11-29 12:18:30'
                     }
}
"""
#  Globals
# List of fields in datatable for fn_aws_iam_detach_user_policies  script
DATA_TBL_FIELDS = ["Policies"]
FN_NAME = "fn_aws_iam_remove_user_from_groups"
WF_NAME = "Delete User"
# Processing
CONTENT = results.content
INPUTS = results.inputs
QUERY_EXECUTION_DATE = results["metrics"]["timestamp"]
DEBUG_SCRIPT = False

def main():
    note_text = ''
    deleted = 0
    no_such_entity = 0
    deleted_groups = []
    no_such_entity_groups = []
    if CONTENT:
        for grp_stat in CONTENT:
            if grp_stat["Status"] == "OK":
                deleted += 1
                deleted_groups.append(grp_stat["GroupName"])
            else:
                no_such_entity += 1
                no_such_entity_groups.append(grp_stat["GroupName"])
        if deleted_groups:
            note_text = "AWS IAM Integration: Workflow <b>{0}</b>: There were <b>{1}</b> Groups <b>{2}</b> removed " \
                        "for user <b>{3}</b> for Resilient function <b>{4}</b>."\
                .format(WF_NAME, len(deleted_groups), ", ".join(str(i) for i in deleted_groups), INPUTS["aws_iam_user_name"], FN_NAME)
        if no_such_entity:
            note_text = "AWS IAM Integration: : Workflow <b>{0}</b>: There were <b>{1}</b> Groups <b>{2}</b> " \
                        "which did not exist for user <b>{3}</b> for Resilient function <b>{4}</b>."\
                .format(WF_NAME, len(no_such_entity_groups), ", ".join(str(i) for i in no_such_entity_groups), INPUTS["aws_iam_user_name"], FN_NAME)
        row.Groups = ''
    else:
        note_text += "AWS IAM Integration: Workflow <b>{0}</b>: There was no result returned for Resilient function <b>{0}</b>."\
            .format(WF_NAME, FN_NAME)
    if DEBUG_SCRIPT:
        incident.addNote(helper.createRichText(note_text))
if __name__ == "__main__":
    main()

```

---

## Function - AWS IAM: List SSH Public Keys

### API Name
`fn_aws_iam_list_ssh_keys`

### Output Name
`list_ssh_keys_results`

### Message Destination
`fn_aws_iam`

### Pre-Processing Script
```python
inputs.aws_iam_user_name = row.UserName
```

### Post-Processing Script
```python
##  AWS IAM - fn_aws_iam_list_ssh_public_keys script ##
# Example result:
"""
Result: {
          'version': '1.0', 'success': True, 'reason': None, 
          'content': [{'UserName': 'iam_test_user', 'SSHPublicKeyId': 'APKA4EQBBG2YCGOGDY5G', 
                       'Status': 'Active', 'UploadDate': '2020-02-25 11:05:17'
                      }
                     ], 
          'raw': '[{"UserName": "iam_test_user_10", "SSHPublicKeyId": "APKA4EQBBG2YCGOGDY5G", 
                  "Status": "Active", "UploadDate": "2020-02-25 11:05:17"}]', 
          'inputs': {'aws_iam_user_name': 'iam_test_user'}, 
          'metrics': {'version': '1.0', 'package': 'fn-aws-iam', 'package_version': '1.0.0', 'host': 'myhost.ibm.com', 
                      'execution_time_ms': 657, 'timestamp': '2020-02-25 16:11:28'
                     }
}
"""
#  Globals
# List of fields in datatable fn_aws_iam_list_ssh_public_keys script
DATA_TBL_FIELDS = ["SSHPublicKeyIds"]
FN_NAME = "fn_aws_iam_list_ssh_public_keys"
WF_NAME = "Delete User"
# Processing
CONTENT = results.content
INPUTS = results.inputs
DEBUG_SCRIPT=False

def main():
    note_text = ''
    if CONTENT:
        note_text = "AWS IAM Integration: Workflow <b>{0}</b>: There were <b>{1}</b> 'SSH Public keys' returned for user " \
                    "<b>{2}</b> for Resilient function <b>{3}</b>."\
            .format(WF_NAME, len(CONTENT), INPUTS["aws_iam_user_name"], FN_NAME)
        access_key_ids = []
        for sshk_id in CONTENT:
            if sshk_id["SSHPublicKeyId"] is not None:
                workflow.addProperty("has_ssh_public_keys", {})
                break
    else:
        note_text = "AWS IAM Integration: Workflow <b>{0}</b>: There was <b>no</b> 'SSH Public keys' result(s) returned for " \
                    "user <b>{1}</b> for Resilient function <b>{2}</b>."\
            .format(WF_NAME, INPUTS["aws_iam_user_name"], FN_NAME)
    if DEBUG_SCRIPT:
        incident.addNote(helper.createRichText(note_text))

if __name__ == "__main__":
    main()
```

---

## Function - AWS IAM: Delete SSH Public Keys

### API Name
`fn_aws_iam_delete_ssh_keys`

### Output Name
`None`

### Message Destination
`fn_aws_iam`

### Pre-Processing Script
```python
inputs.aws_iam_user_name = row.UserName
content = workflow.properties.list_ssh_keys_results.content
ssh_key_ids = []
for ssh_key_id in content:
    if ssh_key_id["SSHPublicKeyId"] is not None:
        ssh_key_ids.append(ssh_key_id["SSHPublicKeyId"])
inputs.aws_iam_ssh_key_ids = ",".join(ssh_key_ids)


```

### Post-Processing Script
```python
##  AWS IAM - fn_aws_iam_delete_ssh_keys script ##
# Example result:
"""
OK
Result: {
          'version': '1.0', 'success': True, 'reason': None,
          'content': [{'SSHPublicKeyId': 'APKA4EQBBG2YCGOGDY5G', 'Status': 'OK'}
                      {'SSHPublicKeyId': 'APKA4EQBBG2YCGOGDY5G', 'Status': 'NoSuchEntity'}],
          'raw': '[{'SSHPublicKeyId': "APKA4EQBBG2YCGOGDY5G", 'Status": 'OK'},
                  {'SSHPublicKeyId': 'APKA4EQBBG2YCGOGDY5G', 'Status': 'NoSuchEntity'}]',
          'inputs': {'aws_iam_ssh_keys_ids': 'APKA4EQBBG2YCGOGDY5G', 'aws_iam_user_name': 'iam_test_User'},
          'metrics': {'version': '1.0', 'package': 'fn-aws-iam', 'package_version': '1.0.0', 'host': 'myhost.ibm.com',
                      'execution_time_ms': 790, 'timestamp': '2019-11-29 12:18:30'
                     }
}
"""
#  Globals
# List of fields in datatable for fn_aws_iam_delete_ssh_keys  script
DATA_TBL_FIELDS = ["Policies"]
FN_NAME = "fn_aws_iam_delete_ssh_keys"
WF_NAME = "Delete User"
# Processing
CONTENT = results.content
INPUTS = results.inputs
QUERY_EXECUTION_DATE = results["metrics"]["timestamp"]
DEBUG_SCRIPT = False

def main():
    note_text = ''
    deleted = 0
    no_such_entity = 0
    deleted_keys = []
    no_such_entity_keys = []
    if CONTENT:
        for grp_stat in CONTENT:
            if grp_stat["Status"] == "OK":
                deleted += 1
                deleted_keys.append(grp_stat["GroupName"])
            else:
                no_such_entity += 1
                no_such_entity_keys.append(grp_stat["GroupName"])
        if deleted_keys:
            note_text = "AWS IAM Integration: Workflow <b>{0}</b>: There were <b>{1}</b> 'SSH Public keys' <b>{2}</b> removed " \
                        "for user <b>{3}</b> for Resilient function <b>{4}</b>."\
                .format(WF_NAME, len(deleted_keys), ", ".join(str(i) for i in deleted_keys), INPUTS["aws_iam_user_name"], FN_NAME)
        if no_such_entity:
            note_text = "AWS IAM Integration: : Workflow <b>{0}</b>: There were <b>{1}</b> 'SSH Public keys' <b>{2}</b> " \
                        "which did not exist for user <b>{3}</b> for Resilient function <b>{4}</b>."\
                .format(WF_NAME, len(no_such_entity_keys), ", ".join(str(i) for i in no_such_entity_keys), INPUTS["aws_iam_user_name"], FN_NAME)
    else:
        note_text += "AWS IAM Integration: Workflow <b>{0}</b>: There was no result returned for Resilient function <b>{0}</b>."\
            .format(WF_NAME, FN_NAME)
    if DEBUG_SCRIPT:
        incident.addNote(helper.createRichText(note_text))
if __name__ == "__main__":
    main()

```

---

## Function - AWS IAM: List Service Specific Credentials

### API Name
`fn_aws_iam_list_ss_creds`

### Output Name
`list_srv_specific_creds_results`

### Message Destination
`fn_aws_iam`

### Pre-Processing Script
```python
inputs.aws_iam_user_name = row.UserName
```

### Post-Processing Script
```python
##  AWS IAM - fn_aws_iam_list_service_specific_credentials script ##
# Example result:
"""
Result: {'version': '1.0', 'success': True, 'reason': None, 
         'content': [{'UserName': 'iam_test_user', 'Status': 'Active', 'ServiceUserName': 'iam_test_user-at-834299573936', 
                      'CreateDate': '2020-02-25 10:43:24', 'ServiceSpecificCredentialId': 'ACCA4EQBBG2YH6NR76SCQ', 
                      'ServiceName': 'codecommit.amazonaws.com'
                     },
                     {'UserName': 'iam_test_user', 'Status': 'Active', 'ServiceUserName': 'iam_test_user_10-at-834299573936',
                      'CreateDate': '2020-02-26 11:50:52', 'ServiceSpecificCredentialId': 'ACCA4EQBBG2YGOLHZWY7L', 
                      'ServiceName': 'cassandra.amazonaws.com'}], 
         'raw': '[{"UserName": "iam_test_user", "Status": "Active", "ServiceUserName": "iam_test_user_10-at-834299573936", 
                   "CreateDate": "2020-02-25 10:43:24", "ServiceSpecificCredentialId": "ACCA4EQBBG2YH6NR76SCQ", "ServiceName": "codecommit.amazonaws.com"}, 
                   {"UserName": "iam_test_user_10", "Status": "Active", "ServiceUserName": "iam_test_user_10-at-834299573936", 
                   "CreateDate": "2020-02-26 11:50:52", "ServiceSpecificCredentialId": "ACCA4EQBBG2YGOLHZWY7L", "ServiceName": "cassandra.amazonaws.com"}]', 
         'inputs': {'aws_iam_user_name': 'iam_test_user'}, 
         'metrics': {'version': '1.0', 'package': 'fn-aws-iam', 'package_version': '1.0.0', 'host': 'myhost.ibm.com', 
                     'execution_time_ms': 982, 'timestamp': '2020-02-26 11:56:51'
                    }
}
"""
#  Globals
# List of fields in datatable fn_aws_iam_list_service_specific_credentials script
DATA_TBL_FIELDS = ["ServiceSpecificCredentialIds"]
FN_NAME = "fn_aws_iam_list_service_specific_credentials"
WF_NAME = "Delete User"
# Processing
CONTENT = results.content
INPUTS = results.inputs
DEBUG_SCRIPT = False

def main():
    note_text = ''
    if CONTENT:
        note_text = "AWS IAM Integration: Workflow <b>{0}</b>: There were <b>{1}</b> 'Service specific credentials' returned for user " \
                    "<b>{2}</b> for Resilient function <b>{3}</b>."\
            .format(WF_NAME, len(CONTENT), INPUTS["aws_iam_user_name"], FN_NAME)
        for ssc_id in CONTENT:
            if ssc_id["ServiceSpecificCredentialId"] is not None:
                workflow.addProperty("has_srv_creds", {})
                break
    else:
        note_text = "AWS IAM Integration: Workflow <b>{0}</b>: There was <b>no</b> 'Service specific credentials' result(s) returned for " \
                    "user <b>{1}</b> for Resilient function <b>{2}</b>."\
            .format(WF_NAME, INPUTS["aws_iam_user_name"], FN_NAME)
    if DEBUG_SCRIPT:
        incident.addNote(helper.createRichText(note_text))

if __name__ == "__main__":
    main()
```

---

## Function - AWS IAM: Delete Service Specific Credentials

### API Name
`fn_aws_iam_delete_ss_creds`

### Output Name
`None`

### Message Destination
`fn_aws_iam`

### Pre-Processing Script
```python
inputs.aws_iam_user_name = row.UserName
content = workflow.properties.list_srv_specific_creds_results.content
srv_specific_cred_ids = []
for ssc_id in content:
    if ssc_id["ServiceSpecificCredentialId"] is not None:
        srv_specific_cred_ids.append(ssc_id["ServiceSpecificCredentialId"])
inputs.aws_iam_ssc_ids = ",".join(srv_specific_cred_ids)
```

### Post-Processing Script
```python
##  AWS IAM - fn_aws_iam_delete_ss_creds script ##
# Example result:
"""
OK
Result: {
          'version': '1.0', 'success': True, 'reason': None,
          'content': [{'ServiceSpecificCredentialId': 'ACCA4EQBBG2YH6NR76SCQ', 'Status': 'OK'}
                      {'ServiceSpecificCredentialId': 'ACCA4EQBBG2YH6NR76SCQ', 'Status': 'NoSuchEntity'}],
          'raw': '[{'ServiceSpecificCredentialId: "ACCA4EQBBG2YH6NR76SCQ", 'Status": 'OK'},
                  {'ServiceSpecificCredentialId': 'ACCA4EQBBG2YH6NR76SCQ', 'Status': 'NoSuchEntity'}]',
          'inputs': {'aws_iam_ssc_ids': 'ACCA4EQBBG2YH6NR76SCQ', 'aws_iam_user_name': 'iam_test_User'},
          'metrics': {'version': '1.0', 'package': 'fn-aws-iam', 'package_version': '1.0.0', 'host': 'myhost.ibm.com',
                      'execution_time_ms': 790, 'timestamp': '2019-11-29 12:18:30'
                     }
}
"""
#  Globals
# List of fields in datatable for fn_aws_iam_delete_ss_creds  script
DATA_TBL_FIELDS = ["Policies"]
FN_NAME = "fn_aws_iam_delete_ss_creds"
WF_NAME = "Delete User"
# Processing
CONTENT = results.content
INPUTS = results.inputs
QUERY_EXECUTION_DATE = results["metrics"]["timestamp"]
DEBUG_SCRIPT = False

def main():
    note_text = ''
    deleted = 0
    no_such_entity = 0
    deleted_creds = []
    no_such_entity_creds = []
    if CONTENT:
        for grp_stat in CONTENT:
            if grp_stat["Status"] == "OK":
                deleted += 1
                deleted_creds.append(grp_stat["GroupName"])
            else:
                no_such_entity += 1
                no_such_entity_creds.append(grp_stat["GroupName"])
        if deleted_creds:
            note_text = "AWS IAM Integration: Workflow <b>{0}</b>: There were <b>{1}</b> 'Service specific credentials' <b>{2}</b> removed " \
                        "for user <b>{3}</b> for Resilient function <b>{4}</b>."\
                .format(WF_NAME, len(deleted_creds), ", ".join(str(i) for i in deleted_creds), INPUTS["aws_iam_user_name"], FN_NAME)
        if no_such_entity:
            note_text = "AWS IAM Integration: : Workflow <b>{0}</b>: There were <b>{1}</b> 'Service specific credentials' <b>{2}</b> " \
                        "which did not exist for user <b>{3}</b> for Resilient function <b>{4}</b>."\
                .format(WF_NAME, len(no_such_entity_creds), ", ".join(str(i) for i in no_such_entity_creds), INPUTS["aws_iam_user_name"], FN_NAME)
    else:
        note_text += "AWS IAM Integration: Workflow <b>{0}</b>: There was no result returned for Resilient function <b>{0}</b>."\
            .format(WF_NAME, FN_NAME)
    if DEBUG_SCRIPT:
        incident.addNote(helper.createRichText(note_text))
if __name__ == "__main__":
    main()

```

---

## Function - AWS IAM: List Signing Certificates

### API Name
`fn_aws_iam_list_signing_certs`

### Output Name
`list_signing_certs_results`

### Message Destination
`fn_aws_iam`

### Pre-Processing Script
```python
inputs.aws_iam_user_name = row.UserName
```

### Post-Processing Script
```python
##  AWS IAM - fn_aws_iam_list_signing_certificates script ##
# Example result:
"""
Result: {'version': '1.0', 'success': True, 'reason': None, 
         'content': [{'UserName': 'iam_test_user', 'CertificateId': 'WM6U3NNR5JH3AOTNJY44CUI6I6EYXTLD', 
                      'CertificateBody': '-----BEGIN CERTIFICATE-----\nMIID...Apg=\n-----END CERTIFICATE-----', 
                      'Status': 'Active', 'UploadDate': '2020-02-26 12:25:27'}], 
         'raw': '[{"UserName": "iam_test_user", "CertificateId": "WM6U3NNR5JH3AOTNJY44CUI6I6EYXTLD", "CertificateBody": 
                 "-----BEGIN CERTIFICATE-----\\nMIID...Apg=\\n-----END CERTIFICATE-----", "Status": "Active", "UploadDate": "2020-02-26 12:25:27"}]', 
         'inputs': {'aws_iam_user_name': 'iam_test_user'}, 
         'metrics': {'version': '1.0', 'package': 'fn-aws-iam', 'package_version': '1.0.0', 'host': 'myhost.ibm.com', 'execution_time_ms': 729, 'timestamp': '2020-02-26 12:33:57'
        }
}
"""
#  Globals
# List of fields in datatable fn_aws_iam_list_signing_certificates script
DATA_TBL_FIELDS = ["CertificateIds"]
FN_NAME = "fn_aws_iam_list_signing_certificates"
WF_NAME = "Delete User"
# Processing
CONTENT = results.content
INPUTS = results.inputs
DEBUG_SCRIPT=False

def main():
    note_text = ''
    if CONTENT:
        note_text = "AWS IAM Integration: Workflow <b>{0}</b>: There were <b>{1}</b> 'Signing Certificates' returned for user " \
                    "<b>{2}</b> for Resilient function <b>{3}</b>."\
            .format(WF_NAME, len(CONTENT), INPUTS["aws_iam_user_name"], FN_NAME)
        for scert_id in CONTENT:
            if scert_id["CertificateId"] is not None:
                workflow.addProperty("has_sign_certs", {})
                break
    else:
        note_text = "AWS IAM Integration: Workflow <b>{0}</b>: There was <b>no</b> 'Signing Certificates' result(s) returned for " \
                    "user <b>{1}</b> for Resilient function <b>{2}</b>."\
            .format(WF_NAME, INPUTS["aws_iam_user_name"], FN_NAME)
    if DEBUG_SCRIPT:
        incident.addNote(helper.createRichText(note_text))

if __name__ == "__main__":
    main()
```

---

## Function - AWS IAM: Delete Signing Certificates

### API Name
`fn_aws_iam_delete_signing_certs`

### Output Name
`None`

### Message Destination
`fn_aws_iam`

### Pre-Processing Script
```python
inputs.aws_iam_user_name = row.UserName
content = workflow.properties.list_signing_certs_results.content
sign_cert_ids = []
for scert_id in content:
    if scert_id["CertificateId"] is not None:
        sign_cert_ids.append(scert_id["CertificateId"])
inputs.aws_iam_sign_cert_ids = ",".join(sign_cert_ids)
```

### Post-Processing Script
```python
##  AWS IAM - fn_aws_iam_list_signing_certs script ##
# Example result:
"""
OK
Result: {
          'version': '1.0', 'success': True, 'reason': None,
          'content': [{'CertificateId': 'WM6U3NNR5JH3AOTNJY44CUI6I6EYXTLD', 'Status': 'OK'},
                      {'CertificateId': 'WM6U3NNR5JH3AOTNJY44CUI6I6EYXTLD', 'Status': 'NoSuchEntity'}],
          'raw': '[{'CertificateId: "WM6U3NNR5JH3AOTNJY44CUI6I6EYXTLD", 'Status": 'OK'},
                  {'CertificateId': 'WM6U3NNR5JH3AOTNJY44CUI6I6EYXTLD', 'Status': 'NoSuchEntity'}]',
          'inputs': {'aws_iam_sign_cert_ids': 'WM6U3NNR5JH3AOTNJY44CUI6I6EYXTLD', 'aws_iam_user_name': 'iam_test_User'},
          'metrics': {'version': '1.0', 'package': 'fn-aws-iam', 'package_version': '1.0.0', 'host': 'myhost.ibm.com',
                      'execution_time_ms': 790, 'timestamp': '2019-11-29 12:18:30'
                     }
}
"""
#  Globals
# List of fields in datatable for fn_aws_iam_list_signing_certs  script
DATA_TBL_FIELDS = ["Policies"]
FN_NAME = "fn_aws_iam_list_signing_certs"
WF_NAME = "Delete User"
# Processing
CONTENT = results.content
INPUTS = results.inputs
QUERY_EXECUTION_DATE = results["metrics"]["timestamp"]
DEBUG_SCRIPT = False

def main():
    note_text = ''
    deleted = 0
    no_such_entity = 0
    deleted_certs = []
    no_such_entity_certs = []
    if CONTENT:
        for grp_stat in CONTENT:
            if grp_stat["Status"] == "OK":
                deleted += 1
                deleted_certs.append(grp_stat["GroupName"])
            else:
                no_such_entity += 1
                no_such_entity_certs.append(grp_stat["GroupName"])
        if deleted_certs:
            note_text = "AWS IAM Integration: Workflow <b>{0}</b>: There were <b>{1}</b> 'Signing Certificates' <b>{2}</b> removed " \
                        "for user <b>{3}</b> for Resilient function <b>{4}</b>."\
                .format(WF_NAME, len(deleted_certs), ", ".join(str(i) for i in deleted_certs), INPUTS["aws_iam_user_name"], FN_NAME)
        if no_such_entity:
            note_text = "AWS IAM Integration: Workflow <b>{0}</b>: There were <b>{1}</b> 'Signing Certificates' <b>{2}</b> " \
                        "which did not exist for user <b>{3}</b> for Resilient function <b>{4}</b>."\
                .format(WF_NAME, len(no_such_entity_certs), ", ".join(str(i) for i in no_such_entity_certs), INPUTS["aws_iam_user_name"], FN_NAME)
    else:
        note_text += "AWS IAM Integration: Workflow <b>{0}</b>: There was no result returned for Resilient function <b>{0}</b>."\
            .format(WF_NAME, FN_NAME)
    if DEBUG_SCRIPT:
        incident.addNote(helper.createRichText(note_text))
if __name__ == "__main__":
    main()

```

---

## Function - AWS IAM: List MFA Devices

### API Name
`fn_aws_iam_list_mfa_devices`

### Output Name
`list_mfa_devices_results`

### Message Destination
`fn_aws_iam`

### Pre-Processing Script
```python
inputs.aws_iam_user_name = row.UserName
```

### Post-Processing Script
```python
##  AWS IAM - fn_aws_iam_list_mfa_devices script ##
# Example result:
"""
Result: {'version': '1.0', 'success': True, 'reason': None, 
         'content': [{'UserName': 'iam_test_user', 'SerialNumber': 'arn:aws:iam::834299573936:mfa/iam_test_user', 
                      'EnableDate': '2020-02-26 16:55:05', 'is_virtual': True}], 
         'raw': '[{"UserName": "iam_test_user_10", "SerialNumber": "arn:aws:iam::834299573936:mfa/iam_test_user_10", 
                 "EnableDate": "2020-02-26 16:55:05", 'is_virtual': True}]', 
         'inputs': {'aws_iam_user_name': 'iam_test_user_10'}, 
         'metrics': {'version': '1.0', 'package': 'fn-aws-iam', 'package_version': '1.0.0', 'host': 'myhost.ie.ibm.com', 
                     'execution_time_ms': 5644, 'timestamp': '2020-02-26 17:37:48'
                    }
}
"""
#  Globals
# List of fields in datatable fn_aws_iam_list_mfa_devices script
DATA_TBL_FIELDS = ["SerialNumbers"]
FN_NAME = "fn_aws_iam_list_mfa_devices"
WF_NAME = "Delete User"
# Processing
CONTENT = results.content
INPUTS = results.inputs
DEBUG_SCRIPT=False

def main():
    note_text = ''
    if CONTENT:
        note_text = "AWS IAM Integration: Workflow <b>{0}</b>: There were <b>{1}</b> 'Active NFA devices' returned for user " \
                    "<b>{2}</b> for Resilient function <b>{3}</b>."\
            .format(WF_NAME, len(CONTENT), INPUTS["aws_iam_user_name"], FN_NAME)
        for mfa_ser_num in CONTENT:
            if mfa_ser_num["SerialNumber"] is not None:
                workflow.addProperty("has_active_mfa", {})
            if mfa_ser_num.get("is_virtual", None):
                workflow.addProperty("is_virtual_mfa", {})
    else:
        note_text = "AWS IAM Integration: Workflow <b>{0}</b>: There was <b>no</b> 'Active NFA devices' result(s) returned for " \
                    "user <b>{1}</b> for Resilient function <b>{2}</b>."\
            .format(WF_NAME, INPUTS["aws_iam_user_name"], FN_NAME)
    if DEBUG_SCRIPT:
        incident.addNote(helper.createRichText(note_text))

if __name__ == "__main__":
    main()
```

---

## Function - AWS IAM: Deactivate MFA Devices

### API Name
`fn_aws_iam_deactivate_mfa_devices`

### Output Name
`None`

### Message Destination
`fn_aws_iam`

### Pre-Processing Script
```python
inputs.aws_iam_user_name = row.UserName
content = workflow.properties.list_mfa_devices_results.content
mfa_serial_nums = []
for mfa_ser_num in content:
    if mfa_ser_num["SerialNumber"] is not None:
        mfa_serial_nums.append(mfa_ser_num["SerialNumber"])
inputs.aws_iam_mfa_serial_nums = ",".join(mfa_serial_nums)
```

### Post-Processing Script
```python
##  AWS IAM - fn_aws_iam_deactivate_mfa_devices script ##
# Example result:
"""
OK
Result: {
          'version': '1.0', 'success': True, 'reason': None,
          'content': [{'SerialNumber': 'arn:aws:iam::834299573936:mfa/iam_test_user', 'Status': 'OK'}
                      {'SerialNumber': 'arn:aws:iam::834299573936:mfa/iam_test_user', 'Status': 'NoSuchEntity'}],
          'raw': '[{'SerialNumber: "arn:aws:iam::834299573936:mfa/iam_test_user", 'Status": 'OK'},
                  {'SerialNumber': 'arn:aws:iam::834299573936:mfa/iam_test_user', 'Status': 'NoSuchEntity'}]',
          'inputs': {'aws_iam_mfa_serial_nums': 'arn:aws:iam::834299573936:mfa/iam_test_user', 'aws_iam_user_name': 'iam_test_User'},
          'metrics': {'version': '1.0', 'package': 'fn-aws-iam', 'package_version': '1.0.0', 'host': 'myhost.ibm.com',
                      'execution_time_ms': 790, 'timestamp': '2019-11-29 12:18:30'
                     }
}
"""
#  Globals
# List of fields in datatable for fn_aws_iam_deactivate_mfa_devices  script
DATA_TBL_FIELDS = ["Policies"]
FN_NAME = "fn_aws_iam_deactivate_mfa_devices"
WF_NAME = "Delete User"
# Processing
CONTENT = results.content
INPUTS = results.inputs
QUERY_EXECUTION_DATE = results["metrics"]["timestamp"]
DEBUG_SCRIPT = False

def main():
    note_text = ''
    deactivated = 0
    no_such_entity = 0
    deactivated_mfas = []
    no_such_entity_mfas = []
    if CONTENT:
        for grp_stat in CONTENT:
            if grp_stat["Status"] == "OK":
                deactivated += 1
                deactivated_mfas.append(grp_stat["GroupName"])
            else:
                no_such_entity += 1
                no_such_entity_mfas.append(grp_stat["GroupName"])
        if deactivated_mfas:
            note_text = "AWS IAM Integration: Workflow <b>{0}</b>: There were <b>{1}</b> 'MFA devices' <b>{2}</b> de-activated " \
                        "for user <b>{3}</b> for Resilient function <b>{4}</b>."\
                .format(WF_NAME, len(deactivated_mfas), ", ".join(str(i) for i in deactivated_mfas), INPUTS["aws_iam_user_name"], FN_NAME)
        if no_such_entity:
            note_text = "AWS IAM Integration: : Workflow <b>{0}</b>: There were <b>{1}</b> 'MFA devices' <b>{2}</b> " \
                        "which did not exist for user <b>{3}</b> for Resilient function <b>{4}</b>."\
                .format(WF_NAME, len(no_such_entity_mfas), ", ".join(str(i) for i in no_such_entity_mfas), INPUTS["aws_iam_user_name"], FN_NAME)
    else:
        note_text += "AWS IAM Integration: Workflow <b>{0}</b>: There was no result returned for Resilient function <b>{0}</b>."\
            .format(WF_NAME, FN_NAME)
    if DEBUG_SCRIPT:
        incident.addNote(helper.createRichText(note_text))
if __name__ == "__main__":
    main()

```

---

## Function - AWS IAM: Delete Virtual MFA Devices

### API Name
`fn_aws_iam_delete_mfa_devices`

### Output Name
`None`

### Message Destination
`fn_aws_iam`

### Pre-Processing Script
```python
content = workflow.properties.list_mfa_devices_results.content
mfa_serial_nums = []
for mfa_ser_num in content:
    if mfa_ser_num["SerialNumber"] is not None and mfa_ser_num.get("is_virtual", None):
        mfa_serial_nums.append(mfa_ser_num["SerialNumber"])
inputs.aws_iam_mfa_serial_nums = ",".join(mfa_serial_nums)

```

### Post-Processing Script
```python
##  AWS IAM - fn_aws_iam_delete_mfa_devices script ##
# Example result:
"""
OK
Result: {
          'version': '1.0', 'success': True, 'reason': None,
          'content': [{'SerialNumber': 'arn:aws:iam::834299573936:mfa/iam_test_user', 'Status': 'OK'}
                      {'SerialNumber': 'arn:aws:iam::834299573936:mfa/iam_test_user', 'Status': 'NoSuchEntity'}],
          'raw': '[{'SerialNumber: "arn:aws:iam::834299573936:mfa/iam_test_user", 'Status": 'OK'},
                  {'SerialNumber': 'arn:aws:iam::834299573936:mfa/iam_test_user', 'Status': 'NoSuchEntity'}]',
          'inputs': {'aws_iam_mfa_serial_nums': 'arn:aws:iam::834299573936:mfa/iam_test_user', 'aws_iam_user_name': 'iam_test_User'},
          'metrics': {'version': '1.0', 'package': 'fn-aws-iam', 'package_version': '1.0.0', 'host': 'myhost.ibm.com',
                      'execution_time_ms': 790, 'timestamp': '2019-11-29 12:18:30'
                     }
}
"""
#  Globals
# List of fields in datatable for fn_aws_iam_delete_mfa_devices  script
DATA_TBL_FIELDS = ["Policies"]
FN_NAME = "fn_aws_iam_delete_mfa_devices"
WF_NAME = "Delete User"
# Processing
CONTENT = results.content
INPUTS = results.inputs
QUERY_EXECUTION_DATE = results["metrics"]["timestamp"]
DEBUG_SCRIPT = False

def main():
    note_text = ''
    deleted = 0
    no_such_entity = 0
    deleted_mfas = []
    no_such_entity_mfas = []
    if CONTENT:
        for grp_stat in CONTENT:
            if grp_stat["Status"] == "OK":
                deleted += 1
                deleted_mfas.append(grp_stat["GroupName"])
            else:
                no_such_entity += 1
                no_such_entity_mfas.append(grp_stat["GroupName"])
        if deleted_mfas:
            note_text = "AWS IAM Integration: Workflow <b>{0}</b>: There were <b>{1}</b> 'MFA devices' <b>{2}</b> deleted" \
                        "for user <b>{3}</b> for Resilient function <b>{4}</b>."\
                .format(WF_NAME, len(deleted_mfas), ", ".join(str(i) for i in deleted_mfas), INPUTS["aws_iam_user_name"], FN_NAME)
        if no_such_entity:
            note_text = "AWS IAM Integration: : Workflow <b>{0}</b>: There were <b>{1}</b> 'MFA devices' <b>{2}</b> " \
                        "which did not exist for user <b>{3}</b> for Resilient function <b>{4}</b>."\
                .format(WF_NAME, len(no_such_entity_mfas), ", ".join(str(i) for i in no_such_entity_mfas), INPUTS["aws_iam_user_name"], FN_NAME)
    else:
        note_text += "AWS IAM Integration: Workflow <b>{0}</b>: There was no result returned for Resilient function <b>{0}</b>."\
            .format(WF_NAME, FN_NAME)
    if DEBUG_SCRIPT:
        incident.addNote(helper.createRichText(note_text))
if __name__ == "__main__":
    main()

```

---

## Function - AWS IAM: Delete User

### API Name
`fn_aws_iam_delete_user`

### Output Name
`None`

### Message Destination
`fn_aws_iam`

### Pre-Processing Script
```python
inputs.aws_iam_user_name = row.UserName
```

### Post-Processing Script
```python
##  AWS IAM - fn_aws_iam_delete_access_keys script ##
# Example result:
"""
OK
Result: { 'version': '1.0', 'success': True, 'reason': None, 
          'content': 'OK', 
          'raw': '"OK"', 
          'inputs': {'aws_iam_user_name': 'iam_test_user'}, 
          'metrics': {'version': '1.0', 'package': 'fn-aws-iam', 'package_version': '1.0.0', 'host': 'myhost.ibm.com', 
                      'execution_time_ms': 689, 'timestamp': '2020-01-15 10:27:48'
                     }
}
"""
#  Globals
# List of fields in datatable for fn_aws_iam_delete_user  script
DATA_TBL_FIELDS = ["Status"]
FN_NAME = "fn_aws_iam_delete_user"
WF_NAME = "Delete User"
# Processing
CONTENT = results.content
INPUTS = results.inputs
EXECUTION_DATE = results["metrics"]["timestamp"]

def main():
    note_text = ''
    if CONTENT:
        if CONTENT == "OK":
            note_text = "AWS IAM Integration: : Workflow <b>{0}</b>: User <b>{1}</b> was successfully deleted for " \
                        "Resilient function <b>{2}</b>.".format(WF_NAME, INPUTS["aws_iam_user_name"], FN_NAME)
            row.Status = "Deleted"
            row.Tags = ""
            row.query_execution_date = EXECUTION_DATE
        else:
            note_text = "AWS IAM Integration: : Workflow <b>{0}</b>: Unexpected delete status <b>{1}</b> for delete" \
                        " user operation <b>{2}</b> for Resilient function <b>{3}</b>."\
                .format(WF_NAME, CONTENT, INPUTS["aws_iam_user_name"], FN_NAME)
    else:
        note_text += "AWS IAM Integration: Workflow <b>{0}</b>: There was no result returned for Resilient function <b>{0}</b>."\
            .format(WF_NAME, FN_NAME)

    incident.addNote(helper.createRichText(note_text))
if __name__ == "__main__":
    main()
```

---

