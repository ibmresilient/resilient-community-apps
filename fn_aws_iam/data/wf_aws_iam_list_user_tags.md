<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-circuits codegen
-->

# Example: AWS IAM: List User Tags


## Function - AWS IAM: List User Tags

### API Name
`fn_aws_iam_list_user_tags`

### Output Name
`None`

### Message Destination
`fn_aws_iam`

### Pre-Processing Script
```python
inputs.aws_iam_user_name = row.UserName
```

### Post-Processing Script
```python
##  AWS IAM - fn_aws_iam_list_user_tags script ##
# Example result:
"""
Result: {
          'version': '1.0', 'success': True, 'reason': None,
          'content': [{'Key': 'Test_tag1', 'Value': 'A test TAG'},
                      {'Key': 'Tes Tag2', 'Value': 'Another test tag'}],
          'raw': '[{"Key": "Test_tag1", "Value": "A test TAG"}, {"Key": "Tes Tag2", "Value": "Another test tag"}]',
          'inputs': {'aws_iam_user_name': 'iam_johnpren_test_User'},
          'metrics': {'version': '1.0', 'package': 'fn-aws-iam', 'package_version': '1.0.0', 'host': 'myhost.ie.ibm.com',
                      'execution_time_ms': 1009, 'timestamp': '2019-11-18 12:19:06'
                     }
}
"""
import re
#  Globals
# List of fields in datatable fn_aws_iam_list_user_tags script
DATA_TBL_FIELDS = ["Tags"]
FN_NAME = "fn_aws_iam_list_user_tags"
WF_NAME = "List User Tags"
# Processing
CONTENT = results.content
INPUTS = results.inputs
QUERY_EXECUTION_DATE = results["metrics"]["timestamp"]
note_text = ''

def check_add_quotes(tag_name):
    # Using regex
    # If spaces in tag name add quotes
    if re.search(r"\s", tag_name):
        return "'"+tag_name+"'"
    else:
        return tag_name

def main():
    note_text = ''
    if CONTENT is not None:
        note_text = "AWS IAM Integration: Workflow <b>{0}</b>: There was <b>{1}</b> 'Tag' result(s) returned for user " \
                    "<b>{2}</b> for Resilient function <b>{3}</b>"\
            .format(WF_NAME, len(CONTENT), INPUTS["aws_iam_user_name"], FN_NAME)
        tags = []
        for i in range(len(CONTENT)):
            if CONTENT[i]["Key"] is not None:
                tags.append(CONTENT[i]["Key"])
        row.Tags = ','.join(check_add_quotes(t) for t in tags)
    else:
        note_text = "AWS IAM Integration: Workflow <b>{0}</b>: There was <b>no</b> 'Tag' result(s) returned for " \
                    "user <b>{1}</b> for Resilient function <b>{2}</b>"\
            .format(WF_NAME, INPUTS["aws_iam_user_name"], FN_NAME)

    incident.addNote(helper.createRichText(note_text))
if __name__ == "__main__":
    main()
```

---

