<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-circuits codegen
-->

# Example: AWS IAM: Add User To Group

## Function - AWS IAM: Add User To Groups

### API Name
`fn_aws_iam_add_user_to_groups`

### Output Name
`None`

### Message Destination
`fn_aws_iam`

### Pre-Processing Script
```python
inputs.aws_iam_user_name = row.UserName
inputs.aws_iam_group_names = rule.properties.aws_iam_group
```

### Post-Processing Script
```python
##  AWS IAM - fn_aws_iam_add_user_to_groups script ##
# Example result:
"""
Result: {'version': '1.0', 'success': True, 'reason': None, 
         'content': [{'GroupName': 'denyall_group', 'Status': 'OK'}], 
         'raw': '[{"GroupName": "denyall_group", "Status": "OK"}]', 
         'inputs': {'aws_iam_user_name': 'iam_test_user_1', 'aws_iam_group_names': 'denyall_group'}, 
         'metrics': {'version': '1.0', 'package': 'fn-aws-iam', 'package_version': '1.0.0', 
                     'host': 'myhost.ibm.com', 'execution_time_ms': 4303, 'timestamp': '2020-03-16 15:43:17'
           
        }
}
"""
#  Globals
# List of fields in datatable for fn_aws_iam_add_user_to_groups  script
DATA_TBL_FIELDS = ["Groups"]
FN_NAME = "fn_aws_iam_add_user_to_groups"
WF_NAME = "Add User To Group"
# Processing
CONTENT = results.content
INPUTS = results.inputs
QUERY_EXECUTION_DATE = results["metrics"]["timestamp"]
note_text = ''

def main():
    note_text = ''
    added = 0
    no_such_entity = 0
    added_groups = []
    no_such_entity_groups = []
    if CONTENT:
        for grp_stat in CONTENT:
            if grp_stat["Status"] == "OK":
                added += 1
                added_groups.append(grp_stat["GroupName"])
            else:
                no_such_entity += 1
                no_such_entity_groups.append(grp_stat["GroupName"])
        if added_groups:
            note_text = "AWS IAM Integration: Workflow <b>{0}</b>: User <b>{1}</b> added to group <b>{2}</b> " \
                        "for Resilient function <b>{3}</b>."\
                .format(WF_NAME, INPUTS["aws_iam_user_name"], ", ".join(str(i) for i in added_groups), FN_NAME)
            note_text += "<br>Refreshing data table <b>{0}</b> row for user <b>{1}</b> with updated group data."\
                .format("AWS IAM Users", INPUTS["aws_iam_user_name"])
        if no_such_entity:
            note_text = "AWS IAM Integration: : Workflow <b>{0}</b>: The group(s) <b>{1}</b> " \
                        "did not exist for user <b>{2}</b> for Resilient function <b>{3}</b>."\
                .format(WF_NAME, ", ".join(str(i) for i in no_such_entity_groups), INPUTS["aws_iam_user_name"], FN_NAME)
    else:
        note_text += "AWS IAM Integration: Workflow <b>{0}</b>: There was no result returned for Resilient function <b>{0}</b>."\
            .format(WF_NAME, FN_NAME)

    incident.addNote(helper.createRichText(note_text))
if __name__ == "__main__":
    main()

```

---

## Function - AWS IAM: List User Groups

### API Name
`fn_aws_iam_list_user_groups`

### Output Name
`None`

### Message Destination
`fn_aws_iam`

### Pre-Processing Script
```python
inputs.aws_iam_user_name = row.UserName
```

### Post-Processing Script
```python
##  AWS IAM - fn_aws_iam_list_user_groups script ##
# Example result:
"""
Result: {'version': '1.0', 'success': True, 'reason': None, 
         'content': [{'Path': '/', 'GroupName': 'null_group', 'GroupId': 'AGPA4EQBBG2YAVPJATCNZ', 
                      'Arn': 'arn:aws:iam::834299573936:group/null_group', 'CreateDate': '2019-12-04 12:31:47'}, 
                      {'Path': '/', 'GroupName': 'denyall_group', 'GroupId': 'AGPA4EQBBG2YPUAIHTA3E', 
                       'Arn': 'arn:aws:iam::834299573936:group/denyall_group', 'CreateDate': '2019-11-29 15:49:34'}, 
                      {'Path': '/', 'GroupName': 'myS3group', 'GroupId': 'AGPAIH4V2XCXOME6HWCPQ', 
                      'Arn': 'arn:aws:iam::834299573936:group/myS3group', 'CreateDate': '2017-05-29 20:41:50'}], 
          'raw': '[{"Path": "/", "GroupName": "null_group", "GroupId": "AGPA4EQBBG2YAVPJATCNZ", 
                 "Arn": "arn:aws:iam::834299573936:group/null_group", "CreateDate": "2019-12-04 12:31:47"}, 
                 "Path": "/", "GroupName": "denyall_group", "GroupId": "AGPA4EQBBG2YPUAIHTA3E", 
                 "Arn": "arn:aws:iam::834299573936:group/denyall_group", "CreateDate": "2019-11-29 15:49:34"}, 
                 {"Path": "/", "GroupName": "myS3group", "GroupId": "AGPAIH4V2XCXOME6HWCPQ", 
                 "Arn": "arn:aws:iam::834299573936:group/myS3group", "CreateDate": "2017-05-29 20:41:50"}]', 
         'inputs': {'aws_iam_user_name': 'iam_test_user_1'}, 
         'metrics': {'version': '1.0', 'package': 'fn-aws-iam', 'package_version': '1.0.0', 'host': 'myhost.ie.ibm.com', 
                     'execution_time_ms': 944, 'timestamp': '2020-03-16 15:43:21'
                    }
}
"""
#  Globals
# List of fields in datatable fn_aws_iam_list_user_groups script
DATA_TBL_FIELDS = ["Groups"]
FN_NAME = "fn_aws_iam_list_user_groups"
WF_NAME = "Add User To Group"
# Processing
CONTENT = results.content
INPUTS = results.inputs
QUERY_EXECUTION_DATE = results["metrics"]["timestamp"]
note_text = ''

def main():
    note_text = ''
    if CONTENT:
        groups = []
        for grp in CONTENT:
            if grp["GroupName"] is not None:
                groups.append(grp["GroupName"])
        row.Groups = ",".join(groups)
    else:
        note_text = "AWS IAM Integration: Workflow <b>{0}</b>: The user <b>{1}</b> does not appear to be a member " \
                    "of any group for Resilient function <b>{2}</b>."\
            .format(WF_NAME, INPUTS["aws_iam_user_name"], FN_NAME)
        row.Groups = ""
    if note_text:
        incident.addNote(helper.createRichText(note_text))
if __name__ == "__main__":
    main()
```

---

