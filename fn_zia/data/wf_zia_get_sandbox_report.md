<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-circuits codegen
-->

# Example: ZIA: Get Sandbox Report

## Function - ZIA: Get Sandbox Report

### API Name
`funct_zia_get_sandbox_report`

### Output Name
`None`

### Message Destination
`zia`

### Pre-Processing Script
```python
inputs.zia_md5 =  artifact.value
if rule.properties.zia_report_type.lower() == "full":
    inputs.zia_full_report = True
else:
    inputs.zia_full_report = False
```

### Post-Processing Script
```python
##  ZIA - wf_zia_get_sandbox_report post processing script ##

#  Globals
FN_NAME = "funct_zia_get_sandbox_report"
WF_NAME = "Example: ZIA: Get Sandbox Report"
CONTENT = results.content
INPUTS = results.inputs
QUERY_EXECUTION_DATE = results["metrics"]["timestamp"]

SUMM_HEADERS = ["Summary", "Classification", "FileProperties"]
DATA_TBL_FIELDS = {
    "Summary": ["Status", "report_Category"],
    "Classification": ["Type", "Category", "Score", "DetectedMalware"],
    "FileProperties":  ["FileType", "FileSize", "MD5", "SHA1", "Sha256", "Issuer", "DigitalCerificate", 
                        "SSDeep", "RootCA"]
}

#Processing
def main():
    note_text = u''
    md5 = INPUTS.get("zia_md5")
    if CONTENT:
        full = CONTENT.get("Full Details")
        summary = CONTENT.get("Summary")
        if summary:
            note_text = u"ZIA Integration: Workflow <b>{0}</b>: A summary report was returned for MD5 <b>{1}</b>. " \
                        u"The data table <b>{2}</b> has been updated for SOAR function <b>{3}</b>."\
                .format(WF_NAME, md5, "Zscaler Internet Access - Sandbox Report Summary", FN_NAME)
            
            newrow = incident.addRow("zia_sandbox_report_summary")
            newrow.query_execution_date = QUERY_EXECUTION_DATE
            
            for header in SUMM_HEADERS:
                section = summary.get(header)
                for field in DATA_TBL_FIELDS[header]:
                    try:
                        f = field.split('_')[1]
                    except IndexError:
                        f = field
                    newrow[field]  = "{}".format(section[f])
        elif full:
            note_text = u"ZIA Integration: Workflow <b>{0}</b>: A full report was returned for MD5 <b>{1}</b>. " \
                        u"for SOAR function <b>{2}</b>."\
                .format(WF_NAME, md5, FN_NAME)
            note_text += "<br><b>{0}</b>".format(full)
        else:
            note_text += u"ZIA Integration: Workflow <b>{0}</b>: There was an unknown report type returned for MD5 <b>{1}</b>" \
                         u" for SOAR function <b>{2}</b>.".format(WF_NAME, md5, FN_NAME)
    else:
        note_text += u"ZIA Integration: Workflow <b>{0}</b>: There were <b>no</b> results returned for MD5 <b>{1}</b>" \
                     u" for SOAR function <b>{2}</b>."\
            .format(WF_NAME, md5, FN_NAME)

    incident.addNote(helper.createRichText(note_text))

main()


```

---

