<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-circuits codegen
-->

# ZIA: Get URL Categories.

## Function - ZIA: Get URL Categories

### API Name
`funct_zia_get_url_categories`

### Output Name
`None`

### Message Destination
`zia`

### Pre-Processing Script
```python
##  ZIA - wf_zia_get_url_categories pre processing script ##
inputs.zia_custom_only = rule.properties.zia_custom_only
inputs.zia_category_id = rule.properties.zia_category_id_input
import re

URL_FILTER = rule.properties.zia_url_filter
NAME_FILTER = rule.properties.zia_name_filter

def is_regex(regex_str):
    """"Test if sting is a correctly formed regular expression.

    :param regex_str: Regular expression string.
    :return: Boolean.
    """
    try:
        re.compile(regex_str)
        return True
    except (re.error, TypeError):
        return False


def main():
    # Test filter to ensure it is a valid regular expressions.

    if URL_FILTER and not is_regex(URL_FILTER):
        raise ValueError("The url filter '{}' is not a valid regular expression.".format(unicode(URL_FILTER)))
    
    if NAME_FILTER and not is_regex(NAME_FILTER):
        raise ValueError("The category name filter '{}' is not a valid regular expression.".format(unicode(NAME_FILTER)))
    
    inputs.zia_url_filter = URL_FILTER
    inputs.zia_name_filter = NAME_FILTER


if __name__ == "__main__":
    main()
```

### Post-Processing Script
```python
##  ZIA - wf_zia_get_url_categories post processing script ##

#  Globals
FN_NAME = "funct_zia_get_url_categories"
WF_NAME = "ZIA: Get URL Categories"
CONTENT = results.content
INPUTS = results.inputs
QUERY_EXECUTION_DATE = results["metrics"]["timestamp"]
note_text = ''
DATA_TBL_FIELDS = ["configuredName", "urls", "customCategory", "editable", "type", "customUrlsCount"]
#Processing
def main():
    note_text = u''
    if CONTENT:
        categories = CONTENT.get("categories")
        cat_counts = CONTENT.get("category_counts")
        custom_only = INPUTS.get("zia_custom_only")
        name_filter = INPUTS.get("zia_name_filter")
        url_filter = INPUTS.get("zia_url_filter")
        note_text += u"ZIA Integration: Workflow <b>{0}</b>: There were <b>{1}</b> URL categories out of a total of "\
                     u"<b>{2}</b> returned with 'custom_only' set to <b>{3}</b>, category name filter "\
                     u"<b>{4}</b> and URL filter <b>{5}</b> for SOAR function <b>{6}</b>."\
        .format(WF_NAME, cat_counts["filtered"], cat_counts["total"], custom_only, name_filter, url_filter, FN_NAME)
        if categories:
            note_text += u"<br>The data table <b>{0}</b> has been updated".format("Zscaler Internet Access - URL Categories")
        for cat in categories:
            newrow = incident.addRow("zia_url_categories")
            newrow.query_execution_date = QUERY_EXECUTION_DATE
            newrow.cat_id = cat["id"]
            for f in DATA_TBL_FIELDS:
              if cat[f] is None:
                  newrow[f]  = cat[f]
              if isinstance(cat[f], list):
                  newrow[f]  = "{}".format(", ".join(cat[f]))
              elif isinstance(cat[f], bool):
                  newrow[f]  = str(cat[f])
              else:
                  newrow[f]  = "{}".format(cat[f])
            newrow.url_filter = url_filter
            newrow.name_filter = name_filter
            
    else:
        note_text += u"ZIA Integration: Workflow <b>{0}</b>: There were <b>no</b> results returned with 'custom_only' set to " \
                     u"<b>{1}</b> configured name filter <b>{2}</b> and url filter <b>{3}</b> for SOAR function <b>{4}</b>."\
            .format(WF_NAME, custom_only, url_filter, name_filter, FN_NAME)


    incident.addNote(helper.createRichText(note_text))

main()

```

---

