<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v51.0.2.2.1096
-->

# Playbook - Cisco Umbrella Inv: DNS RR history for an ip address - Example (PB)

### API Name
`cisco_umbrella_inv_dns_rr_history_for_an_ip_address`

### Status
`enabled`

### Activation Type
`Manual`

### Activation Conditions
`artifact.type equals IP Address`

### Object Type
`artifact`

### Description
Cisco Umbrella Investigate Playbook to get the DNS RR history for an IP address of DNS type 'A'. This playbook only works with the legacy version of Cisco Umbrella Investigate.


---
## Function - umbrella_dns_rr_hist

### API Name
`umbrella_dns_rr_hist`

### Output Name
`umbrell_rr_hist_ip_result`

### Message Destination
`umbrella_investigate`

### Function-Input Script
```python
None
```

---

## Local script - umbrella dns rr hist ip output

### Description


### Script Type
`Local script`

### Object Type
`artifact`

### Script Content
```python
results = playbook.functions.results.umbrell_rr_hist_ip_result
content = results.get("content", {})
dns_rr_history_ip = content.get("dns_rr_history", {})
resource_name = content.get("resource_name", None)
over_limit = content.get("over_limit", None)
query_execution_time = content.get("query_execution_time", None)
att_name = content.get("att_name", None)

if results.get("success", None):
  if over_limit:
    noteText = f"""<br>DNS RR history for {artifact.type} <b>{resource_name}</b> has completed.
    Attachment name : <b>{att_name}</b>"""

    incident.addNote(helper.createRichText(noteText))
  else:
    if dns_rr_history_ip:
      if dns_rr_history_ip.get("features", {}):
        newrow = incident.addRow("umbinv_dns_rr_history_ip")
        newrow["ip_address"] = resource_name
        newrow.query_execution_time = query_execution_time
        newrow["response_class"] = "Features"
        feats = dns_rr_history_ip.get("features", {})
        newrow["rr_count"] = str(feats.get("rr_count"))
        newrow["ld2_count"] = str(feats.get("ld2_count"))
        newrow["ld3_count"] = str(feats.get("ld3_count"))
        newrow["ld2_1_count"] = str(feats.get("ld2_1_count"))
        newrow["ld2_2_count"] = str(feats.get("ld2_2_count"))
        newrow["div_ld2"] = str(feats.get("div_ld2"))
        newrow["div_ld3"] = str(feats.get("div_ld3"))
        newrow["div_ld2_1"] = str(feats.get("div_ld2_1"))
        newrow["div_ld2_2"] = str(feats.get("div_ld2_2"))

      if dns_rr_history_ip.get("rrs", []):
        for r in dns_rr_history_ip.get("rrs", []):
          newrow = incident.addRow("umbinv_dns_rr_history_ip")
          newrow["ip_address"] = resource_name
          newrow.query_execution_time = query_execution_time
          newrow["response_class"] = "Resource Record"
          newrow["ttl"] = str(r.get("ttl"))
          newrow["type"] = r.get("type", None)
          newrow["class"] = r.get("class", None)
          newrow["rr"] = r.get("rr", None)
          newrow["name_rrs"] = r.get("name", None)
    else:
      incident.addNote("Cisco Umbrella Inv playbook: DNS RR history for an ip address returned no results.")
else:
  incident.addNote(f"Cisco Umbrella Inv playbook: DNS RR history for an ip address\nFailed with reason: {results.get('reason', None)}")
```

---

