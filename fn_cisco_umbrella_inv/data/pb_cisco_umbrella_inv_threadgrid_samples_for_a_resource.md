<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v51.0.4.0.1351
-->

# Playbook - Cisco Umbrella Inv: ThreatGrid samples for a resource - Example (PB)

### API Name
`cisco_umbrella_inv_threadgrid_samples_for_a_resource`

### Status
`enabled`

### Activation Type
`Manual`

### Activation Conditions
`artifact.type in ['IP Address', 'DNS Name', 'URL']`

### Object Type
`artifact`

### Description
Cisco Umbrella Investigate Playbook to get the ThreatGrid samples for a domain, IP or URL


---
## Function - umbrella_threat_grid_samples

### API Name
`umbrella_threat_grid_samples`

### Output Name
`threatgrid_samples_results`

### Message Destination
`umbrella_investigate`

### Function-Input Script
```python
None
```

---

## Local script - umbrella threatgrid samples from a resource output

### Description


### Script Type
`Local script`

### Object Type
`artifact`

### Script Content
```python
results = playbook.functions.results.threatgrid_samples_results
content = results.get("content", {})
thread_grid_samples = content.get("thread_grid_samples", {})
resource_name = content.get("resource_name", None)
query_execution_time = content.get("query_execution_time", None)

if results.get("success", None):
  if thread_grid_samples and thread_grid_samples.get("totalResults", 0):
    if thread_grid_samples.get("samples", []):
      more_data_available = thread_grid_samples.get("moreDataAvailable", False)
      for s in thread_grid_samples.get("samples", []):
        newrow = incident.addRow("umbinv_thread_grid_samples_for_a_resource")
        newrow.resource_name = resource_name
        newrow.query_execution_time = query_execution_time
        newrow["magic_type"] = s.get("magicType", None)
        newrow["sha1"] = s.get("sha1", None)
        newrow["sha256"] = s.get("sha256", None)
        newrow["threat_score"] = s.get("threatScore", None)
        newrow["first_seen"] = s.get("firstSeen", None)
        newrow["last_seen"] = s.get("lastSeen", None)
        newrow["first_seen_converted"] = s.get("first_seen_converted", None)
        newrow["last_seen_converted"] = s.get("last_seen_converted", None)
        newrow["more_data_available"] = s.get("moreDataAvailable", None)
      if more_data_available and str(more_data_available).lower() == 'true':
        newrow.more_data_available = str(more_data_available)
  else:
    incident.addNote("Cisco Umbrella Inv playbook: ThreatGrid samples for a resource returned no results.")
else:
  incident.addNote(f"Cisco Umbrella Inv playbook: ThreatGrid samples for a resource\nFailed with reason: {results.get('reason', None)}")
```

---

