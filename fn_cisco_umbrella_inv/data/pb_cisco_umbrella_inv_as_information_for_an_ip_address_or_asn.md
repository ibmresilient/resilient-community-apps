<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v51.0.4.0.1351
-->

# Playbook - Cisco Umbrella Inv: AS Information for an ip address or ASN - Example (PB)

### API Name
`cisco_umbrella_inv_as_information_for_an_ip_address_or_asn`

### Status
`enabled`

### Activation Type
`Manual`

### Activation Conditions
`artifact.type in ['IP Address', 'String']`

### Object Type
`artifact`

### Description
Cisco Umbrella Investigate playbook to get AS Information for an ip address or ASN


---
## Function - umbrella_ip_as_info

### API Name
`umbrella_ip_as_info`

### Output Name
`umbrella_ip_as_info_results`

### Message Destination
`umbrella_investigate`

### Function-Input Script
```python
None
```

---

## Local script - umbrella IP as info return

### Description


### Script Type
`Local script`

### Object Type
`artifact`

### Script Content
```python
results = playbook.functions.results.umbrella_ip_as_info_results
content = results.get("content", {})
as_for_ip = content.get("as_for_ip", [])
ip_address = content.get("ip_address", None)
asn = content.get("asn", None)
prefixes_for_asn = content.get("prefixes_for_asn", [])
query_execution_time = content.get("query_execution_time", None)

def update_fields(result, ip_or_asn):
  num_row = 0
  for r in result:
    if num_row >= 100:
      break
    num_row+=1
    newrow = incident.addRow("umbinv_as_for_an_ip_or_asn")
    newrow.ip_address_or_asn = ip_or_asn
    newrow.query_execution_time = query_execution_time
    newrow["description_as"] = r.get("description", None)
    newrow["cidr"] = r.get("cidr", None)
    newrow["ir"] = r.get("ir", None)
    newrow["asn"] = r.get("asn", None)
    newrow["creation_date"] = r.get("creation_date", None)
    if r.get("geo", {}):
      newrow["country_name"] = str(r.get("geo", {}).get("country_name", None))
      newrow["country_code"] = str(r.get("geo", {}).get("country_code", None))

if results.get("success", None):
  if as_for_ip:
    update_fields(as_for_ip, ip_address)
  elif prefixes_for_asn:
    update_fields(prefixes_for_asn, asn)
  else:
    incident.addNote("Cisco Umbrella Inv playbook: AS Information for an ip address or ASN returned no results.")
else:
  incident.addNote(f"Cisco Umbrella Inv playbook: AS Information for an ip address or ASN\nFailed with reason: {results.get('reason', None)}")
```

---

