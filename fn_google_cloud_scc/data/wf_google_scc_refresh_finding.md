<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
-->

# Google SCC: Refresh Finding

## Function - Google Cloud SCC: Get Findings

### API Name
`google_scc_get_findings`

### Output Name
``

### Message Destination
`fn_google_cloud_scc`

### Pre-Processing Script
```python
finding_name = incident.properties.google_scc_name.get("content")

if finding_name:
  inputs.google_scc_filter = "name = \"{0}\"".format(finding_name)
else:
  log.fail("Could not find value for finding_name in Incident")
```

### Post-Processing Script
```python
SPAN_FORMATTER = "<span class='label' rel='tooltip' title='{0}'>{1}</span>"
LINK_FORMATTER = "<a target='_blank' href='{0}'>{1}</a>"

findings_list = results.get("content").get("findings_list", [])

if results.get("success") and len(findings_list) == 1:
  finding = findings_list[0].get("finding")
  compliance_standards = finding.get("source_properties").get("compliance_standards")
  security_marks = finding.get("security_marks").get("marks")

  incident.properties.google_scc_class = SPAN_FORMATTER.format(finding.get("finding_class"), finding.get("finding_class"))
  standards_list = [SPAN_FORMATTER.format(standard.upper(), "{0} : {1}".format(standard.upper(), compliance_standards[standard][0]['ids'][0])) for standard in compliance_standards]
  incident.properties.google_scc_compliance_standards = " ".join(standards_list)
  marks_list = [SPAN_FORMATTER.format(mark_key, "{0} : {1}".format(mark_key, security_marks.get(mark_key))) for mark_key in security_marks]
  incident.properties.google_scc_security_marks = " ".join(marks_list)
  incident.properties.google_scc_remediation_link = "<b>{0}</b><br>".format(finding.get("resource", {}).get("display_name")) + LINK_FORMATTER.format(finding.get("external_uri"), finding.get("resource", {}).get("name"))
  incident.properties.google_scc_category = SPAN_FORMATTER.format(finding.get("category"), finding.get("category"))
  incident.properties.google_scc_recommendation = finding.get("linkified_recommendation")
  incident.properties.google_scc_vulnerability = finding.get("vulnerability").get("cve")
  incident.properties.google_scc_state = finding.get("state")
  incident.properties.google_scc_next_steps = finding.get("next_steps")
  
```

---

