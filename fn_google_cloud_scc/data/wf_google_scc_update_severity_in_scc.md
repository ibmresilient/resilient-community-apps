<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
-->

# Google SCC: Update Severity in SCC

## Function - Google Cloud SCC: Update Findings

### API Name
`google_cloud_scc_update_finding`

### Output Name
`None`

### Message Destination
`fn_google_cloud_scc`

### Pre-Processing Script
```python
finding_name = incident.properties.google_scc_name.get("content")

if finding_name:
  # for this specific workflow, we want to only update the finding that
  # is associated with this incident so we pass in the finding name as the filter
  inputs.google_scc_filter = "name = \"{0}\"".format(finding_name)
  
  inputs.google_scc_update_key = "severity"
  inputs.google_scc_update_value = rule.properties.google_scc_updated_severity
else:
  raise ValueError("Could not find appropriate finding name value")
```

### Post-Processing Script
```python
SPAN_FORMATTER = "<span class='label' rel='tooltip' title='{0}'>{1}</span>"
LINK_FORMATTER = "<a target='_blank' href='{0}'>{1}</a>"

severity_mapping = {
  "CRITICAL": "High", 
  "HIGH": "High", 
  "MEDIUM": "Medium", 
  "LOW": "Low", 
  "DEFAULT": "Low"
}

if results and results.get("success"):
  findings_list = results.get("content", {}).get("findings_list", [])
  
  
  # have to iterate because this function is set up to return a list
  # to support multiple incident updates at the same time
  # but in this specific workflow we intend to just update the incident associated with
  # this incident
  for i in range(len(findings_list)):
    finding = findings_list[i].get("finding", {})
    if finding.get("name", "") == incident.properties.google_scc_name:
      security_marks = finding.get("security_marks", {}).get("marks")


      marks_list = [SPAN_FORMATTER.format(mark_key, "{0} : {1}".format(mark_key, security_marks.get(mark_key))) for mark_key in security_marks]
      incident.properties.google_scc_security_marks = " ".join(marks_list)
      incident.properties.google_scc_state = finding.get("state", "UNKNOWN")
      incident.severity_code = severity_mapping.get(finding.get("severity"), "DEFAULT")
      incident.properties.google_scc_next_steps = finding.get("next_steps")
```

---

