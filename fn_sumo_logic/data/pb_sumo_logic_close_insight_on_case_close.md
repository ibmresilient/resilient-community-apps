<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v51.0.2.2.1096
-->

# Playbook - Sumo Logic: Close Insight on Case Close

### API Name
`sumo_logic_close_insight_on_case_close`

### Status
`enabled`

### Activation Type
`Automatic`

### Activation Conditions
`incident.plan_status changed_to Closed AND incident.properties.sumo_logic_insight_id has_a_value`

### Object Type
`incident`

### Description
Automatic playbook that updates the Status and Resolution of the associated insight in Sumo Logic  when the cases is closed in SOAR.  The SOAR case resolution summary is written as a comment to the Sumo Logic insight.


---
## Function - Sumo Logic: Update Insight Status

### API Name
`sumo_logic_update_insight_status`

### Output Name
`update_insight_status_results`

### Message Destination
`fn_sumo_logic`

### Function-Input Script
```python
RESOLUTION_LOOKUP = {
  "Unresolved": "No Action",   # Unresolved
  "Duplicate": "Duplicate",    # Duplicate
  "Not an Issue": "False Positive", # Not an Issue
  "Resolved": "Resolved"      # Resolved
}

inputs.sumo_logic_insight_id = incident.properties.sumo_logic_insight_id
inputs.sumo_logic_insight_status = "Closed"
inputs.sumo_logic_insight_resolution = RESOLUTION_LOOKUP.get(incident.resolution_id, "Resolved")

```

---
## Function - Sumo Logic: Add Comment to Insight

### API Name
`sumo_logic_add_comment_to_insight`

### Output Name
`add_comment_to_insight_results`

### Message Destination
`fn_sumo_logic`

### Function-Input Script
```python
inputs.sumo_logic_insight_id = incident.properties.sumo_logic_insight_id
inputs.sumo_logic_comment_text = incident.resolution_summary.content if incident.resolution_summary.content else "Case {0} was closed in QRadar SOAR".format(incident.id)
```

---

## Local script - Sumo Logic: Write Update Status to SOAR Note

### Description
Write the results of update insight status function to a SOAR note. 

### Script Type
`Local script`

### Object Type
`incident`

### Script Content
```python
results = playbook.functions.results.update_insight_status_results

if results.get("success"):
  note_text = "<b>Sumo Logic: Update Status on Case Close:</b> Closed insight in Sumo Logic"
  incident.properties.sumo_logic_insight_status = "Closed"
  if results.get("content").get("data").get("resolution"):
      incident.properties.sumo_logic_insight_resolution = results.get("content").get("data").get("resolution")
else:
  reason = results.get("reason")
  if "has already been closed" in reason:
      note_text = f"<b>Sumo Logic: Update Status on Case Close:</b> Sumo Logic insight has already been closed."
  else:
      note_text = f"<b>Sumo Logic: Update Status on Case Close:</b> Failed function to update insight status. Reason = {reason}"
  
incident.addNote(note_text)
```

---
## Local script - Sumo Logic: Write Error Posting Comment to Insight

### Description
Write a note to SOAR case.

### Script Type
`Local script`

### Object Type
`incident`

### Script Content
```python
results = playbook.functions.results.add_comment_to_insight_results

note_text = "Sumo Logic Automatic playbook <b>On close from SOAR case</b> failed to post comment to Sumo Logic insight: {0}".format(results.get("reason", None))

incident.addNote(note_text)
```

---

