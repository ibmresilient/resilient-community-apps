<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
-->

# AbuseIPDB Check IP Address Blocklist

## Function - AbuseIPDB

### API Name
`fn_abuseipdb`

### Output Name
`None`

### Message Destination
`abuseipdb`

### Pre-Processing Script
```python
inputs.abuseipdb_artifact_type = artifact.type
inputs.abuseipdb_artifact_value = artifact.value
```

### Post-Processing Script
```python
CATEGORIES= {
  3: "Fraud Orders",
  4: "DDoS Attack",
  5: "FTP Brute-Force",
  6: "Ping of Death",
  7: "Phishing",
  8: "Fraud VoIP",
  9: "Open Proxy",
  10: "Web Spam",
  11: "Email Spam",
  12: "Blog Spam",
  13: "VPN IP",
  14: "Port Scan",
  15: "Hacking",
  16: "SQL Injection",
  17: "Spoofing",
  18: "Brute-Force",
  19: "Bad Web Bot",
  20: "Exploited Host",
  21: "Web App Attack",
  22: "SSH",
  23: "IoT Targeted",
}

if results.success:
  if results.content:
    resp_data = results.content['data']
    number_of_reports = resp_data['totalReports']
    country_name = resp_data['countryName']
    most_recent_report = resp_data['lastReportedAt']
    confidence_score = resp_data.get("abuseConfidenceScore", 0)
    
    hit = []
    
    # get clean list of de-duped categories
    categories_names = ""
    if resp_data.get('reports'):
        categories_list = []
        for report in resp_data['reports']:
            categories_list.extend(report["categories"])
        categories_set = set(categories_list)  # dedup list
        categories_names = u', '.join(CATEGORIES.get(item, 'unknown') for item in categories_set)
  
    
    # only return data if there's anything useful
    if number_of_reports or confidence_score:
      hit = [
        {
          "name": "Confidence Score",
          "type": "number",
          "value": "{}".format(confidence_score)
        }, 
        {
          "name": "Number of Reports",
          "type": "number",
          "value": "{}".format(number_of_reports)
        }, 
        {
          "name": "Country",
          "type": "string",
          "value": "{}".format(country_name)
        },
        {
          "name": "Most Recent Report",
          "type": "string",
          "value": "{}".format(most_recent_report)
        },
        {
          "name": "Categories",
          "type": "string",
          "value": "{}".format(categories_names)
        }
        ]
      artifact.addHit("AbuseIPDB Function hits added", hit)
    else:
      incident.addNote("{} has no reports or confidence score to return or is not in AbuseIPDB's database.".format(resp_data["ipAddress"]))
else:
  incident.addNote("AbuseIPDB Check IP Address Blocklist failed: {}".format(results.reason))

```

---

