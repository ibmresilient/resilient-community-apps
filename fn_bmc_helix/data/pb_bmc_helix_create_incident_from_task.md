<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v49.0.4423
-->

# Playbook - BMC Helix Create Incident from Task

### API Name
`bmc_helix_create_incident_from_task`

### Status
`enabled`

### Activation Type
`manual`

### Object Type
`task`

### Description
Create a new Incident in BMC Helix from a SOAR case Task


---
## Function - Helix: Create Incident

### API Name
`helix_create_incident`

### Output Name
`create_incident`

### Message Destination
`fn_bmc_helix`

### Function-Input Script
```python
def mk_str(value, quotes='"'):
  if value is None:
    return "null"
  else:
    esc_value = value.replace('"', '\\"')
    if quotes:
      return '{0}{1}{0}'.format(quotes, esc_value)
    else:
      return esc_value

payload = """{{ "ApplyTemplate": {},
  "First_Name": {},
  "Last_Name": {},
  "Impact": {},
  "Urgency": {},
  "Service_Type": {},
  "Status": {},
  "Reported Source": {},
  "Description": {},
  "Assigned Support Organization": {},
  "additional_data": {}
}}""".format(mk_str(playbook.inputs.bmc_helix_template),
  mk_str(playbook.inputs.bmc_helix_customer_first_name),
  mk_str(playbook.inputs.bmc_helix_customer_last_name),
  mk_str(playbook.inputs.bmc_helix_impact),
  mk_str(playbook.inputs.bmc_helix_urgency),
  mk_str(playbook.inputs.bmc_helix_service_type),
  mk_str(playbook.inputs.bmc_helix_status),
  mk_str(playbook.inputs.bmc_helix_reported_source),
  mk_str(playbook.inputs.bmc_helix_note),
  mk_str(playbook.inputs.bmc_helix_support_group),
  playbook.inputs.bmc_helix_additional_data.content if playbook.inputs.bmc_helix_additional_data.content else "null"
)

# set inputs
inputs.task_id = task.id
inputs.incident_id = incident.id
inputs.helix_incident_name = task.name
inputs.helix_payload = payload
```

---

## Local script - post process

### Description


### Script Type
`Local script`

### Objet Type
`task`

### Script Content
```python
from datetime import datetime
results = playbook.functions.results.create_incident

if results.get("success"):
  values = results.get("content", {}).get("values", {})

  dt_row = incident.addRow("bmc_helix_incidents")
  dt_row["soar_task_id"] = f'{results.get("inputs", {}).get("task_id")}: {results.get("inputs", {}).get("helix_incident_name")}'
  dt_row["bmc_helix_request_id"] = values.get("Request ID")
  dt_row["bmc_helix_status"] = values.get("Status")
  dt_row["bmc_helix_created_date"] = int(datetime.now().timestamp()*1000)
  dt_row["bmc_helix_assigned_to"] = values.get("Assignee")
  dt_row["bmc_helix_incident_number"] = values.get("Incident Number")
  dt_row["bmc_helix_description"] = values.get("Description")
  dt_row["bmc_helix_company"] = values.get("Company")
  dt_row["bmc_helix_organization"] = values.get("Organization")
  dt_row["bmc_helix_assigned_support_organization"] = values.get("Assigned Support Organization")
  dt_row["bmc_helix_urgency"] = values.get("Urgency")
  dt_row["bmc_helix_impact"] = values.get("Impact")
  dt_row["bmc_helix_priority"] = values.get("Priority")
```

---
