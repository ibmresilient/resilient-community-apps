<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v50.0.131
-->

# Playbook - BMC Helix: Create Helix Incident from Task - Example (PB)

### API Name
`bmc_helix_create_incident_from_task`

### Status
`enabled`

### Activation Type
`Manual`

### Activation Conditions
`-`

### Activation Form Elements
| Input Field Label | API Name | Element Type | Tooltip | Requirement |
| ----------------- | -------- | ------------ | ------- | ----------- |
| Additional Data | `bmc_helix_additional_data` | textarea | Addtional key value pairs to send to BMC Helix. Keys must match the incident schema in the BMC Helix system. | Optional |
| Customer First Name | `bmc_helix_customer_first_name` | text | First name of the affected customer | Always |
| Customer Last Name | `bmc_helix_customer_last_name` | text | Last name of the affected customer | Always |
| Impact | `bmc_helix_impact` | select | Impact to assign to the BMC Helix form | Always |
| Incident Type | `bmc_helix_incident_type` | select | Incident type to assign to the BMC Helix form | Always |
| Note | `bmc_helix_note` | text | Optionally, define the note/description of the Helix form | Optional |
| Reported Source | `bmc_helix_reported_source` | select | The originating source of this Incident. Must be configured with values present in your BMC Helix system. | Always |
| Status | `bmc_helix_status` | select | - | Always |
| Support Group | `bmc_helix_support_group` | select | Support Organization to assign the incident to | Always |
| Template | `bmc_helix_template` | select | Template to apply to the incident to prefill values | Optional |
| Urgency | `bmc_helix_urgency` | select | Urgency to assign to the BMC Helix form | Always |

### Object Type
`task`

### Description
Create a new Incident in BMC Helix from a SOAR case task


---
## Function - Helix: Create Incident

### API Name
`helix_create_incident`

### Output Name
`created_incident`

### Message Destination
`fn_bmc_helix`

### Function-Input Script
```python
def mk_str(value, quotes='"'):
  if value is None:
    return "null"
  else:
    esc_value = value.replace('"', '\\"')
    if quotes:
      return '{0}{1}{0}'.format(quotes, esc_value)
    else:
      return esc_value

payload = """{{ "ApplyTemplate": {},
  "First_Name": {},
  "Last_Name": {},
  "Impact": {},
  "Urgency": {},
  "Service_Type": {},
  "Status": {},
  "Reported Source": {},
  "Description": {},
  "Assigned Support Organization": {},
  "additional_data": {}
}}""".format(mk_str(playbook.inputs.bmc_helix_template),
  mk_str(playbook.inputs.bmc_helix_customer_first_name),
  mk_str(playbook.inputs.bmc_helix_customer_last_name),
  mk_str(playbook.inputs.bmc_helix_impact),
  mk_str(playbook.inputs.bmc_helix_urgency),
  mk_str(playbook.inputs.bmc_helix_incident_type),
  mk_str(playbook.inputs.bmc_helix_status),
  mk_str(playbook.inputs.bmc_helix_reported_source),
  mk_str(playbook.inputs.bmc_helix_note),
  mk_str(playbook.inputs.bmc_helix_support_group),
  playbook.inputs.bmc_helix_additional_data.content if getattr(playbook.inputs, "bmc_helix_additional_data").content else "null"
)

# set inputs
inputs.task_id = task.id
inputs.incident_id = incident.id
inputs.helix_incident_name = task.name
inputs.helix_payload = payload
```

---

## Local script - post process

### Description


### Script Type
`Local script`

### Object Type
`task`

### Script Content
```python
from datetime import datetime
results = playbook.functions.results.created_incident

if results.get("success"):
  values = results.get("content", {}).get("values", {})

  dt_row = incident.addRow("bmc_helix_incidents")
  dt_row["soar_task_id"] = f'{results.get("inputs", {}).get("task_id")}: {results.get("inputs", {}).get("helix_incident_name")}'
  dt_row["helix_request_id"] = values.get("Request ID")
  dt_row["helix_status"] = values.get("Status")
  dt_row["helix_created_date"] = int(datetime.now().timestamp()*1000)
  dt_row["helix_assigned_to"] = values.get("Assignee")
  dt_row["helix_incident_number"] = values.get("Incident Number")
  dt_row["helix_description"] = values.get("Description")
  dt_row["helix_company"] = values.get("Company")
  dt_row["helix_organization"] = values.get("Organization")
  dt_row["helix_assigned_support_organization"] = values.get("Assigned Support Organization")
  dt_row["helix_urgency"] = values.get("Urgency")
  dt_row["helix_impact"] = values.get("Impact")
  dt_row["helix_priority"] = values.get("Priority")
  incident.properties.bmc_helix_task_linked = True
```

---

