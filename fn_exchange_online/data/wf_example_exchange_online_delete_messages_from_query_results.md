<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-circuits codegen
-->

# Example: Exchange Online Delete Messages From Query Results

## Function - Exchange Online: Query Messages

### API Name
`exchange_online_query_emails`

### Output Name
`exo_query_results`

### Message Destination
`fn_exchange_online`

### Pre-Processing Script
```python
inputs.incident_id = incident.id

# Get the email address of the user whose mailbox will be queried.
inputs.exo_email_address = inputs.exo_email_address if rule.properties.exo_email_address_list is None else rule.properties.exo_email_address_list

# Get the search criteria from the activity rules if available. 
inputs.exo_mail_folders         = inputs.exo_mail_folders         if rule.properties.exo_mailfolder_id        is None else rule.properties.exo_mailfolder_id
inputs.exo_email_address_sender = inputs.exo_email_address_sender if rule.properties.exo_email_address_sender is None else rule.properties.exo_email_address_sender
inputs.exo_message_subject      = inputs.exo_message_subject      if rule.properties.exo_message_subject      is None else rule.properties.exo_message_subject
inputs.exo_message_body         = inputs.exo_message_body         if rule.properties.exo_message_body         is None else rule.properties.exo_message_body
inputs.exo_start_date           = inputs.exo_start_date           if rule.properties.exo_start_date           is None else rule.properties.exo_start_date
inputs.exo_end_date             = inputs.exo_end_date             if rule.properties.exo_end_date             is None else rule.properties.exo_end_date
inputs.exo_has_attachments      = inputs.exo_has_attachments      if rule.properties.exo_has_attachments      is None else rule.properties.exo_has_attachments
inputs.exo_query_output_format  = inputs.exo_query_output_format  if rule.properties.exo_query_output_format  is None else rule.properties.exo_query_output_format
```

### Post-Processing Script
```python
None
```

---

## Function - Exchange Online: Delete Messages From Query Results

### API Name
`exchange_online_delete_messages_from_query_results`

### Output Name
``

### Message Destination
`fn_exchange_online`

### Pre-Processing Script
```python
inputs.exo_query_messages_results = workflow.properties.exo_query_results['raw']

```

### Post-Processing Script
```python
from java.util import Date

content = results.get("content")
output_format = content.get("exo_query_output_format")

# Write to the data table if the user requested it.
if "Exchange Online data table" in output_format:

  user_list = content.get("delete_results")
  # Add each email as a row in the query results data table
  for user in user_list:

    for email in user.get("deleted_list"):
      message_row = incident.addRow("exo_message_query_results_dt")
      message_row.exo_dt_query_date = Date()
      message_row.exo_dt_message_id = email.id
      message_row.exo_dt_received_date   = email.receivedDateTime
      message_row.exo_dt_email_address = user.get("email_address")
      if email.sender:
        message_row.exo_dt_sender_email = email.sender.emailAddress.address
      else:
        message_row.exo_dt_sender_email = ""
      message_row.exo_dt_message_subject = email.subject
      message_row.exo_dt_has_attachments = email.hasAttachments
      message_row.exo_dt_web_link = ""
 
      text = u"""<p style= "color:{color}">{status} </p>""".format(color="red", status="Deleted")
      message_row.exo_dt_status = helper.createRichText(text)

```

---

