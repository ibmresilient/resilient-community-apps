<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v51.0.5.0.1475
-->

# Playbook - Exchange Online Move Message to Folder - Example (PB)

### API Name
`example_exchange_online_move_message_to_folder`

### Status
`enabled`

### Activation Type
`Manual`

### Activation Conditions
`exo_message_query_results_dt.exo_dt_status equals Active`

### Activation Form Elements
| Input Field Label | API Name | Element Type | Tooltip | Requirement |
| ----------------- | -------- | ------------ | ------- | ----------- |
| Well-known Folders | `exchange_online_wellknown_folders` | select | Destination folder to of moved message | Always |

### Object Type
`exo_message_query_results_dt`

### Description
This playbook will move a row-entry message in the Exchange Online Message Query Results data table to the specified user mail folder.


---
## Function - Exchange Online: Move Message to Folder

### API Name
`exchange_online_move_message_to_folder`

### Output Name
`exchange_online_move_nessage_to_folder_result`

### Message Destination
`fn_exchange_online`

### Function-Input Script
```python
inputs.exo_email_address = row.exo_dt_email_address
inputs.exo_mailfolders_id = None
inputs.exo_messages_id = row.exo_dt_message_id
inputs.exo_destination_mailfolder_id = playbook.inputs.exchange_online_wellknown_folders
```

---

## Local script - exchange_online_move_message_to_folder_post_process

### Description
Write results of move message function to a note and update the data table.

### Script Type
`Local script`

### Object Type
`exo_message_query_results_dt`

### Script Content
```python
results = playbook.functions.results.exchange_online_move_nessage_to_folder_result
email_address = results.inputs["exo_email_address"]
message_id = results.inputs["exo_messages_id"]
destination_folder = results.inputs["exo_destination_mailfolder_id"]["name"]
note_text = f"Exchange Online: Move Message to Folder:\n email address: {email_address}\n"

if results.success:
  # When a message is moved it's ID changes, so update the new message ID into the data table
  # The message status is still "Active" but the weblink is no longer valid, so make is empty string.
  new_message_id = results.content["new_message_id"]
  noteText = f"{note_text} Message has been moved to destination folder: <b>{destination_folder}</b>\n\n  Old message ID: {message_id} \n\n  New message ID: {new_message_id}"
  row['exo_dt_message_id'] = new_message_id
  row['exo_dt_web_link'] = ref_html = """<a href='{0}'>Link</a>""".format(results.content["new_web_link"])
  row['exo_dt_message_folder'] = results.inputs["exo_destination_mailfolder_id"]["name"]
else: 
  note_text = f"{note_text} FAILED to move message to folder <b>{destination_folder}</b>\n"
  error_results = results.content.get("error")

  if error_results:
    error_code = error_results.get("code", None)
    error_message = error_results.get("message", None)
    noteText = f"{note_text} error code: {error_code}\n error message: {error_message}"

incident.addNote(noteText)
```

---

