<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
    Generated with resilient-sdk v51.0.2.2.1096
-->

# Playbook - Scheduler: Schedule a Job (Artifact) (PB)

### API Name
`pb_scheduler_schedule_job_artifact`

### Status
`enabled`

### Activation Type
`Manual`

### Activation Conditions
`-`

### Activation Form Elements
| Input Field Label | API Name | Element Type | Tooltip | Requirement |
| ----------------- | -------- | ------------ | ------- | ----------- |
| is Playbook | `schedule_is_playbook` | boolean | Yes - Playbook, No - Rule | Always |
| Schedule Label Prefix | `schedule_label_prefix` | text | name of schedule for future reference | Always |
| Schedule Rule Name | `schedule_rule_name` | text | Name of Rule to schedule | Always |
| Schedule Rule Parameters | `schedule_rule_parameters` | text | field1=value;field2=value format of optional rule parameters | Optional |
| Schedule Type | `schedule_type` | select | - | Optional |
| Schedule Type Value | `schedule_type_value` | text | cron (* 5 * * *); date (yyyy/mm/dd hh:mm:ss) ; interval (10m) | Always |
| schedule_rule_type | `schedule_rule_type` | select | Required for MSSP child orgs | Optional |

### Object Type
`artifact`

### Description
Schedule a rule/playbook to run in the future for a given artifact


---
## Function - Scheduled Rule Create

### API Name
`create_a_scheduled_rule`

### Output Name
`output_scheduled_rule_create`

### Message Destination
`fn_scheduler`

### Function-Input Script
```python
inputs.object_id    = artifact.id
inputs.incident_id  = incident.id

inputs.scheduler_type         = getattr(playbook.inputs, "schedule_type", "cron")
inputs.scheduler_rule_name    = getattr(playbook.inputs, "schedule_rule_name", None)
inputs.scheduler_label_prefix = getattr(playbook.inputs, "schedule_label_prefix", None)
inputs.scheduler_is_playbook  = getattr(playbook.inputs, "schedule_is_playbook", False)

if getattr(playbook.inputs, "schedule_rule_parameters", None):
  inputs.scheduler_rule_parameters =  getattr(playbook.inputs, "schedule_rule_parameters", "") + u";artifact_type={};artifact_value={}".format(artifact.type, artifact.value)
else:
  inputs.scheduler_rule_parameters = u"artifact_type={};artifact_value={}".format(artifact.type, artifact.value)

if getattr(playbook.inputs, "schedule_type", "cron") == "date":
  # date format converted to use dashes
  inputs.scheduler_type_value = getattr(playbook.inputs, "schedule_type_value", "").replace("/", "-")
else:
  inputs.scheduler_type_value = getattr(playbook.inputs, "schedule_type_value", "")

if getattr(playbook.inputs, "schedule_rule_type", None):
  inputs.scheduler_rule_type = playbook.inputs.schedule_rule_type
```

---

## Global script - Write scheduled job to DataTable

### Description
Write out scheduled job information to a datatable

### Script Type
`Global script`

### Object Type
`incident`

### Script Content
```python
from datetime import datetime

results = playbook.functions.results.output_scheduled_rule_create
now = datetime.now().strftime("%Y-%m-%d %H:%M:%S") # '2023-03-24 11:28:34'
TYPE_LOOKUP = {
  0: 'Incident',
  1: "Task",
  4: "Artifact",
  5: "Attachment"}

if results.get("success"):
  job = results.get("content")
  row = incident.addRow("scheduler_rules")
  row['reported_on'] = now
  row['schedule_label'] = job['id']
  row['schedule_type'] = job['type']
  row['incident_id'] = job['args'][0]
  row['schedule'] = job['value']
  row['status'] = 'Active'
  row['next_run_time'] = job['next_run_time']
  row['rule_type'] = TYPE_LOOKUP.get(job['args'][6], "Datatable")
  if job['args'][8]:
    row['rule'] = "<a href='#playbooks/designer/{}'>{}</a>".format(job['args'][5], job['args'][4])
  else:
    row['rule'] = "<a href='#customize?tab=actions&id={}'>{}</a>".format(job['args'][5], job['args'][4])
else:
  incident.addNote("Schedule a Rule/Playbook failed: {}".format(result.get("reason")))
```

---

